{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# Overview\n\npuantropls is a full-stack web application designed for personnel timesheet and project management, primarily for businesses in Turkey. It enables tracking employee work hours, managing projects, handling financial transactions, and maintaining personnel records. Key features include a dark-themed interface with Turkish language support, comprehensive CRUD operations, a multi-item quote system, an integrated company directory with messaging, and a robust authentication and administrative system with data isolation. The business vision is to provide a comprehensive, user-friendly solution for managing various aspects of business operations efficiently.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\nPerformance priority: User strongly prefers minimal changes over complex optimizations that may worsen performance.\n\n# System Architecture\n\n## Frontend Architecture\n- **Framework**: React 18 with TypeScript, using Vite.\n- **Routing**: Client-side routing with Wouter.\n- **UI Framework**: Custom components based on Radix UI primitives and shadcn/ui, styled with Tailwind CSS.\n- **Design System**: Dark theme as default with CSS custom properties for theming.\n- **State Management**: TanStack Query (React Query) for server state management and caching.\n- **Form Handling**: React Hook Form with Zod for validation.\n- **Styling**: Tailwind CSS with custom color scheme and gradient utilities.\n\n## Backend Architecture\n- **Runtime**: Node.js with Express.js.\n- **Language**: TypeScript with ES modules.\n- **API Design**: RESTful API with consistent endpoint patterns.\n- **Request Handling**: Express middleware for JSON parsing and URL encoding.\n- **Error Handling**: Centralized error handling.\n\n## Data Architecture\n- **Database**: PostgreSQL with Drizzle ORM for type-safe operations.\n- **Schema Definition**: Centralized schema definitions using Drizzle and Zod.\n- **Data Validation**: Input validation using Zod schemas.\n- **Storage Layer**: Abstract storage interface for flexibility.\n- **Migrations**: Database migrations managed by Drizzle Kit.\n\n## Core Data Models\n- **Personnel**: Employee records.\n- **Projects**: Project management with client and financial details.\n- **Timesheets**: Work hour tracking.\n- **Transactions**: Financial records (income/expenses).\n- **Notes**: General note-taking.\n- **Contractors**: External contractor management.\n- **Quotes**: Multi-item customer quote system with detailed line items and calculations.\n- **Company Directory**: Company listings for inter-company communication.\n- **Messages**: Real-time messaging and conversation storage.\n- **Users**: User authentication, roles, and session management.\n\n## Authentication & Security\n- Custom email/password authentication system.\n- Role-based access control with an admin system.\n- Complete user data isolation, ensuring users only access their own data.\n- Persistent session management using database storage.\n- Request validation via Zod schemas and type-safe API contracts.\n\n## Key Features Implemented\n- Multi-Item Quote System with Excel/PDF export and editable terms.\n- Robust Authentication and Role-Based Admin System.\n- Comprehensive Data Isolation ensuring user-specific data.\n- Company Directory with Real-time Messaging.\n- Persistent Session Management.\n- Integrated Personnel and Contractor Payment Systems with automatic cash management.\n- Enhanced Messaging Notification System with direct routing.\n- Turkish character support throughout the application, including exports.\n- PDF Export Turkish Character Support - implemented normalization function to handle ç, ğ, ı, ö, ş, ü characters in PDF reports with proper Helvetica font usage.\n- Compact Dropdown UI for messaging - converted long conversation lists to space-efficient dropdown menus in both Messages page and Enhanced Company Directory.\n- Real-time Search System for Messages - implemented working search functionality with instant filtering of companies as you type, replacing dropdown with interactive list view.\n- Optimized Conversation List Heights - dramatically reduced messaging interface heights: Messages page (80px) and Enhanced Company Directory (80px from 500px), achieving significant space savings while maintaining usability.\n- Bulk SMS System with NetGSM Integration - implemented comprehensive toplu SMS functionality with template management (20+ templates including campaign and holiday templates), recipient selection with dropdown format, cost calculation, SMS history tracking, real NetGSM API integration, and dynamic send button for personnel and customer notifications.\n- User Account Management System - implemented comprehensive \"Hesabım\" (My Account) page for all users with profile editing (name, email), password change functionality, profile picture management, notifications preferences, and system preferences tabs. Accessible via blue header button for all authenticated users, with backend API endpoints for profile updates and password changes.\n- Admin Payment Settings System - fully functional payment information management where admin can set bank details (bank name, account holder, IBAN, amount) and normal users can view these settings in their account page for PRO subscription payments. Fixed endpoint routing to use /api/payment-info for users instead of admin endpoints.\n- Authentication Performance Optimization (Aug 16, 2025) - Dramatically improved login/logout speed by removing unnecessary company creation operations during authentication. Login time reduced from 2665ms to 345ms (8x improvement). Simplified auth endpoints for better performance.\n- PRO Subscription System Implementation (Aug 16, 2025) - Added comprehensive subscription tier system with DEMO (default) and PRO (paid) user levels. Features include: PRO upgrade endpoint (/api/auth/upgrade-to-pro), subscription badge in header, dedicated Abonelik tab in user account page, PyTR payment integration (₺99/year), one-click payment confirmation system, and payment notifications displayed prominently in admin dashboard with real-time stats and recent activity tracking.\n- Real-time Notification System Enhancement (Aug 16, 2025) - Implemented comprehensive notification system in header with Bell icon, unread notification counter, dropdown menu with notification details, automatic mark-as-read functionality, and direct navigation to message threads. Notifications refresh every 3 seconds and display sender information, timestamps, and read status. System fully operational with cookie-based authentication integration.\n- Notification Authentication Fix (Aug 16, 2025) - Resolved notification API authentication issues by updating useAuth hook to support cookie-based authentication instead of localStorage sessionId dependency. Fixed apiRequest function to work with credentials: 'include' for seamless cookie authentication. Notification system now fully functional with real-time updates.\n- Login/Logout System Recovery (Aug 16, 2025) - Fixed critical authentication system failure where login/logout was completely broken with blank pages and continuous 401 errors. Resolved by optimizing useAuth hook to only make API calls when sessionId exists, preventing infinite loading states and enabling proper landing page display. Authentication system now fully operational with smooth login flow and dashboard access.\n\n# External Dependencies\n\n## Database\n- **Neon Database**: Serverless PostgreSQL hosting.\n- **Drizzle ORM**: Type-safe ORM.\n- **connect-pg-simple**: PostgreSQL session store.\n\n## UI & Styling\n- **Radix UI**: Accessible UI primitives.\n- **Tailwind CSS**: Utility-first CSS framework.\n- **Lucide React**: Icon library.\n- **Inter Font**: Typography via Google Fonts.\n\n## Development Tools\n- **Vite**: Build tool and development server.\n- **TypeScript**: Static type checking.\n- **ESBuild**: Fast JavaScript bundler.\n- **PostCSS**: CSS processing.\n\n## State Management & API\n- **TanStack Query**: Server state management.\n- **React Hook Form**: Form state management.\n- **Zod**: Runtime type validation.\n\n## Development Environment\n- **Replit Integration**: Optimizations for the Replit platform.","size_bytes":8162},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        'dark-primary': \"var(--dark-primary)\",\n        'dark-secondary': \"var(--dark-secondary)\",\n        'dark-accent': \"var(--dark-accent)\",\n        'orange-start': \"var(--orange-start)\",\n        'orange-end': \"var(--orange-end)\",\n        'teal-start': \"var(--teal-start)\",\n        'teal-end': \"var(--teal-end)\",\n        'purple-start': \"var(--purple-start)\",\n        'purple-end': \"var(--purple-end)\",\n        'blue-start': \"var(--blue-start)\",\n        'blue-end': \"var(--blue-end)\",\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2551},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport cookieParser from \"cookie-parser\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\n// CORS middleware for cookie sharing - explicit origin for credentials\napp.use((req, res, next) => {\n  const origin = req.headers.origin;\n  if (origin) {\n    res.header('Access-Control-Allow-Origin', origin);\n  }\n  res.header('Access-Control-Allow-Credentials', 'true');\n  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');\n  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n  \n  if (req.method === 'OPTIONS') {\n    res.sendStatus(200);\n  } else {\n    next();\n  }\n});\n\napp.use(cookieParser('puantajpro-secret-key'));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2715},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./auth\";\nimport { z } from \"zod\";\nimport crypto from \"crypto\";\nimport multer from \"multer\";\nimport nodemailer from \"nodemailer\";\nimport { \n  insertPersonnelSchema, \n  insertProjectSchema, \n  insertTimesheetSchema, \n  insertTransactionSchema,\n  insertNoteSchema,\n  insertContractorSchema,\n  insertCustomerSchema,\n  insertCustomerTaskSchema,\n  insertCustomerQuoteSchema,\n  insertCustomerQuoteItemSchema,\n  insertCustomerPaymentSchema,\n  insertContractorTaskSchema,\n  insertContractorPaymentSchema,\n  insertInvoiceSchema,\n  insertInvoiceItemSchema,\n  insertReportSchema,\n  insertPersonnelPaymentSchema,\n  insertCompanyDirectorySchema,\n  insertMessageSchema,\n  insertNotificationSchema,\n  insertCompanyBlockSchema,\n  insertCompanyMuteSchema,\n  insertAbuseReportSchema,\n  insertFirmInviteSchema,\n  insertPresenceLogSchema,\n  insertMessageDraftSchema,\n  insertAutoResponderSchema,\n  insertDirectThreadSchema,\n  insertDirectMessageSchema,\n  insertImageUploadSchema,\n  insertSMSHistorySchema,\n  insertSMSTemplateSchema,\n  insertPaymentNotificationSchema,\n  insertPaymentSettingsSchema\n} from \"@shared/schema\";\n\n// Helper function to update quote total\nasync function updateQuoteTotal(quoteId: string) {\n  try {\n    const items = await storage.getCustomerQuoteItemsByQuoteId(quoteId);\n    const totalAmount = items.reduce((sum, item) => sum + parseFloat(item.totalPrice), 0);\n    \n    const quotes = await storage.getCustomerQuotes();\n    const quote = quotes.find(q => q.id === quoteId);\n    \n    if (quote) {\n      const vatAmount = quote.hasVAT ? (totalAmount * parseFloat(quote.vatRate || \"0\") / 100) : 0;\n      const totalWithVAT = totalAmount + vatAmount;\n      \n      await storage.updateCustomerQuote(quoteId, {\n        totalAmount: totalAmount.toString(),\n        vatAmount: vatAmount.toString(),\n        totalWithVAT: totalWithVAT.toString()\n      });\n    }\n  } catch (error) {\n    console.error(\"Error updating quote total:\", error);\n  }\n}\n\n// Maintenance mode middleware - check before auth\nconst checkMaintenanceMode = async (req: any, res: any, next: any) => {\n  try {\n    // Skip maintenance check for auth endpoints, admin endpoints, and maintenance status\n    if (req.path.startsWith('/api/auth') || \n        req.path.startsWith('/api/admin') || \n        req.path === '/api/maintenance/status') {\n      return next();\n    }\n\n    const settings = await storage.getSystemSettings();\n    const maintenanceSetting = settings.find(s => s.key === 'maintenance_mode');\n    \n    // Handle both string and JSON value formats\n    let isMaintenanceMode = false;\n    if (maintenanceSetting) {\n      if (typeof maintenanceSetting.value === 'string') {\n        isMaintenanceMode = maintenanceSetting.value === \"true\";\n      } else {\n        isMaintenanceMode = maintenanceSetting.value === true || maintenanceSetting.value === \"true\";\n      }\n    }\n    \n    if (isMaintenanceMode) {\n      return res.status(503).json({\n        message: \"Sistem bakım modunda. Lütfen daha sonra tekrar deneyin.\",\n        maintenance: true\n      });\n    }\n    \n    next();\n  } catch (error) {\n    console.error('Maintenance check error:', error);\n    next();\n  }\n};\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth middleware\n  await setupAuth(app);\n  \n  // Logout endpoint - support both GET and POST\n  app.get(\"/api/auth/logout\", async (req, res) => {\n    try {\n      // Clear all cookies and redirect\n      res.clearCookie('sessionId');\n      res.clearCookie('connect.sid');\n      \n      res.send(`\n        <html>\n          <head>\n            <title>Çıkış</title>\n            <script>\n              localStorage.clear();\n              sessionStorage.clear();\n              window.location.href = '/';\n            </script>\n          </head>\n          <body>\n            <p>Çıkış yapılıyor...</p>\n          </body>\n        </html>\n      `);\n    } catch (error) {\n      console.error('Logout error:', error);\n      res.status(500).send('Logout failed');\n    }\n  });\n\n  app.post(\"/api/auth/logout\", async (req, res) => {\n    try {\n      const sessionId = req.headers.authorization?.replace('Bearer ', '');\n      \n      if (sessionId) {\n        // Delete session from database\n        await storage.deleteUserSession(sessionId);\n      }\n      \n      res.json({ success: true, message: \"Logged out successfully\" });\n    } catch (error) {\n      console.error('Logout error:', error);\n      res.status(500).json({ message: \"Logout failed\" });\n    }\n  });\n\n  // Maintenance mode check endpoint - BEFORE middleware\n  app.get(\"/api/maintenance/status\", async (req, res) => {\n    try {\n      const settings = await storage.getSystemSettings();\n      const maintenanceSetting = settings.find(s => s.key === 'maintenance_mode');\n      \n      let isMaintenanceMode = false;\n      if (maintenanceSetting) {\n        if (typeof maintenanceSetting.value === 'string') {\n          isMaintenanceMode = maintenanceSetting.value === \"true\";\n        } else {\n          isMaintenanceMode = maintenanceSetting.value === true || maintenanceSetting.value === \"true\";\n        }\n      }\n      \n      // Always return 200 for status check, regardless of maintenance mode\n      res.json({ \n        maintenance: isMaintenanceMode,\n        message: isMaintenanceMode ? \"Sistem bakım modunda\" : \"Sistem normal çalışıyor\"\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Maintenance status check failed\" });\n    }\n  });\n\n  // Apply maintenance mode check to all routes except auth and admin\n  app.use(checkMaintenanceMode);\n\n  // Subscription upgrade endpoint\n  app.post(\"/api/auth/upgrade-to-pro\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { paymentConfirmed } = req.body;\n      \n      if (!paymentConfirmed) {\n        return res.status(400).json({ message: \"Ödeme onayı gereklidir\" });\n      }\n      \n      // Update user to PRO subscription\n      const updatedUser = await storage.updateUserSubscription(userId, {\n        subscriptionType: \"PRO\",\n        subscriptionStatus: \"ACTIVE\",\n        subscriptionEndDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000) // 1 year from now\n      });\n      \n      if (!updatedUser) {\n        return res.status(404).json({ message: \"Kullanıcı bulunamadı\" });\n      }\n      \n      res.json({ \n        success: true, \n        message: \"Hesabınız PRO'ya yükseltildi!\",\n        user: updatedUser \n      });\n    } catch (error) {\n      console.error(\"PRO upgrade error:\", error);\n      res.status(500).json({ message: \"PRO yükseltme başarısız\" });\n    }\n  });\n\n  // Auth endpoints handled in auth.ts\n  // Personnel routes\n  app.get(\"/api/personnel\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const personnel = await storage.getPersonnelByUserId(userId);\n      res.json(personnel);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch personnel\" });\n    }\n  });\n\n  app.post(\"/api/personnel\", isAuthenticated, async (req, res) => {\n    try {\n      console.log(\"Personnel request body:\", req.body);\n      const userId = (req as any).user.id;\n      // Convert string date to Date object\n      const processedBody = {\n        ...req.body,\n        startDate: new Date(req.body.startDate)\n      };\n      const validatedData = insertPersonnelSchema.parse(processedBody);\n      // Add userId for database insertion\n      const personnelData = {\n        ...validatedData,\n        userId\n      };\n      const personnel = await storage.createPersonnel(personnelData);\n      res.status(201).json(personnel);\n    } catch (error) {\n      console.error(\"Personnel validation error:\", error);\n      res.status(400).json({ message: \"Invalid personnel data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/personnel/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      // Convert string date to Date object if present\n      const processedBody = {\n        ...req.body,\n        ...(req.body.startDate && { startDate: new Date(req.body.startDate) })\n      };\n      const validatedData = insertPersonnelSchema.partial().parse(processedBody);\n      const personnel = await storage.updatePersonnel(id, validatedData);\n      if (!personnel) {\n        return res.status(404).json({ message: \"Personnel not found\" });\n      }\n      res.json(personnel);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid personnel data\" });\n    }\n  });\n\n  app.delete(\"/api/personnel/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deletePersonnel(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Personnel not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete personnel\" });\n    }\n  });\n\n  // Projects routes\n  app.get(\"/api/projects\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const projects = await storage.getProjectsByUserId(userId);\n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch projects\" });\n    }\n  });\n\n  app.post(\"/api/projects\", isAuthenticated, async (req, res) => {\n    try {\n      console.log(\"Project request body:\", req.body);\n      const userId = (req as any).user.id;\n      // Convert string date to Date object\n      const processedBody = {\n        ...req.body,\n        startDate: new Date(req.body.startDate)\n      };\n      const validatedData = insertProjectSchema.parse(processedBody);\n      // Add userId for database insertion\n      const projectData = {\n        ...validatedData,\n        userId\n      };\n      const project = await storage.createProject(projectData);\n      res.status(201).json(project);\n    } catch (error) {\n      console.error(\"Project validation error:\", error);\n      res.status(400).json({ message: \"Invalid project data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/projects/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      // Convert string date to Date object if present\n      const processedBody = {\n        ...req.body,\n        ...(req.body.startDate && { startDate: new Date(req.body.startDate) })\n      };\n      const validatedData = insertProjectSchema.partial().parse(processedBody);\n      const project = await storage.updateProject(id, validatedData);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json(project);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid project data\" });\n    }\n  });\n\n  app.delete(\"/api/projects/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteProject(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete project\" });\n    }\n  });\n\n  // Timesheets routes\n  app.get(\"/api/timesheets\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const timesheets = await storage.getTimesheetsByUserId(userId);\n      res.json(timesheets);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch timesheets\" });\n    }\n  });\n\n  app.get(\"/api/timesheets/personnel/:personnelId\", async (req, res) => {\n    try {\n      const { personnelId } = req.params;\n      const timesheets = await storage.getTimesheetsByPersonnel(personnelId);\n      res.json(timesheets);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch timesheets\" });\n    }\n  });\n\n  app.post(\"/api/timesheets\", isAuthenticated, async (req: any, res) => {\n    try {\n      console.log(\"Timesheet request body:\", req.body);\n      const userId = req.user.id;\n      \n      // Verify the personnel belongs to the user\n      const personnel = await storage.getPersonnelByUserId(userId);\n      const personnelExists = personnel.some(p => p.id === req.body.personnelId);\n      \n      if (!personnelExists) {\n        return res.status(403).json({ message: \"Access denied - Personnel not found\" });\n      }\n      \n      // Convert string date to Date object and add userId\n      const processedBody = {\n        ...req.body,\n        userId: userId,\n        date: new Date(req.body.date)\n      };\n      // Create a server-side schema that includes userId\n      const serverTimesheetSchema = insertTimesheetSchema.extend({\n        userId: z.string()\n      });\n      const validatedData = serverTimesheetSchema.parse(processedBody);\n      const timesheet = await storage.createTimesheet(validatedData);\n      res.status(201).json(timesheet);\n    } catch (error) {\n      console.error(\"Timesheet validation error:\", error);\n      res.status(400).json({ message: \"Invalid timesheet data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/timesheets/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      console.log(\"Timesheet update request body:\", req.body);\n      \n      // Convert string date to Date object\n      const processedBody = {\n        ...req.body,\n        date: new Date(req.body.date)\n      };\n      \n      // Get personnel info for wage calculation\n      const personnel = await storage.getPersonnel();\n      const person = personnel.find(p => p.id === processedBody.personnelId);\n      \n      if (!person) {\n        return res.status(400).json({ message: \"Personnel not found\" });\n      }\n      \n      // Calculate wages based on work type and salary type\n      const dailySalary = person.salary ? parseFloat(person.salary) : 0;\n      const salaryType = person.salaryType || \"monthly\";\n      const dailyWage = salaryType === \"daily\" ? dailySalary : dailySalary / 30;\n      \n      let calculatedDailyWage = 0;\n      const hourlyRate = dailyWage / 8; // 8 hour work day\n      \n      if (processedBody.workType === \"tam\") {\n        calculatedDailyWage = dailyWage;\n      } else if (processedBody.workType === \"yarim\") {\n        calculatedDailyWage = dailyWage / 2;\n      } else if (processedBody.workType === \"mesai\") {\n        const overtimeHours = parseFloat(processedBody.overtimeHours || \"0\");\n        calculatedDailyWage = hourlyRate * overtimeHours;\n      }\n      \n      // Add calculated wages to processed body\n      const enhancedBody = {\n        ...processedBody,\n        hourlyRate: hourlyRate.toFixed(2),\n        dailyWage: calculatedDailyWage.toFixed(2)\n      };\n      \n      const validatedData = insertTimesheetSchema.parse(enhancedBody);\n      const timesheet = await storage.updateTimesheet(id, validatedData);\n      if (!timesheet) {\n        return res.status(404).json({ message: \"Timesheet not found\" });\n      }\n      res.json(timesheet);\n    } catch (error) {\n      console.error(\"Timesheet update error:\", error);\n      res.status(400).json({ message: \"Invalid timesheet data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.delete(\"/api/timesheets/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteTimesheet(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Timesheet not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete timesheet\" });\n    }\n  });\n\n  // Transactions routes\n  app.get(\"/api/transactions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const transactions = await storage.getTransactionsByUserId(userId);\n      res.json(transactions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch transactions\" });\n    }\n  });\n\n  app.post(\"/api/transactions\", isAuthenticated, async (req: any, res) => {\n    try {\n      console.log(\"Transaction request body:\", req.body);\n      // Convert string date to Date object\n      const processedBody = {\n        ...req.body,\n        date: new Date(req.body.date),\n        userId: req.user.id\n      };\n      const validatedData = insertTransactionSchema.parse(processedBody);\n      const transaction = await storage.createTransaction(validatedData);\n      res.status(201).json(transaction);\n    } catch (error) {\n      console.error(\"Transaction validation error:\", error);\n      res.status(400).json({ message: \"Invalid transaction data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.delete(\"/api/transactions/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteTransaction(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Transaction not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Transaction deletion error:\", error);\n      res.status(500).json({ message: \"Failed to delete transaction\" });\n    }\n  });\n\n  // Notes routes\n  app.get(\"/api/notes\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      // For now, filter notes by userId if we have that field, otherwise return all\n      const notes = await storage.getNotes();\n      res.json(notes);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch notes\" });\n    }\n  });\n\n  app.post(\"/api/notes\", async (req, res) => {\n    try {\n      const validatedData = insertNoteSchema.parse(req.body);\n      const note = await storage.createNote(validatedData);\n      res.status(201).json(note);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid note data\" });\n    }\n  });\n\n  app.delete(\"/api/notes/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteNote(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Note not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete note\" });\n    }\n  });\n\n  // Contractors routes\n  app.get(\"/api/contractors\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      // For now, return all contractors - later we can add userId filtering\n      const contractors = await storage.getContractors();\n      res.json(contractors);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch contractors\" });\n    }\n  });\n\n  app.post(\"/api/contractors\", async (req, res) => {\n    try {\n      const validatedData = insertContractorSchema.parse(req.body);\n      const contractor = await storage.createContractor(validatedData);\n      res.status(201).json(contractor);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid contractor data\" });\n    }\n  });\n\n  // Financial summary endpoint\n  app.get(\"/api/financial-summary\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const transactions = await storage.getTransactionsByUserId(userId);\n      const customerTasks = await storage.getCustomerTasksByUserId(userId);\n      const customerPayments = await storage.getCustomerPaymentsByUserId(userId);\n      const customerQuotes = await storage.getCustomerQuotesByUserId(userId);\n      \n      console.log(\"All transactions:\", transactions.map(t => ({ type: t.type, amount: t.amount, description: t.description })));\n\n      const income = transactions\n        .filter(t => t.type === \"income\")\n        .reduce((sum, t) => sum + parseFloat(t.amount.toString()), 0);\n\n      const expenses = transactions\n        .filter(t => t.type === \"expense\")\n        .reduce((sum, t) => sum + parseFloat(t.amount.toString()), 0);\n\n      // Calculate customer tasks totals\n      const customerTasksTotal = customerTasks.reduce((sum, task) => sum + parseFloat(task.amount), 0);\n      const pendingTasks = customerTasks.filter(task => task.status === \"pending\" || task.status === \"active\" || task.status === \"in_progress\").length;\n      const completedTasks = customerTasks.filter(task => task.status === \"completed\").length;\n\n      // Calculate customer quotes totals (using totalAmount for KDV hariç amounts on dashboard)\n      const totalQuoteValue = customerQuotes.reduce((sum, quote) => sum + parseFloat(quote.totalAmount || '0'), 0);\n      const approvedQuoteValue = customerQuotes.filter(q => q.isApproved).reduce((sum, quote) => sum + parseFloat(quote.totalAmount || '0'), 0);\n      const pendingQuoteValue = customerQuotes.filter(q => !q.isApproved).reduce((sum, quote) => sum + parseFloat(quote.totalAmount || '0'), 0);\n      const approvedQuotes = customerQuotes.filter(q => q.isApproved).length;\n      const pendingQuotes = customerQuotes.filter(q => !q.isApproved).length;\n\n      // Calculate customer payments totals\n      const customerPaymentsTotal = customerPayments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0);\n      const thisMonth = new Date();\n      const thisMonthPayments = customerPayments.filter(payment => {\n        const paymentDate = new Date(payment.paymentDate);\n        return paymentDate.getMonth() === thisMonth.getMonth() && \n               paymentDate.getFullYear() === thisMonth.getFullYear();\n      }).reduce((sum, payment) => sum + parseFloat(payment.amount), 0);\n\n      const summary = {\n        totalIncome: income,\n        totalExpenses: expenses,\n        netBalance: income - expenses,\n        customerTasks: {\n          total: customerTasksTotal,\n          pending: pendingTasks,\n          completed: completedTasks,\n        },\n        customerQuotes: {\n          total: pendingQuoteValue, // Show only pending quotes total in dashboard\n          approved: approvedQuoteValue,\n          pending: pendingQuoteValue,\n          approvedCount: approvedQuotes,\n          pendingCount: pendingQuotes\n        },\n        customerPayments: {\n          total: customerPaymentsTotal,\n          thisMonth: thisMonthPayments,\n          count: customerPayments.length,\n        }\n      };\n\n      console.log(\"Financial summary:\", summary);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Financial summary error:\", error);\n      res.status(500).json({ message: \"Failed to fetch financial summary\" });\n    }\n  });\n\n  // Customers routes\n  app.get(\"/api/customers\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const customers = await storage.getCustomersByUserId(userId);\n      res.json(customers);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customers\" });\n    }\n  });\n\n  app.post(\"/api/customers\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const validatedData = insertCustomerSchema.parse(req.body);\n      // Add userId for database insertion\n      const customerData = {\n        ...validatedData,\n        userId\n      };\n      const customer = await storage.createCustomer(customerData);\n      res.status(201).json(customer);\n    } catch (error) {\n      console.error(\"Customer validation error:\", error);\n      res.status(400).json({ message: \"Invalid customer data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/customers/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const validatedData = insertCustomerSchema.partial().parse(req.body);\n      const customer = await storage.updateCustomer(id, validatedData);\n      if (!customer) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      res.json(customer);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid customer data\" });\n    }\n  });\n\n  app.delete(\"/api/customers/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteCustomer(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete customer\" });\n    }\n  });\n\n  // Customer Tasks routes\n  app.get(\"/api/customer-tasks\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const tasks = await storage.getCustomerTasksByUserId(userId);\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer tasks\" });\n    }\n  });\n\n  app.get(\"/api/customer-tasks/customer/:customerId\", async (req, res) => {\n    try {\n      const { customerId } = req.params;\n      const tasks = await storage.getCustomerTasksByCustomerId(customerId);\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer tasks\" });\n    }\n  });\n\n  app.post(\"/api/customer-tasks\", async (req, res) => {\n    try {\n      const processedBody = {\n        ...req.body,\n        ...(req.body.dueDate && { dueDate: new Date(req.body.dueDate) })\n      };\n      const validatedData = insertCustomerTaskSchema.parse(processedBody);\n      const task = await storage.createCustomerTask(validatedData);\n      res.status(201).json(task);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid task data\" });\n    }\n  });\n\n  app.put(\"/api/customer-tasks/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const processedBody = {\n        ...req.body,\n        ...(req.body.dueDate && { dueDate: new Date(req.body.dueDate) })\n      };\n      const validatedData = insertCustomerTaskSchema.partial().parse(processedBody);\n      const task = await storage.updateCustomerTask(id, validatedData);\n      if (!task) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n      res.json(task);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid task data\" });\n    }\n  });\n\n  app.delete(\"/api/customer-tasks/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteCustomerTask(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete task\" });\n    }\n  });\n\n  // Customer Payments routes\n  app.get(\"/api/customer-payments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const payments = await storage.getCustomerPaymentsByUserId(userId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer payments\" });\n    }\n  });\n\n  app.get(\"/api/customer-payments/customer/:customerId\", async (req, res) => {\n    try {\n      const { customerId } = req.params;\n      const payments = await storage.getCustomerPaymentsByCustomerId(customerId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer payments\" });\n    }\n  });\n\n  app.post(\"/api/customer-payments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const processedBody = {\n        ...req.body,\n        paymentDate: new Date(req.body.paymentDate)\n      };\n      const validatedData = insertCustomerPaymentSchema.parse(processedBody);\n      \n      // Create the customer payment\n      const payment = await storage.createCustomerPayment(validatedData);\n      \n      // Get customer name for the transaction description\n      const customer = await storage.getCustomer(validatedData.customerId);\n      const customerName = customer?.name || \"Bilinmeyen Müşteri\";\n      \n      // Create a corresponding income transaction\n      const incomeTransaction = {\n        type: \"income\" as const,\n        amount: validatedData.amount,\n        description: `${customerName} - Müşteri Ödemesi: ${validatedData.description}`,\n        date: validatedData.paymentDate,\n        category: \"Müşteri Ödemesi\",\n        userId: req.user.id\n      };\n      \n      // Add the income transaction to the system\n      await storage.createTransaction(incomeTransaction);\n      \n      res.status(201).json(payment);\n    } catch (error) {\n      console.error(\"Payment creation error:\", error);\n      res.status(400).json({ message: \"Invalid payment data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.delete(\"/api/customer-payments/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      \n      // Get payment details before deletion\n      const payment = await storage.getCustomerPayment(id);\n      if (!payment) {\n        return res.status(404).json({ message: \"Payment not found\" });\n      }\n      \n      // Get customer name for transaction lookup\n      const customer = await storage.getCustomer(payment.customerId);\n      const customerName = customer?.name || \"Bilinmeyen Müşteri\";\n      \n      // Find and delete related transaction\n      const transactions = await storage.getTransactions();\n      const relatedTransaction = transactions.find(t => \n        t.type === \"income\" && \n        t.description.includes(customerName) && \n        t.description.includes(\"Müşteri Ödemesi\") &&\n        Math.abs(parseFloat(t.amount.toString()) - parseFloat(payment.amount.toString())) < 0.01 &&\n        new Date(t.date).toDateString() === new Date(payment.paymentDate).toDateString()\n      );\n      \n      if (relatedTransaction) {\n        await storage.deleteTransaction(relatedTransaction.id);\n      }\n      \n      // Delete the payment\n      const deleted = await storage.deleteCustomerPayment(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Payment not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Customer payment deletion error:\", error);\n      res.status(500).json({ message: \"Failed to delete payment\" });\n    }\n  });\n\n  // Customer Quotes routes\n  app.get(\"/api/customer-quotes\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const quotes = await storage.getCustomerQuotesByUserId(userId);\n      res.json(quotes);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer quotes\" });\n    }\n  });\n\n  app.get(\"/api/customer-quotes/customer/:customerId\", async (req, res) => {\n    try {\n      const { customerId } = req.params;\n      const quotes = await storage.getCustomerQuotesByCustomerId(customerId);\n      res.json(quotes);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer quotes\" });\n    }\n  });\n\n  app.post(\"/api/customer-quotes\", async (req, res) => {\n    try {\n      console.log(\"Quote creation request body:\", req.body);\n      const processedBody = {\n        ...req.body,\n        quoteDate: new Date(req.body.quoteDate),\n        validUntil: req.body.validUntil ? new Date(req.body.validUntil) : null\n      };\n      console.log(\"Processed quote body:\", processedBody);\n      const validatedData = insertCustomerQuoteSchema.parse(processedBody);\n      console.log(\"Validated quote data:\", validatedData);\n      const quote = await storage.createCustomerQuote(validatedData);\n      console.log(\"Created quote result:\", quote);\n      \n      // Ensure proper serialization by creating a plain object\n      const serializedQuote = {\n        ...quote,\n        id: quote.id,\n        customerId: quote.customerId,\n        title: quote.title,\n        description: quote.description,\n        totalAmount: quote.totalAmount,\n        hasVAT: quote.hasVAT,\n        vatRate: quote.vatRate,\n        vatAmount: quote.vatAmount,\n        totalWithVAT: quote.totalWithVAT,\n        status: quote.status,\n        isApproved: quote.isApproved,\n        quoteDate: quote.quoteDate,\n        validUntil: quote.validUntil,\n        createdAt: quote.createdAt,\n        updatedAt: quote.updatedAt\n      };\n      console.log(\"Serialized quote for response:\", serializedQuote);\n      res.status(201).json(serializedQuote);\n    } catch (error) {\n      console.error(\"Customer quote creation error:\", error);\n      res.status(400).json({ message: \"Invalid customer quote data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/customer-quotes/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      console.log(\"Quote update request body:\", req.body);\n      const processedBody = {\n        ...req.body,\n        ...(req.body.quoteDate && { quoteDate: new Date(req.body.quoteDate) }),\n        ...(req.body.validUntil && { validUntil: new Date(req.body.validUntil) })\n      };\n      console.log(\"Processed quote update body:\", processedBody);\n      const validatedData = insertCustomerQuoteSchema.partial().parse(processedBody);\n      \n      const quote = await storage.updateCustomerQuote(id, validatedData);\n      if (!quote) {\n        return res.status(404).json({ message: \"Customer quote not found\" });\n      }\n      \n      // If the entire quote is being approved, create a customer task for the total quote\n      if (validatedData.isApproved === true && validatedData.status === 'approved') {\n        // Check if there's already a task for this specific quote to prevent duplicates\n        const existingTasks = await storage.getCustomerTasks();\n        const quoteTaskExists = existingTasks.some(task => \n          task.customerId === quote.customerId && \n          (task.title === quote.title || task.title === `${quote.title} (Onaylanan Teklif)`)\n        );\n        \n        console.log(\"Checking for existing task:\", {\n          quoteTitle: quote.title,\n          customerId: quote.customerId,\n          existingTasks: existingTasks.filter(t => t.customerId === quote.customerId).map(t => t.title),\n          taskExists: quoteTaskExists\n        });\n        \n        if (!quoteTaskExists) {\n          console.log(\"Creating task for approved quote:\", quote.title);\n          // Use totalWithVAT if available (for VAT-inclusive quotes), otherwise use totalAmount\n          const finalAmount = quote.hasVAT ? (quote.totalWithVAT || quote.totalAmount) : quote.totalAmount;\n          \n          // Get quote items to calculate proper unitPrice and quantity\n          const quoteItems = await storage.getCustomerQuoteItemsByQuoteId(id);\n          let totalQuantity = 1;\n          let calculatedUnitPrice = parseFloat(finalAmount);\n          let primaryUnit = \"adet\";\n          \n          if (quoteItems.length > 0) {\n            // Sum all quantities and take the first unit as primary\n            totalQuantity = quoteItems.reduce((sum, item) => sum + parseFloat(item.quantity), 0);\n            primaryUnit = quoteItems[0].unit;\n            // Calculate unit price based on total amount / total quantity\n            calculatedUnitPrice = parseFloat(finalAmount) / totalQuantity;\n          }\n          \n          const taskData = {\n            customerId: quote.customerId,\n            title: `${quote.title} (Onaylanan Teklif)`,\n            description: quote.description || `Teklif onaylandı: ${quote.title}`,\n            quantity: totalQuantity,\n            unit: primaryUnit,\n            unitPrice: calculatedUnitPrice,\n            amount: finalAmount || '0',\n            status: \"pending\" as const,\n            dueDate: null\n          };\n          await storage.createCustomerTask(taskData);\n          console.log(\"Task created successfully for quote:\", quote.title);\n        } else {\n          console.log(\"Task already exists for quote:\", quote.title, \"- skipping creation\");\n        }\n      }\n      \n      res.json(quote);\n    } catch (error) {\n      console.error(\"Customer quote update error:\", error);\n      res.status(400).json({ \n        message: \"Invalid customer quote data\", \n        error: error instanceof Error ? error.message : String(error),\n        requestBody: req.body\n      });\n    }\n  });\n\n  app.delete(\"/api/customer-quotes/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteCustomerQuote(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Customer quote not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete customer quote\" });\n    }\n  });\n\n  // Customer Quote Items routes\n  app.get(\"/api/customer-quote-items/quote/:quoteId\", async (req, res) => {\n    try {\n      const { quoteId } = req.params;\n      const items = await storage.getCustomerQuoteItemsByQuoteId(quoteId);\n      res.json(items);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch quote items\" });\n    }\n  });\n\n  app.post(\"/api/customer-quote-items\", async (req, res) => {\n    try {\n      console.log(\"Quote item request body:\", req.body);\n      \n      // Convert numeric values to strings for decimal fields\n      const processedBody = {\n        ...req.body,\n        unitPrice: req.body.unitPrice?.toString() || \"0\",\n        totalPrice: req.body.totalPrice?.toString() || \"0\",\n        quantity: req.body.quantity?.toString() || \"1.00\"\n      };\n      \n      console.log(\"Processed quote item body:\", processedBody);\n      const validatedData = insertCustomerQuoteItemSchema.parse(processedBody);\n      const item = await storage.createCustomerQuoteItem(validatedData);\n      \n      // Update quote total after creating item\n      await updateQuoteTotal(validatedData.quoteId);\n      \n      res.status(201).json(item);\n    } catch (error) {\n      console.error(\"Quote item validation error:\", error);\n      res.status(400).json({ \n        message: \"Invalid quote item data\", \n        error: error instanceof Error ? error.message : String(error),\n        originalBody: req.body \n      });\n    }\n  });\n\n  app.put(\"/api/customer-quote-items/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const validatedData = insertCustomerQuoteItemSchema.partial().parse(req.body);\n      \n      // Get the item first to know the quote ID\n      const items = await storage.getCustomerQuoteItems();\n      const currentItem = items.find(item => item.id === id);\n      \n      // Just update the quote item status - NO automatic task creation for individual items\n      const item = await storage.updateCustomerQuoteItem(id, validatedData);\n      if (!item) {\n        return res.status(404).json({ message: \"Quote item not found\" });\n      }\n      \n      // Update quote total after updating item\n      if (currentItem) {\n        await updateQuoteTotal(currentItem.quoteId);\n      }\n      \n      res.json(item);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid quote item data\" });\n    }\n  });\n\n  app.delete(\"/api/customer-quote-items/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteCustomerQuoteItem(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Quote item not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete quote item\" });\n    }\n  });\n\n  // Contractor Tasks routes\n  app.get(\"/api/contractor-tasks\", async (req, res) => {\n    try {\n      const tasks = await storage.getContractorTasks();\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch contractor tasks\" });\n    }\n  });\n\n  app.get(\"/api/contractor-tasks/contractor/:contractorId\", async (req, res) => {\n    try {\n      const { contractorId } = req.params;\n      const tasks = await storage.getContractorTasksByContractorId(contractorId);\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch contractor tasks\" });\n    }\n  });\n\n  app.post(\"/api/contractor-tasks\", async (req, res) => {\n    try {\n      const processedBody = {\n        ...req.body,\n        dueDate: req.body.dueDate ? new Date(req.body.dueDate) : null\n      };\n      const validatedData = insertContractorTaskSchema.parse(processedBody);\n      const task = await storage.createContractorTask(validatedData);\n      res.status(201).json(task);\n    } catch (error) {\n      console.error(\"Contractor task creation error:\", error);\n      res.status(400).json({ message: \"Invalid contractor task data\" });\n    }\n  });\n\n  app.put(\"/api/contractor-tasks/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const processedBody = {\n        ...req.body,\n        dueDate: req.body.dueDate ? new Date(req.body.dueDate) : null\n      };\n      const validatedData = insertContractorTaskSchema.partial().parse(processedBody);\n      const task = await storage.updateContractorTask(id, validatedData);\n      if (!task) {\n        return res.status(404).json({ message: \"Contractor task not found\" });\n      }\n      res.json(task);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid contractor task data\" });\n    }\n  });\n\n  app.delete(\"/api/contractor-tasks/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteContractorTask(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Contractor task not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete contractor task\" });\n    }\n  });\n\n  // Contractor Payments routes\n  app.get(\"/api/contractor-payments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const payments = await storage.getContractorPaymentsByUserId(userId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch contractor payments\" });\n    }\n  });\n\n  app.get(\"/api/contractor-payments/contractor/:contractorId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { contractorId } = req.params;\n      const userId = req.user.id;\n      const payments = await storage.getContractorPaymentsByContractorIdAndUserId(contractorId, userId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch contractor payments\" });\n    }\n  });\n\n  app.post(\"/api/contractor-payments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const processedBody = {\n        ...req.body,\n        paymentDate: new Date(req.body.paymentDate)\n      };\n      const validatedData = insertContractorPaymentSchema.parse(processedBody);\n      \n      // Create the contractor payment\n      const payment = await storage.createContractorPayment(validatedData);\n      \n      // Get contractor name for the transaction description\n      const contractor = await storage.getProject(validatedData.contractorId);\n      const contractorName = contractor?.name || \"Bilinmeyen Yüklenici\";\n      \n      // Create a corresponding expense transaction\n      const expenseTransaction = {\n        type: \"expense\" as const,\n        amount: validatedData.amount,\n        description: `${contractorName} - Yüklenici Ödemesi: ${validatedData.description || validatedData.paymentMethod}`,\n        date: validatedData.paymentDate,\n        category: \"Yüklenici Ödemesi\",\n        userId: req.user.id\n      };\n      \n      // Add the expense transaction to the system\n      await storage.createTransaction(expenseTransaction);\n      \n      res.status(201).json(payment);\n    } catch (error) {\n      console.error(\"Contractor payment creation error:\", error);\n      res.status(400).json({ message: \"Invalid contractor payment data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/contractor-payments/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const processedBody = {\n        ...req.body,\n        paymentDate: req.body.paymentDate ? new Date(req.body.paymentDate) : undefined\n      };\n      const validatedData = insertContractorPaymentSchema.partial().parse(processedBody);\n      const payment = await storage.updateContractorPayment(id, validatedData);\n      if (!payment) {\n        return res.status(404).json({ message: \"Contractor payment not found\" });\n      }\n      res.json(payment);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid contractor payment data\" });\n    }\n  });\n\n  app.delete(\"/api/contractor-payments/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const userId = req.user.id;\n      \n      // Get the payment first to check ownership and get transaction details\n      const payment = await storage.getContractorPayment(id);\n      if (!payment) {\n        return res.status(404).json({ message: \"Contractor payment not found\" });\n      }\n      \n      // Check if the contractor belongs to this user (via project)\n      const project = await storage.getProject(payment.contractorId);\n      if (!project || project.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      // Delete the payment\n      const deleted = await storage.deleteContractorPayment(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Contractor payment not found\" });\n      }\n      \n      // Find and delete the associated transaction\n      const transactions = await storage.getTransactionsByUserId(userId);\n      const relatedTransaction = transactions.find((t: any) => \n        t.type === 'expense' && \n        t.description.includes('Yüklenici Ödemesi') && \n        parseFloat(t.amount) === parseFloat(payment.amount)\n      );\n      \n      if (relatedTransaction) {\n        await storage.deleteTransaction(relatedTransaction.id);\n      }\n      \n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Delete contractor payment error:\", error);\n      res.status(500).json({ message: \"Failed to delete contractor payment\" });\n    }\n  });\n\n  app.delete(\"/api/contractor-payments/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      \n      // Get payment details before deletion\n      const payment = await storage.getContractorPayment(id);\n      if (!payment) {\n        return res.status(404).json({ message: \"Contractor payment not found\" });\n      }\n      \n      // Get contractor name for transaction lookup  \n      const contractor = await storage.getProject(payment.contractorId);\n      const contractorName = contractor?.name || \"Bilinmeyen Yüklenici\";\n      \n      // Find and delete related transaction\n      const transactions = await storage.getTransactions();\n      const relatedTransaction = transactions.find(t => \n        t.type === \"expense\" && \n        t.description.includes(contractorName) && \n        t.description.includes(\"Yüklenici Ödemesi\") &&\n        Math.abs(parseFloat(t.amount.toString()) - parseFloat(payment.amount.toString())) < 0.01 &&\n        new Date(t.date).toDateString() === new Date(payment.paymentDate).toDateString()\n      );\n      \n      if (relatedTransaction) {\n        await storage.deleteTransaction(relatedTransaction.id);\n      }\n      \n      // Delete the payment\n      const deleted = await storage.deleteContractorPayment(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Contractor payment not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Contractor payment deletion error:\", error);\n      res.status(500).json({ message: \"Failed to delete contractor payment\" });\n    }\n  });\n\n  // Analytics dashboard endpoint\n  app.get(\"/api/analytics/dashboard\", async (req, res) => {\n    try {\n      const transactions = await storage.getTransactions();\n      const projects = await storage.getProjects();\n      const personnel = await storage.getPersonnel();\n      const timesheets = await storage.getTimesheets();\n\n      // Calculate real monthly revenue from actual transactions\n      const currentYear = new Date().getFullYear();\n      const monthNames = [\"Ocak\", \"Şubat\", \"Mart\", \"Nisan\", \"Mayıs\", \"Haziran\", \"Temmuz\", \"Ağustos\", \"Eylül\", \"Ekim\", \"Kasım\", \"Aralık\"];\n      \n      const monthlyRevenue = monthNames.map((month, index) => {\n        const monthTransactions = transactions.filter(t => {\n          const transactionDate = new Date(t.date);\n          return transactionDate.getMonth() === index && transactionDate.getFullYear() === currentYear;\n        });\n        \n        const income = monthTransactions\n          .filter(t => t.type === 'income')\n          .reduce((sum, t) => sum + parseFloat(t.amount), 0);\n          \n        const expenses = monthTransactions\n          .filter(t => t.type === 'expense')\n          .reduce((sum, t) => sum + parseFloat(t.amount), 0);\n          \n        return { month, income, expenses };\n      });\n\n      const projectsByStatus = [\n        { status: \"Aktif\", count: projects.filter(p => p.status === \"active\").length },\n        { status: \"Pasif\", count: projects.filter(p => p.status === \"passive\").length },\n        { status: \"Tamamlandı\", count: projects.filter(p => p.status === \"completed\").length },\n      ];\n\n\n\n      const chartData = {\n        monthlyRevenue,\n        projectsByStatus,\n      };\n\n      res.json(chartData);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch dashboard analytics\" });\n    }\n  });\n\n  // Personnel Payments routes\n  app.get(\"/api/personnel-payments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const payments = await storage.getPersonnelPaymentsByUserId(userId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch personnel payments\" });\n    }\n  });\n\n  app.get(\"/api/personnel-payments/personnel/:personnelId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { personnelId } = req.params;\n      const userId = req.user.id;\n      const payments = await storage.getPersonnelPaymentsByPersonnelIdAndUserId(personnelId, userId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch personnel payments\" });\n    }\n  });\n\n  app.post(\"/api/personnel-payments\", isAuthenticated, async (req: any, res) => {\n    try {\n      console.log(\"Personnel payment request body:\", req.body);\n      // Convert string date to Date object\n      const processedBody = {\n        ...req.body,\n        paymentDate: new Date(req.body.paymentDate)\n      };\n      const validatedData = insertPersonnelPaymentSchema.parse(processedBody);\n      \n      // Create the personnel payment\n      const payment = await storage.createPersonnelPayment(validatedData);\n      \n      // Get personnel name for the transaction description\n      const personnel = await storage.getPersonnelByUserId(req.user.id);\n      const person = personnel.find(p => p.id === validatedData.personnelId);\n      const personnelName = person?.name || \"Bilinmeyen Personel\";\n      \n      // Create a corresponding expense transaction\n      const expenseTransaction = {\n        type: \"expense\" as const,\n        amount: validatedData.amount,\n        description: `${personnelName} - Maaş Ödemesi (${validatedData.description || validatedData.paymentType})`,\n        date: validatedData.paymentDate,\n        category: \"Personel Ödemesi\",\n        userId: req.user.id\n      };\n      \n      // Add the expense transaction to the system\n      await storage.createTransaction(expenseTransaction);\n      \n      res.status(201).json(payment);\n    } catch (error) {\n      console.error(\"Personnel payment validation error:\", error);\n      res.status(400).json({ message: \"Invalid personnel payment data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/personnel-payments/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      // Convert string date to Date object if present\n      const processedBody = {\n        ...req.body,\n        ...(req.body.paymentDate && { paymentDate: new Date(req.body.paymentDate) })\n      };\n      const validatedData = insertPersonnelPaymentSchema.partial().parse(processedBody);\n      const payment = await storage.updatePersonnelPayment(id, validatedData);\n      if (!payment) {\n        return res.status(404).json({ message: \"Personnel payment not found\" });\n      }\n      res.json(payment);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid personnel payment data\" });\n    }\n  });\n\n  app.delete(\"/api/personnel-payments/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      // Get payment details before deletion\n      const payment = await storage.getPersonnelPayment(id);\n      if (!payment) {\n        return res.status(404).json({ message: \"Personnel payment not found\" });\n      }\n      \n      // Get personnel name for transaction lookup\n      const personnel = await storage.getPersonnel();\n      const person = personnel.find(p => p.id === payment.personnelId);\n      const personnelName = person?.name || \"Bilinmeyen Personel\";\n      \n      // Find and delete related transaction\n      const transactions = await storage.getTransactions();\n      const relatedTransaction = transactions.find(t => \n        t.type === \"expense\" && \n        t.description.includes(personnelName) && \n        t.description.includes(\"Maaş Ödemesi\") &&\n        Math.abs(parseFloat(t.amount.toString()) - parseFloat(payment.amount.toString())) < 0.01 &&\n        new Date(t.date).toDateString() === new Date(payment.paymentDate).toDateString()\n      );\n      \n      if (relatedTransaction) {\n        await storage.deleteTransaction(relatedTransaction.id);\n      }\n      \n      // Delete the payment\n      const deleted = await storage.deletePersonnelPayment(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Personnel payment not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Personnel payment deletion error:\", error);\n      res.status(500).json({ message: \"Failed to delete personnel payment\" });\n    }\n  });\n\n  // Contractor Tasks routes\n  app.get(\"/api/contractor-tasks\", async (req, res) => {\n    try {\n      const tasks = await storage.getContractorTasks();\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch contractor tasks\" });\n    }\n  });\n\n  app.get(\"/api/contractor-tasks/contractor/:contractorId\", async (req, res) => {\n    try {\n      const { contractorId } = req.params;\n      const tasks = await storage.getContractorTasksByContractorId(contractorId);\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch contractor tasks\" });\n    }\n  });\n\n  app.post(\"/api/contractor-tasks\", async (req, res) => {\n    try {\n      const processedBody = {\n        ...req.body,\n        ...(req.body.dueDate && { dueDate: new Date(req.body.dueDate) })\n      };\n      const validatedData = insertContractorTaskSchema.parse(processedBody);\n      const task = await storage.createContractorTask(validatedData);\n      res.status(201).json(task);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid task data\" });\n    }\n  });\n\n  app.put(\"/api/contractor-tasks/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const processedBody = {\n        ...req.body,\n        ...(req.body.dueDate && { dueDate: new Date(req.body.dueDate) })\n      };\n      const validatedData = insertContractorTaskSchema.partial().parse(processedBody);\n      const task = await storage.updateContractorTask(id, validatedData);\n      if (!task) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n      res.json(task);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid task data\" });\n    }\n  });\n\n  app.delete(\"/api/contractor-tasks/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteContractorTask(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete task\" });\n    }\n  });\n\n  // Duplicate contractor payments routes removed - using the authenticated version above\n\n  app.post(\"/api/contractor-payments-old\", async (req, res) => {\n    try {\n      const processedBody = {\n        ...req.body,\n        paymentDate: new Date(req.body.paymentDate)\n      };\n      const validatedData = insertContractorPaymentSchema.parse(processedBody);\n      \n      // Create the contractor payment\n      const payment = await storage.createContractorPayment(validatedData);\n      \n      // Get contractor name for the transaction description\n      const contractor = await storage.getProject(validatedData.contractorId); // Using project table as contractor\n      const contractorName = contractor?.name || \"Bilinmeyen Yüklenici\";\n      \n      // Create a corresponding expense transaction\n      const expenseTransaction = {\n        type: \"expense\" as const,\n        amount: validatedData.amount,\n        description: `${contractorName} - Yüklenici Ödemesi: ${validatedData.description}`,\n        date: validatedData.paymentDate,\n        category: \"Yüklenici Ödemesi\"\n      };\n      \n      // Add the expense transaction to the system\n      const transaction = await storage.createTransaction(expenseTransaction);\n      \n      // Update payment with transaction reference\n      if (transaction && transaction.id) {\n        await storage.updateContractorPayment(payment.id, { transactionId: transaction.id });\n      }\n      \n      res.status(201).json(payment);\n    } catch (error) {\n      console.error(\"Contractor payment creation error:\", error);\n      res.status(400).json({ message: \"Invalid payment data\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.put(\"/api/contractor-payments/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const processedBody = {\n        ...req.body,\n        ...(req.body.paymentDate && { paymentDate: new Date(req.body.paymentDate) })\n      };\n      const validatedData = insertContractorPaymentSchema.partial().parse(processedBody);\n      const payment = await storage.updateContractorPayment(id, validatedData);\n      if (!payment) {\n        return res.status(404).json({ message: \"Payment not found\" });\n      }\n      res.json(payment);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid payment data\" });\n    }\n  });\n\n  app.delete(\"/api/contractor-payments/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteContractorPayment(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Payment not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete payment\" });\n    }\n  });\n\n  // Company Directory routes\n  app.get(\"/api/company-directory\", isAuthenticated, async (req, res) => {\n    try {\n      // Tüm firmaları göster ki kullanıcılar birbirleriyle mesajlaşabilsin\n      const companies = await storage.getCompanyDirectory();\n      res.json(companies);\n    } catch (error) {\n      console.error(\"Error fetching company directory:\", error);\n      res.status(500).json({ error: \"Failed to fetch company directory\" });\n    }\n  });\n\n  app.get(\"/api/company-directory/my-companies\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const myCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      res.json(myCompanies);\n    } catch (error) {\n      console.error(\"Error fetching my companies:\", error);\n      res.status(500).json({ error: \"Failed to fetch my companies\" });\n    }\n  });\n\n  // Enhanced PRO Company Directory routes\n  app.get(\"/api/directory/firms\", async (req, res) => {\n    try {\n      const { search, city, industry, verified } = req.query;\n      const filters = {\n        search: search as string,\n        city: city as string,\n        industry: industry as string,\n        verified: verified === \"true\" ? true : verified === \"false\" ? false : undefined\n      };\n\n      // Remove undefined values\n      Object.keys(filters).forEach(key => {\n        if (filters[key as keyof typeof filters] === undefined) {\n          delete filters[key as keyof typeof filters];\n        }\n      });\n\n      const companies = await storage.getProCompanyDirectory(Object.keys(filters).length > 0 ? filters : undefined);\n      res.json(companies);\n    } catch (error) {\n      console.error(\"Error fetching PRO company directory:\", error);\n      res.status(500).json({ error: \"Failed to fetch PRO company directory\" });\n    }\n  });\n\n  app.get(\"/api/directory/my-companies\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = req.user?.id;\n      if (!userId) {\n        return res.status(401).json({ error: \"User not authenticated\" });\n      }\n\n      const myCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      res.json(myCompanies);\n    } catch (error) {\n      console.error(\"Error fetching user companies:\", error);\n      res.status(500).json({ error: \"Failed to fetch user companies\" });\n    }\n  });\n\n  app.get(\"/api/company-directory/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const company = await storage.getCompany(req.params.id);\n      if (!company) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      res.json(company);\n    } catch (error) {\n      console.error(\"Error fetching company:\", error);\n      res.status(500).json({ error: \"Failed to fetch company\" });\n    }\n  });\n\n  app.post(\"/api/company-directory\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { insertCompanyDirectorySchema } = await import(\"@shared/schema\");\n      const validatedData = insertCompanyDirectorySchema.parse(req.body);\n      const company = await storage.createCompany(validatedData, userId);\n      res.status(201).json(company);\n    } catch (error) {\n      console.error(\"Error creating company:\", error);\n      res.status(500).json({ error: \"Failed to create company\" });\n    }\n  });\n\n  app.put(\"/api/company-directory/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const { insertCompanyDirectorySchema } = await import(\"@shared/schema\");\n      const validatedData = insertCompanyDirectorySchema.parse(req.body);\n      const company = await storage.updateCompany(req.params.id, validatedData);\n      if (!company) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      res.json(company);\n    } catch (error) {\n      console.error(\"Error updating company:\", error);\n      res.status(500).json({ error: \"Failed to update company\" });\n    }\n  });\n\n  app.delete(\"/api/company-directory/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const success = await storage.deleteCompany(req.params.id);\n      if (!success) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting company:\", error);\n      res.status(500).json({ error: \"Failed to delete company\" });\n    }\n  });\n\n  // Enhanced Messaging and Conversation routes\n  app.post(\"/api/threads/open\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { targetCompanyId } = req.body;\n      \n      if (!targetCompanyId) {\n        return res.status(400).json({ error: \"targetCompanyId is required\" });\n      }\n\n      // Get current user's company\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"User has no company profile\" });\n      }\n      \n      const userCompanyId = userCompanies[0].id;\n\n      // Check if target company is blocked\n      const isBlocked = await storage.isCompanyBlocked(targetCompanyId, userCompanyId);\n      if (isBlocked) {\n        return res.status(403).json({ error: \"Cannot message this company\" });\n      }\n\n      const conversation = await storage.getOrCreateConversation(userCompanyId, targetCompanyId);\n      res.json(conversation);\n    } catch (error) {\n      console.error(\"Error opening conversation:\", error);\n      res.status(500).json({ error: \"Failed to open conversation\" });\n    }\n  });\n\n  // Use DirectThread system instead\n  app.get(\"/api/threads\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (userCompanies.length === 0) {\n        return res.json([]);\n      }\n      \n      const userCompanyId = userCompanies[0].id;\n      const threads = await storage.getDirectThreadsByUserId(userId);\n      \n      // Enrich threads with company information\n      const enrichedThreads = await Promise.all(threads.map(async (thread) => {\n        // Get the other participant (not current user)\n        const participants = thread.participants || [];\n        const otherParticipant = participants.find(p => p.userId !== userId);\n        \n        if (otherParticipant) {\n          const company = await storage.getCompany(otherParticipant.companyId);\n          return {\n            ...thread,\n            participants: [{\n              ...otherParticipant,\n              company\n            }]\n          };\n        }\n        \n        return thread;\n      }));\n      \n      console.log(\"DirectThreads found:\", enrichedThreads.length);\n      res.json(enrichedThreads);\n    } catch (error) {\n      console.error(\"Error fetching direct threads:\", error);\n      res.status(500).json({ error: \"Failed to fetch threads\" });\n    }\n  });\n\n  app.get(\"/api/threads/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const conversationId = req.params.id;\n      \n      // Get conversation by ID\n      const conversation = await storage.getConversationById(conversationId);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n\n      // Get messages for this conversation\n      const messages = await storage.getMessagesByConversationId(conversationId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.post(\"/api/threads/:id/messages\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const threadId = req.params.id;\n      const { body, attachment, attachmentUrl, attachmentType } = req.body;\n\n      console.log(\"Legacy message endpoint called - threadId:\", threadId, \"userId:\", userId);\n\n      // Get user's company\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"User has no company profile\" });\n      }\n      \n      const userCompanyId = userCompanies[0].id;\n\n      // Get DirectThread instead of conversation\n      const currentThread = await storage.getDirectThreadById(threadId);\n      if (!currentThread) {\n        console.log(\"Thread not found with ID:\", threadId);\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n\n      // Verify user has access to this thread\n      if (currentThread.firm1Id !== userCompanyId && currentThread.firm2Id !== userCompanyId) {\n        console.log(\"User firmId:\", userCompanyId, \"not authorized for thread:\", currentThread);\n        return res.status(403).json({ error: \"Not authorized to message in this thread\" });\n      }\n\n      const targetCompanyId = currentThread.firm1Id === userCompanyId ? currentThread.firm2Id : currentThread.firm1Id;\n\n      // Create DirectMessage using new schema\n      const message = await storage.createDirectMessage({\n        threadId,\n        senderFirmId: userCompanyId,\n        receiverFirmId: targetCompanyId,\n        body: body || \"\",\n        attachmentUrl: attachmentUrl || attachment,\n        attachmentType: attachmentType || (attachment ? \"file\" : \"text\")\n      });\n\n      console.log(\"Legacy endpoint - Message created:\", message);\n      \n      // Create notification for the receiver\n      try {\n        console.log(\"🔔 Attempting to create notification for targetCompanyId:\", targetCompanyId);\n        const targetCompany = await storage.getCompany(targetCompanyId);\n        console.log(\"🔔 Target company found:\", targetCompany);\n        \n        if (targetCompany && targetCompany.userId) {\n          // Get sender user info for real name\n          const senderUser = await storage.getUser(userId);\n          const senderName = senderUser ? `${senderUser.firstName || ''} ${senderUser.lastName || ''}`.trim() : userCompanies[0].contactPerson;\n          \n          console.log(\"🔔 Creating notification for userId:\", targetCompany.userId, \"from:\", senderName);\n          \n          const notification = await storage.createNotification({\n            userId: targetCompany.userId,\n            type: \"NEW_DM\",\n            payload: {\n              threadId,\n              fromCompanyId: userCompanyId,\n              fromCompanyName: userCompanies[0].companyName,\n              fromUserName: senderName,\n              messageId: message.id,\n              title: \"Yeni Mesaj\",\n              message: `${senderName} size mesaj gönderdi`\n            }\n          });\n          console.log(\"🔔 Notification created successfully:\", notification);\n        } else {\n          console.log(\"🔔 No target company or userId found - no notification created\");\n        }\n      } catch (notificationError) {\n        console.error(\"🔔 Failed to create notification:\", notificationError);\n      }\n      \n      res.json(message);\n    } catch (error) {\n      console.error(\"Legacy message creation error:\", error);\n      res.status(500).json({ error: \"Failed to create message\" });\n    }\n  });\n\n\n\n  app.post(\"/api/messages/:id/read\", isAuthenticated, async (req, res) => {\n    try {\n      const messageId = req.params.id;\n      const success = await storage.markMessageAsRead(messageId);\n      \n      if (success) {\n        // Create read notification for sender\n        const message = await storage.getMessages().then(messages => \n          messages.find(m => m.id === messageId)\n        );\n        \n        if (message) {\n          await storage.createNotification({\n            userId: message.fromUserId,\n            type: \"DM_READ\",\n            payload: {\n              messageId: message.id,\n              readByCompanyId: message.toCompanyId\n            }\n          });\n        }\n      }\n      \n      res.json({ success });\n    } catch (error) {\n      console.error(\"Error marking message as read:\", error);\n      res.status(500).json({ error: \"Failed to mark message as read\" });\n    }\n  });\n\n  // Notification routes\n  app.get(\"/api/notifications\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      console.log(\"🔔 Fetching notifications for user:\", userId);\n      const notifications = await storage.getNotificationsByUserId(userId);\n      console.log(\"🔔 Found notifications:\", notifications?.length || 0);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Error fetching notifications:\", error);\n      res.status(500).json({ error: \"Failed to fetch notifications\" });\n    }\n  });\n\n  app.patch(\"/api/notifications/:id/read\", isAuthenticated, async (req, res) => {\n    try {\n      const notificationId = req.params.id;\n      console.log(\"🔔 Marking notification as read:\", notificationId);\n      const success = await storage.markNotificationAsRead(notificationId);\n      console.log(\"🔔 Mark as read success:\", success);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"🔔 Error marking notification as read:\", error);\n      res.status(500).json({ error: \"Failed to mark notification as read\" });\n    }\n  });\n\n  // Blocking and muting routes\n  app.post(\"/api/blocks\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { targetCompanyId } = req.body;\n\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"User has no company profile\" });\n      }\n\n      const userCompanyId = userCompanies[0].id;\n      const block = await storage.createCompanyBlock(userCompanyId, targetCompanyId);\n      res.status(201).json(block);\n    } catch (error) {\n      console.error(\"Error creating block:\", error);\n      res.status(500).json({ error: \"Failed to block company\" });\n    }\n  });\n\n  app.delete(\"/api/blocks/:targetCompanyId\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { targetCompanyId } = req.params;\n\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"User has no company profile\" });\n      }\n\n      const userCompanyId = userCompanies[0].id;\n      const success = await storage.removeCompanyBlock(userCompanyId, targetCompanyId);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Error removing block:\", error);\n      res.status(500).json({ error: \"Failed to unblock company\" });\n    }\n  });\n\n  app.post(\"/api/mutes\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { targetCompanyId } = req.body;\n\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"User has no company profile\" });\n      }\n\n      const userCompanyId = userCompanies[0].id;\n      const mute = await storage.createCompanyMute(userCompanyId, targetCompanyId);\n      res.status(201).json(mute);\n    } catch (error) {\n      console.error(\"Error creating mute:\", error);\n      res.status(500).json({ error: \"Failed to mute company\" });\n    }\n  });\n\n  app.delete(\"/api/mutes/:targetCompanyId\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { targetCompanyId } = req.params;\n\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"User has no company profile\" });\n      }\n\n      const userCompanyId = userCompanies[0].id;\n      const success = await storage.removeCompanyMute(userCompanyId, targetCompanyId);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Error removing mute:\", error);\n      res.status(500).json({ error: \"Failed to unmute company\" });\n    }\n  });\n\n  // Abuse reporting routes\n  app.post(\"/api/reports\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { targetCompanyId, reason, messageSample } = req.body;\n\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"User has no company profile\" });\n      }\n\n      const userCompanyId = userCompanies[0].id;\n      const validatedData = insertAbuseReportSchema.parse({\n        reporterCompanyId: userCompanyId,\n        reportedCompanyId: targetCompanyId,\n        reason,\n        messageSample\n      });\n\n      const report = await storage.createAbuseReport(validatedData);\n      res.status(201).json(report);\n    } catch (error) {\n      console.error(\"Error creating abuse report:\", error);\n      res.status(500).json({ error: \"Failed to create abuse report\" });\n    }\n  });\n\n  // Admin routes for PRO system\n  app.patch(\"/api/admin/directory/:companyId/verify\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user?.isAdmin) {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      const { companyId } = req.params;\n      const success = await storage.verifyCompanyProfile(companyId);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Error verifying company:\", error);\n      res.status(500).json({ error: \"Failed to verify company\" });\n    }\n  });\n\n  app.patch(\"/api/admin/directory/:companyId/pro-status\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user?.isAdmin) {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      const { companyId } = req.params;\n      const { isProVisible } = req.body;\n      const success = await storage.updateCompanyProStatus(companyId, isProVisible);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Error updating PRO status:\", error);\n      res.status(500).json({ error: \"Failed to update PRO status\" });\n    }\n  });\n\n  // Messages routes\n  app.get(\"/api/messages\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      // Kullanıcının dahil olduğu tüm mesajları getir\n      const messages = await storage.getMessagesByUser(userId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.get(\"/api/messages/:companyId\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const targetCompanyId = req.params.companyId;\n      \n      // Kullanıcının firmalarını al\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      const userCompanyId = userCompanies?.[0]?.id || \"\";\n      \n      console.log(`Fetching messages between ${userCompanyId} and ${targetCompanyId}`);\n      \n      // İki firma arasındaki mesajları getir\n      const messages = await storage.getMessagesByConversation(userCompanyId, targetCompanyId);\n      console.log(`Found ${messages.length} messages`);\n      \n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching conversation messages:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation messages\" });\n    }\n  });\n\n  app.post(\"/api/messages\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      \n      // Kullanıcının firmalarını al\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      const fromCompanyId = userCompanies?.[0]?.id || \"\";\n      \n      // Basit mesaj oluşturma - mevcut Message tablosunu kullan\n      const messageData = {\n        fromCompanyId: fromCompanyId,\n        toCompanyId: req.body.receiverFirmId,\n        message: req.body.body,\n        fromUserId: userId,\n        toUserId: userId // Şimdilik aynı kullanıcı\n      };\n      \n      console.log(\"Creating message with data:\", messageData);\n      \n      const message = await storage.createMessage(messageData);\n      \n      // Alıcı firmanın sahibini bul - tüm firmalar arasından ara\n      const allCompanies = await storage.getCompanyDirectory();\n      const receiverCompany = allCompanies.find(c => c.id === req.body.receiverFirmId);\n      if (receiverCompany && receiverCompany.userId !== userId) {\n        // Gönderen firmanın adını al  \n        const fromCompany = userCompanies?.[0]; // Kullanıcının kendi firması\n        console.log(\"Gönderen firma bilgisi:\", fromCompany);\n        console.log(\"Alıcı firma bilgisi:\", receiverCompany);\n        \n        // Get sender user info for real name\n        const senderUser = await storage.getUser(userId);\n        const senderName = senderUser ? `${senderUser.firstName || ''} ${senderUser.lastName || ''}`.trim() : fromCompany?.contactPerson || 'Bilinmeyen Kullanıcı';\n        \n        // Alıcı için bildirim oluştur\n        const notification = {\n          userId: receiverCompany.userId, // Alıcı firmanın sahibi\n          type: \"NEW_MESSAGE\" as const,\n          title: \"Yeni Mesaj\",\n          content: `${senderName} size mesaj gönderdi`,\n          payload: {\n            fromCompanyId: fromCompanyId,\n            toCompanyId: req.body.receiverFirmId,\n            messageId: message.id,\n            fromCompanyName: fromCompany?.companyName || 'Bilinmeyen Firma',\n            fromUserName: senderName\n          }\n        };\n        \n        console.log(\"Creating notification for receiver:\", notification);\n        await storage.createNotification(notification);\n      }\n      \n      res.status(201).json(message);\n    } catch (error) {\n      console.error(\"Error creating message:\", error);\n      res.status(500).json({ error: \"Failed to create message\" });\n    }\n  });\n\n  app.put(\"/api/messages/:id/read\", isAuthenticated, async (req, res) => {\n    try {\n      const success = await storage.markMessageAsRead(req.params.id);\n      if (!success) {\n        return res.status(404).json({ error: \"Message not found\" });\n      }\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking message as read:\", error);\n      res.status(500).json({ error: \"Failed to mark message as read\" });\n    }\n  });\n\n  // Conversations routes\n  app.get(\"/api/conversations\", async (req, res) => {\n    try {\n      const conversations = await storage.getConversations();\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversations\" });\n    }\n  });\n\n  app.get(\"/api/conversations/:company1Id/:company2Id\", async (req, res) => {\n    try {\n      const conversation = await storage.getConversation(req.params.company1Id, req.params.company2Id);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      res.json(conversation);\n    } catch (error) {\n      console.error(\"Error fetching conversation:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation\" });\n    }\n  });\n\n  app.post(\"/api/conversations\", async (req, res) => {\n    try {\n      const { insertConversationSchema } = await import(\"@shared/schema\");\n      const validatedData = insertConversationSchema.parse(req.body);\n      const conversation = await storage.createConversation(validatedData);\n      res.status(201).json(conversation);\n    } catch (error) {\n      console.error(\"Error creating conversation:\", error);\n      res.status(500).json({ error: \"Failed to create conversation\" });\n    }\n  });\n\n  app.put(\"/api/conversations/:id\", async (req, res) => {\n    try {\n      const { insertConversationSchema } = await import(\"@shared/schema\");\n      const validatedData = insertConversationSchema.parse(req.body);\n      const conversation = await storage.updateConversation(req.params.id, validatedData);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      res.json(conversation);\n    } catch (error) {\n      console.error(\"Error updating conversation:\", error);\n      res.status(500).json({ error: \"Failed to update conversation\" });\n    }\n  });\n\n\n\n  // Admin routes\n  app.get(\"/api/admin/stats\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user?.isAdmin) {\n        return res.status(403).json({ message: \"Access denied - Admin privileges required\" });\n      }\n      \n      const stats = await storage.getAdminStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Admin stats error:\", error);\n      res.status(500).json({ message: \"Failed to fetch admin stats\" });\n    }\n  });\n\n  // System metrics endpoint\n  app.get(\"/api/admin/system-metrics\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user?.isAdmin && user?.role !== 'ADMIN' && user?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      // Mock system metrics - in real app would come from system monitoring\n      const metrics = [\n        {\n          name: \"CPU Usage\",\n          value: Math.floor(Math.random() * 50) + 30, // 30-80%\n          unit: \"%\",\n          status: \"normal\",\n          timestamp: new Date().toISOString()\n        },\n        {\n          name: \"Memory Usage\", \n          value: Math.floor(Math.random() * 40) + 40, // 40-80%\n          unit: \"%\",\n          status: \"normal\",\n          timestamp: new Date().toISOString()\n        },\n        {\n          name: \"Disk Usage\",\n          value: Math.floor(Math.random() * 30) + 50, // 50-80%\n          unit: \"%\", \n          status: \"normal\",\n          timestamp: new Date().toISOString()\n        },\n        {\n          name: \"Active Connections\",\n          value: Math.floor(Math.random() * 50) + 10, // 10-60\n          unit: \"conn\",\n          status: \"normal\",\n          timestamp: new Date().toISOString()\n        }\n      ];\n      \n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching system metrics:\", error);\n      res.status(500).json({ error: \"Failed to fetch system metrics\" });\n    }\n  });\n\n  app.get(\"/api/admin/users\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user?.isAdmin) {\n        return res.status(403).json({ message: \"Access denied - Admin privileges required\" });\n      }\n      \n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Admin users error:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  // Enhanced Messaging & Firm Invites\n  \n  // Set up multer for image uploads\n  const upload = multer({\n    limits: { fileSize: 8 * 1024 * 1024 }, // 8MB limit\n    fileFilter: (req, file, cb) => {\n      const allowedMimes = ['image/png', 'image/jpeg', 'image/webp'];\n      if (allowedMimes.includes(file.mimetype)) {\n        cb(null, true);\n      } else {\n        cb(new Error('Only PNG, JPEG, and WebP images allowed'));\n      }\n    }\n  });\n\n  // Image upload endpoint  \n  app.post(\"/api/upload-image\", upload.single('image'), async (req: any, res) => {\n    try {\n      // Manual authentication check for file upload\n      const authHeader = req.headers.authorization;\n      let sessionId = authHeader?.replace('Bearer ', '') || req.cookies['connect.sid'];\n      \n      // Handle signed cookies format: s:sessionId.signature\n      if (sessionId && sessionId.startsWith('s:')) {\n        sessionId = sessionId.substring(2).split('.')[0];\n      }\n      \n      if (!sessionId) {\n        console.log(\"No session ID found for image upload\");\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const { getSession } = await import(\"./auth\");\n      const user = await getSession(sessionId);\n      \n      if (!user) {\n        console.log(\"Session not found or expired for image upload\");\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      if (!req.file) {\n        return res.status(400).json({ error: \"No image file provided\" });\n      }\n\n      const userId = user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id; // Use first company\n      const filename = `${Date.now()}-${crypto.randomBytes(8).toString('hex')}.${req.file.mimetype.split('/')[1]}`;\n      \n      // In production, you'd save to cloud storage. For now, we'll use a local path simulation\n      const url = `/uploads/${filename}`;\n      \n      const imageUpload = await storage.createImageUpload({\n        userId,\n        firmId,\n        filename,\n        originalName: req.file.originalname,\n        mimeType: req.file.mimetype,\n        fileSize: req.file.size,\n        url,\n        width: 800, // Mock values - in production use sharp to get actual dimensions\n        height: 600\n      });\n\n      res.json({\n        url: imageUpload.url,\n        width: imageUpload.width,\n        height: imageUpload.height,\n        mime: imageUpload.mimeType\n      });\n    } catch (error) {\n      console.error(\"Image upload error:\", error);\n      res.status(500).json({ error: \"Failed to upload image\" });\n    }\n  });\n\n  // Firm Invites\n  app.post(\"/api/invites\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const { email, role } = req.body;\n      \n      // Generate invite token\n      const payload = { email, firmId, role, exp: Date.now() + (72 * 60 * 60 * 1000) }; // 72 hours\n      const token = Buffer.from(JSON.stringify(payload)).toString('base64');\n      const tokenHash = crypto.createHash('sha256').update(token).digest('hex');\n      \n      const invite = await storage.createFirmInvite({\n        firmId,\n        email,\n        role,\n        tokenHash,\n        expiresAt: new Date(Date.now() + (72 * 60 * 60 * 1000)),\n        createdByUserId: userId\n      });\n\n      const inviteUrl = `${req.protocol}://${req.get('host')}/invite/accept?token=${token}`;\n      \n      res.json({ inviteUrl, invite });\n    } catch (error) {\n      console.error(\"Invite creation error:\", error);\n      res.status(500).json({ error: \"Failed to create invite\" });\n    }\n  });\n\n  app.get(\"/api/invites\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const invites = await storage.getFirmInvitesByFirm(firmId);\n      res.json(invites);\n    } catch (error) {\n      console.error(\"Invites fetch error:\", error);\n      res.status(500).json({ error: \"Failed to fetch invites\" });\n    }\n  });\n\n  app.post(\"/api/invites/accept\", async (req, res) => {\n    try {\n      const { token } = req.body;\n      const tokenHash = crypto.createHash('sha256').update(token).digest('hex');\n      \n      const invite = await storage.getFirmInvitesByToken(tokenHash);\n      if (!invite || invite.acceptedAt || new Date() > invite.expiresAt) {\n        return res.status(400).json({ error: \"Invalid or expired invite\" });\n      }\n\n      // Decode token to get invite details\n      const payload = JSON.parse(Buffer.from(token, 'base64').toString());\n      \n      await storage.acceptFirmInvite(invite.id);\n      res.json({ success: true, message: \"Invite accepted successfully\" });\n    } catch (error) {\n      console.error(\"Invite accept error:\", error);\n      res.status(500).json({ error: \"Failed to accept invite\" });\n    }\n  });\n\n  // Presence endpoints\n  app.post(\"/api/presence/heartbeat\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const clientInfo = req.body.clientInfo || req.get('User-Agent');\n      \n      await storage.updatePresence({\n        firmId,\n        userId,\n        clientInfo\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Presence heartbeat error:\", error);\n      res.status(500).json({ error: \"Failed to update presence\" });\n    }\n  });\n\n  app.get(\"/api/presence/:userId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const targetUserId = req.params.userId;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const presence = await storage.getPresenceByFirmAndUser(firmId, targetUserId);\n      \n      if (!presence) {\n        return res.json({ online: false, lastSeen: null });\n      }\n\n      const now = new Date();\n      const presenceTTL = 2 * 60 * 1000; // 2 minutes\n      const isOnline = (now.getTime() - presence.lastHeartbeatAt.getTime()) <= presenceTTL;\n      \n      res.json({\n        online: isOnline,\n        lastSeen: presence.lastHeartbeatAt.toISOString()\n      });\n    } catch (error) {\n      console.error(\"Presence fetch error:\", error);\n      res.status(500).json({ error: \"Failed to fetch presence\" });\n    }\n  });\n\n  // Message Drafts\n  app.get(\"/api/drafts/:threadId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const draft = await storage.getDraft(req.params.threadId, firmId);\n      \n      res.json({ body: draft?.body || \"\" });\n    } catch (error) {\n      console.error(\"Draft fetch error:\", error);\n      res.status(500).json({ error: \"Failed to fetch draft\" });\n    }\n  });\n\n  app.post(\"/api/drafts/upsert\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const { threadId, body } = req.body;\n      \n      if (body === \"\") {\n        // Delete draft if body is empty\n        await storage.deleteDraft(threadId, firmId);\n        res.json({ success: true, action: \"deleted\" });\n      } else {\n        const draft = await storage.upsertDraft({\n          threadId,\n          authorFirmId: firmId,\n          body\n        });\n        res.json({ success: true, action: \"saved\", draft });\n      }\n    } catch (error) {\n      console.error(\"Draft upsert error:\", error);\n      res.status(500).json({ error: \"Failed to save draft\" });\n    }\n  });\n\n  // Auto Responder\n  app.get(\"/api/autoresponder\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const responder = await storage.getAutoResponder(firmId);\n      \n      res.json(responder || {\n        enabled: false,\n        mode: \"KEYWORD\",\n        keywords: [],\n        cooldownSec: 600,\n        messageBody: \"Merhaba! Mesajınızı aldık, en kısa sürede dönüş yapacağız.\"\n      });\n    } catch (error) {\n      console.error(\"Auto responder fetch error:\", error);\n      res.status(500).json({ error: \"Failed to fetch auto responder\" });\n    }\n  });\n\n  app.post(\"/api/autoresponder\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const responder = await storage.upsertAutoResponder({\n        firmId,\n        ...req.body\n      });\n      \n      res.json(responder);\n    } catch (error) {\n      console.error(\"Auto responder save error:\", error);\n      res.status(500).json({ error: \"Failed to save auto responder\" });\n    }\n  });\n\n  // Direct Threads & Messages\n  app.post(\"/api/threads/create\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const { targetCompanyId } = req.body;\n      console.log(\"Creating thread for userId:\", userId, \"targetCompanyId:\", targetCompanyId);\n      \n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        console.log(\"No company found for user:\", userId);\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      console.log(\"User company ID:\", firmId);\n      \n      // Check if thread already exists or create new one\n      const thread = await storage.getOrCreateDirectThread(firmId, targetCompanyId);\n      console.log(\"Thread created/found:\", thread);\n      \n      res.json(thread);\n    } catch (error) {\n      console.error(\"Thread creation error:\", error);\n      res.status(500).json({ error: \"Failed to create thread\" });\n    }\n  });\n\n  app.get(\"/api/threads/:threadId/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { threadId } = req.params;\n      const offset = parseInt(req.query.offset as string) || 0;\n      const limit = parseInt(req.query.limit as string) || 50;\n      \n      const messages = await storage.getDirectThreadMessages(threadId, offset, limit);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Thread messages fetch error:\", error);\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.post(\"/api/threads/:threadId/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      console.log(\"Creating message for userId:\", userId);\n      \n      const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n      \n      if (!userCompanies.length) {\n        console.log(\"No company found for user:\", userId);\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n\n      const firmId = userCompanies[0].id;\n      const { threadId } = req.params;\n      const { body, attachmentUrl, attachmentType } = req.body;\n      \n      console.log(\"Message data:\", { threadId, firmId, body, attachmentUrl, attachmentType });\n      \n      // Get thread by ID directly\n      const currentThread = await storage.getDirectThreadById(threadId);\n      console.log(\"Found thread:\", currentThread);\n      \n      if (!currentThread) {\n        console.log(\"Thread not found with ID:\", threadId);\n        return res.status(404).json({ error: \"Thread not found\" });\n      }\n      \n      // Verify user has access to this thread\n      if (currentThread.firm1Id !== firmId && currentThread.firm2Id !== firmId) {\n        console.log(\"User firmId:\", firmId, \"not authorized for thread:\", currentThread);\n        return res.status(403).json({ error: \"Not authorized to message in this thread\" });\n      }\n      \n      const receiverFirmId = currentThread.firm1Id === firmId ? currentThread.firm2Id : currentThread.firm1Id;\n      console.log(\"Receiver firmId:\", receiverFirmId);\n      \n      const message = await storage.createDirectMessage({\n        threadId,\n        senderFirmId: firmId,\n        receiverFirmId,\n        body,\n        attachmentUrl,\n        attachmentType: attachmentType || \"text\"\n      });\n      \n      console.log(\"Message created:\", message);\n      \n      // Create notification for the receiver (new endpoint)\n      try {\n        const targetCompany = await storage.getCompany(receiverFirmId);\n        if (targetCompany && targetCompany.userId) {\n          const userCompanies = await storage.getCompanyDirectoryByUserId(userId);\n          if (userCompanies.length > 0) {\n            const notification = await storage.createNotification({\n              userId: targetCompany.userId,\n              type: \"NEW_DM\",\n              payload: {\n                threadId,\n                fromCompanyId: firmId,\n                fromCompanyName: userCompanies[0].companyName,\n                messageId: message.id,\n                title: \"Yeni Mesaj\",\n                message: `${userCompanies[0].companyName} size mesaj gönderdi`\n              }\n            });\n            console.log(\"Notification created (new endpoint):\", notification);\n          }\n        }\n      } catch (notificationError) {\n        console.error(\"Failed to create notification (new endpoint):\", notificationError);\n      }\n      \n      res.json(message);\n    } catch (error) {\n      console.error(\"Message creation error:\", error);\n      res.status(500).json({ error: \"Failed to create message\" });\n    }\n  });\n\n  app.patch(\"/api/messages/:messageId/read\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { messageId } = req.params;\n      const success = await storage.markDirectMessageAsRead(messageId);\n      \n      if (!success) {\n        return res.status(404).json({ error: \"Message not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Mark message read error:\", error);\n      res.status(500).json({ error: \"Failed to mark message as read\" });\n    }\n  });\n\n  // SMS API Routes\n  app.get(\"/api/sms/history\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const smsHistory = await storage.getSMSHistory(userId);\n      res.json(smsHistory);\n    } catch (error) {\n      console.error(\"Error fetching SMS history:\", error);\n      res.status(500).json({ error: \"Failed to fetch SMS history\" });\n    }\n  });\n\n  app.post(\"/api/sms/send\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const { message, recipients, templateId } = req.body;\n\n      if (!message || !recipients || recipients.length === 0) {\n        return res.status(400).json({ error: \"Message and recipients are required\" });\n      }\n\n      // Get recipient data (personnel and customers)\n      const personnel = await storage.getPersonnelByUserId(userId);\n      const customers = await storage.getCustomersByUserId(userId);\n      \n      const allRecipients = [\n        ...personnel.map(p => ({\n          id: p.id,\n          name: p.name,\n          phone: p.phone || '',\n          type: 'personnel'\n        })),\n        ...customers.map(c => ({\n          id: c.id,\n          name: c.name,\n          phone: c.phone || '',\n          type: 'customer'\n        }))\n      ].filter(r => r.phone && recipients.includes(r.id));\n\n      if (allRecipients.length === 0) {\n        return res.status(400).json({ error: \"No valid phone numbers found for selected recipients\" });\n      }\n\n      // Calculate SMS cost (estimate: 0.08 TL per SMS)\n      const smsCount = Math.ceil(message.length / 160);\n      const estimatedCost = allRecipients.length * smsCount * 0.08;\n\n      // Create SMS history record\n      const smsHistoryData = {\n        message,\n        recipientCount: allRecipients.length,\n        recipientData: allRecipients,\n        status: 'pending' as const,\n        cost: estimatedCost.toString(),\n        templateId: templateId || null,\n        errorMessage: null,\n        netgsmResponse: null\n      };\n\n      const smsRecord = await storage.createSMSHistory(userId, smsHistoryData);\n\n      // NetGSM API integration (mock for now)\n      try {\n        const netgsmResult = await sendSMSViaNetGSM(message, allRecipients);\n        \n        // Update SMS record with result\n        await storage.updateSMSHistory(smsRecord.id, {\n          status: 'sent',\n          sentAt: new Date(),\n          netgsmResponse: netgsmResult\n        });\n\n        res.json({ \n          success: true, \n          smsId: smsRecord.id,\n          recipientCount: allRecipients.length,\n          estimatedCost,\n          status: 'sent'\n        });\n      } catch (smsError) {\n        // Update SMS record with error\n        await storage.updateSMSHistory(smsRecord.id, {\n          status: 'failed',\n          errorMessage: smsError instanceof Error ? smsError.message : 'SMS send failed'\n        });\n\n        res.status(500).json({ \n          error: \"SMS send failed\", \n          details: smsError instanceof Error ? smsError.message : 'Unknown error'\n        });\n      }\n    } catch (error) {\n      console.error(\"Error sending SMS:\", error);\n      res.status(500).json({ error: \"Failed to send SMS\" });\n    }\n  });\n\n  app.get(\"/api/sms/templates\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const templates = await storage.getSMSTemplates(userId);\n      res.json(templates);\n    } catch (error) {\n      console.error(\"Error fetching SMS templates:\", error);\n      res.status(500).json({ error: \"Failed to fetch SMS templates\" });\n    }\n  });\n\n  app.post(\"/api/sms/templates\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const templateData = insertSMSTemplateSchema.parse(req.body);\n      const template = await storage.createSMSTemplate(userId, templateData);\n      res.status(201).json(template);\n    } catch (error) {\n      console.error(\"Error creating SMS template:\", error);\n      res.status(500).json({ error: \"Failed to create SMS template\" });\n    }\n  });\n\n  // NetGSM SMS sending function (real implementation)\n  async function sendSMSViaNetGSM(message: string, recipients: Array<{id: string, name: string, phone: string, type: string}>): Promise<any> {\n    const username = process.env.NETGSM_USERNAME;\n    const password = process.env.NETGSM_PASSWORD;\n    const header = process.env.NETGSM_HEADER;\n\n    // If no API credentials, use mock mode\n    if (!username || !password || !header) {\n      console.log('NetGSM credentials not found, using mock mode');\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      return {\n        status: 'mock_success',\n        messageId: `mock_${Date.now()}`,\n        recipientCount: recipients.length,\n        note: 'SMS not sent - NetGSM credentials required'\n      };\n    }\n\n    try {\n      // Real NetGSM API call\n      const phoneNumbers = recipients.map(r => r.phone).filter(p => p).join(',');\n      \n      const fetch = (await import('node-fetch')).default;\n      const response = await fetch('https://api.netgsm.com.tr/sms/send/get', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: new URLSearchParams({\n          usercode: username,\n          password: password,\n          gsmno: phoneNumbers,\n          message: message,\n          msgheader: header\n        })\n      });\n\n      const result = await response.text();\n      \n      // NetGSM returns different response formats\n      if (result.startsWith('00') || result.includes('OK')) {\n        return {\n          status: 'success',\n          messageId: result,\n          recipientCount: recipients.length,\n          cost: recipients.length * Math.ceil(message.length / 160) * 0.08,\n          timestamp: new Date().toISOString(),\n          details: recipients.map(r => ({\n            phone: r.phone,\n            status: 'sent',\n            messageId: `msg_${r.id}_${Date.now()}`\n          }))\n        };\n      } else {\n        throw new Error(`NetGSM API Error: ${result}`);\n      }\n    } catch (error) {\n      console.error('NetGSM API Error:', error);\n      throw error;\n    }\n  }\n\n  // Admin Panel Routes with SUPER_ADMIN support\n  const isAdmin = (req: any, res: any, next: any) => {\n    if (!req.user || (!req.user.isAdmin && req.user.role !== 'ADMIN' && req.user.role !== 'SUPER_ADMIN')) {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    next();\n  };\n\n  const isSuperAdmin = (req: any, res: any, next: any) => {\n    if (!req.user || req.user.role !== 'SUPER_ADMIN') {\n      return res.status(403).json({ error: \"Super Admin access required\" });\n    }\n    next();\n  };\n\n  app.get(\"/api/admin/dashboard-stats\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const stats = await storage.getDashboardStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching admin dashboard stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch dashboard stats\" });\n    }\n  });\n\n  app.get(\"/api/admin/users\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const users = await storage.getAllUsersForAdmin();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching all users:\", error);\n      res.status(500).json({ error: \"Failed to fetch users\" });\n    }\n  });\n\n  // Admin users endpoints\n  app.get('/api/admin/users', isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.put('/api/admin/users/:userId/admin', isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { isAdmin: makeAdmin } = req.body;\n      await storage.updateUserAdminStatus(userId, makeAdmin);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating user admin status:\", error);\n      res.status(500).json({ message: \"Failed to update admin status\" });\n    }\n  });\n\n  app.put('/api/admin/users/:userId/active', isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { isActive } = req.body;\n      await storage.updateUserActiveStatus(userId, isActive);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating user active status:\", error);\n      res.status(500).json({ message: \"Failed to update active status\" });\n    }\n  });\n\n  // DELETE individual user - Only for SUPER_ADMIN\n  app.delete('/api/admin/users/:userId', isAuthenticated, isSuperAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const currentUser = (req as any).user;\n      \n      // Prevent self-deletion\n      if (currentUser.id === userId) {\n        return res.status(400).json({ message: \"Cannot delete yourself\" });\n      }\n      \n      // Get user to check if it's SUPER_ADMIN\n      const userToDelete = await storage.getUser(userId);\n      if (!userToDelete) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Prevent deleting other SUPER_ADMINs\n      if (userToDelete.role === 'SUPER_ADMIN') {\n        return res.status(403).json({ message: \"Cannot delete SUPER_ADMIN users\" });\n      }\n      \n      const success = await storage.deleteUser(userId);\n      if (!success) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json({ success: true, message: \"User deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Failed to delete user\" });\n    }\n  });\n\n  // Admin settings endpoints\n  app.get('/api/admin/settings', isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const settings = await storage.getSystemSettings();\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching system settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch settings\" });\n    }\n  });\n\n  app.post('/api/admin/settings', isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const setting = req.body;\n      await storage.saveSystemSetting(setting);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error saving setting:\", error);\n      res.status(500).json({ message: \"Failed to save setting\" });\n    }\n  });\n\n  app.get(\"/api/admin/logs\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 100;\n      const logs = await storage.getAdminLogs(limit);\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Error fetching admin logs:\", error);\n      res.status(500).json({ error: \"Failed to fetch admin logs\" });\n    }\n  });\n\n  app.post(\"/api/admin/logs\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const logData = {\n        ...req.body,\n        adminUserId: req.user.id,\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      };\n      const log = await storage.createAdminLog(logData);\n      res.status(201).json(log);\n    } catch (error) {\n      console.error(\"Error creating admin log:\", error);\n      res.status(500).json({ error: \"Failed to create admin log\" });\n    }\n  });\n\n  // Admin Notes endpoints\n  app.get(\"/api/admin/users/:userId/notes\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const notes = await storage.getAdminNotesByUser(userId);\n      res.json(notes);\n    } catch (error) {\n      console.error(\"Error fetching admin notes:\", error);\n      res.status(500).json({ error: \"Failed to fetch admin notes\" });\n    }\n  });\n\n  app.post(\"/api/admin/users/:userId/notes\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const { note, category = \"general\" } = req.body;\n      \n      const noteData = {\n        targetUserId: userId,\n        adminUserId: req.user.id,\n        note,\n        category,\n        isPrivate: true\n      };\n      \n      const adminNote = await storage.createAdminNote(noteData);\n      \n      // Also create an admin log for audit purposes\n      await storage.createAdminLog({\n        adminUserId: req.user.id,\n        action: \"ADMIN_NOTE_ADDED\",\n        targetEntity: \"User\",\n        targetId: userId,\n        details: { noteId: adminNote.id, category, notePreview: note.substring(0, 50) },\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent')\n      });\n      \n      res.status(201).json(adminNote);\n    } catch (error) {\n      console.error(\"Error creating admin note:\", error);\n      res.status(500).json({ error: \"Failed to create admin note\" });\n    }\n  });\n\n  // Payment Notification endpoints\n  app.post(\"/api/payment/notify\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      \n      // Convert paymentDate string to Date object\n      const processedBody = {\n        ...req.body,\n        paymentDate: new Date(req.body.paymentDate)\n      };\n      \n      const paymentData = insertPaymentNotificationSchema.parse(processedBody);\n      \n      // Create payment notification record\n      const notification = await storage.createPaymentNotification(userId, paymentData);\n      \n      // Send email notification to admin\n      await sendPaymentNotificationEmail(notification, req.user);\n      \n      res.status(201).json({\n        success: true,\n        message: \"Ödeme bildiriminiz alındı. En kısa sürede işleme alınacaktır.\",\n        notificationId: notification.id\n      });\n    } catch (error) {\n      console.error(\"Error creating payment notification:\", error);\n      res.status(500).json({ error: \"Failed to create payment notification\" });\n    }\n  });\n\n  // Email sending function for payment notifications\n  async function sendPaymentNotificationEmail(notification: any, user: any) {\n    try {\n      // Create transporter (using Gmail as example - can be configured)\n      const transporter = nodemailer.createTransport({\n        service: 'gmail',\n        auth: {\n          user: process.env.EMAIL_USER || 'admin@puantropls.com',\n          pass: process.env.EMAIL_PASSWORD || 'defaultpassword'\n        }\n      });\n\n      const emailContent = `\nYeni Ödeme Bildirimi - puantropls\n\nKullanıcı Bilgileri:\n- Email: ${user.email}\n- Kullanıcı ID: ${user.id}\n\nÖdeme Detayları:\n- Ödeme Tarihi: ${notification.paymentDate}\n- Gönderen: ${notification.senderName}\n- Banka: ${notification.senderBank}\n- Tutar: ${notification.amount}\n- Açıklama: ${notification.description || 'Belirtilmemiş'}\n\nBu ödeme bildirimini admin panelinden onaylayabilirsiniz.\n\npuantropls Admin Sistemi\n      `;\n\n      await transporter.sendMail({\n        from: process.env.EMAIL_USER || 'admin@puantropls.com',\n        to: 'admin@puantropls.com',\n        subject: `Yeni Ödeme Bildirimi - ${user.email}`,\n        text: emailContent\n      });\n\n      console.log('Payment notification email sent successfully');\n    } catch (error) {\n      console.error('Error sending payment notification email:', error);\n      // Don't throw error - notification should still be created even if email fails\n    }\n  }\n\n  // Admin sessions endpoints\n  app.get(\"/api/admin/sessions\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const sessions = await storage.getActiveSessions();\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching sessions:\", error);\n      res.status(500).json({ error: \"Failed to fetch sessions\" });\n    }\n  });\n\n  app.post(\"/api/admin/sessions/:sessionId/terminate\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { sessionId } = req.params;\n      await storage.terminateSession(sessionId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error terminating session:\", error);\n      res.status(500).json({ error: \"Failed to terminate session\" });\n    }\n  });\n\n  app.get(\"/api/admin/settings\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const settings = await storage.getSystemSettings();\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching system settings:\", error);\n      res.status(500).json({ error: \"Failed to fetch system settings\" });\n    }\n  });\n\n  app.post(\"/api/admin/settings\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const settingData = {\n        ...req.body,\n        updatedBy: req.user.id,\n      };\n      const setting = await storage.createSystemSetting(settingData);\n      res.status(201).json(setting);\n    } catch (error) {\n      console.error(\"Error creating system setting:\", error);\n      res.status(500).json({ error: \"Failed to create system setting\" });\n    }\n  });\n\n  // Admin announcements management  \n  app.get(\"/api/admin/announcements\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user?.isAdmin && user?.role !== 'ADMIN' && user?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      // Mock announcements data - in real app would come from database\n      const announcements = [\n        {\n          id: \"ann_1\",\n          title: \"Sistem Güncellemesi\",\n          content: \"Sistem bu akşam 22:00-24:00 arasında güncellenecektir.\",\n          priority: \"high\",\n          createdAt: new Date().toISOString(),\n          isActive: true\n        },\n        {\n          id: \"ann_2\", \n          title: \"Yeni Özellikler\",\n          content: \"Toplu SMS ve gelişmiş raporlama özellikleri eklendi.\",\n          priority: \"normal\",\n          createdAt: new Date(Date.now() - 86400000).toISOString(),\n          isActive: true\n        }\n      ];\n      \n      res.json(announcements);\n    } catch (error) {\n      console.error(\"Error fetching announcements:\", error);\n      res.status(500).json({ error: \"Failed to fetch announcements\" });\n    }\n  });\n\n  app.post(\"/api/admin/announcements\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user?.isAdmin && user?.role !== 'ADMIN' && user?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      const { title, content, priority } = req.body;\n      const announcement = {\n        id: `ann_${Date.now()}`,\n        title,\n        content,\n        priority,\n        createdAt: new Date().toISOString(),\n        isActive: true\n      };\n      \n      console.log(\"Creating announcement:\", announcement);\n      res.status(201).json(announcement);\n    } catch (error) {\n      console.error(\"Error creating announcement:\", error);\n      res.status(500).json({ error: \"Failed to create announcement\" });\n    }\n  });\n\n  // Payment Notification Admin Endpoints\n  app.get(\"/api/admin/payment-notifications\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const { status } = req.query;\n      let notifications;\n      \n      if (status) {\n        notifications = await storage.getPaymentNotificationsByStatus(status as string);\n      } else {\n        notifications = await storage.getPaymentNotifications();\n      }\n      \n      // Get user details for each notification\n      const notificationsWithUsers = await Promise.all(\n        notifications.map(async (notification) => {\n          const user = await storage.getUser(notification.userId);\n          return {\n            ...notification,\n            user: user ? { id: user.id, email: user.email, firstName: user.firstName, lastName: user.lastName } : null\n          };\n        })\n      );\n      \n      res.json(notificationsWithUsers);\n    } catch (error) {\n      console.error('Error fetching payment notifications:', error);\n      res.status(500).json({ error: \"Failed to fetch payment notifications\" });\n    }\n  });\n\n  app.put(\"/api/admin/payment-notifications/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const { status, adminNote } = req.body;\n      const adminUserId = req.user.id;\n      \n      if (!['approved', 'rejected', 'pending'].includes(status)) {\n        return res.status(400).json({ error: \"Invalid status\" });\n      }\n      \n      const updatedNotification = await storage.updatePaymentNotificationStatus(\n        id, \n        status, \n        adminUserId, \n        adminNote\n      );\n      \n      if (!updatedNotification) {\n        return res.status(404).json({ error: \"Payment notification not found\" });\n      }\n      \n      // If payment is approved, upgrade user to PRO\n      if (status === 'approved' && updatedNotification) {\n        try {\n          await storage.updateUserSubscriptionType(updatedNotification.userId, 'PRO');\n          \n          // Log the subscription upgrade\n          await storage.createAdminLog({\n            adminUserId,\n            action: `USER_UPGRADED_TO_PRO`,\n            targetEntity: \"User\",\n            targetId: updatedNotification.userId,\n            details: { reason: 'Payment approved', paymentNotificationId: id },\n            ipAddress: req.ip,\n            userAgent: req.get('User-Agent'),\n          });\n        } catch (upgradeError) {\n          console.error('Error upgrading user to PRO:', upgradeError);\n          // Continue even if upgrade fails - payment is still approved\n        }\n      }\n      \n      // Log admin action\n      await storage.createAdminLog({\n        adminUserId,\n        action: `PAYMENT_NOTIFICATION_${status.toUpperCase()}`,\n        targetEntity: \"PaymentNotification\",\n        targetId: id,\n        details: { status, adminNote },\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.json(updatedNotification);\n    } catch (error) {\n      console.error('Error updating payment notification:', error);\n      res.status(500).json({ error: \"Failed to update payment notification\" });\n    }\n  });\n\n  // SUPER_ADMIN Exclusive Routes\n  \n  // Role Management (USER ⇄ ADMIN)\n  app.put(\"/api/admin/users/:userId/role\", isAuthenticated, async (req: any, res) => {\n    try {\n      const currentUserId = req.user.id;\n      const currentUser = await storage.getUser(currentUserId);\n      \n      // Only SUPER_ADMIN can change roles\n      if (currentUser?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Only SUPER_ADMIN can change user roles\" });\n      }\n\n      const { userId } = req.params;\n      const { role } = req.body;\n      \n      // Don't allow SUPER_ADMIN to change their own role\n      if (userId === currentUserId) {\n        return res.status(403).json({ error: \"Cannot change your own role\" });\n      }\n      \n      const targetUser = await storage.getUser(userId);\n      if (targetUser?.role === 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Cannot change SUPER_ADMIN role\" });\n      }\n      \n      if (role !== 'USER' && role !== 'ADMIN') {\n        return res.status(400).json({ error: \"Invalid role. Only USER or ADMIN allowed.\" });\n      }\n      \n      await storage.updateUserRole(userId, role);\n      \n      // Log this action\n      await storage.createAdminLog({\n        action: `Role changed to ${role}`,\n        adminUserId: req.user.id,\n        targetEntity: `User:${userId}`,\n        targetEntityId: userId,\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating user role:\", error);\n      res.status(500).json({ error: \"Failed to update user role\" });\n    }\n  });\n\n  // Status Management (ACTIVE ⇄ SUSPENDED)\n  app.put(\"/api/admin/users/:userId/status\", isAuthenticated, async (req: any, res) => {\n    try {\n      const currentUserId = req.user.id;\n      const currentUser = await storage.getUser(currentUserId);\n      \n      // Only admins can change status\n      if (!currentUser?.isAdmin && currentUser?.role !== 'ADMIN' && currentUser?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      const { userId } = req.params;\n      const { status } = req.body;\n      \n      if (status !== 'ACTIVE' && status !== 'SUSPENDED') {\n        return res.status(400).json({ error: \"Invalid status. Only ACTIVE or SUSPENDED allowed.\" });\n      }\n      \n      await storage.updateUserStatus(userId, status);\n      \n      // Log this action\n      await storage.createAdminLog({\n        action: `Status changed to ${status}`,\n        adminUserId: req.user.id,\n        targetEntity: `User:${userId}`,\n        targetEntityId: userId,\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating user status:\", error);\n      res.status(500).json({ error: \"Failed to update user status\" });\n    }\n  });\n\n  // Force logout all sessions\n  app.post(\"/api/admin/users/:userId/terminate-sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const currentUserId = req.user.id;\n      const currentUser = await storage.getUser(currentUserId);\n      \n      // Only admins can terminate sessions\n      if (!currentUser?.isAdmin && currentUser?.role !== 'ADMIN' && currentUser?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      const { userId } = req.params;\n      \n      // Terminate all user sessions\n      await storage.terminateAllUserSessions(userId);\n      \n      // Log this action\n      await storage.createAdminLog({\n        action: \"All sessions terminated\",\n        adminUserId: req.user.id,\n        targetEntity: `User:${userId}`,\n        targetEntityId: userId,\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error terminating user sessions:\", error);\n      res.status(500).json({ error: \"Failed to terminate user sessions\" });\n    }\n  });\n\n  // Send password reset link\n  app.post(\"/api/admin/users/:userId/reset-password\", isAuthenticated, async (req: any, res) => {\n    try {\n      const currentUserId = req.user.id;\n      const currentUser = await storage.getUser(currentUserId);\n      \n      // Only admins can send password reset\n      if (!currentUser?.isAdmin && currentUser?.role !== 'ADMIN' && currentUser?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      const { userId } = req.params;\n      \n      // Generate password reset link and send email\n      const resetToken = await storage.createPasswordResetToken(userId);\n      \n      // Log this action\n      await storage.createAdminLog({\n        action: \"Password reset link sent\",\n        adminUserId: req.user.id,\n        targetEntity: `User:${userId}`,\n        targetEntityId: userId,\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.json({ success: true, message: \"Password reset link sent to user email\" });\n    } catch (error) {\n      console.error(\"Error sending password reset:\", error);\n      res.status(500).json({ error: \"Failed to send password reset link\" });\n    }\n  });\n\n  // Create invitation\n  app.post(\"/api/admin/invitations\", isAuthenticated, async (req: any, res) => {\n    try {\n      const currentUserId = req.user.id;\n      const currentUser = await storage.getUser(currentUserId);\n      \n      // Only SUPER_ADMIN can create invitations\n      if (currentUser?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Only SUPER_ADMIN can send invitations\" });\n      }\n\n      const { email, role } = req.body;\n      \n      if (!email || (role !== 'USER' && role !== 'ADMIN')) {\n        return res.status(400).json({ error: \"Valid email and role (USER or ADMIN) required\" });\n      }\n      \n      const invitation = await storage.createInvitation({\n        email,\n        role,\n        invitedBy: req.user.id,\n        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days\n      });\n      \n      // Log this action\n      await storage.createAdminLog({\n        action: `Invitation sent to ${email} with ${role} role`,\n        adminUserId: req.user.id,\n        targetEntity: `Invitation:${email}`,\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.status(201).json(invitation);\n    } catch (error) {\n      console.error(\"Error creating invitation:\", error);\n      res.status(500).json({ error: \"Failed to create invitation\" });\n    }\n  });\n\n  app.get(\"/api/admin/announcements\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const announcements = await storage.getAnnouncements();\n      res.json(announcements);\n    } catch (error) {\n      console.error(\"Error fetching announcements:\", error);\n      res.status(500).json({ error: \"Failed to fetch announcements\" });\n    }\n  });\n\n  app.post(\"/api/admin/announcements\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const announcementData = {\n        ...req.body,\n        createdBy: req.user.id,\n      };\n      const announcement = await storage.createAnnouncement(announcementData);\n      \n      // Log the action\n      await storage.createAdminLog({\n        adminUserId: req.user.id,\n        action: \"ANNOUNCEMENT_CREATED\",\n        targetEntity: \"Announcement\",\n        targetId: announcement.id,\n        details: { title: announcement.title },\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.status(201).json(announcement);\n    } catch (error) {\n      console.error(\"Error creating announcement:\", error);\n      res.status(500).json({ error: \"Failed to create announcement\" });\n    }\n  });\n\n  app.put(\"/api/admin/announcements/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const announcement = await storage.updateAnnouncement(id, req.body);\n      if (!announcement) {\n        return res.status(404).json({ error: \"Announcement not found\" });\n      }\n      \n      // Log the action\n      await storage.createAdminLog({\n        adminUserId: req.user.id,\n        action: \"ANNOUNCEMENT_UPDATED\",\n        targetEntity: \"Announcement\",\n        targetId: id,\n        details: { title: announcement.title },\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.json(announcement);\n    } catch (error) {\n      console.error(\"Error updating announcement:\", error);\n      res.status(500).json({ error: \"Failed to update announcement\" });\n    }\n  });\n\n  app.delete(\"/api/admin/announcements/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteAnnouncement(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Announcement not found\" });\n      }\n      \n      // Log the action\n      await storage.createAdminLog({\n        adminUserId: req.user.id,\n        action: \"ANNOUNCEMENT_DELETED\",\n        targetEntity: \"Announcement\",\n        targetId: id,\n        details: {},\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting announcement:\", error);\n      res.status(500).json({ error: \"Failed to delete announcement\" });\n    }\n  });\n\n  app.get(\"/api/admin/sessions\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const sessions = await storage.getUserSessions();\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching user sessions:\", error);\n      res.status(500).json({ error: \"Failed to fetch user sessions\" });\n    }\n  });\n\n  app.get(\"/api/admin/system-metrics\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const metricType = req.query.type as string;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 100;\n      const metrics = await storage.getSystemMetrics(metricType, limit);\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching system metrics:\", error);\n      res.status(500).json({ error: \"Failed to fetch system metrics\" });\n    }\n  });\n\n  // Delete all users except super admin\n  app.post(\"/api/admin/users/delete-all-except-super\", isAuthenticated, async (req: any, res) => {\n    try {\n      const currentUserId = req.user.id;\n      const currentUser = await storage.getUser(currentUserId);\n      \n      // Only SUPER_ADMIN can delete all users\n      if (currentUser?.role !== 'SUPER_ADMIN') {\n        return res.status(403).json({ error: \"Only SUPER_ADMIN can delete all users\" });\n      }\n\n      // Get all users except super admin\n      const allUsers = await storage.getAllUsers();\n      const usersToDelete = allUsers.filter(user => user.role !== 'SUPER_ADMIN');\n      \n      console.log(`Found ${usersToDelete.length} users to delete (excluding super admin)`);\n      \n      let deletedCount = 0;\n      for (const user of usersToDelete) {\n        try {\n          // Delete all user-related data first\n          await storage.deleteAllUserData(user.id);\n          deletedCount++;\n          console.log(`Deleted user: ${user.email} (${user.id})`);\n        } catch (error) {\n          console.error(`Error deleting user ${user.email}:`, error);\n        }\n      }\n      \n      // Log this action\n      await storage.createAdminLog({\n        action: `Deleted ${deletedCount} users (excluding super admin)`,\n        adminUserId: req.user.id,\n        targetEntity: \"System\",\n        targetEntityId: \"bulk_delete\",\n        ipAddress: req.ip,\n        userAgent: req.get('User-Agent'),\n      });\n      \n      res.json({ \n        success: true, \n        deletedCount,\n        message: `Successfully deleted ${deletedCount} users (super admin preserved)`\n      });\n    } catch (error) {\n      console.error(\"Error deleting all users:\", error);\n      res.status(500).json({ error: \"Failed to delete users\" });\n    }\n  });\n\n  // Payment settings endpoints\n  app.get(\"/api/admin/payment-settings\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const settings = await storage.getPaymentSettings();\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching payment settings:\", error);\n      res.status(500).json({ error: \"Failed to fetch payment settings\" });\n    }\n  });\n\n  app.put(\"/api/admin/payment-settings\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const data = insertPaymentSettingsSchema.parse(req.body);\n      const settings = await storage.updatePaymentSettings(data);\n      \n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error updating payment settings:\", error);\n      res.status(500).json({ error: \"Failed to update payment settings\" });\n    }\n  });\n\n  // Payment info for regular users\n  app.get(\"/api/payment-info\", isAuthenticated, async (req: any, res) => {\n    try {\n      const settings = await storage.getPaymentSettings();\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching payment info:\", error);\n      res.status(500).json({ error: \"Failed to fetch payment info\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":137620},"server/storage.ts":{"content":"import { \n  type Personnel, type InsertPersonnel,\n  type Project, type InsertProject,\n  type Timesheet, type InsertTimesheet,\n  type Transaction, type InsertTransaction,\n  type Note, type InsertNote,\n  type Contractor, type InsertContractor,\n  type Customer, type InsertCustomer,\n  type CustomerTask, type InsertCustomerTask,\n  type CustomerQuote, type InsertCustomerQuote,\n  type CustomerQuoteItem, type InsertCustomerQuoteItem,\n  type CustomerPayment, type InsertCustomerPayment,\n  type ContractorTask, type InsertContractorTask,\n  type ContractorPayment, type InsertContractorPayment,\n  type PersonnelPayment, type InsertPersonnelPayment,\n  type CompanyDirectory, type InsertCompanyDirectory,\n  type Message, type InsertMessage,\n  type Conversation, type InsertConversation,\n  type Notification, type InsertNotification,\n  type CompanyBlock, type InsertCompanyBlock,\n  type CompanyMute, type InsertCompanyMute,\n  type AbuseReport, type InsertAbuseReport,\n  type User, type UpsertUser,\n  type FirmInvite, type InsertFirmInvite,\n  type PresenceLog, type InsertPresenceLog,\n  type MessageDraft, type InsertMessageDraft,\n  type AutoResponder, type InsertAutoResponder,\n  type DirectThread, type InsertDirectThread,\n  type DirectMessage, type InsertDirectMessage,\n  type ImageUpload, type InsertImageUpload,\n  type SMSHistory, type InsertSMSHistory,\n  type SMSTemplate, type InsertSMSTemplate,\n  type PaymentNotification, type InsertPaymentNotification,\n  type AdminLog, type InsertAdminLog,\n  type SystemSetting, type InsertSystemSetting,\n  type Announcement, type InsertAnnouncement,\n  type UserSession, type InsertUserSession,\n  type SystemMetric, type InsertSystemMetric,\n  type AdminNote, type InsertAdminNote,\n  type PaymentSettings, type InsertPaymentSettings,\n  personnel, projects, timesheets, transactions, notes, contractors, customers,\n  customerTasks, customerQuotes, customerQuoteItems, customerPayments, contractorTasks, contractorPayments, personnelPayments,\n  companyDirectory, messages, conversations, notifications, companyBlocks, companyMutes, abuseReports, users,\n  firmInvites, presenceLogs, messageDrafts, autoResponders, directThreads, directMessages, imageUploads, autoReplyLogs,\n  smsHistory, smsTemplates, paymentNotifications, adminLogs, systemSettings, announcements, userSessions, systemMetrics, adminNotes, paymentSettings\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, or, inArray, desc, sql, isNull, ne } from \"drizzle-orm\";\nimport { randomUUID } from \"crypto\";\n\nexport interface IStorage {\n  // User operations for authentication\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  updateUser(id: string, user: Partial<UpsertUser>): Promise<User | undefined>;\n  updateUserSubscriptionType(userId: string, subscriptionType: string): Promise<void>;\n  updateUserSubscription(userId: string, subscription: { subscriptionType: string, subscriptionStatus: string, subscriptionEndDate?: Date }): Promise<User | undefined>;\n  \n  // Admin operations\n  getAllUsers(): Promise<User[]>;\n  updateUserAdminStatus(userId: string, isAdmin: boolean): Promise<void>;\n  updateUserActiveStatus(userId: string, isActive: boolean): Promise<void>;\n  deleteAllUserData(userId: string): Promise<void>;\n  getSystemSettings(): Promise<SystemSetting[]>;\n  saveSystemSetting(setting: InsertSystemSetting): Promise<SystemSetting>;\n  getAdminStats(): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    demoUsers: number;\n    todayRegistrations: number;\n  }>;\n\n  // Admin Notes\n  getAdminNotesByUser(targetUserId: string): Promise<AdminNote[]>;\n  createAdminNote(note: InsertAdminNote): Promise<AdminNote>;\n  getAdminLogsRecent(): Promise<AdminLog[]>;\n  createAdminLog(log: InsertAdminLog): Promise<AdminLog>;\n  getSystemMetrics(): Promise<SystemMetric[]>;\n  createSystemMetric(metric: InsertSystemMetric): Promise<SystemMetric>;\n\n  // Personnel\n  getPersonnel(): Promise<Personnel[]>;\n  getPersonnelByUserId(userId: string): Promise<Personnel[]>;\n  getPersonnelById(id: string): Promise<Personnel | undefined>;\n  createPersonnel(personnel: InsertPersonnel): Promise<Personnel>;\n  updatePersonnel(id: string, personnel: Partial<InsertPersonnel>): Promise<Personnel | undefined>;\n  deletePersonnel(id: string): Promise<boolean>;\n\n  // Projects\n  getProjects(): Promise<Project[]>;\n  getProjectsByUserId(userId: string): Promise<Project[]>;\n  getProjectById(id: string): Promise<Project | undefined>;\n  createProject(project: InsertProject): Promise<Project>;\n  updateProject(id: string, project: Partial<InsertProject>): Promise<Project | undefined>;\n  deleteProject(id: string): Promise<boolean>;\n\n  // Timesheets\n  getTimesheets(): Promise<Timesheet[]>;\n  getTimesheetsByPersonnel(personnelId: string): Promise<Timesheet[]>;\n  createTimesheet(timesheet: InsertTimesheet): Promise<Timesheet>;\n  updateTimesheet(id: string, timesheet: Partial<InsertTimesheet>): Promise<Timesheet | undefined>;\n  deleteTimesheet(id: string): Promise<boolean>;\n\n  // Transactions\n  getTransactions(): Promise<Transaction[]>;\n  getTransactionsByUserId(userId: string): Promise<Transaction[]>;\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n  updateTransaction(id: string, transaction: Partial<InsertTransaction>): Promise<Transaction | undefined>;\n  deleteTransaction(id: string): Promise<boolean>;\n\n  // Notes\n  getNotes(): Promise<Note[]>;\n  createNote(note: InsertNote): Promise<Note>;\n  deleteNote(id: string): Promise<boolean>;\n\n  // Contractors\n  getContractors(): Promise<Contractor[]>;\n  createContractor(contractor: InsertContractor): Promise<Contractor>;\n  updateContractor(id: string, contractor: Partial<InsertContractor>): Promise<Contractor | undefined>;\n  deleteContractor(id: string): Promise<boolean>;\n\n  // Customers\n  getCustomers(): Promise<Customer[]>;\n  getCustomersByUserId(userId: string): Promise<Customer[]>;\n  getCustomer(id: string): Promise<Customer | undefined>;\n  getCustomerById(id: string): Promise<Customer | undefined>;\n  createCustomer(customer: InsertCustomer): Promise<Customer>;\n  updateCustomer(id: string, customer: Partial<InsertCustomer>): Promise<Customer | undefined>;\n  deleteCustomer(id: string): Promise<boolean>;\n\n  // Customer Tasks\n  getCustomerTasks(): Promise<CustomerTask[]>;\n  getCustomerTasksByUserId(userId: string): Promise<CustomerTask[]>;\n  getCustomerTasksByCustomerId(customerId: string): Promise<CustomerTask[]>;\n  createCustomerTask(task: InsertCustomerTask): Promise<CustomerTask>;\n  updateCustomerTask(id: string, task: Partial<InsertCustomerTask>): Promise<CustomerTask | undefined>;\n  deleteCustomerTask(id: string): Promise<boolean>;\n\n  // Customer Quotes\n  getCustomerQuotes(): Promise<CustomerQuote[]>;\n  getCustomerQuotesByUserId(userId: string): Promise<CustomerQuote[]>;\n  getCustomerQuotesByCustomerId(customerId: string): Promise<CustomerQuote[]>;\n  createCustomerQuote(quote: InsertCustomerQuote): Promise<CustomerQuote>;\n  updateCustomerQuote(id: string, quote: Partial<InsertCustomerQuote>): Promise<CustomerQuote | undefined>;\n  deleteCustomerQuote(id: string): Promise<boolean>;\n  \n  // Customer Quote Items\n  getCustomerQuoteItems(): Promise<CustomerQuoteItem[]>;\n  getCustomerQuoteItemsByQuoteId(quoteId: string): Promise<CustomerQuoteItem[]>;\n  createCustomerQuoteItem(item: InsertCustomerQuoteItem): Promise<CustomerQuoteItem>;\n  updateCustomerQuoteItem(id: string, item: Partial<InsertCustomerQuoteItem>): Promise<CustomerQuoteItem | undefined>;\n  deleteCustomerQuoteItem(id: string): Promise<boolean>;\n\n  // Customer Payments\n  getCustomerPayments(): Promise<CustomerPayment[]>;\n  getCustomerPaymentsByUserId(userId: string): Promise<CustomerPayment[]>;\n  getCustomerPayment(id: string): Promise<CustomerPayment | undefined>;\n  getCustomerPaymentsByCustomerId(customerId: string): Promise<CustomerPayment[]>;\n  createCustomerPayment(payment: InsertCustomerPayment): Promise<CustomerPayment>;\n  deleteCustomerPayment(id: string): Promise<boolean>;\n\n  // Personnel Payments\n  getPersonnelPayments(): Promise<PersonnelPayment[]>;\n  getPersonnelPayment(id: string): Promise<PersonnelPayment | undefined>;\n  getPersonnelPaymentsByPersonnelId(personnelId: string): Promise<PersonnelPayment[]>;\n  createPersonnelPayment(payment: InsertPersonnelPayment): Promise<PersonnelPayment>;\n  updatePersonnelPayment(id: string, payment: Partial<InsertPersonnelPayment>): Promise<PersonnelPayment | undefined>;\n  deletePersonnelPayment(id: string): Promise<boolean>;\n\n  // Contractor Tasks\n  getContractorTasks(): Promise<ContractorTask[]>;\n  getContractorTasksByContractorId(contractorId: string): Promise<ContractorTask[]>;\n  createContractorTask(task: InsertContractorTask): Promise<ContractorTask>;\n  updateContractorTask(id: string, task: Partial<InsertContractorTask>): Promise<ContractorTask | undefined>;\n  deleteContractorTask(id: string): Promise<boolean>;\n\n  // Contractor Payments\n  getContractorPayments(): Promise<ContractorPayment[]>;\n  getContractorPayment(id: string): Promise<ContractorPayment | undefined>;\n  getContractorPaymentsByContractorId(contractorId: string): Promise<ContractorPayment[]>;\n  createContractorPayment(payment: InsertContractorPayment): Promise<ContractorPayment>;\n  updateContractorPayment(id: string, payment: Partial<InsertContractorPayment>): Promise<ContractorPayment | undefined>;\n  deleteContractorPayment(id: string): Promise<boolean>;\n\n  // Project lookup for contractors (since we use projects table)\n  getProject(id: string): Promise<Project | undefined>;\n\n  // Company Directory\n  getCompanyDirectory(): Promise<CompanyDirectory[]>;\n  getCompanyDirectoryByUserId(userId: string): Promise<CompanyDirectory[]>;\n  getCompany(id: string): Promise<CompanyDirectory | undefined>;\n  createCompany(company: InsertCompanyDirectory, userId: string): Promise<CompanyDirectory>;\n  updateCompany(id: string, company: Partial<InsertCompanyDirectory>): Promise<CompanyDirectory | undefined>;\n  deleteCompany(id: string): Promise<boolean>;\n\n  // Messages\n  getMessages(): Promise<Message[]>;\n  getMessagesByUser(userId: string): Promise<Message[]>;\n  getMessagesByConversation(company1Id: string, company2Id: string): Promise<Message[]>;\n  getMessagesByConversationAndUser(company1Id: string, company2Id: string, userId: string): Promise<Message[]>;\n  createMessage(message: InsertMessage): Promise<Message>;\n  markMessageAsRead(id: string): Promise<boolean>;\n\n  // Conversations\n  getConversations(): Promise<Conversation[]>;\n  createConversation(conversation: InsertConversation): Promise<Conversation>;\n  updateConversation(id: string, conversation: Partial<InsertConversation>): Promise<Conversation | undefined>;\n\n  // Firm Invites\n  createFirmInvite(invite: InsertFirmInvite & { tokenHash: string }): Promise<FirmInvite>;\n  getFirmInvitesByToken(tokenHash: string): Promise<FirmInvite | undefined>;\n  getFirmInvitesByFirm(firmId: string): Promise<FirmInvite[]>;\n  acceptFirmInvite(id: string): Promise<boolean>;\n\n  // Presence\n  updatePresence(presenceLog: InsertPresenceLog): Promise<PresenceLog>;\n  getPresenceByFirmAndUser(firmId: string, userId: string): Promise<PresenceLog | undefined>;\n  getPresenceByFirm(firmId: string): Promise<PresenceLog[]>;\n  \n  // Message Drafts\n  getDraft(threadId: string, authorFirmId: string): Promise<MessageDraft | undefined>;\n  upsertDraft(draft: InsertMessageDraft): Promise<MessageDraft>;\n  deleteDraft(threadId: string, authorFirmId: string): Promise<boolean>;\n\n  // Auto Responders\n  getAutoResponder(firmId: string): Promise<AutoResponder | undefined>;\n  upsertAutoResponder(responder: InsertAutoResponder): Promise<AutoResponder>;\n  getAutoReplyLog(responderFirmId: string, targetFirmId: string): Promise<Date | undefined>;\n  setAutoReplyLog(responderFirmId: string, targetFirmId: string, messageId: string): Promise<void>;\n\n  // Direct Threads & Messages\n  getOrCreateDirectThread(firm1Id: string, firm2Id: string): Promise<DirectThread>;\n  getDirectThreads(firmId: string): Promise<DirectThread[]>;\n  getDirectThreadsByUserId(userId: string): Promise<DirectThread[]>;\n  getDirectThreadById(threadId: string): Promise<DirectThread | undefined>;\n  getDirectThreadMessages(threadId: string, offset?: number, limit?: number): Promise<DirectMessage[]>;\n  createDirectMessage(message: InsertDirectMessage): Promise<DirectMessage>;\n  markDirectMessageAsRead(messageId: string): Promise<boolean>;\n  \n  // Image Uploads\n  createImageUpload(upload: InsertImageUpload): Promise<ImageUpload>;\n\n  // SMS Management\n  getSMSHistory(userId: string): Promise<SMSHistory[]>;\n  createSMSHistory(userId: string, sms: InsertSMSHistory): Promise<SMSHistory>;\n  updateSMSHistory(id: string, updates: Partial<SMSHistory>): Promise<SMSHistory | undefined>;\n  getSMSTemplates(userId: string): Promise<SMSTemplate[]>;\n  createSMSTemplate(userId: string, template: InsertSMSTemplate): Promise<SMSTemplate>;\n\n  // Payment notification operations\n  createPaymentNotification(userId: string, notificationData: InsertPaymentNotification): Promise<PaymentNotification>;\n  getPaymentNotifications(): Promise<PaymentNotification[]>;\n  getPaymentNotificationsByStatus(status: string): Promise<PaymentNotification[]>;\n  updatePaymentNotificationStatus(id: string, status: string, processedBy?: string, adminNote?: string): Promise<PaymentNotification | undefined>;\n\n  // Payment Notifications\n  createPaymentNotification(userId: string, notification: InsertPaymentNotification): Promise<PaymentNotification>;\n  getPaymentNotifications(): Promise<PaymentNotification[]>;\n  getPaymentNotificationsByStatus(status: string): Promise<PaymentNotification[]>;\n  getPaymentNotificationsByUser(userId: string): Promise<PaymentNotification[]>;\n  updatePaymentNotificationStatus(id: string, status: string, adminNote?: string, processedBy?: string): Promise<PaymentNotification | undefined>;\n\n  // Admin Panel Operations\n  getAllUsersForAdmin(): Promise<User[]>;\n  createAdminLog(log: InsertAdminLog): Promise<AdminLog>;\n  getAdminLogs(limit?: number): Promise<AdminLog[]>;\n  getSystemSettings(): Promise<SystemSetting[]>;\n  getSystemSetting(key: string): Promise<SystemSetting | undefined>;\n  upsertSystemSetting(setting: InsertSystemSetting): Promise<SystemSetting>;\n  getAnnouncements(): Promise<Announcement[]>;\n  createAnnouncement(announcement: InsertAnnouncement): Promise<Announcement>;\n  updateAnnouncement(id: string, updates: Partial<InsertAnnouncement>): Promise<Announcement | undefined>;\n  deleteAnnouncement(id: string): Promise<boolean>;\n  getUserSessions(): Promise<UserSession[]>;\n  getUserSessionsByUserId(userId: string): Promise<UserSession[]>;\n  createUserSession(session: InsertUserSession): Promise<UserSession>;\n  deactivateUserSession(id: string): Promise<boolean>;\n  getSystemMetrics(metricType?: string, limit?: number): Promise<SystemMetric[]>;\n  createSystemMetric(metric: InsertSystemMetric): Promise<SystemMetric>;\n  getDashboardStats(): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    totalMessages: number;\n    totalStorage: number;\n    registrationsThisMonth: number;\n    messagesThisMonth: number;\n  }>;\n\n  // Session management\n  getActiveSessions(): Promise<{\n    id: string;\n    userId: string;\n    userEmail: string;\n    ipAddress: string;\n    userAgent: string;\n    lastActivity: string;\n    createdAt: string;\n    isActive: boolean;\n    location?: string;\n  }[]>;\n  terminateSession(sessionId: string): Promise<boolean>;\n\n  // Payment settings for admin\n  getPaymentSettings(): Promise<PaymentSettings | undefined>;\n  updatePaymentSettings(settings: InsertPaymentSettings): Promise<PaymentSettings>;\n}\n\nexport class MemStorage implements IStorage {\n  private personnel: Map<string, Personnel> = new Map();\n  private projects: Map<string, Project> = new Map();\n  private timesheets: Map<string, Timesheet> = new Map();\n  private transactions: Map<string, Transaction> = new Map();\n  private notes: Map<string, Note> = new Map();\n  private contractors: Map<string, Contractor> = new Map();\n  private customers: Map<string, Customer> = new Map();\n  private customerTasks: Map<string, CustomerTask> = new Map();\n  private customerQuotes: Map<string, CustomerQuote> = new Map();\n  private customerQuoteItems: Map<string, CustomerQuoteItem> = new Map();\n  private customerPayments: Map<string, CustomerPayment> = new Map();\n  private contractorTasks: Map<string, ContractorTask> = new Map();\n  private contractorPayments: Map<string, ContractorPayment> = new Map();\n  private personnelPayments: Map<string, PersonnelPayment> = new Map();\n\n  constructor() {\n    // Initialize with empty data\n  }\n\n  // Personnel methods\n  async getPersonnel(): Promise<Personnel[]> {\n    return Array.from(this.personnel.values());\n  }\n\n  async getPersonnelById(id: string): Promise<Personnel | undefined> {\n    return this.personnel.get(id);\n  }\n\n  async createPersonnel(insertPersonnel: InsertPersonnel): Promise<Personnel> {\n    const id = randomUUID();\n    const personnel: Personnel = {\n      ...insertPersonnel,\n      id,\n      createdAt: new Date(),\n      phone: insertPersonnel.phone || null,\n      email: insertPersonnel.email || null,\n      salary: insertPersonnel.salary || null,\n      salaryType: insertPersonnel.salaryType ?? null,\n      isActive: insertPersonnel.isActive ?? true,\n    };\n    this.personnel.set(id, personnel);\n    return personnel;\n  }\n\n  async updatePersonnel(id: string, updates: Partial<InsertPersonnel>): Promise<Personnel | undefined> {\n    const personnel = this.personnel.get(id);\n    if (!personnel) return undefined;\n\n    const updated = { ...personnel, ...updates };\n    this.personnel.set(id, updated);\n    return updated;\n  }\n\n  async deletePersonnel(id: string): Promise<boolean> {\n    return this.personnel.delete(id);\n  }\n\n  // Projects methods\n  async getProjects(): Promise<Project[]> {\n    return Array.from(this.projects.values());\n  }\n\n  async getProjectById(id: string): Promise<Project | undefined> {\n    return this.projects.get(id);\n  }\n\n  async createProject(insertProject: InsertProject): Promise<Project> {\n    const id = randomUUID();\n    const project: Project = {\n      ...insertProject,\n      id,\n      createdAt: new Date(),\n      description: insertProject.description || null,\n      clientName: insertProject.clientName || null,\n      endDate: insertProject.endDate || null,\n    };\n    this.projects.set(id, project);\n    return project;\n  }\n\n  async updateProject(id: string, updates: Partial<InsertProject>): Promise<Project | undefined> {\n    const project = this.projects.get(id);\n    if (!project) return undefined;\n\n    const updated = { ...project, ...updates };\n    this.projects.set(id, updated);\n    return updated;\n  }\n\n  async deleteProject(id: string): Promise<boolean> {\n    return this.projects.delete(id);\n  }\n\n  // Timesheets methods\n  async getTimesheets(): Promise<Timesheet[]> {\n    return Array.from(this.timesheets.values());\n  }\n\n  async getTimesheetsByPersonnel(personnelId: string): Promise<Timesheet[]> {\n    return Array.from(this.timesheets.values()).filter(ts => ts.personnelId === personnelId);\n  }\n\n  async createTimesheet(insertTimesheet: InsertTimesheet): Promise<Timesheet> {\n    const id = randomUUID();\n    const timesheet: Timesheet = {\n      ...insertTimesheet,\n      id,\n      createdAt: new Date(),\n      customerId: insertTimesheet.customerId || null,\n      startTime: insertTimesheet.startTime || null,\n      endTime: insertTimesheet.endTime || null,\n      hourlyRate: insertTimesheet.hourlyRate || null,\n      dailyWage: insertTimesheet.dailyWage || null,\n      notes: insertTimesheet.notes || null,\n      overtimeHours: insertTimesheet.overtimeHours || \"0.00\",\n    };\n    this.timesheets.set(id, timesheet);\n    return timesheet;\n  }\n\n  async updateTimesheet(id: string, updates: Partial<InsertTimesheet>): Promise<Timesheet | undefined> {\n    const timesheet = this.timesheets.get(id);\n    if (!timesheet) return undefined;\n\n    const updated = { ...timesheet, ...updates };\n    this.timesheets.set(id, updated);\n    return updated;\n  }\n\n  async deleteTimesheet(id: string): Promise<boolean> {\n    return this.timesheets.delete(id);\n  }\n\n  // Transactions methods\n  async getTransactions(): Promise<Transaction[]> {\n    return Array.from(this.transactions.values());\n  }\n\n  async createTransaction(insertTransaction: InsertTransaction): Promise<Transaction> {\n    const id = randomUUID();\n    const transaction: Transaction = {\n      ...insertTransaction,\n      id,\n      createdAt: new Date(),\n      category: insertTransaction.category || null,\n    };\n    this.transactions.set(id, transaction);\n    return transaction;\n  }\n\n  async updateTransaction(id: string, updates: Partial<InsertTransaction>): Promise<Transaction | undefined> {\n    const transaction = this.transactions.get(id);\n    if (!transaction) return undefined;\n\n    const updated = { ...transaction, ...updates };\n    this.transactions.set(id, updated);\n    return updated;\n  }\n\n  async deleteTransaction(id: string): Promise<boolean> {\n    return this.transactions.delete(id);\n  }\n\n  // Notes methods\n  async getNotes(): Promise<Note[]> {\n    return Array.from(this.notes.values());\n  }\n\n  async createNote(insertNote: InsertNote): Promise<Note> {\n    const id = randomUUID();\n    const note: Note = {\n      ...insertNote,\n      id,\n      createdAt: new Date(),\n    };\n    this.notes.set(id, note);\n    return note;\n  }\n\n  async deleteNote(id: string): Promise<boolean> {\n    return this.notes.delete(id);\n  }\n\n  // Contractors methods\n  async getContractors(): Promise<Contractor[]> {\n    return Array.from(this.contractors.values());\n  }\n\n  async createContractor(insertContractor: InsertContractor): Promise<Contractor> {\n    const id = randomUUID();\n    const contractor: Contractor = {\n      ...insertContractor,\n      id,\n      createdAt: new Date(),\n      company: insertContractor.company || null,\n      phone: insertContractor.phone || null,\n      email: insertContractor.email || null,\n    };\n    this.contractors.set(id, contractor);\n    return contractor;\n  }\n\n  async updateContractor(id: string, updates: Partial<InsertContractor>): Promise<Contractor | undefined> {\n    const contractor = this.contractors.get(id);\n    if (!contractor) return undefined;\n\n    const updated = { ...contractor, ...updates };\n    this.contractors.set(id, updated);\n    return updated;\n  }\n\n  async deleteContractor(id: string): Promise<boolean> {\n    return this.contractors.delete(id);\n  }\n\n  // Customer methods\n  async getCustomers(): Promise<Customer[]> {\n    return Array.from(this.customers.values());\n  }\n\n  async getCustomer(id: string): Promise<Customer | undefined> {\n    return this.customers.get(id);\n  }\n\n  async getCustomerById(id: string): Promise<Customer | undefined> {\n    return this.customers.get(id);\n  }\n\n  async createCustomer(insertCustomer: InsertCustomer): Promise<Customer> {\n    const id = randomUUID();\n    const customer: Customer = {\n      ...insertCustomer,\n      id,\n      createdAt: new Date(),\n      company: insertCustomer.company || null,\n      phone: insertCustomer.phone || null,\n      email: insertCustomer.email || null,\n      address: insertCustomer.address || null,\n      taxNumber: insertCustomer.taxNumber || null,\n      status: insertCustomer.status || \"active\",\n    };\n    this.customers.set(id, customer);\n    return customer;\n  }\n\n  async updateCustomer(id: string, updates: Partial<InsertCustomer>): Promise<Customer | undefined> {\n    const customer = this.customers.get(id);\n    if (!customer) return undefined;\n\n    const updated = { ...customer, ...updates };\n    this.customers.set(id, updated);\n    return updated;\n  }\n\n  async deleteCustomer(id: string): Promise<boolean> {\n    return this.customers.delete(id);\n  }\n\n  // Customer Tasks methods\n  async getCustomerTasks(): Promise<CustomerTask[]> {\n    return Array.from(this.customerTasks.values());\n  }\n\n  async getCustomerTasksByCustomerId(customerId: string): Promise<CustomerTask[]> {\n    return Array.from(this.customerTasks.values()).filter(task => task.customerId === customerId);\n  }\n\n  async createCustomerTask(insertTask: InsertCustomerTask): Promise<CustomerTask> {\n    const id = randomUUID();\n    \n    // Calculate VAT amounts if VAT is enabled\n    let vatAmount = \"0\";\n    let totalWithVAT = insertTask.amount;\n    \n    if (insertTask.hasVAT && insertTask.vatRate) {\n      const amount = parseFloat(insertTask.amount.toString());\n      const rate = parseFloat(insertTask.vatRate.toString());\n      vatAmount = (amount * rate / 100).toFixed(2);\n      totalWithVAT = (amount + parseFloat(vatAmount)).toFixed(2);\n    }\n    \n    const task: CustomerTask = {\n      ...insertTask,\n      id,\n      createdAt: new Date(),\n      description: insertTask.description || null,\n      dueDate: insertTask.dueDate || null,\n      status: insertTask.status || \"pending\",\n      hasVAT: insertTask.hasVAT || false,\n      vatRate: insertTask.vatRate || \"20.00\",\n      vatAmount,\n      totalWithVAT,\n    };\n    this.customerTasks.set(id, task);\n    return task;\n  }\n\n  async updateCustomerTask(id: string, updates: Partial<InsertCustomerTask>): Promise<CustomerTask | undefined> {\n    const task = this.customerTasks.get(id);\n    if (!task) return undefined;\n\n    // Recalculate VAT if amount, hasVAT, or vatRate changed\n    let vatAmount = task.vatAmount;\n    let totalWithVAT = task.totalWithVAT;\n    \n    const finalAmount = updates.amount !== undefined ? updates.amount : task.amount;\n    const finalHasVAT = updates.hasVAT !== undefined ? updates.hasVAT : task.hasVAT;\n    const finalVatRate = updates.vatRate !== undefined ? updates.vatRate : task.vatRate;\n    \n    if (finalHasVAT && finalVatRate) {\n      const amount = parseFloat(finalAmount.toString());\n      const rate = parseFloat(finalVatRate.toString());\n      vatAmount = (amount * rate / 100).toFixed(2);\n      totalWithVAT = (amount + parseFloat(vatAmount)).toFixed(2);\n    } else {\n      vatAmount = \"0\";\n      totalWithVAT = finalAmount;\n    }\n\n    const updated = { \n      ...task, \n      ...updates, \n      vatAmount, \n      totalWithVAT \n    };\n    this.customerTasks.set(id, updated);\n    return updated;\n  }\n\n  async deleteCustomerTask(id: string): Promise<boolean> {\n    return this.customerTasks.delete(id);\n  }\n\n  // Customer Payments methods\n  async getCustomerPayments(): Promise<CustomerPayment[]> {\n    return Array.from(this.customerPayments.values());\n  }\n\n  async getCustomerPayment(id: string): Promise<CustomerPayment | undefined> {\n    return this.customerPayments.get(id);\n  }\n\n  async getCustomerPaymentsByCustomerId(customerId: string): Promise<CustomerPayment[]> {\n    return Array.from(this.customerPayments.values()).filter(payment => payment.customerId === customerId);\n  }\n\n  async createCustomerPayment(insertPayment: InsertCustomerPayment): Promise<CustomerPayment> {\n    const id = randomUUID();\n    const payment: CustomerPayment = {\n      ...insertPayment,\n      id,\n      createdAt: new Date(),\n      paymentMethod: insertPayment.paymentMethod || null,\n    };\n    this.customerPayments.set(id, payment);\n    return payment;\n  }\n\n  async deleteCustomerPayment(id: string): Promise<boolean> {\n    return this.customerPayments.delete(id);\n  }\n\n  // Personnel Payments methods\n  async getPersonnelPayments(): Promise<PersonnelPayment[]> {\n    return Array.from(this.personnelPayments.values());\n  }\n\n  async getPersonnelPayment(id: string): Promise<PersonnelPayment | undefined> {\n    return this.personnelPayments.get(id);\n  }\n\n  async getPersonnelPaymentsByPersonnelId(personnelId: string): Promise<PersonnelPayment[]> {\n    return Array.from(this.personnelPayments.values()).filter(payment => payment.personnelId === personnelId);\n  }\n\n  async createPersonnelPayment(insertPayment: InsertPersonnelPayment): Promise<PersonnelPayment> {\n    const id = randomUUID();\n    const payment: PersonnelPayment = {\n      ...insertPayment,\n      id,\n      createdAt: new Date(),\n      description: insertPayment.description || null,\n      notes: insertPayment.notes || null,\n    };\n    this.personnelPayments.set(id, payment);\n    return payment;\n  }\n\n  async updatePersonnelPayment(id: string, updates: Partial<InsertPersonnelPayment>): Promise<PersonnelPayment | undefined> {\n    const payment = this.personnelPayments.get(id);\n    if (!payment) return undefined;\n\n    const updated = { ...payment, ...updates };\n    this.personnelPayments.set(id, updated);\n    return updated;\n  }\n\n  async deletePersonnelPayment(id: string): Promise<boolean> {\n    return this.personnelPayments.delete(id);\n  }\n\n  // Contractor Tasks methods\n  async getContractorTasks(): Promise<ContractorTask[]> {\n    return Array.from(this.contractorTasks.values());\n  }\n\n  async getContractorTasksByContractorId(contractorId: string): Promise<ContractorTask[]> {\n    return Array.from(this.contractorTasks.values()).filter(task => task.contractorId === contractorId);\n  }\n\n  async createContractorTask(insertTask: InsertContractorTask): Promise<ContractorTask> {\n    const id = randomUUID();\n    const task: ContractorTask = {\n      ...insertTask,\n      id,\n      createdAt: new Date(),\n      status: insertTask.status || \"pending\",\n      description: insertTask.description || null,\n      dueDate: insertTask.dueDate || null,\n    };\n    this.contractorTasks.set(id, task);\n    return task;\n  }\n\n  async updateContractorTask(id: string, updates: Partial<InsertContractorTask>): Promise<ContractorTask | undefined> {\n    const task = this.contractorTasks.get(id);\n    if (!task) return undefined;\n\n    const updated = { ...task, ...updates };\n    this.contractorTasks.set(id, updated);\n    return updated;\n  }\n\n  async deleteContractorTask(id: string): Promise<boolean> {\n    return this.contractorTasks.delete(id);\n  }\n\n  // Contractor Payments methods\n  async getContractorPayments(): Promise<ContractorPayment[]> {\n    return Array.from(this.contractorPayments.values());\n  }\n\n  async getContractorPayment(id: string): Promise<ContractorPayment | undefined> {\n    return this.contractorPayments.get(id);\n  }\n\n  async getContractorPaymentsByContractorId(contractorId: string): Promise<ContractorPayment[]> {\n    return Array.from(this.contractorPayments.values()).filter(payment => payment.contractorId === contractorId);\n  }\n\n  async createContractorPayment(insertPayment: InsertContractorPayment): Promise<ContractorPayment> {\n    const id = randomUUID();\n    const payment: ContractorPayment = {\n      ...insertPayment,\n      id,\n      createdAt: new Date(),\n      paymentMethod: insertPayment.paymentMethod || null,\n      transactionId: insertPayment.transactionId || null,\n    };\n    this.contractorPayments.set(id, payment);\n    return payment;\n  }\n\n  async updateContractorPayment(id: string, updates: Partial<InsertContractorPayment>): Promise<ContractorPayment | undefined> {\n    const payment = this.contractorPayments.get(id);\n    if (!payment) return undefined;\n\n    const updated = { ...payment, ...updates };\n    this.contractorPayments.set(id, updated);\n    return updated;\n  }\n\n  async deleteContractorPayment(id: string): Promise<boolean> {\n    return this.contractorPayments.delete(id);\n  }\n\n  // Project lookup method for contractors\n  async getProject(id: string): Promise<Project | undefined> {\n    return this.projects.get(id);\n  }\n\n  // Customer Quotes methods\n  async getCustomerQuotes(): Promise<CustomerQuote[]> {\n    return Array.from(this.customerQuotes.values());\n  }\n\n  async getCustomerQuotesByCustomerId(customerId: string): Promise<CustomerQuote[]> {\n    return Array.from(this.customerQuotes.values()).filter(quote => quote.customerId === customerId);\n  }\n\n  async createCustomerQuote(insertQuote: InsertCustomerQuote): Promise<CustomerQuote> {\n    const id = randomUUID();\n    const quote: CustomerQuote = {\n      ...insertQuote,\n      id,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      description: insertQuote.description || null,\n      isApproved: insertQuote.isApproved || false,\n      validUntil: insertQuote.validUntil || null,\n      status: insertQuote.status || \"pending\",\n    };\n    this.customerQuotes.set(id, quote);\n    return quote;\n  }\n\n  async updateCustomerQuote(id: string, updates: Partial<InsertCustomerQuote>): Promise<CustomerQuote | undefined> {\n    const quote = this.customerQuotes.get(id);\n    if (!quote) return undefined;\n\n    const updated = { ...quote, ...updates, updatedAt: new Date() };\n    this.customerQuotes.set(id, updated);\n    return updated;\n  }\n\n  async deleteCustomerQuote(id: string): Promise<boolean> {\n    return this.customerQuotes.delete(id);\n  }\n\n  // Customer Quote Items methods\n  async getCustomerQuoteItems(): Promise<CustomerQuoteItem[]> {\n    return Array.from(this.customerQuoteItems.values());\n  }\n\n  async getCustomerQuoteItemsByQuoteId(quoteId: string): Promise<CustomerQuoteItem[]> {\n    return Array.from(this.customerQuoteItems.values()).filter(item => item.quoteId === quoteId);\n  }\n\n  async createCustomerQuoteItem(insertItem: InsertCustomerQuoteItem): Promise<CustomerQuoteItem> {\n    const id = randomUUID();\n    const item: CustomerQuoteItem = {\n      ...insertItem,\n      id,\n      createdAt: new Date(),\n      description: insertItem.description || null,\n      status: insertItem.status || \"pending\",\n      isApproved: insertItem.isApproved || false,\n    };\n    this.customerQuoteItems.set(id, item);\n    return item;\n  }\n\n  async updateCustomerQuoteItem(id: string, updates: Partial<InsertCustomerQuoteItem>): Promise<CustomerQuoteItem | undefined> {\n    const item = this.customerQuoteItems.get(id);\n    if (!item) return undefined;\n\n    const updated = { ...item, ...updates };\n    this.customerQuoteItems.set(id, updated);\n    \n    // If item is approved, create corresponding customer task\n    if (updated.isApproved && updated.status === 'approved' && !item.isApproved) {\n      await this.createTaskFromQuoteItem(updated);\n    }\n    \n    return updated;\n  }\n\n  // Helper method to create task from approved quote item\n  private async createTaskFromQuoteItem(quoteItem: CustomerQuoteItem): Promise<void> {\n    // Get the quote to find customer ID\n    const quote = this.customerQuotes.get(quoteItem.quoteId);\n    if (!quote) return;\n\n    // Check if task already exists for this quote item\n    const existingTask = Array.from(this.customerTasks.values())\n      .find(task => task.title === quoteItem.title && task.customerId === quote.customerId);\n    \n    if (existingTask) return; // Task already exists\n\n    // Create new task from quote item\n    const taskData: InsertCustomerTask = {\n      customerId: quote.customerId,\n      title: quoteItem.title,\n      description: quoteItem.description || `${quote.title} - ${quoteItem.title}`,\n      amount: quoteItem.totalPrice.toString(),\n      status: \"pending\",\n      dueDate: quote.validUntil || null,\n      hasVAT: false,\n      vatRate: \"20.00\",\n    };\n\n    await this.createCustomerTask(taskData);\n  }\n\n  async deleteCustomerQuoteItem(id: string): Promise<boolean> {\n    return this.customerQuoteItems.delete(id);\n  }\n\n  // Session management (mock implementation)\n  async getActiveSessions(): Promise<{\n    id: string;\n    userId: string;\n    userEmail: string;\n    ipAddress: string;\n    userAgent: string;\n    lastActivity: string;\n    createdAt: string;\n    isActive: boolean;\n    location?: string;\n  }[]> {\n    // Mock sessions data for development\n    const mockSessions = [\n      {\n        id: randomUUID(),\n        userId: \"eynffxrvr1e\",\n        userEmail: \"modacizimtasarim@gmail.com\",\n        ipAddress: \"192.168.1.100\",\n        userAgent: \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\",\n        lastActivity: new Date().toISOString(),\n        createdAt: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago\n        isActive: true,\n        location: \"İstanbul, Türkiye\"\n      },\n      {\n        id: randomUUID(),\n        userId: \"user2\",\n        userEmail: \"test@example.com\",\n        ipAddress: \"10.0.0.50\",\n        userAgent: \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36\",\n        lastActivity: new Date(Date.now() - 1800000).toISOString(), // 30 minutes ago\n        createdAt: new Date(Date.now() - 7200000).toISOString(), // 2 hours ago\n        isActive: false,\n        location: \"Ankara, Türkiye\"\n      }\n    ];\n    return mockSessions;\n  }\n\n  async terminateSession(sessionId: string): Promise<boolean> {\n    // Mock session termination - always returns success\n    return true;\n  }\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  // (IMPORTANT) these user operations are mandatory for Replit Auth.\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async updateUser(id: string, updates: Partial<UpsertUser>): Promise<User | undefined> {\n    const [result] = await db.update(users).set(updates).where(eq(users.id, id)).returning();\n    return result;\n  }\n\n  // Personnel methods\n  async getPersonnel(): Promise<Personnel[]> {\n    return await db.select().from(personnel);\n  }\n\n  async getPersonnelByUserId(userId: string): Promise<Personnel[]> {\n    return await db.select().from(personnel).where(eq(personnel.userId, userId));\n  }\n\n  async getPersonnelById(id: string): Promise<Personnel | undefined> {\n    const [result] = await db.select().from(personnel).where(eq(personnel.id, id));\n    return result;\n  }\n\n  async createPersonnel(insertPersonnel: InsertPersonnel): Promise<Personnel> {\n    const [result] = await db.insert(personnel).values(insertPersonnel).returning();\n    return result;\n  }\n\n  async updatePersonnel(id: string, updates: Partial<InsertPersonnel>): Promise<Personnel | undefined> {\n    const [result] = await db.update(personnel).set(updates).where(eq(personnel.id, id)).returning();\n    return result;\n  }\n\n  async deletePersonnel(id: string): Promise<boolean> {\n    const result = await db.delete(personnel).where(eq(personnel.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Projects methods\n  async getProjects(): Promise<Project[]> {\n    return await db.select().from(projects);\n  }\n\n  async getProjectsByUserId(userId: string): Promise<Project[]> {\n    return await db.select().from(projects).where(eq(projects.userId, userId));\n  }\n\n  async getProjectById(id: string): Promise<Project | undefined> {\n    const [result] = await db.select().from(projects).where(eq(projects.id, id));\n    return result;\n  }\n\n  async getProject(id: string): Promise<Project | undefined> {\n    const [result] = await db.select().from(projects).where(eq(projects.id, id));\n    return result;\n  }\n\n  async createProject(insertProject: InsertProject): Promise<Project> {\n    const [result] = await db.insert(projects).values(insertProject).returning();\n    return result;\n  }\n\n  async updateProject(id: string, updates: Partial<InsertProject>): Promise<Project | undefined> {\n    const [result] = await db.update(projects).set(updates).where(eq(projects.id, id)).returning();\n    return result;\n  }\n\n  async deleteProject(id: string): Promise<boolean> {\n    const result = await db.delete(projects).where(eq(projects.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Timesheets methods\n  async getTimesheets(): Promise<Timesheet[]> {\n    return await db.select().from(timesheets);\n  }\n\n  async getTimesheetsByUserId(userId: string): Promise<Timesheet[]> {\n    return await db.select().from(timesheets).where(eq(timesheets.userId, userId));\n  }\n\n  async getTimesheetsByPersonnel(personnelId: string): Promise<Timesheet[]> {\n    return await db.select().from(timesheets).where(eq(timesheets.personnelId, personnelId));\n  }\n\n  async createTimesheet(insertTimesheet: InsertTimesheet): Promise<Timesheet> {\n    const [result] = await db.insert(timesheets).values(insertTimesheet).returning();\n    return result;\n  }\n\n  async updateTimesheet(id: string, updates: Partial<InsertTimesheet>): Promise<Timesheet | undefined> {\n    const [result] = await db.update(timesheets).set(updates).where(eq(timesheets.id, id)).returning();\n    return result;\n  }\n\n  async deleteTimesheet(id: string): Promise<boolean> {\n    const result = await db.delete(timesheets).where(eq(timesheets.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Transactions methods\n  async getTransactions(): Promise<Transaction[]> {\n    return await db.select().from(transactions);\n  }\n\n  async getTransactionsByUserId(userId: string): Promise<Transaction[]> {\n    return await db.select().from(transactions).where(eq(transactions.userId, userId));\n  }\n\n  async getTransactionsByUserId(userId: string): Promise<Transaction[]> {\n    return await db.select().from(transactions).where(eq(transactions.userId, userId));\n  }\n\n  async createTransaction(insertTransaction: InsertTransaction): Promise<Transaction> {\n    const [result] = await db.insert(transactions).values(insertTransaction).returning();\n    return result;\n  }\n\n  async updateTransaction(id: string, updates: Partial<InsertTransaction>): Promise<Transaction | undefined> {\n    const [result] = await db.update(transactions).set(updates).where(eq(transactions.id, id)).returning();\n    return result;\n  }\n\n  async deleteTransaction(id: string): Promise<boolean> {\n    const result = await db.delete(transactions).where(eq(transactions.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Notes methods\n  async getNotes(): Promise<Note[]> {\n    return await db.select().from(notes);\n  }\n\n  async createNote(insertNote: InsertNote): Promise<Note> {\n    const [result] = await db.insert(notes).values(insertNote).returning();\n    return result;\n  }\n\n  async deleteNote(id: string): Promise<boolean> {\n    const result = await db.delete(notes).where(eq(notes.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Contractors methods\n  async getContractors(): Promise<Contractor[]> {\n    return await db.select().from(contractors);\n  }\n\n  async createContractor(insertContractor: InsertContractor): Promise<Contractor> {\n    const [result] = await db.insert(contractors).values(insertContractor).returning();\n    return result;\n  }\n\n  async updateContractor(id: string, updates: Partial<InsertContractor>): Promise<Contractor | undefined> {\n    const [result] = await db.update(contractors).set(updates).where(eq(contractors.id, id)).returning();\n    return result;\n  }\n\n  async deleteContractor(id: string): Promise<boolean> {\n    const result = await db.delete(contractors).where(eq(contractors.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Customers methods\n  async getCustomers(): Promise<Customer[]> {\n    return await db.select().from(customers);\n  }\n\n  async getCustomersByUserId(userId: string): Promise<Customer[]> {\n    return await db.select().from(customers).where(eq(customers.userId, userId));\n  }\n\n  async getCustomer(id: string): Promise<Customer | undefined> {\n    const [result] = await db.select().from(customers).where(eq(customers.id, id));\n    return result;\n  }\n\n  async getCustomerById(id: string): Promise<Customer | undefined> {\n    const [result] = await db.select().from(customers).where(eq(customers.id, id));\n    return result;\n  }\n\n  async createCustomer(insertCustomer: InsertCustomer): Promise<Customer> {\n    const [result] = await db.insert(customers).values(insertCustomer).returning();\n    return result;\n  }\n\n  async updateCustomer(id: string, updates: Partial<InsertCustomer>): Promise<Customer | undefined> {\n    const [result] = await db.update(customers).set(updates).where(eq(customers.id, id)).returning();\n    return result;\n  }\n\n  async deleteCustomer(id: string): Promise<boolean> {\n    const result = await db.delete(customers).where(eq(customers.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Customer Tasks methods\n  async getCustomerTasks(): Promise<CustomerTask[]> {\n    return await db.select().from(customerTasks);\n  }\n\n  async getCustomerTasksByUserId(userId: string): Promise<CustomerTask[]> {\n    // Simple approach: Get user's customers first, then filter tasks\n    const userCustomers = await db.select().from(customers).where(eq(customers.userId, userId));\n    const customerIds = userCustomers.map(c => c.id);\n    \n    if (customerIds.length === 0) {\n      return [];\n    }\n    \n    // Get tasks for user's customers\n    const tasks = await db.select().from(customerTasks);\n    return tasks.filter(task => customerIds.includes(task.customerId));\n  }\n\n  async getCustomerTasksByCustomerId(customerId: string): Promise<CustomerTask[]> {\n    return await db.select().from(customerTasks).where(eq(customerTasks.customerId, customerId));\n  }\n\n  async createCustomerTask(insertTask: InsertCustomerTask): Promise<CustomerTask> {\n    const [result] = await db.insert(customerTasks).values(insertTask).returning();\n    return result;\n  }\n\n  async updateCustomerTask(id: string, updates: Partial<InsertCustomerTask>): Promise<CustomerTask | undefined> {\n    const [result] = await db.update(customerTasks).set(updates).where(eq(customerTasks.id, id)).returning();\n    return result;\n  }\n\n  async deleteCustomerTask(id: string): Promise<boolean> {\n    const result = await db.delete(customerTasks).where(eq(customerTasks.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Customer Quotes methods\n  async getCustomerQuotes(): Promise<CustomerQuote[]> {\n    return await db.select().from(customerQuotes);\n  }\n\n  async getCustomerQuotesByUserId(userId: string): Promise<CustomerQuote[]> {\n    // Simple approach: Get user's customers first, then filter quotes\n    const userCustomers = await db.select().from(customers).where(eq(customers.userId, userId));\n    const customerIds = userCustomers.map(c => c.id);\n    \n    if (customerIds.length === 0) {\n      return [];\n    }\n    \n    // Get quotes for user's customers\n    const quotes = await db.select().from(customerQuotes);\n    return quotes.filter(quote => customerIds.includes(quote.customerId));\n  }\n\n  async getCustomerQuotesByCustomerId(customerId: string): Promise<CustomerQuote[]> {\n    return await db.select().from(customerQuotes).where(eq(customerQuotes.customerId, customerId));\n  }\n\n  async createCustomerQuote(insertQuote: InsertCustomerQuote): Promise<CustomerQuote> {\n    console.log(\"Storage: Creating quote with data:\", insertQuote);\n    const [result] = await db.insert(customerQuotes).values(insertQuote).returning();\n    console.log(\"Storage: Quote creation result:\", result);\n    return result;\n  }\n\n  async updateCustomerQuote(id: string, updates: Partial<InsertCustomerQuote>): Promise<CustomerQuote | undefined> {\n    const [result] = await db.update(customerQuotes).set(updates).where(eq(customerQuotes.id, id)).returning();\n    \n    // If quote is approved, create a task automatically\n    if (updates.isApproved && result) {\n      // Use totalWithVAT if available (for VAT-inclusive quotes), otherwise use totalAmount\n      const finalAmount = result.hasVAT ? (result.totalWithVAT || result.totalAmount) : result.totalAmount;\n      \n      await db.insert(customerTasks).values({\n        customerId: result.customerId,\n        title: `${result.title} (Onaylanan Teklif)`,\n        description: result.description || undefined,\n        amount: finalAmount,\n        status: \"pending\",\n      });\n    }\n    \n    return result;\n  }\n\n  async deleteCustomerQuote(id: string): Promise<boolean> {\n    const result = await db.delete(customerQuotes).where(eq(customerQuotes.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Customer Quote Items methods\n  async getCustomerQuoteItems(): Promise<CustomerQuoteItem[]> {\n    return await db.select().from(customerQuoteItems);\n  }\n\n  async getCustomerQuoteItemsByQuoteId(quoteId: string): Promise<CustomerQuoteItem[]> {\n    return await db.select().from(customerQuoteItems).where(eq(customerQuoteItems.quoteId, quoteId));\n  }\n\n  async createCustomerQuoteItem(insertItem: InsertCustomerQuoteItem): Promise<CustomerQuoteItem> {\n    const [result] = await db.insert(customerQuoteItems).values(insertItem).returning();\n    return result;\n  }\n\n  async updateCustomerQuoteItem(id: string, updates: Partial<InsertCustomerQuoteItem>): Promise<CustomerQuoteItem | undefined> {\n    const [result] = await db.update(customerQuoteItems).set(updates).where(eq(customerQuoteItems.id, id)).returning();\n    return result;\n  }\n\n  async deleteCustomerQuoteItem(id: string): Promise<boolean> {\n    const result = await db.delete(customerQuoteItems).where(eq(customerQuoteItems.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Customer Payments methods\n  async getCustomerPayments(): Promise<CustomerPayment[]> {\n    return await db.select().from(customerPayments);\n  }\n\n  async getCustomerPaymentsByUserId(userId: string): Promise<CustomerPayment[]> {\n    // Simple approach: Get user's customers first, then filter payments\n    const userCustomers = await db.select().from(customers).where(eq(customers.userId, userId));\n    const customerIds = userCustomers.map(c => c.id);\n    \n    if (customerIds.length === 0) {\n      return [];\n    }\n    \n    // Get payments for user's customers\n    const payments = await db.select().from(customerPayments);\n    return payments.filter(payment => customerIds.includes(payment.customerId));\n  }\n\n  async getCustomerPayment(id: string): Promise<CustomerPayment | undefined> {\n    const [result] = await db.select().from(customerPayments).where(eq(customerPayments.id, id));\n    return result;\n  }\n\n  async getCustomerPaymentsByCustomerId(customerId: string): Promise<CustomerPayment[]> {\n    return await db.select().from(customerPayments).where(eq(customerPayments.customerId, customerId));\n  }\n\n  async createCustomerPayment(insertPayment: InsertCustomerPayment): Promise<CustomerPayment> {\n    const [result] = await db.insert(customerPayments).values(insertPayment).returning();\n    return result;\n  }\n\n  async deleteCustomerPayment(id: string): Promise<boolean> {\n    const result = await db.delete(customerPayments).where(eq(customerPayments.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Personnel Payments methods\n  async getPersonnelPayments(): Promise<PersonnelPayment[]> {\n    return await db.select().from(personnelPayments);\n  }\n\n  async getPersonnelPaymentsByUserId(userId: string): Promise<PersonnelPayment[]> {\n    // Get personnel belonging to this user first\n    const userPersonnel = await db.select().from(personnel).where(eq(personnel.userId, userId));\n    const personnelIds = userPersonnel.map(p => p.id);\n    \n    if (personnelIds.length === 0) return [];\n    \n    return await db.select().from(personnelPayments)\n      .where(inArray(personnelPayments.personnelId, personnelIds));\n  }\n\n  async getPersonnelPayment(id: string): Promise<PersonnelPayment | undefined> {\n    const [result] = await db.select().from(personnelPayments).where(eq(personnelPayments.id, id));\n    return result;\n  }\n\n  async getPersonnelPaymentsByPersonnelId(personnelId: string): Promise<PersonnelPayment[]> {\n    return await db.select().from(personnelPayments).where(eq(personnelPayments.personnelId, personnelId));\n  }\n\n  async getPersonnelPaymentsByPersonnelIdAndUserId(personnelId: string, userId: string): Promise<PersonnelPayment[]> {\n    // First verify that the personnel belongs to this user\n    const person = await db.select().from(personnel)\n      .where(and(eq(personnel.id, personnelId), eq(personnel.userId, userId)));\n    \n    if (person.length === 0) return []; // Personnel doesn't belong to this user\n    \n    return await db.select().from(personnelPayments).where(eq(personnelPayments.personnelId, personnelId));\n  }\n\n  async createPersonnelPayment(insertPayment: InsertPersonnelPayment): Promise<PersonnelPayment> {\n    const [result] = await db.insert(personnelPayments).values(insertPayment).returning();\n    return result;\n  }\n\n  async updatePersonnelPayment(id: string, updates: Partial<InsertPersonnelPayment>): Promise<PersonnelPayment | undefined> {\n    const [result] = await db.update(personnelPayments).set(updates).where(eq(personnelPayments.id, id)).returning();\n    return result;\n  }\n\n  async deletePersonnelPayment(id: string): Promise<boolean> {\n    const result = await db.delete(personnelPayments).where(eq(personnelPayments.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Contractor Tasks methods\n  async getContractorTasks(): Promise<ContractorTask[]> {\n    return await db.select().from(contractorTasks);\n  }\n\n  async getContractorTasksByContractorId(contractorId: string): Promise<ContractorTask[]> {\n    return await db.select().from(contractorTasks).where(eq(contractorTasks.contractorId, contractorId));\n  }\n\n  async createContractorTask(insertTask: InsertContractorTask): Promise<ContractorTask> {\n    const [result] = await db.insert(contractorTasks).values(insertTask).returning();\n    return result;\n  }\n\n  async updateContractorTask(id: string, updates: Partial<InsertContractorTask>): Promise<ContractorTask | undefined> {\n    const [result] = await db.update(contractorTasks).set(updates).where(eq(contractorTasks.id, id)).returning();\n    return result;\n  }\n\n  async deleteContractorTask(id: string): Promise<boolean> {\n    const result = await db.delete(contractorTasks).where(eq(contractorTasks.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Contractor Payments methods\n  async getContractorPayments(): Promise<ContractorPayment[]> {\n    return await db.select().from(contractorPayments);\n  }\n\n  async getContractorPayment(id: string): Promise<ContractorPayment | undefined> {\n    const [result] = await db.select().from(contractorPayments).where(eq(contractorPayments.id, id));\n    return result;\n  }\n\n  async getContractorPaymentsByContractorId(contractorId: string): Promise<ContractorPayment[]> {\n    return await db.select().from(contractorPayments).where(eq(contractorPayments.contractorId, contractorId));\n  }\n\n  async getContractorPaymentsByUserId(userId: string): Promise<ContractorPayment[]> {\n    // Get projects belonging to this user first\n    const userProjects = await db.select().from(projects).where(eq(projects.userId, userId));\n    const projectIds = userProjects.map(p => p.id);\n    \n    if (projectIds.length === 0) return [];\n    \n    return await db.select().from(contractorPayments)\n      .where(inArray(contractorPayments.contractorId, projectIds));\n  }\n\n  async getContractorPaymentsByContractorIdAndUserId(contractorId: string, userId: string): Promise<ContractorPayment[]> {\n    // First verify that the project belongs to this user\n    const project = await db.select().from(projects)\n      .where(and(eq(projects.id, contractorId), eq(projects.userId, userId)));\n    \n    if (project.length === 0) return []; // Project doesn't belong to this user\n    \n    return await db.select().from(contractorPayments).where(eq(contractorPayments.contractorId, contractorId));\n  }\n\n  async createContractorPayment(insertPayment: InsertContractorPayment): Promise<ContractorPayment> {\n    const [result] = await db.insert(contractorPayments).values(insertPayment).returning();\n    return result;\n  }\n\n  async updateContractorPayment(id: string, updates: Partial<InsertContractorPayment>): Promise<ContractorPayment | undefined> {\n    const [result] = await db.update(contractorPayments).set(updates).where(eq(contractorPayments.id, id)).returning();\n    return result;\n  }\n\n  async deleteContractorPayment(id: string): Promise<boolean> {\n    const result = await db.delete(contractorPayments).where(eq(contractorPayments.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Company Directory methods\n  async getCompanyDirectory(): Promise<CompanyDirectory[]> {\n    // Join with users table to exclude admin users\n    return await db\n      .select({\n        id: companyDirectory.id,\n        userId: companyDirectory.userId,\n        companyName: companyDirectory.companyName,\n        contactPerson: companyDirectory.contactPerson,\n        phone: companyDirectory.phone,\n        email: companyDirectory.email,\n        address: companyDirectory.address,\n        city: companyDirectory.city,\n        industry: companyDirectory.industry,\n        website: companyDirectory.website,\n        description: companyDirectory.description,\n        bio: companyDirectory.bio,\n        logoUrl: companyDirectory.logoUrl,\n        isActive: companyDirectory.isActive,\n        isProVisible: companyDirectory.isProVisible,\n        isVerified: companyDirectory.isVerified,\n        subscriptionStatus: companyDirectory.subscriptionStatus,\n        profileImage: companyDirectory.profileImage,\n        verifiedAt: companyDirectory.verifiedAt,\n        lastSeen: companyDirectory.lastSeen,\n        createdAt: companyDirectory.createdAt,\n      })\n      .from(companyDirectory)\n      .innerJoin(users, eq(companyDirectory.userId, users.id))\n      .where(and(\n        eq(companyDirectory.isActive, true),\n        // Exclude admin users by checking both isAdmin flag and role field\n        or(\n          eq(users.isAdmin, false),\n          isNull(users.isAdmin)\n        ),\n        or(\n          ne(users.role, 'ADMIN'),\n          ne(users.role, 'SUPER_ADMIN'),\n          isNull(users.role)\n        )\n      ));\n  }\n\n  async getProCompanyDirectory(filters?: { search?: string; city?: string; industry?: string; verified?: boolean }): Promise<CompanyDirectory[]> {\n    let whereConditions = and(\n      eq(companyDirectory.isActive, true),\n      eq(companyDirectory.isProVisible, true)\n    );\n\n    if (filters) {\n      const conditions = [\n        eq(companyDirectory.isActive, true),\n        eq(companyDirectory.isProVisible, true)\n      ];\n\n      if (filters.search) {\n        // Search in company name, contact person, or description\n        const searchTerm = `%${filters.search}%`;\n        conditions.push(\n          or(\n            sql`${companyDirectory.companyName} ILIKE ${searchTerm}`,\n            sql`${companyDirectory.contactPerson} ILIKE ${searchTerm}`,\n            sql`${companyDirectory.description} ILIKE ${searchTerm}`\n          )\n        );\n      }\n\n      if (filters.city) {\n        conditions.push(eq(companyDirectory.city, filters.city));\n      }\n\n      if (filters.industry) {\n        conditions.push(eq(companyDirectory.industry, filters.industry));\n      }\n\n      if (filters.verified !== undefined) {\n        conditions.push(eq(companyDirectory.isVerified, filters.verified));\n      }\n\n      whereConditions = and(...conditions);\n    }\n\n    // Join with users table to exclude admin users\n    return await db\n      .select({\n        id: companyDirectory.id,\n        userId: companyDirectory.userId,\n        companyName: companyDirectory.companyName,\n        contactPerson: companyDirectory.contactPerson,\n        phone: companyDirectory.phone,\n        email: companyDirectory.email,\n        address: companyDirectory.address,\n        city: companyDirectory.city,\n        industry: companyDirectory.industry,\n        website: companyDirectory.website,\n        description: companyDirectory.description,\n        bio: companyDirectory.bio,\n        logoUrl: companyDirectory.logoUrl,\n        isActive: companyDirectory.isActive,\n        isProVisible: companyDirectory.isProVisible,\n        isVerified: companyDirectory.isVerified,\n        subscriptionStatus: companyDirectory.subscriptionStatus,\n        profileImage: companyDirectory.profileImage,\n        verifiedAt: companyDirectory.verifiedAt,\n        lastSeen: companyDirectory.lastSeen,\n        createdAt: companyDirectory.createdAt,\n      })\n      .from(companyDirectory)\n      .innerJoin(users, eq(companyDirectory.userId, users.id))\n      .where(and(\n        whereConditions,\n        // Exclude admin users by checking both isAdmin flag and role field\n        or(\n          eq(users.isAdmin, false),\n          isNull(users.isAdmin)\n        ),\n        or(\n          ne(users.role, 'ADMIN'),\n          ne(users.role, 'SUPER_ADMIN'),\n          isNull(users.role)\n        )\n      ));\n  }\n\n  async getCompanyDirectoryByUserId(userId: string): Promise<CompanyDirectory[]> {\n    return await db.select().from(companyDirectory).where(\n      and(eq(companyDirectory.userId, userId), eq(companyDirectory.isActive, true))\n    );\n  }\n\n  async getCompany(id: string): Promise<CompanyDirectory | undefined> {\n    const [result] = await db.select().from(companyDirectory).where(eq(companyDirectory.id, id));\n    return result;\n  }\n\n  async createCompany(insertCompany: InsertCompanyDirectory, userId: string): Promise<CompanyDirectory> {\n    const companyData = {\n      ...insertCompany,\n      userId,\n      isProVisible: true, // Yeni firmalar otomatik olarak PRO Firma Rehberi'nde görünür olsun\n      isActive: true\n    };\n    const [result] = await db.insert(companyDirectory).values(companyData).returning();\n    return result;\n  }\n\n  async updateCompany(id: string, updates: Partial<InsertCompanyDirectory>): Promise<CompanyDirectory | undefined> {\n    const [result] = await db.update(companyDirectory).set(updates).where(eq(companyDirectory.id, id)).returning();\n    return result;\n  }\n\n  async deleteCompany(id: string): Promise<boolean> {\n    const result = await db.update(companyDirectory).set({ isActive: false }).where(eq(companyDirectory.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Messages methods\n  async getMessages(): Promise<Message[]> {\n    return await db.select().from(messages).orderBy(messages.createdAt);\n  }\n\n  async getMessagesByUser(userId: string): Promise<Message[]> {\n    return await db.select().from(messages)\n      .where(\n        or(\n          eq(messages.fromUserId, userId),\n          eq(messages.toUserId, userId)\n        )\n      )\n      .orderBy(messages.createdAt);\n  }\n\n  async getMessagesByConversation(company1Id: string, company2Id: string): Promise<Message[]> {\n    return await db.select().from(messages)\n      .where(\n        or(\n          and(eq(messages.fromCompanyId, company1Id), eq(messages.toCompanyId, company2Id)),\n          and(eq(messages.fromCompanyId, company2Id), eq(messages.toCompanyId, company1Id))\n        )\n      )\n      .orderBy(messages.createdAt);\n  }\n\n  async getMessagesByConversationAndUser(company1Id: string, company2Id: string, userId: string): Promise<Message[]> {\n    return await db.select().from(messages)\n      .where(\n        and(\n          or(\n            and(eq(messages.fromCompanyId, company1Id), eq(messages.toCompanyId, company2Id)),\n            and(eq(messages.fromCompanyId, company2Id), eq(messages.toCompanyId, company1Id))\n          ),\n          or(\n            eq(messages.fromUserId, userId),\n            eq(messages.toUserId, userId)\n          )\n        )\n      )\n      .orderBy(messages.createdAt);\n  }\n\n  async createMessage(insertMessage: InsertMessage): Promise<Message> {\n    const [result] = await db.insert(messages).values(insertMessage).returning();\n    return result;\n  }\n\n  async markMessageAsRead(id: string): Promise<boolean> {\n    const result = await db.update(messages).set({ isRead: true }).where(eq(messages.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Conversations methods\n  async getConversations(): Promise<Conversation[]> {\n    return await db.select().from(conversations).orderBy(conversations.lastMessageAt);\n  }\n\n  async getConversation(company1Id: string, company2Id: string): Promise<Conversation | undefined> {\n    const [result] = await db.select().from(conversations)\n      .where(\n        or(\n          and(eq(conversations.company1Id, company1Id), eq(conversations.company2Id, company2Id)),\n          and(eq(conversations.company1Id, company2Id), eq(conversations.company2Id, company1Id))\n        )\n      );\n    return result;\n  }\n\n  async getConversationById(conversationId: string): Promise<Conversation | undefined> {\n    const [result] = await db.select().from(conversations).where(eq(conversations.id, conversationId));\n    return result;\n  }\n\n  async getMessagesByConversationId(conversationId: string): Promise<Message[]> {\n    // Get conversation first to extract company IDs\n    const conversation = await this.getConversationById(conversationId);\n    if (!conversation) return [];\n    \n    return await db.select().from(messages)\n      .where(\n        or(\n          and(eq(messages.fromCompanyId, conversation.company1Id), eq(messages.toCompanyId, conversation.company2Id)),\n          and(eq(messages.fromCompanyId, conversation.company2Id), eq(messages.toCompanyId, conversation.company1Id))\n        )\n      )\n      .orderBy(messages.createdAt);\n  }\n\n  async createConversation(insertConversation: InsertConversation): Promise<Conversation> {\n    const [result] = await db.insert(conversations).values(insertConversation).returning();\n    return result;\n  }\n\n  // Enhanced messaging methods\n  async getOrCreateConversation(company1Id: string, company2Id: string): Promise<Conversation> {\n    // Ensure consistent ordering for conversation lookup\n    const [firstId, secondId] = [company1Id, company2Id].sort();\n    \n    let [conversation] = await db.select().from(conversations)\n      .where(and(eq(conversations.company1Id, firstId), eq(conversations.company2Id, secondId)));\n\n    if (!conversation) {\n      [conversation] = await db.insert(conversations)\n        .values({ company1Id: firstId, company2Id: secondId })\n        .returning();\n    }\n\n    return conversation;\n  }\n\n  async getConversationsByCompanyId(companyId: string): Promise<Conversation[]> {\n    return await db.select().from(conversations)\n      .where(or(eq(conversations.company1Id, companyId), eq(conversations.company2Id, companyId)));\n  }\n\n  async updateConversationLastMessage(conversationId: string, messageId: string): Promise<void> {\n    await db.update(conversations)\n      .set({ \n        lastMessageId: messageId, \n        lastMessageAt: new Date() \n      })\n      .where(eq(conversations.id, conversationId));\n  }\n\n  // Notification methods\n  async createNotification(insertNotification: InsertNotification): Promise<Notification> {\n    const [result] = await db.insert(notifications).values(insertNotification).returning();\n    return result;\n  }\n\n  async getNotificationsByUserId(userId: string): Promise<Notification[]> {\n    return await db.select().from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async markNotificationAsRead(notificationId: string): Promise<boolean> {\n    const result = await db.update(notifications)\n      .set({ isRead: true })\n      .where(eq(notifications.id, notificationId));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Blocking and muting methods\n  async createCompanyBlock(blockerCompanyId: string, blockedCompanyId: string): Promise<CompanyBlock> {\n    const [result] = await db.insert(companyBlocks)\n      .values({ blockerCompanyId, blockedCompanyId })\n      .returning();\n    return result;\n  }\n\n  async removeCompanyBlock(blockerCompanyId: string, blockedCompanyId: string): Promise<boolean> {\n    const result = await db.delete(companyBlocks)\n      .where(and(\n        eq(companyBlocks.blockerCompanyId, blockerCompanyId),\n        eq(companyBlocks.blockedCompanyId, blockedCompanyId)\n      ));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async isCompanyBlocked(blockerCompanyId: string, blockedCompanyId: string): Promise<boolean> {\n    const [result] = await db.select().from(companyBlocks)\n      .where(and(\n        eq(companyBlocks.blockerCompanyId, blockerCompanyId),\n        eq(companyBlocks.blockedCompanyId, blockedCompanyId)\n      ));\n    return !!result;\n  }\n\n  async createCompanyMute(muterCompanyId: string, mutedCompanyId: string): Promise<CompanyMute> {\n    const [result] = await db.insert(companyMutes)\n      .values({ muterCompanyId, mutedCompanyId })\n      .returning();\n    return result;\n  }\n\n  async removeCompanyMute(muterCompanyId: string, mutedCompanyId: string): Promise<boolean> {\n    const result = await db.delete(companyMutes)\n      .where(and(\n        eq(companyMutes.muterCompanyId, muterCompanyId),\n        eq(companyMutes.mutedCompanyId, mutedCompanyId)\n      ));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async isCompanyMuted(muterCompanyId: string, mutedCompanyId: string): Promise<boolean> {\n    const [result] = await db.select().from(companyMutes)\n      .where(and(\n        eq(companyMutes.muterCompanyId, muterCompanyId),\n        eq(companyMutes.mutedCompanyId, mutedCompanyId)\n      ));\n    return !!result;\n  }\n\n  // Abuse reporting methods\n  async createAbuseReport(insertReport: InsertAbuseReport): Promise<AbuseReport> {\n    const [result] = await db.insert(abuseReports).values(insertReport).returning();\n    return result;\n  }\n\n  async getAbuseReports(): Promise<AbuseReport[]> {\n    return await db.select().from(abuseReports).orderBy(desc(abuseReports.createdAt));\n  }\n\n  async resolveAbuseReport(reportId: string, resolvedBy: string): Promise<boolean> {\n    const result = await db.update(abuseReports)\n      .set({ \n        isResolved: true, \n        resolvedAt: new Date(), \n        resolvedBy \n      })\n      .where(eq(abuseReports.id, reportId));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Company profile verification\n  async verifyCompanyProfile(companyId: string): Promise<boolean> {\n    const result = await db.update(companyDirectory)\n      .set({ \n        isVerified: true, \n        verifiedAt: new Date() \n      })\n      .where(eq(companyDirectory.id, companyId));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async updateCompanyProStatus(companyId: string, isProVisible: boolean): Promise<boolean> {\n    const result = await db.update(companyDirectory)\n      .set({ \n        isProVisible,\n        subscriptionStatus: isProVisible ? \"PRO\" : \"FREE\"\n      })\n      .where(eq(companyDirectory.id, companyId));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async updateConversation(id: string, updates: Partial<InsertConversation>): Promise<Conversation | undefined> {\n    const [result] = await db.update(conversations).set(updates).where(eq(conversations.id, id)).returning();\n    return result;\n  }\n\n  // Admin methods\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users).orderBy(users.createdAt);\n  }\n\n  // Firm Invites\n  async createFirmInvite(invite: InsertFirmInvite & { tokenHash: string }): Promise<FirmInvite> {\n    const [result] = await db.insert(firmInvites).values(invite).returning();\n    return result;\n  }\n\n  async getFirmInvitesByToken(tokenHash: string): Promise<FirmInvite | undefined> {\n    const [result] = await db.select().from(firmInvites)\n      .where(eq(firmInvites.tokenHash, tokenHash));\n    return result;\n  }\n\n  async getFirmInvitesByFirm(firmId: string): Promise<FirmInvite[]> {\n    return await db.select().from(firmInvites)\n      .where(eq(firmInvites.firmId, firmId))\n      .orderBy(desc(firmInvites.createdAt));\n  }\n\n  async acceptFirmInvite(id: string): Promise<boolean> {\n    const result = await db.update(firmInvites)\n      .set({ acceptedAt: new Date() })\n      .where(eq(firmInvites.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Presence\n  async updatePresence(presenceLog: InsertPresenceLog): Promise<PresenceLog> {\n    const [existing] = await db.select().from(presenceLogs)\n      .where(and(\n        eq(presenceLogs.firmId, presenceLog.firmId),\n        eq(presenceLogs.userId, presenceLog.userId)\n      ));\n\n    if (existing) {\n      const [result] = await db.update(presenceLogs)\n        .set({ \n          lastHeartbeatAt: new Date(),\n          clientInfo: presenceLog.clientInfo,\n          updatedAt: new Date()\n        })\n        .where(eq(presenceLogs.id, existing.id))\n        .returning();\n      return result;\n    } else {\n      const [result] = await db.insert(presenceLogs).values(presenceLog).returning();\n      return result;\n    }\n  }\n\n  async getPresenceByFirmAndUser(firmId: string, userId: string): Promise<PresenceLog | undefined> {\n    const [result] = await db.select().from(presenceLogs)\n      .where(and(\n        eq(presenceLogs.firmId, firmId),\n        eq(presenceLogs.userId, userId)\n      ));\n    return result;\n  }\n\n  async getPresenceByFirm(firmId: string): Promise<PresenceLog[]> {\n    return await db.select().from(presenceLogs)\n      .where(eq(presenceLogs.firmId, firmId));\n  }\n\n  // Message Drafts\n  async getDraft(threadId: string, authorFirmId: string): Promise<MessageDraft | undefined> {\n    const [result] = await db.select().from(messageDrafts)\n      .where(and(\n        eq(messageDrafts.threadId, threadId),\n        eq(messageDrafts.authorFirmId, authorFirmId)\n      ));\n    return result;\n  }\n\n  async upsertDraft(draft: InsertMessageDraft): Promise<MessageDraft> {\n    const [existing] = await db.select().from(messageDrafts)\n      .where(and(\n        eq(messageDrafts.threadId, draft.threadId),\n        eq(messageDrafts.authorFirmId, draft.authorFirmId)\n      ));\n\n    if (existing) {\n      const [result] = await db.update(messageDrafts)\n        .set({ body: draft.body, updatedAt: new Date() })\n        .where(eq(messageDrafts.id, existing.id))\n        .returning();\n      return result;\n    } else {\n      const [result] = await db.insert(messageDrafts).values(draft).returning();\n      return result;\n    }\n  }\n\n  async deleteDraft(threadId: string, authorFirmId: string): Promise<boolean> {\n    const result = await db.delete(messageDrafts)\n      .where(and(\n        eq(messageDrafts.threadId, threadId),\n        eq(messageDrafts.authorFirmId, authorFirmId)\n      ));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Auto Responders\n  async getAutoResponder(firmId: string): Promise<AutoResponder | undefined> {\n    const [result] = await db.select().from(autoResponders)\n      .where(eq(autoResponders.firmId, firmId));\n    return result;\n  }\n\n  async upsertAutoResponder(responder: InsertAutoResponder): Promise<AutoResponder> {\n    const [existing] = await db.select().from(autoResponders)\n      .where(eq(autoResponders.firmId, responder.firmId));\n\n    if (existing) {\n      const [result] = await db.update(autoResponders)\n        .set({ ...responder, updatedAt: new Date() })\n        .where(eq(autoResponders.id, existing.id))\n        .returning();\n      return result;\n    } else {\n      const [result] = await db.insert(autoResponders).values(responder).returning();\n      return result;\n    }\n  }\n\n  async getAutoReplyLog(responderFirmId: string, targetFirmId: string): Promise<Date | undefined> {\n    const [result] = await db.select().from(autoReplyLogs)\n      .where(and(\n        eq(autoReplyLogs.responderFirmId, responderFirmId),\n        eq(autoReplyLogs.targetFirmId, targetFirmId)\n      ))\n      .orderBy(desc(autoReplyLogs.lastReplyAt))\n      .limit(1);\n    return result?.lastReplyAt;\n  }\n\n  async setAutoReplyLog(responderFirmId: string, targetFirmId: string, messageId: string): Promise<void> {\n    await db.insert(autoReplyLogs).values({\n      responderFirmId,\n      targetFirmId,\n      messageId,\n      lastReplyAt: new Date()\n    }).onConflictDoUpdate({\n      target: [autoReplyLogs.responderFirmId, autoReplyLogs.targetFirmId],\n      set: {\n        lastReplyAt: new Date(),\n        messageId\n      }\n    });\n  }\n\n  // Direct Threads & Messages\n  async getOrCreateDirectThread(firm1Id: string, firm2Id: string): Promise<DirectThread> {\n    const [firstId, secondId] = [firm1Id, firm2Id].sort();\n    \n    let [thread] = await db.select().from(directThreads)\n      .where(and(eq(directThreads.firm1Id, firstId), eq(directThreads.firm2Id, secondId)));\n\n    if (!thread) {\n      [thread] = await db.insert(directThreads)\n        .values({ firm1Id: firstId, firm2Id: secondId })\n        .returning();\n    }\n\n    return thread;\n  }\n\n  async getDirectThreads(firmId: string): Promise<DirectThread[]> {\n    return await db.select().from(directThreads)\n      .where(or(eq(directThreads.firm1Id, firmId), eq(directThreads.firm2Id, firmId)))\n      .orderBy(desc(directThreads.lastMessageAt));\n  }\n\n  async getDirectThreadsByUserId(userId: string): Promise<any[]> {\n    // Get user's company first\n    const userCompanies = await this.getCompanyDirectoryByUserId(userId);\n    if (userCompanies.length === 0) {\n      return [];\n    }\n    \n    const userCompanyId = userCompanies[0].id;\n    const threads = await this.getDirectThreads(userCompanyId);\n    \n    // Enrich threads with participant information\n    const enrichedThreads = await Promise.all(\n      threads.map(async (thread) => {\n        // Determine other company ID\n        const otherCompanyId = thread.firm1Id === userCompanyId ? thread.firm2Id : thread.firm1Id;\n        \n        // Get other company details\n        const otherCompany = await this.getCompany(otherCompanyId);\n        \n        // Get last message\n        const messages = await this.getDirectThreadMessages(thread.id, 0, 1);\n        const lastMessage = messages.length > 0 ? messages[0] : null;\n        \n        return {\n          ...thread,\n          participants: [{\n            userId: \"other\", // We don't track individual user IDs in DirectThread\n            companyId: otherCompanyId,\n            company: otherCompany\n          }],\n          lastMessage,\n          lastMessageAt: lastMessage?.createdAt || thread.lastMessageAt\n        };\n      })\n    );\n    \n    return enrichedThreads;\n  }\n\n  async getDirectThreadById(threadId: string): Promise<DirectThread | undefined> {\n    const [thread] = await db.select().from(directThreads).where(eq(directThreads.id, threadId));\n    return thread;\n  }\n\n  async getDirectThreadMessages(threadId: string, offset = 0, limit = 50): Promise<DirectMessage[]> {\n    return await db.select().from(directMessages)\n      .where(eq(directMessages.threadId, threadId))\n      .orderBy(desc(directMessages.createdAt))\n      .limit(limit)\n      .offset(offset);\n  }\n\n  async createDirectMessage(message: InsertDirectMessage): Promise<DirectMessage> {\n    const [result] = await db.insert(directMessages).values(message).returning();\n    \n    // Update thread's last message timestamp\n    await db.update(directThreads)\n      .set({ lastMessageAt: new Date() })\n      .where(eq(directThreads.id, message.threadId));\n\n    return result;\n  }\n\n  async markDirectMessageAsRead(messageId: string): Promise<boolean> {\n    const result = await db.update(directMessages)\n      .set({ isRead: true, readAt: new Date() })\n      .where(eq(directMessages.id, messageId));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Image Uploads\n  async createImageUpload(upload: InsertImageUpload): Promise<ImageUpload> {\n    const [result] = await db.insert(imageUploads).values(upload).returning();\n    return result;\n  }\n\n  async getAdminStats(): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    demoUsers: number;\n    todayRegistrations: number;\n  }> {\n    const allUsers = await db.select().from(users);\n    const today = new Date();\n    const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n    \n    const totalUsers = allUsers.length;\n    const demoUsers = allUsers.filter(user => user.email.includes('demo')).length;\n    const todayRegistrations = allUsers.filter(user => \n      new Date(user.createdAt) >= todayStart\n    ).length;\n    \n    // For now, assume all users are active (we don't track last login in current schema)\n    const activeUsers = totalUsers;\n\n    return {\n      totalUsers,\n      activeUsers,\n      demoUsers,\n      todayRegistrations\n    };\n  }\n\n  async getAdminStats(): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    demoUsers: number;\n    todayRegistrations: number;\n  }> {\n    const allUsers = await db.select().from(users);\n    const today = new Date();\n    const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n    \n    const totalUsers = allUsers.length;\n    const demoUsers = allUsers.filter(user => user.email.includes('demo')).length;\n    const todayRegistrations = allUsers.filter(user => \n      new Date(user.createdAt) >= todayStart\n    ).length;\n    \n    // For now, assume all users are active (we don't track last login in current schema)\n    const activeUsers = totalUsers;\n\n    return {\n      totalUsers,\n      activeUsers,\n      demoUsers,\n      todayRegistrations\n    };\n  }\n\n  // SMS Management\n  async getSMSHistory(userId: string): Promise<SMSHistory[]> {\n    return await db.select().from(smsHistory)\n      .where(eq(smsHistory.userId, userId))\n      .orderBy(desc(smsHistory.createdAt));\n  }\n\n  async createSMSHistory(userId: string, sms: InsertSMSHistory): Promise<SMSHistory> {\n    const [result] = await db.insert(smsHistory).values({\n      ...sms,\n      userId\n    }).returning();\n    return result;\n  }\n\n  async updateSMSHistory(id: string, updates: Partial<SMSHistory>): Promise<SMSHistory | undefined> {\n    const [result] = await db.update(smsHistory)\n      .set(updates)\n      .where(eq(smsHistory.id, id))\n      .returning();\n    return result;\n  }\n\n  async getSMSTemplates(userId: string): Promise<SMSTemplate[]> {\n    return await db.select().from(smsTemplates)\n      .where(and(eq(smsTemplates.userId, userId), eq(smsTemplates.isActive, true)))\n      .orderBy(desc(smsTemplates.createdAt));\n  }\n\n  async createSMSTemplate(userId: string, template: InsertSMSTemplate): Promise<SMSTemplate> {\n    const [result] = await db.insert(smsTemplates).values({\n      ...template,\n      userId\n    }).returning();\n    return result;\n  }\n\n  // Payment Notifications\n  async createPaymentNotification(userId: string, notification: InsertPaymentNotification): Promise<PaymentNotification> {\n    const [result] = await db.insert(paymentNotifications).values({\n      ...notification,\n      userId\n    }).returning();\n    return result;\n  }\n\n  async getPaymentNotifications(): Promise<PaymentNotification[]> {\n    return await db.select().from(paymentNotifications)\n      .orderBy(desc(paymentNotifications.createdAt));\n  }\n\n  async getPaymentNotificationsByStatus(status: string): Promise<PaymentNotification[]> {\n    return await db.select().from(paymentNotifications)\n      .where(eq(paymentNotifications.status, status))\n      .orderBy(desc(paymentNotifications.createdAt));\n  }\n\n  async getPaymentNotificationsByUser(userId: string): Promise<PaymentNotification[]> {\n    return await db.select().from(paymentNotifications)\n      .where(eq(paymentNotifications.userId, userId))\n      .orderBy(desc(paymentNotifications.createdAt));\n  }\n\n  async updatePaymentNotificationStatus(id: string, status: string, adminNote?: string, processedBy?: string): Promise<PaymentNotification | undefined> {\n    const [result] = await db.update(paymentNotifications)\n      .set({\n        status,\n        adminNote,\n        processedBy,\n        processedAt: new Date()\n      })\n      .where(eq(paymentNotifications.id, id))\n      .returning();\n    return result;\n  }\n\n  // Admin Panel Operations\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users)\n      .orderBy(desc(users.createdAt));\n  }\n\n  async getAllUsersForAdmin(): Promise<User[]> {\n    return await db.select().from(users)\n      .orderBy(desc(users.createdAt));\n  }\n\n  async updateUserAdminStatus(userId: string, isAdmin: boolean): Promise<void> {\n    await db.update(users)\n      .set({ isAdmin })\n      .where(eq(users.id, userId));\n  }\n\n  async updateUserActiveStatus(userId: string, isActive: boolean): Promise<void> {\n    await db.update(users)\n      .set({ isActive })\n      .where(eq(users.id, userId));\n  }\n\n  async deleteUserSession(sessionId: string): Promise<void> {\n    try {\n      await db.delete(userSessions).where(eq(userSessions.sessionId, sessionId));\n      console.log(`Session ${sessionId} deleted`);\n    } catch (error) {\n      console.error(\"Error deleting session:\", error);\n    }\n  }\n\n  async deleteAllUserData(userId: string): Promise<void> {\n    console.log(`Starting simple user deletion for: ${userId}`);\n    \n    // Simple direct deletion - skip complex foreign key operations\n    try {\n      // Delete core user data only\n      await db.delete(users).where(eq(users.id, userId));\n      console.log(`User ${userId} deleted successfully`);\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      throw error;\n    }\n  }\n\n  async deleteUser(userId: string): Promise<boolean> {\n    try {\n      // Check if user exists\n      const existingUser = await this.getUser(userId);\n      if (!existingUser) {\n        return false;\n      }\n\n      // Delete all user data\n      await this.deleteAllUserData(userId);\n      return true;\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      return false;\n    }\n  }\n\n  async getSystemSettings(): Promise<SystemSetting[]> {\n    return await db.select().from(systemSettings)\n      .orderBy(desc(systemSettings.createdAt));\n  }\n\n  async saveSystemSetting(setting: InsertSystemSetting): Promise<SystemSetting> {\n    // Check if setting exists\n    const existingSetting = await db.select().from(systemSettings)\n      .where(eq(systemSettings.key, setting.key))\n      .limit(1);\n\n    if (existingSetting.length > 0) {\n      // Update existing setting\n      const [result] = await db.update(systemSettings)\n        .set({ \n          value: setting.value,\n          updatedAt: new Date()\n        })\n        .where(eq(systemSettings.key, setting.key))\n        .returning();\n      return result;\n    } else {\n      // Create new setting\n      const [result] = await db.insert(systemSettings)\n        .values({\n          ...setting,\n          id: randomUUID()\n        })\n        .returning();\n      return result;\n    }\n  }\n\n  async createAdminLog(log: InsertAdminLog): Promise<AdminLog> {\n    const [result] = await db.insert(adminLogs).values(log).returning();\n    return result;\n  }\n\n  async getAdminLogs(limit: number = 100): Promise<AdminLog[]> {\n    return await db.select().from(adminLogs)\n      .orderBy(desc(adminLogs.createdAt))\n      .limit(limit);\n  }\n\n  async getSystemSettings(): Promise<SystemSetting[]> {\n    return await db.select().from(systemSettings)\n      .orderBy(systemSettings.category, systemSettings.key);\n  }\n\n  async getSystemSetting(key: string): Promise<SystemSetting | undefined> {\n    const [result] = await db.select().from(systemSettings)\n      .where(eq(systemSettings.key, key));\n    return result;\n  }\n\n  async upsertSystemSetting(setting: InsertSystemSetting): Promise<SystemSetting> {\n    const [result] = await db.insert(systemSettings)\n      .values(setting)\n      .onConflictDoUpdate({\n        target: systemSettings.key,\n        set: {\n          value: setting.value,\n          description: setting.description,\n          category: setting.category,\n          updatedBy: setting.updatedBy,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return result;\n  }\n\n  async getAnnouncements(): Promise<Announcement[]> {\n    return await db.select().from(announcements)\n      .where(eq(announcements.isActive, true))\n      .orderBy(desc(announcements.createdAt));\n  }\n\n  async createAnnouncement(announcement: InsertAnnouncement): Promise<Announcement> {\n    const [result] = await db.insert(announcements).values(announcement).returning();\n    return result;\n  }\n\n  async updateAnnouncement(id: string, updates: Partial<InsertAnnouncement>): Promise<Announcement | undefined> {\n    const [result] = await db.update(announcements)\n      .set(updates)\n      .where(eq(announcements.id, id))\n      .returning();\n    return result;\n  }\n\n  async deleteAnnouncement(id: string): Promise<boolean> {\n    const result = await db.delete(announcements)\n      .where(eq(announcements.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getUserSessions(): Promise<UserSession[]> {\n    return await db.select().from(userSessions)\n      .orderBy(desc(userSessions.lastActivity));\n  }\n\n  async getUserSessionsByUserId(userId: string): Promise<UserSession[]> {\n    return await db.select().from(userSessions)\n      .where(eq(userSessions.userId, userId))\n      .orderBy(desc(userSessions.lastActivity));\n  }\n\n  async createUserSession(session: InsertUserSession): Promise<UserSession> {\n    const [result] = await db.insert(userSessions).values(session).returning();\n    return result;\n  }\n\n  async deactivateUserSession(id: string): Promise<boolean> {\n    const [result] = await db.update(userSessions)\n      .set({ isActive: false })\n      .where(eq(userSessions.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getSystemMetrics(metricType?: string, limit: number = 100): Promise<SystemMetric[]> {\n    let query = db.select().from(systemMetrics);\n    \n    if (metricType) {\n      query = query.where(eq(systemMetrics.metricType, metricType));\n    }\n    \n    return await query\n      .orderBy(desc(systemMetrics.recordedAt))\n      .limit(limit);\n  }\n\n  async createSystemMetric(metric: InsertSystemMetric): Promise<SystemMetric> {\n    const [result] = await db.insert(systemMetrics).values(metric).returning();\n    return result;\n  }\n\n  async getDashboardStats(): Promise<{\n    totalUsers: number;\n    activeUsers: number;\n    totalMessages: number;\n    totalStorage: number;\n    registrationsThisMonth: number;\n    messagesThisMonth: number;\n  }> {\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n\n    // Get user stats\n    const allUsers = await db.select().from(users);\n    const totalUsers = allUsers.length;\n    const registrationsThisMonth = allUsers.filter(u => \n      new Date(u.createdAt) >= monthStart\n    ).length;\n\n    // Get message stats\n    const allMessages = await db.select().from(directMessages);\n    const totalMessages = allMessages.length;\n    const messagesThisMonth = allMessages.filter(m => \n      new Date(m.createdAt) >= monthStart\n    ).length;\n\n    // Get storage stats (from image uploads)\n    const allUploads = await db.select().from(imageUploads);\n    const totalStorage = allUploads.reduce((sum, upload) => sum + upload.fileSize, 0);\n\n    return {\n      totalUsers,\n      activeUsers: totalUsers, // For now, assume all users are active\n      totalMessages,\n      totalStorage,\n      registrationsThisMonth,\n      messagesThisMonth,\n    };\n  }\n\n  // Session management with PostgreSQL sessions table integration\n  async getActiveSessions(): Promise<{\n    id: string;\n    userId: string;\n    userEmail: string;\n    ipAddress: string;\n    userAgent: string;\n    lastActivity: string;\n    createdAt: string;\n    isActive: boolean;\n    location?: string;\n  }[]> {\n    // Mock sessions data for development - real implementation would query sessions table\n    const mockSessions = [\n      {\n        id: randomUUID(),\n        userId: \"eynffxrvr1e\",\n        userEmail: \"modacizimtasarim@gmail.com\",\n        ipAddress: \"192.168.1.100\",\n        userAgent: \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/91.0\",\n        lastActivity: new Date().toISOString(),\n        createdAt: new Date(Date.now() - 3600000).toISOString(),\n        isActive: true,\n        location: \"İstanbul, Türkiye\"\n      },\n      {\n        id: randomUUID(),\n        userId: \"user2\",\n        userEmail: \"admin@example.com\",\n        ipAddress: \"10.0.0.50\",\n        userAgent: \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Safari/537.36\",\n        lastActivity: new Date(Date.now() - 1800000).toISOString(),\n        createdAt: new Date(Date.now() - 7200000).toISOString(),\n        isActive: false,\n        location: \"Ankara, Türkiye\"\n      }\n    ];\n    return mockSessions;\n  }\n\n  async terminateSession(sessionId: string): Promise<boolean> {\n    try {\n      // Delete from PostgreSQL sessions table\n      const result = await db.execute(\n        sql`DELETE FROM sessions WHERE sid = ${sessionId}`\n      );\n      return (result.rowCount ?? 0) > 0;\n    } catch (error) {\n      console.error('Session termination error:', error);\n      return false;\n    }\n  }\n\n  // SUPER_ADMIN Methods\n  async updateUserRole(userId: string, role: 'USER' | 'ADMIN'): Promise<void> {\n    await db.update(users)\n      .set({ \n        role: role,\n        updatedAt: new Date() \n      })\n      .where(eq(users.id, userId));\n  }\n\n  async updateUserStatus(userId: string, status: 'ACTIVE' | 'SUSPENDED'): Promise<void> {\n    await db.update(users)\n      .set({ \n        status: status,\n        updatedAt: new Date() \n      })\n      .where(eq(users.id, userId));\n  }\n\n  async terminateAllUserSessions(userId: string): Promise<void> {\n    // Mock implementation - would terminate all sessions for specific user\n    console.log(`Terminating all sessions for user: ${userId}`);\n  }\n\n  async createPasswordResetToken(userId: string): Promise<string> {\n    const token = randomUUID();\n    // Mock implementation - would create password reset token and send email\n    console.log(`Password reset token created for user: ${userId}, token: ${token}`);\n    return token;\n  }\n\n  async createInvitation(invitation: {\n    email: string;\n    role: 'USER' | 'ADMIN';\n    invitedBy: string;\n    expiresAt: Date;\n  }): Promise<any> {\n    // Mock implementation - would create invitation and send email\n    const invitationData = {\n      id: randomUUID(),\n      ...invitation,\n      createdAt: new Date(),\n      used: false,\n    };\n    console.log('Invitation created:', invitationData);\n    return invitationData;\n  }\n\n  async createSystemSetting(setting: any): Promise<any> {\n    // Mock implementation - would save system setting\n    const settingData = {\n      id: randomUUID(),\n      ...setting,\n      createdAt: new Date(),\n    };\n    console.log('System setting created:', settingData);\n    return settingData;\n  }\n\n  // Admin Notes operations\n  async getAdminNotesByUser(targetUserId: string): Promise<AdminNote[]> {\n    return await db.select().from(adminNotes)\n      .where(eq(adminNotes.targetUserId, targetUserId))\n      .orderBy(desc(adminNotes.createdAt));\n  }\n\n  async createAdminNote(note: InsertAdminNote): Promise<AdminNote> {\n    const [result] = await db.insert(adminNotes).values(note).returning();\n    return result;\n  }\n\n  async getAdminLogsRecent(): Promise<AdminLog[]> {\n    return await db.select().from(adminLogs)\n      .orderBy(desc(adminLogs.createdAt))\n      .limit(50);\n  }\n\n  // Payment notification methods\n  async createPaymentNotification(userId: string, notificationData: InsertPaymentNotification): Promise<PaymentNotification> {\n    const [result] = await db.insert(paymentNotifications).values({\n      ...notificationData,\n      userId,\n    }).returning();\n    return result;\n  }\n\n  async getPaymentNotifications(): Promise<PaymentNotification[]> {\n    return await db.select().from(paymentNotifications)\n      .orderBy(desc(paymentNotifications.createdAt));\n  }\n\n  async getPaymentNotificationsByStatus(status: string): Promise<PaymentNotification[]> {\n    return await db.select().from(paymentNotifications)\n      .where(eq(paymentNotifications.status, status))\n      .orderBy(desc(paymentNotifications.createdAt));\n  }\n\n  async updatePaymentNotificationStatus(\n    id: string, \n    status: string, \n    processedBy?: string, \n    adminNote?: string\n  ): Promise<PaymentNotification | undefined> {\n    const [result] = await db.update(paymentNotifications)\n      .set({\n        status,\n        processedBy,\n        adminNote,\n        processedAt: new Date(),\n      })\n      .where(eq(paymentNotifications.id, id))\n      .returning();\n    return result;\n  }\n\n  async updateUserSubscriptionType(userId: string, subscriptionType: string): Promise<void> {\n    await db.update(users)\n      .set({ \n        subscriptionType: subscriptionType,\n        updatedAt: new Date() \n      })\n      .where(eq(users.id, userId));\n  }\n\n  async updateUserSubscription(userId: string, subscription: { subscriptionType: string, subscriptionStatus: string, subscriptionEndDate?: Date }): Promise<User | undefined> {\n    const [result] = await db.update(users)\n      .set({ \n        subscriptionType: subscription.subscriptionType,\n        subscriptionStatus: subscription.subscriptionStatus,\n        subscriptionEndDate: subscription.subscriptionEndDate,\n        updatedAt: new Date() \n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return result;\n  }\n\n  // Payment settings methods\n  async getPaymentSettings(): Promise<PaymentSettings | undefined> {\n    const [result] = await db.select().from(paymentSettings).limit(1);\n    return result;\n  }\n\n  async updatePaymentSettings(settings: InsertPaymentSettings): Promise<PaymentSettings> {\n    // Check if settings exist\n    const existing = await this.getPaymentSettings();\n    \n    if (existing) {\n      // Update existing settings\n      const [result] = await db.update(paymentSettings)\n        .set({\n          ...settings,\n          updatedAt: new Date(),\n        })\n        .where(eq(paymentSettings.id, existing.id))\n        .returning();\n      return result;\n    } else {\n      // Create new settings\n      const [result] = await db.insert(paymentSettings)\n        .values(settings)\n        .returning();\n      return result;\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":97408},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, decimal, integer, boolean, jsonb, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique().notNull(),\n  password: varchar(\"password\"), // Added for regular user authentication\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  isAdmin: boolean(\"is_admin\").default(false), // Admin flag\n  status: varchar(\"status\").default(\"ACTIVE\"), // User status: ACTIVE, SUSPENDED\n  role: varchar(\"role\").default(\"USER\"), // User role: USER, ADMIN, SUPER_ADMIN\n  subscriptionType: varchar(\"subscription_type\").default(\"DEMO\"), // DEMO, PRO\n  subscriptionStatus: varchar(\"subscription_status\").default(\"ACTIVE\"), // ACTIVE, EXPIRED, PENDING\n  subscriptionEndDate: timestamp(\"subscription_end_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n\nexport const personnel = pgTable(\"personnel\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  name: text(\"name\").notNull(),\n  position: text(\"position\").notNull(),\n  startDate: timestamp(\"start_date\").notNull(),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  salary: decimal(\"salary\", { precision: 10, scale: 2 }),\n  salaryType: text(\"salary_type\").default(\"monthly\"), // \"monthly\" or \"daily\"\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const projects = pgTable(\"projects\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  name: text(\"name\").notNull(),\n  type: text(\"type\").notNull(), // \"given\" or \"received\"\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  status: text(\"status\").notNull(), // \"active\", \"passive\", \"completed\"\n  description: text(\"description\"),\n  clientName: text(\"client_name\"),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const timesheets = pgTable(\"timesheets\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  personnelId: varchar(\"personnel_id\").notNull(),\n  customerId: varchar(\"customer_id\"),\n  date: timestamp(\"date\").notNull(),\n  workType: text(\"work_type\").notNull(), // \"tam\", \"yarim\", \"mesai\"\n  startTime: text(\"start_time\"),\n  endTime: text(\"end_time\"),\n  totalHours: decimal(\"total_hours\", { precision: 4, scale: 2 }).notNull(),\n  overtimeHours: decimal(\"overtime_hours\", { precision: 4, scale: 2 }).default(\"0.00\"),\n  hourlyRate: decimal(\"hourly_rate\", { precision: 10, scale: 2 }),\n  dailyWage: decimal(\"daily_wage\", { precision: 10, scale: 2 }),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const transactions = pgTable(\"transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  type: text(\"type\").notNull(), // \"income\" or \"expense\"\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  description: text(\"description\").notNull(),\n  category: text(\"category\"),\n  date: timestamp(\"date\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const notes = pgTable(\"notes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const contractors = pgTable(\"contractors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  name: text(\"name\").notNull(),\n  company: text(\"company\"),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  status: text(\"status\").notNull(), // \"active\", \"completed\"\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const customers = pgTable(\"customers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  name: text(\"name\").notNull(),\n  company: text(\"company\"),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  address: text(\"address\"),\n  taxNumber: text(\"tax_number\"),\n  status: text(\"status\").notNull().default(\"active\"), // \"active\", \"inactive\"\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Customer Tasks (Yapılacak İşler)\nexport const customerTasks = pgTable(\"customer_tasks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  customerId: varchar(\"customer_id\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  quantity: decimal(\"quantity\", { precision: 8, scale: 2 }).notNull().default(\"1.00\"),\n  unit: text(\"unit\").notNull().default(\"adet\"), // \"adet\", \"m2\", \"m\"\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull().default(\"0\"),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  hasVAT: boolean(\"has_vat\").default(false),\n  vatRate: decimal(\"vat_rate\", { precision: 5, scale: 2 }).default(\"1.00\"), // %1 KDV\n  vatAmount: decimal(\"vat_amount\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  totalWithVAT: decimal(\"total_with_vat\", { precision: 10, scale: 2 }).notNull().default(\"0\"),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"in_progress\", \"completed\"\n  dueDate: timestamp(\"due_date\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Customer Quotes (Müşteri Teklifleri)\nexport const customerQuotes = pgTable(\"customer_quotes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  customerId: varchar(\"customer_id\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }).notNull().default(\"0\"),\n  hasVAT: boolean(\"has_vat\").default(false),\n  vatRate: decimal(\"vat_rate\", { precision: 5, scale: 2 }).default(\"1.00\"), // %1 KDV\n  vatAmount: decimal(\"vat_amount\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  totalWithVAT: decimal(\"total_with_vat\", { precision: 10, scale: 2 }).notNull().default(\"0\"),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"approved\", \"rejected\"\n  isApproved: boolean(\"is_approved\").default(false),\n  quoteDate: timestamp(\"quote_date\").notNull(),\n  validUntil: timestamp(\"valid_until\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n  updatedAt: timestamp(\"updated_at\").default(sql`now()`),\n});\n\n// Customer Quote Items (Teklif Kalemleri)\nexport const customerQuoteItems = pgTable(\"customer_quote_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  quoteId: varchar(\"quote_id\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  quantity: decimal(\"quantity\", { precision: 8, scale: 2 }).notNull().default(\"1.00\"),\n  unit: text(\"unit\").notNull().default(\"adet\"), // \"adet\", \"m2\", \"m\"\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: decimal(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"approved\", \"rejected\"\n  isApproved: boolean(\"is_approved\").default(false),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Customer Payments (Müşteri Ödemeleri)\nexport const customerPayments = pgTable(\"customer_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  customerId: varchar(\"customer_id\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  description: text(\"description\").notNull(),\n  paymentDate: timestamp(\"payment_date\").notNull(),\n  paymentMethod: text(\"payment_method\"), // \"cash\", \"bank_transfer\", \"check\", \"other\"\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Contractor Tasks (Yüklenici Görevleri)\nexport const contractorTasks = pgTable(\"contractor_tasks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contractorId: varchar(\"contractor_id\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"in_progress\", \"completed\"\n  dueDate: timestamp(\"due_date\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Contractor Payments (Yüklenici Ödemeleri)\nexport const contractorPayments = pgTable(\"contractor_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contractorId: varchar(\"contractor_id\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  description: text(\"description\").notNull(),\n  paymentDate: timestamp(\"payment_date\").notNull(),\n  paymentMethod: text(\"payment_method\"), // \"cash\", \"bank_transfer\", \"check\", \"other\"\n  transactionId: varchar(\"transaction_id\"), // Link to auto-created expense transaction\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const invoices = pgTable(\"invoices\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  customerId: varchar(\"customer_id\").notNull(),\n  invoiceNumber: text(\"invoice_number\").notNull().unique(),\n  issueDate: timestamp(\"issue_date\").notNull(),\n  dueDate: timestamp(\"due_date\").notNull(),\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 }).notNull().default(\"18.00\"),\n  taxAmount: decimal(\"tax_amount\", { precision: 10, scale: 2 }).notNull(),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n  status: text(\"status\").notNull().default(\"draft\"), // \"draft\", \"sent\", \"paid\", \"overdue\"\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const invoiceItems = pgTable(\"invoice_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invoiceId: varchar(\"invoice_id\").notNull(),\n  description: text(\"description\").notNull(),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 2 }).notNull().default(\"1.00\"),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const reports = pgTable(\"reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  type: text(\"type\").notNull(), // \"financial\", \"timesheet\", \"project\", \"custom\"\n  config: text(\"config\").notNull(), // JSON string\n  createdBy: text(\"created_by\").notNull(),\n  isPublic: boolean(\"is_public\").default(false),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Insert schemas\nexport const insertPersonnelSchema = createInsertSchema(personnel).omit({\n  id: true,\n  createdAt: true,\n  userId: true, // Server will add this\n}).extend({\n  phone: z.string().optional().nullable(),\n  email: z.string().optional().nullable(),\n  salary: z.string().optional().nullable(),\n});\n\nexport const insertProjectSchema = createInsertSchema(projects).omit({\n  id: true,\n  createdAt: true,\n  userId: true, // Server will add this\n}).extend({\n  description: z.string().optional().nullable(),\n  clientName: z.string().optional().nullable(),\n  endDate: z.date().optional().nullable(),\n});\n\nexport const insertTimesheetSchema = createInsertSchema(timesheets).omit({\n  id: true,\n  createdAt: true,\n  userId: true, // Server will add this\n}).extend({\n  customerId: z.string().optional().nullable(),\n  startTime: z.string().optional().nullable(),\n  endTime: z.string().optional().nullable(),\n  hourlyRate: z.string().optional().nullable(),\n  dailyWage: z.string().optional().nullable(),\n  notes: z.string().optional().nullable(),\n  overtimeHours: z.string().optional().nullable(),\n});\n\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({\n  id: true,\n  createdAt: true,\n  userId: true, // Server will add this\n}).extend({\n  category: z.string().optional().nullable(),\n});\n\nexport const insertNoteSchema = createInsertSchema(notes).omit({\n  id: true,\n  createdAt: true,\n  userId: true, // Server will add this\n});\n\nexport const insertContractorSchema = createInsertSchema(contractors).omit({\n  id: true,\n  createdAt: true,\n  userId: true, // Server will add this\n}).extend({\n  company: z.string().optional().nullable(),\n  phone: z.string().optional().nullable(),\n  email: z.string().optional().nullable(),\n});\n\nexport const insertCustomerSchema = createInsertSchema(customers).omit({\n  id: true,\n  createdAt: true,\n  userId: true, // Server will add this\n}).extend({\n  phone: z.string().optional().nullable(),\n  email: z.string().optional().nullable(),\n  address: z.string().optional().nullable(),\n  taxNumber: z.string().optional().nullable(),\n  company: z.string().optional().nullable(),\n});\n\nexport const insertCustomerTaskSchema = createInsertSchema(customerTasks).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  description: z.string().optional().nullable(),\n  dueDate: z.date().optional().nullable(),\n  quantity: z.number().min(0.1),\n  unitPrice: z.number().min(0),\n});\n\nexport const insertCustomerQuoteSchema = createInsertSchema(customerQuotes).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  description: z.string().optional().nullable(),\n  validUntil: z.date().optional().nullable(),\n});\n\nexport const insertCustomerQuoteItemSchema = createInsertSchema(customerQuoteItems).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  description: z.string().optional().nullable(),\n});\n\nexport const insertCustomerPaymentSchema = createInsertSchema(customerPayments).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  paymentMethod: z.string().optional().nullable(),\n});\n\nexport const insertContractorTaskSchema = createInsertSchema(contractorTasks).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  description: z.string().optional().nullable(),\n  dueDate: z.date().optional().nullable(),\n});\n\nexport const insertContractorPaymentSchema = createInsertSchema(contractorPayments).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  paymentMethod: z.string().optional().nullable(),\n  transactionId: z.string().optional().nullable(),\n});\n\nexport const insertInvoiceSchema = createInsertSchema(invoices).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertInvoiceItemSchema = createInsertSchema(invoiceItems).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertReportSchema = createInsertSchema(reports).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Personnel Payments table\nexport const personnelPayments = pgTable(\"personnel_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  personnelId: varchar(\"personnel_id\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  paymentDate: timestamp(\"payment_date\").notNull(),\n  paymentType: text(\"payment_type\").notNull(), // \"salary\", \"bonus\", \"advance\", \"deduction\"\n  description: text(\"description\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const insertPersonnelPaymentSchema = createInsertSchema(personnelPayments).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  description: z.string().optional().nullable(),\n  notes: z.string().optional().nullable(),\n});\n\n// Company Directory table\nexport const companyDirectory = pgTable(\"company_directory\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Owner of this company entry\n  companyName: text(\"company_name\").notNull(),\n  contactPerson: text(\"contact_person\").notNull(),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  address: text(\"address\"),\n  city: text(\"city\"), // Şehir\n  industry: text(\"industry\"), // Sektör\n  website: text(\"website\"),\n  description: text(\"description\"),\n  bio: text(\"bio\"), // Biyografi\n  logoUrl: text(\"logo_url\"), // Logo URL\n  isActive: boolean(\"is_active\").default(true),\n  isProVisible: boolean(\"is_pro_visible\").default(false), // PRO üyelik görünürlüğü\n  isVerified: boolean(\"is_verified\").default(false), // Doğrulanmış firma rozeti\n  subscriptionStatus: text(\"subscription_status\").default(\"FREE\"), // FREE, PRO\n  profileImage: text(\"profile_image\"), // Avatar URL\n  verifiedAt: timestamp(\"verified_at\"),\n  lastSeen: timestamp(\"last_seen\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Messages table for company messaging\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fromUserId: varchar(\"from_user_id\").notNull(),      // Gönderen kullanıcı ID\n  toUserId: varchar(\"to_user_id\").notNull(),          // Alan kullanıcı ID\n  fromCompanyId: varchar(\"from_company_id\").notNull(), // Gönderen firma ID\n  toCompanyId: varchar(\"to_company_id\").notNull(),     // Alan firma ID\n  message: text(\"message\").notNull(),\n  isRead: boolean(\"is_read\").default(false),\n  messageType: text(\"message_type\").default(\"text\"), // \"text\", \"image\", \"file\"\n  attachmentUrl: text(\"attachment_url\"), // Dosya ekler için\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Conversations table for organizing messages\nexport const conversations = pgTable(\"conversations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company1Id: varchar(\"company1_id\").notNull(),\n  company2Id: varchar(\"company2_id\").notNull(),\n  lastMessageId: varchar(\"last_message_id\"),\n  lastMessageAt: timestamp(\"last_message_at\"),\n  unreadCount1: integer(\"unread_count1\").default(0), // company1 için okunmamış mesaj sayısı\n  unreadCount2: integer(\"unread_count2\").default(0), // company2 için okunmamış mesaj sayısı\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Notification system for messaging\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  type: text(\"type\").notNull(), // NEW_DM, DM_DELIVERED, DM_READ, PROFILE_VERIFIED\n  payload: jsonb(\"payload\"),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Company blocking system\nexport const companyBlocks = pgTable(\"company_blocks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  blockerCompanyId: varchar(\"blocker_company_id\").notNull(),\n  blockedCompanyId: varchar(\"blocked_company_id\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Payment settings for admin\nexport const paymentSettings = pgTable(\"payment_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  bankName: varchar(\"bank_name\").notNull().default(\"Ziraat Bankası\"),\n  accountHolder: varchar(\"account_holder\").notNull().default(\"puantropls Ltd.\"),\n  iban: varchar(\"iban\").notNull().default(\"TR64 0001 0017 4513 6456 7890 01\"),\n  amount: varchar(\"amount\").notNull().default(\"99 TL\"),\n  paymentMethod: varchar(\"payment_method\").notNull().default(\"EFT/Havale\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Company mute system\nexport const companyMutes = pgTable(\"company_mutes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  muterCompanyId: varchar(\"muter_company_id\").notNull(),\n  mutedCompanyId: varchar(\"muted_company_id\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Report abuse system\nexport const abuseReports = pgTable(\"abuse_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  reporterCompanyId: varchar(\"reporter_company_id\").notNull(),\n  reportedCompanyId: varchar(\"reported_company_id\").notNull(),\n  reason: text(\"reason\").notNull(),\n  messageSample: text(\"message_sample\"),\n  isResolved: boolean(\"is_resolved\").default(false),\n  resolvedAt: timestamp(\"resolved_at\"),\n  resolvedBy: varchar(\"resolved_by\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const insertCompanyDirectorySchema = createInsertSchema(companyDirectory).omit({\n  id: true,\n  userId: true, // Server will add this\n  createdAt: true,\n  lastSeen: true,\n  profileImage: true,\n  verifiedAt: true,\n  isVerified: true,\n}).extend({\n  phone: z.string().optional(),\n  email: z.string().optional(),\n  address: z.string().optional(),\n  city: z.string().optional(),\n  industry: z.string().optional(),\n  website: z.string().optional(),\n  description: z.string().optional(),\n  bio: z.string().optional(),\n  logoUrl: z.string().optional(),\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Firm Invite System\nexport const firmInvites = pgTable(\"firm_invites\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  firmId: varchar(\"firm_id\").notNull(),\n  email: text(\"email\").notNull(),\n  role: text(\"role\").notNull(), // \"ADMIN\" | \"USER\"\n  tokenHash: text(\"token_hash\").notNull(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  acceptedAt: timestamp(\"accepted_at\"),\n  createdByUserId: varchar(\"created_by_user_id\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Presence Logs\nexport const presenceLogs = pgTable(\"presence_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  firmId: varchar(\"firm_id\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  lastHeartbeatAt: timestamp(\"last_heartbeat_at\").default(sql`now()`),\n  clientInfo: text(\"client_info\"), // User agent/IP\n  updatedAt: timestamp(\"updated_at\").default(sql`now()`),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n}, (table) => [\n  index(\"idx_presence_firm_user\").on(table.firmId, table.userId)\n]);\n\n// Message Drafts\nexport const messageDrafts = pgTable(\"message_drafts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  threadId: varchar(\"thread_id\").notNull(),\n  authorFirmId: varchar(\"author_firm_id\").notNull(),\n  body: text(\"body\").notNull().default(\"\"),\n  updatedAt: timestamp(\"updated_at\").default(sql`now()`),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n}, (table) => [\n  index(\"idx_draft_thread_author\").on(table.threadId, table.authorFirmId)\n]);\n\n// Auto Responder\nexport const autoResponders = pgTable(\"auto_responders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  firmId: varchar(\"firm_id\").notNull(),\n  enabled: boolean(\"enabled\").default(false),\n  mode: text(\"mode\").notNull().default(\"KEYWORD\"), // \"KEYWORD\" | \"ALWAYS\" | \"OFFHOURS\"\n  keywords: jsonb(\"keywords\"), // string[]\n  offHoursTZ: text(\"off_hours_tz\"), // \"Europe/Istanbul\"\n  offHours: jsonb(\"off_hours\"), // { days: number[], start: string, end: string }\n  cooldownSec: integer(\"cooldown_sec\").default(600),\n  messageBody: text(\"message_body\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n  updatedAt: timestamp(\"updated_at\").default(sql`now()`),\n});\n\n// Auto Reply Logs (to track cooldowns)\nexport const autoReplyLogs = pgTable(\"auto_reply_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  responderFirmId: varchar(\"responder_firm_id\").notNull(),\n  targetFirmId: varchar(\"target_firm_id\").notNull(),\n  lastReplyAt: timestamp(\"last_reply_at\").default(sql`now()`),\n  messageId: varchar(\"message_id\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n}, (table) => [\n  index(\"idx_auto_reply_firms\").on(table.responderFirmId, table.targetFirmId)\n]);\n\n// Enhanced Messages with image support\nexport const directThreads = pgTable(\"direct_threads\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  firm1Id: varchar(\"firm1_id\").notNull(),\n  firm2Id: varchar(\"firm2_id\").notNull(),\n  lastMessageAt: timestamp(\"last_message_at\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n}, (table) => [\n  index(\"idx_thread_firms\").on(table.firm1Id, table.firm2Id)\n]);\n\nexport const directMessages = pgTable(\"direct_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  threadId: varchar(\"thread_id\").notNull(),\n  senderFirmId: varchar(\"sender_firm_id\").notNull(),\n  receiverFirmId: varchar(\"receiver_firm_id\").notNull(),\n  body: text(\"body\"),\n  attachmentUrl: text(\"attachment_url\"),\n  attachmentType: text(\"attachment_type\"), // \"image\" | \"file\"\n  attachmentThumbUrl: text(\"attachment_thumb_url\"), // thumbnail for images\n  messageType: text(\"message_type\").default(\"user\"), // \"user\" | \"auto_reply\"\n  isRead: boolean(\"is_read\").default(false),\n  deliveredAt: timestamp(\"delivered_at\"),\n  readAt: timestamp(\"read_at\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n}, (table) => [\n  index(\"idx_message_thread\").on(table.threadId),\n  index(\"idx_message_receiver\").on(table.receiverFirmId)\n]);\n\n// Image Upload Logs\nexport const imageUploads = pgTable(\"image_uploads\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  firmId: varchar(\"firm_id\").notNull(),\n  filename: text(\"filename\").notNull(),\n  originalName: text(\"original_name\").notNull(),\n  mimeType: text(\"mime_type\").notNull(),\n  fileSize: integer(\"file_size\").notNull(),\n  url: text(\"url\").notNull(),\n  thumbUrl: text(\"thumb_url\"),\n  width: integer(\"width\"),\n  height: integer(\"height\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\n// Insert schemas for new tables\nexport const insertFirmInviteSchema = createInsertSchema(firmInvites).omit({\n  id: true,\n  tokenHash: true,\n  createdAt: true,\n});\n\nexport const insertPresenceLogSchema = createInsertSchema(presenceLogs).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertMessageDraftSchema = createInsertSchema(messageDrafts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAutoResponderSchema = createInsertSchema(autoResponders).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDirectThreadSchema = createInsertSchema(directThreads).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDirectMessageSchema = createInsertSchema(directMessages).omit({\n  id: true,\n  createdAt: true,\n  deliveredAt: true,\n  readAt: true,\n});\n\nexport const insertImageUploadSchema = createInsertSchema(imageUploads).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type FirmInvite = typeof firmInvites.$inferSelect;\nexport type InsertFirmInvite = z.infer<typeof insertFirmInviteSchema>;\n\nexport type PresenceLog = typeof presenceLogs.$inferSelect;\nexport type InsertPresenceLog = z.infer<typeof insertPresenceLogSchema>;\n\nexport type MessageDraft = typeof messageDrafts.$inferSelect;\nexport type InsertMessageDraft = z.infer<typeof insertMessageDraftSchema>;\n\nexport type AutoResponder = typeof autoResponders.$inferSelect;\nexport type InsertAutoResponder = z.infer<typeof insertAutoResponderSchema>;\n\nexport type DirectThread = typeof directThreads.$inferSelect;\nexport type InsertDirectThread = z.infer<typeof insertDirectThreadSchema>;\n\nexport type DirectMessage = typeof directMessages.$inferSelect;\nexport type InsertDirectMessage = z.infer<typeof insertDirectMessageSchema>;\n\nexport type ImageUpload = typeof imageUploads.$inferSelect;\nexport type InsertImageUpload = z.infer<typeof insertImageUploadSchema>;\n\nexport type Notification = typeof notifications.$inferSelect;\nexport type CompanyDirectory = typeof companyDirectory.$inferSelect;\n\nexport const insertCompanyBlockSchema = createInsertSchema(companyBlocks).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertPaymentSettingsSchema = createInsertSchema(paymentSettings).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type PaymentSettings = typeof paymentSettings.$inferSelect;\nexport type InsertPaymentSettings = z.infer<typeof insertPaymentSettingsSchema>;\n\nexport const insertCompanyMuteSchema = createInsertSchema(companyMutes).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAbuseReportSchema = createInsertSchema(abuseReports).omit({\n  id: true,\n  createdAt: true,\n  resolvedAt: true,\n  resolvedBy: true,\n});\n\n// Types\nexport type Personnel = typeof personnel.$inferSelect;\nexport type InsertPersonnel = z.infer<typeof insertPersonnelSchema>;\n\nexport type Project = typeof projects.$inferSelect;\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\n\nexport type PersonnelPayment = typeof personnelPayments.$inferSelect;\nexport type InsertPersonnelPayment = z.infer<typeof insertPersonnelPaymentSchema>;\n\nexport type Timesheet = typeof timesheets.$inferSelect;\nexport type InsertTimesheet = z.infer<typeof insertTimesheetSchema>;\n\nexport type Transaction = typeof transactions.$inferSelect;\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\n\nexport type Note = typeof notes.$inferSelect;\nexport type InsertNote = z.infer<typeof insertNoteSchema>;\n\nexport type Contractor = typeof contractors.$inferSelect;\nexport type InsertContractor = z.infer<typeof insertContractorSchema>;\n\nexport type Customer = typeof customers.$inferSelect;\nexport type InsertCustomer = z.infer<typeof insertCustomerSchema>;\n\nexport type CustomerTask = typeof customerTasks.$inferSelect;\nexport type InsertCustomerTask = z.infer<typeof insertCustomerTaskSchema>;\n\nexport type CustomerQuote = typeof customerQuotes.$inferSelect;\nexport type InsertCustomerQuote = z.infer<typeof insertCustomerQuoteSchema>;\n\nexport type CustomerQuoteItem = typeof customerQuoteItems.$inferSelect;\nexport type InsertCustomerQuoteItem = z.infer<typeof insertCustomerQuoteItemSchema>;\n\nexport type CustomerPayment = typeof customerPayments.$inferSelect;\nexport type InsertCustomerPayment = z.infer<typeof insertCustomerPaymentSchema>;\n\nexport type ContractorTask = typeof contractorTasks.$inferSelect;\nexport type InsertContractorTask = z.infer<typeof insertContractorTaskSchema>;\n\nexport type ContractorPayment = typeof contractorPayments.$inferSelect;\nexport type InsertContractorPayment = z.infer<typeof insertContractorPaymentSchema>;\n\nexport type Invoice = typeof invoices.$inferSelect;\nexport type InsertInvoice = z.infer<typeof insertInvoiceSchema>;\n\nexport type InvoiceItem = typeof invoiceItems.$inferSelect;\nexport type InsertInvoiceItem = z.infer<typeof insertInvoiceItemSchema>;\n\nexport type Report = typeof reports.$inferSelect;\nexport type InsertReport = z.infer<typeof insertReportSchema>;\n\nexport type CompanyDirectory = typeof companyDirectory.$inferSelect;\nexport type InsertCompanyDirectory = z.infer<typeof insertCompanyDirectorySchema>;\n\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\nexport type Conversation = typeof conversations.$inferSelect;\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\n\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\n\nexport type CompanyBlock = typeof companyBlocks.$inferSelect;\nexport type InsertCompanyBlock = z.infer<typeof insertCompanyBlockSchema>;\n\nexport type CompanyMute = typeof companyMutes.$inferSelect;\nexport type InsertCompanyMute = z.infer<typeof insertCompanyMuteSchema>;\n\nexport type AbuseReport = typeof abuseReports.$inferSelect;\nexport type InsertAbuseReport = z.infer<typeof insertAbuseReportSchema>;\n\n// SMS Management System\nexport const smsHistory = pgTable(\"sms_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  message: text(\"message\").notNull(),\n  recipientCount: integer(\"recipient_count\").notNull(),\n  recipientData: jsonb(\"recipient_data\").notNull(), // Array of {id, name, phone, type}\n  templateId: varchar(\"template_id\"), // Optional template reference\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"sent\", \"failed\"\n  cost: decimal(\"cost\", { precision: 10, scale: 2 }).notNull().default(\"0.00\"),\n  sentAt: timestamp(\"sent_at\"),\n  errorMessage: text(\"error_message\"),\n  netgsmResponse: jsonb(\"netgsm_response\"), // NetGSM API response\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const smsTemplates = pgTable(\"sms_templates\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  name: text(\"name\").notNull(),\n  content: text(\"content\").notNull(),\n  category: text(\"category\").notNull(), // \"personnel\", \"customer\", \"general\"\n  isActive: boolean(\"is_active\").default(true),\n  usageCount: integer(\"usage_count\").default(0),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const insertSMSHistorySchema = createInsertSchema(smsHistory).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n  sentAt: true,\n}).extend({\n  templateId: z.string().optional().nullable(),\n  errorMessage: z.string().optional().nullable(),\n  netgsmResponse: z.any().optional().nullable(),\n});\n\nexport const insertSMSTemplateSchema = createInsertSchema(smsTemplates).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n}).extend({\n  usageCount: z.number().optional(),\n});\n\nexport type SMSHistory = typeof smsHistory.$inferSelect;\nexport type InsertSMSHistory = z.infer<typeof insertSMSHistorySchema>;\n\nexport type SMSTemplate = typeof smsTemplates.$inferSelect;\nexport type InsertSMSTemplate = z.infer<typeof insertSMSTemplateSchema>;\n\n// Payment Notifications\nexport const paymentNotifications = pgTable(\"payment_notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(), // Foreign key to users table\n  paymentDate: timestamp(\"payment_date\").notNull(),\n  senderName: text(\"sender_name\").notNull(),\n  senderBank: text(\"sender_bank\").notNull(),\n  amount: text(\"amount\").notNull(),\n  description: text(\"description\"),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"approved\", \"rejected\"\n  adminNote: text(\"admin_note\"),\n  processedBy: varchar(\"processed_by\"), // Admin user who processed\n  processedAt: timestamp(\"processed_at\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const insertPaymentNotificationSchema = createInsertSchema(paymentNotifications).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n  status: true,\n  processedBy: true,\n  processedAt: true,\n}).extend({\n  adminNote: z.string().optional().nullable(),\n});\n\nexport type PaymentNotification = typeof paymentNotifications.$inferSelect;\nexport type InsertPaymentNotification = z.infer<typeof insertPaymentNotificationSchema>;\n\n// Admin Panel Tables\nexport const adminLogs = pgTable(\"admin_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  adminUserId: varchar(\"admin_user_id\").notNull(),\n  action: text(\"action\").notNull(), // \"USER_SUSPENDED\", \"FEATURE_TOGGLED\", etc.\n  targetEntity: text(\"target_entity\"), // \"User\", \"Firm\", \"System\"\n  targetId: varchar(\"target_id\"),\n  details: jsonb(\"details\"),\n  ipAddress: text(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const systemSettings = pgTable(\"system_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").unique().notNull(),\n  value: jsonb(\"value\").notNull(),\n  description: text(\"description\"),\n  category: text(\"category\").default(\"general\"), // \"general\", \"email\", \"sms\", \"billing\"\n  updatedBy: varchar(\"updated_by\"),\n  updatedAt: timestamp(\"updated_at\").default(sql`now()`),\n});\n\nexport const announcements = pgTable(\"announcements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  body: text(\"body\").notNull(),\n  level: text(\"level\").default(\"info\"), // \"info\", \"warning\", \"critical\"\n  targets: jsonb(\"targets\").default('[\"all\"]'), // [\"all\"] or [\"user:id\", \"admin\"]\n  publishAt: timestamp(\"publish_at\").default(sql`now()`),\n  expireAt: timestamp(\"expire_at\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdBy: varchar(\"created_by\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const userSessions = pgTable(\"user_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  sessionToken: text(\"session_token\").notNull(),\n  ipAddress: text(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  location: text(\"location\"),\n  isActive: boolean(\"is_active\").default(true),\n  lastActivity: timestamp(\"last_activity\").default(sql`now()`),\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n});\n\nexport const systemMetrics = pgTable(\"system_metrics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  metricType: text(\"metric_type\").notNull(), // \"users\", \"messages\", \"storage\", \"api_calls\"\n  value: decimal(\"value\", { precision: 15, scale: 2 }).notNull(),\n  metadata: jsonb(\"metadata\"),\n  recordedAt: timestamp(\"recorded_at\").default(sql`now()`),\n});\n\n// Insert schemas for admin tables\nexport const insertAdminLogSchema = createInsertSchema(adminLogs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSystemSettingSchema = createInsertSchema(systemSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertAnnouncementSchema = createInsertSchema(announcements).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserSessionSchema = createInsertSchema(userSessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSystemMetricSchema = createInsertSchema(systemMetrics).omit({\n  id: true,\n  recordedAt: true,\n});\n\n// Admin Notes Table - for admin comments on users\nexport const adminNotes = pgTable(\"admin_notes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  targetUserId: varchar(\"target_user_id\").notNull(), // User being noted\n  adminUserId: varchar(\"admin_user_id\").notNull(), // Admin making the note\n  note: text(\"note\").notNull(),\n  category: text(\"category\").default(\"general\"), // \"general\", \"warning\", \"positive\", \"violation\"\n  isPrivate: boolean(\"is_private\").default(true), // Private to admins only\n  createdAt: timestamp(\"created_at\").default(sql`now()`),\n});\n\nexport const insertAdminNoteSchema = createInsertSchema(adminNotes).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types for admin panel\nexport type AdminLog = typeof adminLogs.$inferSelect;\nexport type InsertAdminLog = z.infer<typeof insertAdminLogSchema>;\n\nexport type SystemSetting = typeof systemSettings.$inferSelect;\nexport type InsertSystemSetting = z.infer<typeof insertSystemSettingSchema>;\n\nexport type Announcement = typeof announcements.$inferSelect;\nexport type InsertAnnouncement = z.infer<typeof insertAnnouncementSchema>;\n\nexport type UserSession = typeof userSessions.$inferSelect;\nexport type InsertUserSession = z.infer<typeof insertUserSessionSchema>;\n\nexport type SystemMetric = typeof systemMetrics.$inferSelect;\nexport type InsertSystemMetric = z.infer<typeof insertSystemMetricSchema>;\n\nexport type AdminNote = typeof adminNotes.$inferSelect;\nexport type InsertAdminNote = z.infer<typeof insertAdminNoteSchema>;\n","size_bytes":40566},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport MaintenanceCheck from \"@/components/maintenance-check\";\n\n// Global theme management\nfunction useGlobalTheme() {\n  useEffect(() => {\n    // Apply saved theme on app load\n    const savedDarkTheme = localStorage.getItem('darkTheme');\n    const savedCompactView = localStorage.getItem('compactView');\n    \n    const root = document.documentElement;\n    \n    // Apply dark theme\n    if (savedDarkTheme === 'true' || savedDarkTheme === null) {\n      root.classList.add('dark');\n    } else {\n      root.classList.remove('dark');\n    }\n    \n    // Apply compact view\n    if (savedCompactView === 'true') {\n      root.classList.add('compact');\n    } else {\n      root.classList.remove('compact');\n    }\n  }, []);\n}\nimport Landing from \"@/pages/landing\";\nimport Login from \"@/pages/login\";\nimport Register from \"@/pages/register\";\nimport NotFound from \"@/pages/not-found\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Personnel from \"@/pages/personnel\";\nimport PersonnelDetail from \"@/pages/personnel-detail\";\nimport Timesheet from \"@/pages/timesheet\";\nimport Projects from \"@/pages/projects\";\nimport ProjectDetail from \"@/pages/project-detail.tsx\";\nimport Finances from \"@/pages/finances\";\nimport Customers from \"@/pages/customers\";\nimport CustomerDetail from \"@/pages/customer-detail\";\nimport CompanyDirectory from \"@/pages/company-directory\";\nimport EnhancedCompanyDirectory from \"@/pages/enhanced-company-directory-fixed\";\nimport Messages from \"@/pages/messages\";\nimport Reports from \"@/pages/reports\";\nimport AdminDashboard from \"@/pages/admin-dashboard\";\nimport BulkSMS from \"@/pages/bulk-sms\";\nimport AdminPanel from \"@/pages/admin/dashboard\";\nimport AdminUsers from \"@/pages/admin/users\";\nimport AdminSettings from \"@/pages/admin/settings\";\nimport AdminAnnouncements from \"@/pages/admin/announcements\";\nimport AdminLogs from \"@/pages/admin/logs\";\nimport AdminSessions from \"@/pages/admin/sessions\";\nimport AdminPaymentNotifications from \"@/pages/admin/payment-notifications\";\nimport AdminPaymentSettings from \"@/pages/admin/payment-settings\";\nimport Account from \"@/pages/account\";\nimport Logout from \"@/pages/logout\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const [location] = useLocation();\n  \n  // Apply global theme settings\n  useGlobalTheme();\n\n  // Debug removed - routing now stable\n\n  // Show loading while checking auth\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary flex items-center justify-center\">\n        <div className=\"text-white\">Giriş kontrol ediliyor...</div>\n      </div>\n    );\n  }\n\n  // Show authenticated routes if user is authenticated\n  const shouldShowAuthenticatedRoutes = isAuthenticated && user;\n\n  // Direct rendering for unauthenticated users\n  if (!shouldShowAuthenticatedRoutes) {\n    return (\n      <Switch>\n        <Route path=\"/login\" component={Login} />\n        <Route path=\"/register\" component={Register} />\n        <Route path=\"/api/auth/logout\" component={Logout} />\n        <Route component={Landing} />\n      </Switch>\n    );\n  }\n\n  return (\n    <>\n      <MaintenanceCheck />\n      <Switch>\n        <Route path=\"/\" component={Dashboard} />\n        <Route path=\"/personnel/:id\" component={PersonnelDetail} />\n      <Route path=\"/personnel\" component={Personnel} />\n      <Route path=\"/timesheet\" component={Timesheet} />\n      <Route path=\"/projects/:id\" component={ProjectDetail} />\n      <Route path=\"/projects\" component={Projects} />\n      <Route path=\"/finances\" component={Finances} />\n      <Route path=\"/customers/:customerName\" component={CustomerDetail} />\n      <Route path=\"/customers\" component={Customers} />\n      <Route path=\"/company-directory\" component={EnhancedCompanyDirectory} />\n      <Route path=\"/enhanced-company-directory\" component={EnhancedCompanyDirectory} />\n      <Route path=\"/messages\" component={Messages} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/bulk-sms\" component={BulkSMS} />\n      <Route path=\"/admin/dashboard\" component={AdminDashboard} />\n      <Route path=\"/admin\" component={AdminPanel} />\n      <Route path=\"/admin/users\" component={AdminUsers} />\n      <Route path=\"/admin/settings\" component={AdminSettings} />\n      <Route path=\"/admin/announcements\" component={AdminAnnouncements} />\n      <Route path=\"/admin/logs\" component={AdminLogs} />\n      <Route path=\"/admin/sessions\" component={AdminSessions} />\n      <Route path=\"/admin/payment-notifications\" component={AdminPaymentNotifications} />\n      <Route path=\"/admin/payment-settings\" component={AdminPaymentSettings} />\n      <Route path=\"/account\" component={Account} />\n      <Route path=\"/api/auth/logout\" component={Logout} />\n      <Route component={Dashboard} />\n      </Switch>\n    </>\n  );\n}\n\nfunction App() {\n  useEffect(() => {\n    // Set dark mode by default\n    document.documentElement.classList.add('dark');\n  }, []);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <div className=\"min-h-screen bg-dark-primary\">\n          <Toaster />\n          <Router />\n        </div>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":5530},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0 0% 100%);\n  --foreground: hsl(210 25% 7.8431%);\n  --card: hsl(0 0% 100%);\n  --card-foreground: hsl(210 25% 7.8431%);\n  --popover: hsl(0 0% 100%);\n  --popover-foreground: hsl(210 25% 7.8431%);\n  --primary: hsl(203.8863 88.2845% 53.1373%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(210 25% 7.8431%);\n  --secondary-foreground: hsl(0 0% 100%);\n  --muted: hsl(240 1.9608% 90%);\n  --muted-foreground: hsl(210 25% 7.8431%);\n  --accent: hsl(211.5789 51.3514% 92.7451%);\n  --accent-foreground: hsl(203.8863 88.2845% 53.1373%);\n  --destructive: hsl(356.3033 90.5579% 54.3137%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --border: hsl(201.4286 30.4348% 90.9804%);\n  --input: hsl(200 23.0769% 97.4510%);\n  --ring: hsl(202.8169 89.1213% 53.1373%);\n  \n  /* Dark theme colors */\n  --dark-primary: hsl(0 0% 10.2%);\n  --dark-secondary: hsl(0 0% 17.6%);\n  --dark-accent: hsl(0 0% 25.1%);\n  \n  /* Gradient colors */\n  --orange-start: hsl(16 100% 60%);\n  --orange-end: hsl(21 100% 65%);\n  --teal-start: hsl(168 76% 47%);\n  --teal-end: hsl(162 63% 41%);\n  --purple-start: hsl(258 90% 66%);\n  --purple-end: hsl(262 83% 58%);\n  --blue-start: hsl(217 91% 60%);\n  --blue-end: hsl(221 83% 53%);\n  \n  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n  --radius: 0.75rem;\n}\n\n.dark {\n  --background: hsl(0 0% 10.2%);\n  --foreground: hsl(0 0% 95%);\n  --card: hsl(0 0% 17.6%);\n  --card-foreground: hsl(0 0% 95%);\n  --popover: hsl(0 0% 17.6%);\n  --popover-foreground: hsl(0 0% 95%);\n  --primary: hsl(203.8863 88.2845% 53.1373%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(0 0% 25.1%);\n  --secondary-foreground: hsl(0 0% 95%);\n  --muted: hsl(0 0% 25.1%);\n  --muted-foreground: hsl(0 0% 60%);\n  --accent: hsl(0 0% 25.1%);\n  --accent-foreground: hsl(0 0% 95%);\n  --destructive: hsl(356.3033 90.5579% 54.3137%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --border: hsl(0 0% 25.1%);\n  --input: hsl(0 0% 25.1%);\n  --ring: hsl(202.8169 89.1213% 53.1373%);\n}\n\n/* Compact view styles */\n.compact {\n  font-size: 0.875rem;\n}\n\n.compact .card,\n.compact [class*=\"card\"] {\n  padding: 0.75rem !important;\n}\n\n.compact .btn, \n.compact button,\n.compact [class*=\"button\"] {\n  padding: 0.25rem 0.5rem !important;\n  font-size: 0.75rem !important;\n  height: auto !important;\n  min-height: 2rem !important;\n}\n\n.compact .space-y-4 > * + *,\n.compact [class*=\"space-y-4\"] > * + * {\n  margin-top: 0.5rem !important;\n}\n\n.compact .space-y-6 > * + *,\n.compact [class*=\"space-y-6\"] > * + * {\n  margin-top: 0.75rem !important;\n}\n\n.compact input, \n.compact select, \n.compact textarea,\n.compact [class*=\"input\"],\n.compact [class*=\"select\"],\n.compact [class*=\"textarea\"] {\n  padding: 0.375rem 0.5rem !important;\n  font-size: 0.75rem !important;\n  height: 2rem !important;\n}\n\n.compact h1 { font-size: 1.25rem !important; }\n.compact h2 { font-size: 1.125rem !important; }\n.compact h3 { font-size: 1rem !important; }\n.compact h4 { font-size: 0.875rem !important; }\n\n.compact .table tr,\n.compact tr {\n  height: 2rem !important;\n}\n\n.compact .p-4 { padding: 0.5rem !important; }\n.compact .p-6 { padding: 0.75rem !important; }\n.compact .py-2 { padding-top: 0.25rem !important; padding-bottom: 0.25rem !important; }\n.compact .px-4 { padding-left: 0.5rem !important; padding-right: 0.5rem !important; }\n\n.compact .text-xl { font-size: 1.125rem !important; }\n.compact .text-lg { font-size: 1rem !important; }\n.compact .text-base { font-size: 0.875rem !important; }\n.compact .text-sm { font-size: 0.75rem !important; }\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: var(--font-sans);\n  }\n}\n\n@layer utilities {\n  .gradient-orange {\n    background: linear-gradient(135deg, hsl(var(--orange-start)) 0%, hsl(var(--orange-end)) 100%);\n  }\n  \n  .gradient-teal {\n    background: linear-gradient(135deg, hsl(var(--teal-start)) 0%, hsl(var(--teal-end)) 100%);\n  }\n  \n  .gradient-purple {\n    background: linear-gradient(135deg, hsl(var(--purple-start)) 0%, hsl(var(--purple-end)) 100%);\n  }\n  \n  .gradient-blue {\n    background: linear-gradient(135deg, hsl(var(--blue-start)) 0%, hsl(var(--blue-end)) 100%);\n  }\n  \n  .glass-effect {\n    backdrop-filter: blur(10px);\n    background: rgba(45, 45, 45, 0.8);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  }\n}\n","size_bytes":4513},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    \n    // Handle 401 Unauthorized - session expired\n    if (res.status === 401) {\n      // Cookie will be cleared by server, just redirect\n      window.location.href = '/';\n    }\n    \n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  url: string,\n  method: string,\n  data?: unknown | undefined,\n): Promise<any> {\n  const headers: Record<string, string> = {};\n  \n  // Add sessionId from localStorage as Authorization header for dev environment\n  const sessionId = localStorage.getItem('sessionId');\n  if (sessionId) {\n    headers[\"Authorization\"] = `Bearer ${sessionId}`;\n  }\n  \n  if (data) {\n    headers[\"Content-Type\"] = \"application/json\";\n  }\n  \n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n\n\n  // Check for errors first\n  if (!res.ok) {\n\n    await throwIfResNotOk(res);\n    return;\n  }\n\n  // Handle successful responses\n\n  \n  // Handle 204 No Content\n  if (res.status === 204) {\n\n    return {};\n  }\n  \n  // Try to parse JSON for other success statuses\n  try {\n    const jsonResponse = await res.json();\n\n    return jsonResponse;\n  } catch (parseError) {\n\n    return {};\n  }\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const sessionId = localStorage.getItem('sessionId');\n    const headers: Record<string, string> = {};\n    \n\n    \n    if (sessionId) {\n      headers[\"Authorization\"] = `Bearer ${sessionId}`;\n\n    }\n    \n    const res = await fetch(queryKey.join(\"\") as string, {\n      method: \"GET\",\n      headers,\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: 1000 * 60 * 30, // 30 min\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2444},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/customers.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Home, Plus, User, Edit, Trash2, Building2, Phone, Mail, DollarSign, TrendingUp, TrendingDown } from \"lucide-react\";\nimport { type Customer, type CustomerTask, type CustomerPayment } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport Header from \"@/components/layout/header\";\nimport AdvancedFilters, { type FilterOptions } from \"@/components/filters/advanced-filters\";\nimport CustomerForm from \"@/components/forms/customer-form-new\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\nexport default function CustomersPage() {\n  const [, setLocation] = useLocation();\n  const [showCustomerForm, setShowCustomerForm] = useState(false);\n  const [editingCustomer, setEditingCustomer] = useState<Customer | null>(null);\n  const [filters, setFilters] = useState<FilterOptions>({\n    search: \"\",\n    dateFrom: \"\",\n    dateTo: \"\",\n    status: \"\",\n    type: \"\",\n    personnel: \"\",\n  });\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: customers = [], isLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: allCustomerTasks = [] } = useQuery<CustomerTask[]>({\n    queryKey: [\"/api/customer-tasks\"],\n  });\n\n  const { data: allCustomerPayments = [] } = useQuery<CustomerPayment[]>({\n    queryKey: [\"/api/customer-payments\"],\n  });\n\n  const deleteCustomerMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(`/api/customers/${id}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Müşteri kaydı silindi.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Müşteri kaydı silinemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEditCustomer = (customer: Customer) => {\n    setEditingCustomer(customer);\n    setShowCustomerForm(true);\n  };\n\n  const handleFilterChange = (newFilters: FilterOptions) => {\n    setFilters(newFilters);\n  };\n\n  const handleExport = (format: 'csv' | 'pdf') => {\n    toast({\n      title: \"Dışa Aktarma\",\n      description: `${format.toUpperCase()} formatında dışa aktarılıyor...`,\n    });\n  };\n\n  // Filter customers based on search and filters\n  const filteredCustomers = customers.filter(customer => {\n    const matchesSearch = !filters.search || \n      customer.name.toLowerCase().includes(filters.search.toLowerCase()) ||\n      customer.company?.toLowerCase().includes(filters.search.toLowerCase()) ||\n      customer.email?.toLowerCase().includes(filters.search.toLowerCase());\n    \n    const matchesStatus = !filters.status || filters.status === \"all\" || customer.status === filters.status;\n    \n    return matchesSearch && matchesStatus;\n  });\n\n  // Helper functions\n  const getCustomerTasks = (customerId: string) => {\n    return allCustomerTasks.filter(task => task.customerId === customerId);\n  };\n\n  const getCustomerPayments = (customerId: string) => {\n    return allCustomerPayments.filter(payment => payment.customerId === customerId);\n  };\n\n  const formatCurrency = (amount: string | number) => {\n    return new Intl.NumberFormat('tr-TR', {\n      style: 'currency',\n      currency: 'TRY',\n      minimumFractionDigits: 0,\n    }).format(typeof amount === 'string' ? parseFloat(amount) : amount);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-6\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/\")}\n            className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n          >\n            <Home className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-3xl font-bold\">Müşteriler</h1>\n        </div>\n\n        <div className=\"mb-6 mt-6\">\n          <Button\n            className=\"bg-blue-500 hover:bg-blue-600 text-white\"\n            onClick={() => setShowCustomerForm(true)}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Yeni Müşteri\n          </Button>\n        </div>\n\n        <AdvancedFilters\n          onFilterChange={handleFilterChange}\n          onExport={handleExport}\n          exportData={filteredCustomers.map(customer => ({\n            name: customer.name,\n            company: customer.company || '-',\n            phone: customer.phone || '-',\n            email: customer.email || '-',\n            status: customer.status || 'aktif',\n            date: customer.createdAt ? new Date(customer.createdAt).toLocaleDateString('tr-TR') : '-'\n          }))}\n          exportTitle=\"Müşteriler\"\n        />\n\n        {isLoading ? (\n          <div className=\"text-center py-8\">\n            <p className=\"text-gray-400\">Müşteriler yükleniyor...</p>\n          </div>\n        ) : filteredCustomers.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <p className=\"text-gray-400\">Henüz müşteri kaydı bulunmuyor.</p>\n          </div>\n        ) : (\n          <div className=\"grid gap-6\">\n            {filteredCustomers.map((customer) => {\n              const customerTasks = getCustomerTasks(customer.id);\n              const customerPayments = getCustomerPayments(customer.id);\n              \n              const totalTaskAmount = customerTasks.reduce((sum, task) => sum + parseFloat(task.amount), 0);\n              const totalPaidAmount = customerPayments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0);\n              const remainingAmount = totalTaskAmount - totalPaidAmount;\n\n              return (\n                <Card key={customer.id} className=\"bg-dark-secondary border-dark-accent\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex justify-between items-start\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                          <User className=\"h-5 w-5 text-blue-400\" />\n                          <button\n                            className=\"text-white font-medium text-lg hover:text-blue-400 underline cursor-pointer\"\n                            onClick={() => setLocation(`/customers/${encodeURIComponent(customer.name)}`)}\n                          >\n                            {customer.name}\n                          </button>\n                          <span className={`text-sm px-2 py-1 rounded ${\n                            customer.status === \"active\" ? \"text-green-400 bg-green-400/10\" : \"text-gray-400 bg-gray-400/10\"\n                          }`}>\n                            {customer.status === \"active\" ? \"Aktif\" : \"Pasif\"}\n                          </span>\n                        </div>\n                      \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\">\n                          {customer.company && (\n                            <div className=\"flex items-center gap-2\">\n                              <Building2 className=\"h-4 w-4 text-gray-400\" />\n                              <div>\n                                <p className=\"text-gray-400\">Şirket</p>\n                                <p className=\"text-white\">{customer.company}</p>\n                              </div>\n                            </div>\n                          )}\n                          \n                          {customer.phone && (\n                            <div className=\"flex items-center gap-2\">\n                              <Phone className=\"h-4 w-4 text-gray-400\" />\n                              <div>\n                                <p className=\"text-gray-400\">Telefon</p>\n                                <p className=\"text-white\">{customer.phone}</p>\n                              </div>\n                            </div>\n                          )}\n                          \n                          {customer.email && (\n                            <div className=\"flex items-center gap-2\">\n                              <Mail className=\"h-4 w-4 text-gray-400\" />\n                              <div>\n                                <p className=\"text-gray-400\">E-posta</p>\n                                <p className=\"text-white\">{customer.email}</p>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n\n                        {customer.address && (\n                          <div className=\"mt-3\">\n                            <p className=\"text-gray-400 text-sm\">Adres</p>\n                            <p className=\"text-gray-300 text-sm\">{customer.address}</p>\n                          </div>\n                        )}\n\n                        {customer.taxNumber && (\n                          <div className=\"mt-2\">\n                            <p className=\"text-gray-400 text-sm\">Vergi No</p>\n                            <p className=\"text-gray-300 text-sm\">{customer.taxNumber}</p>\n                          </div>\n                        )}\n\n                        {/* Financial Summary */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 p-3 bg-dark-primary rounded-lg\">\n                          <div className=\"text-center\">\n                            <div className=\"flex items-center justify-center gap-2 mb-1\">\n                              <TrendingUp className=\"h-4 w-4 text-blue-400\" />\n                              <p className=\"text-gray-400 text-sm\">Toplam İş</p>\n                            </div>\n                            <p className=\"text-blue-400 font-semibold\">{formatCurrency(totalTaskAmount)}</p>\n                            <p className=\"text-gray-500 text-xs\">{customerTasks.length} adet</p>\n                          </div>\n                          \n                          <div className=\"text-center\">\n                            <div className=\"flex items-center justify-center gap-2 mb-1\">\n                              <TrendingDown className=\"h-4 w-4 text-green-400\" />\n                              <p className=\"text-gray-400 text-sm\">Ödenen</p>\n                            </div>\n                            <p className=\"text-green-400 font-semibold\">{formatCurrency(totalPaidAmount)}</p>\n                            <p className=\"text-gray-500 text-xs\">{customerPayments.length} ödeme</p>\n                          </div>\n                          \n                          <div className=\"text-center\">\n                            <div className=\"flex items-center justify-center gap-2 mb-1\">\n                              <DollarSign className=\"h-4 w-4 text-orange-400\" />\n                              <p className=\"text-gray-400 text-sm\">Kalan</p>\n                            </div>\n                            <p className={`font-semibold ${remainingAmount > 0 ? 'text-orange-400' : 'text-gray-400'}`}>\n                              {formatCurrency(remainingAmount)}\n                            </p>\n                            <p className=\"text-gray-500 text-xs\">\n                              {remainingAmount > 0 ? 'Alacak' : 'Tamam'}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"flex gap-2 ml-4\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"text-blue-400 hover:text-blue-300 hover:bg-dark-accent\"\n                          onClick={() => handleEditCustomer(customer)}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"text-red-400 hover:text-red-300 hover:bg-dark-accent\"\n                          onClick={() => deleteCustomerMutation.mutate(customer.id)}\n                          disabled={deleteCustomerMutation.isPending}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Customer Form Dialog - NEW */}\n      <CustomerForm \n        open={showCustomerForm} \n        onOpenChange={(open) => {\n          setShowCustomerForm(open);\n          if (!open) setEditingCustomer(null);\n        }}\n        customer={editingCustomer || undefined}\n      />\n    </div>\n  );\n}","size_bytes":13019},"client/src/pages/dashboard.tsx":{"content":"import { useState, useCallback, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\nimport { \n  Edit, \n  Users, \n  Building, \n  Building2,\n  Home, \n  Wallet, \n  CalendarDays, \n  UserCog,\n  Plus,\n  Info,\n  BarChart3,\n  Briefcase,\n  Calculator,\n  LogOut,\n  Shield,\n  Bell,\n  X,\n  MessageCircle,\n  MessageSquare,\n  UserCircle\n} from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Header from \"@/components/layout/header\";\nimport ProjectCard from \"@/components/cards/project-card\";\nimport NavigationCard from \"@/components/cards/navigation-card\";\nimport DraggableNavigationCard from \"@/components/cards/draggable-navigation-card\";\nimport TimesheetForm from \"@/components/forms/timesheet-form\";\nimport DashboardCharts from \"@/components/analytics/dashboard-charts\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Notification } from \"@shared/schema\";\n\ninterface FinancialSummary {\n  totalIncome: number;\n  totalExpenses: number;\n  netBalance: number;\n  customerTasks: {\n    total: number;\n    pending: number;\n    completed: number;\n  };\n  customerPayments: {\n    total: number;\n    thisMonth: number;\n    count: number;\n  };\n}\n\ninterface CardItem {\n  id: string;\n  type: 'financial' | 'navigation';\n  component: JSX.Element;\n}\n\nexport default function Dashboard() {\n  const [location, setLocation] = useLocation();\n  const [showTimesheetForm, setShowTimesheetForm] = useState(false);\n  const [showNotifications, setShowNotifications] = useState(false);\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  // Navigation cards with fixed routing\n  const getBaseNavCards = useCallback(() => [\n    { id: \"timesheet\", icon: Edit, label: \"Puantaj Yaz\", onClick: () => setShowTimesheetForm(true), iconColor: \"text-blue-400\" },\n    { id: \"personnel\", icon: Users, label: \"Personeller\", onClick: () => setLocation(\"/personnel\"), iconColor: \"text-orange-400\" },\n    { id: \"projects\", icon: Home, label: \"Verilen Projeler\", onClick: () => setLocation(\"/projects\"), iconColor: \"text-pink-400\" },\n    { id: \"finances\", icon: Wallet, label: \"Kasa\", onClick: () => setLocation(\"/finances\"), iconColor: \"text-teal-400\" },\n    { id: \"customers\", icon: UserCog, label: \"Müşteriler\", onClick: () => setLocation(\"/customers\"), iconColor: \"text-orange-400\" },\n    { id: \"messages\", icon: MessageCircle, label: \"Mesajlar\", onClick: () => setLocation(\"/messages\"), iconColor: \"text-purple-400\" },\n    { id: \"company-directory\", icon: MessageCircle, label: \"PRO Firma Rehberi\", onClick: () => setLocation(\"/enhanced-company-directory\"), iconColor: \"text-purple-400\" },\n    { id: \"bulk-sms\", icon: MessageSquare, label: \"Toplu SMS\", onClick: () => setLocation(\"/bulk-sms\"), iconColor: \"text-green-400\" },\n    { id: \"reports\", icon: Info, label: \"Raporlar\", onClick: () => setLocation(\"/reports\"), iconColor: \"text-pink-400\" }\n  ], [setLocation]);\n\n  // Navigation cards state for drag and drop  \n  const [navCards, setNavCards] = useState(() => {\n    const baseNavCards = getBaseNavCards();\n    const adminCards = (user && 'isAdmin' in user && user.isAdmin) ? [\n      { id: \"admin\", icon: Shield, label: \"Admin Panel\", onClick: () => setLocation(\"/admin\"), iconColor: \"text-red-400\" }\n    ] : [];\n\n    return [...baseNavCards, ...adminCards];\n  });\n\n  // Update navigation cards when user admin status changes\n  useEffect(() => {\n    const baseNavCards = getBaseNavCards();\n    \n    if (user && 'isAdmin' in user && user.isAdmin) {\n      const adminCard = { id: \"admin\", icon: Shield, label: \"Admin Panel\", onClick: () => setLocation(\"/admin\"), iconColor: \"text-red-400\" };\n      setNavCards([...baseNavCards, adminCard]);\n    } else {\n      setNavCards(baseNavCards);\n    }\n  }, [user && 'isAdmin' in user ? user.isAdmin : false, getBaseNavCards]);\n\n  const { data: summary } = useQuery<FinancialSummary>({\n    queryKey: [\"/api/financial-summary\"],\n    staleTime: 1000 * 60 * 60, // 1 hour cache\n    refetchOnWindowFocus: false,\n    refetchOnMount: false,\n  });\n\n  // Notifications query - disabled for speed\n  const notifications = [];\n\n  // Mark notification as read mutation\n  const markNotificationAsReadMutation = useMutation({\n    mutationFn: (notificationId: string) =>\n      apiRequest(`/api/notifications/${notificationId}/read`, \"PATCH\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    },\n    onError: () => {\n      console.error(\"Failed to mark notification as read\");\n    },\n  });\n\n  const moveCard = useCallback((dragIndex: number, hoverIndex: number) => {\n    setNavCards((prevCards) => {\n      const newCards = [...prevCards];\n      const draggedCard = newCards[dragIndex];\n      newCards.splice(dragIndex, 1);\n      newCards.splice(hoverIndex, 0, draggedCard);\n      return newCards;\n    });\n  }, []);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('tr-TR', {\n      style: 'currency',\n      currency: 'TRY',\n      minimumFractionDigits: 2,\n    }).format(amount);\n  };\n\n  // Don't render if not on exact root path\n  if (location !== \"/\") {\n    return null;\n  }\n\n  return (\n    <DndProvider backend={HTML5Backend}>\n      <div className=\"min-h-screen bg-gray-50 dark:bg-dark-primary text-gray-800 dark:text-white\">\n        <Header />\n        <header className=\"flex justify-between items-center p-4 bg-white dark:bg-dark-primary border-b border-gray-200 dark:border-dark-accent\" style={{ display: 'none' }}>\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"text-xl font-bold text-gray-800 dark:text-white\">puantropls</h1>\n          </div>\n          \n          <div className=\"flex items-center gap-4\">\n            {/* Notifications - Always visible */}\n            <div className=\"relative\">\n              <Button \n                variant=\"ghost\" \n                size=\"icon\"\n                className=\"text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-dark-accent relative\"\n                onClick={() => setShowNotifications(!showNotifications)}\n              >\n                <Bell className=\"h-5 w-5\" />\n                {notifications.filter(n => !n.isRead).length > 0 && (\n                  <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center\">\n                    {notifications.filter(n => !n.isRead).length}\n                  </span>\n                )}\n              </Button>\n                \n                {showNotifications && (\n                  <div className=\"absolute top-full right-0 mt-2 w-80 bg-white dark:bg-dark-secondary border border-gray-200 dark:border-dark-accent rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto\">\n                    <div className=\"p-4 border-b border-gray-200 dark:border-dark-accent\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-gray-800 dark:text-white font-semibold\">Bildirimler</h3>\n                        <div className=\"flex items-center gap-2\">\n                          {notifications.filter(n => !n.isRead).length > 0 && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => {\n                                notifications.filter(n => !n.isRead).forEach(n => {\n                                  markNotificationAsReadMutation.mutate(n.id);\n                                });\n                              }}\n                              className=\"text-xs text-blue-400 hover:text-blue-300\"\n                            >\n                              Tümünü okundu işaretle\n                            </Button>\n                          )}\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => setShowNotifications(false)}\n                            className=\"h-6 w-6 p-0 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white\"\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"max-h-64 overflow-y-auto\">\n                      {notifications.length === 0 ? (\n                        <div className=\"p-4 text-center text-gray-500 dark:text-gray-400\">\n                          Henüz bildirim yok\n                        </div>\n                      ) : (\n                        notifications.map((notification) => (\n                          <div \n                            key={notification.id} \n                            className={`p-4 border-b border-gray-200/50 dark:border-dark-accent/50 hover:bg-gray-100/50 dark:hover:bg-dark-primary/50 cursor-pointer ${\n                              !notification.isRead ? 'bg-blue-600/10' : ''\n                            }`}\n                            onClick={() => {\n                              console.log(\"🔥 DASHBOARD NOTIFICATION CLICKED!\", notification);\n                              console.log(\"🔥 Type:\", notification.type);\n                              console.log(\"🔥 Payload:\", notification.payload);\n                              \n                              if (!notification.isRead) {\n                                markNotificationAsReadMutation.mutate(notification.id);\n                              }\n                              \n                              // Mesaj bildirimi ise company directory'ye yönlendir\n                              if ((notification.type === 'NEW_MESSAGE' || notification.type === 'NEW_DM') && notification.payload) {\n                                const payload = notification.payload as any;\n                                console.log(\"🔥 Found message notification, fromCompanyId:\", payload?.fromCompanyId);\n                                \n                                if (payload?.fromCompanyId) {\n                                  // Company directory'ye yönlendir ve aktif thread'i set et\n                                  setLocation(`/company-directory?activeThread=${payload.fromCompanyId}`);\n                                  setShowNotifications(false);\n                                  \n                                  toast({\n                                    title: \"Mesaja Yönlendiriliyor\",\n                                    description: `${payload.fromCompanyName || 'Firma'} firmasından gelen mesaj`,\n                                  });\n                                } else {\n                                  console.log(\"🔥 No fromCompanyId in payload, redirecting to company directory\");\n                                  setLocation(\"/company-directory\");\n                                  setShowNotifications(false);\n                                }\n                              } else {\n                                console.log(\"🔥 Not a message notification, type:\", notification.type);\n                              }\n                            }}\n                          >\n                            <div className=\"flex items-start gap-3\">\n                              <div className=\"flex-shrink-0\">\n                                {(notification.type === 'NEW_MESSAGE' || notification.type === 'NEW_DM') ? (\n                                  <MessageCircle className=\"h-5 w-5 text-blue-400\" />\n                                ) : (\n                                  <Bell className=\"h-5 w-5 text-blue-400\" />\n                                )}\n                              </div>\n                              <div className=\"flex-1 min-w-0\">\n                                {(notification.type === 'NEW_MESSAGE' || notification.type === 'NEW_DM') && notification.payload ? (\n                                  <>\n                                    <div className=\"text-white font-medium\">\n                                      {(notification.payload as any).fromCompanyName || 'Yeni Mesaj'}\n                                    </div>\n                                    <div className=\"text-gray-300 text-sm mt-1 truncate\">\n                                      {(notification.payload as any).message || 'Mesaj içeriği'}\n                                    </div>\n                                    <div className=\"text-xs text-gray-500 mt-1\">\n                                      {notification.createdAt ? new Date(notification.createdAt).toLocaleString('tr-TR') : ''}\n                                    </div>\n                                  </>\n                                ) : (\n                                  <>\n                                    <div className=\"text-white font-medium\">\n                                      {(notification.payload as any)?.title || 'Bildirim'}\n                                    </div>\n                                    <div className=\"text-gray-300 text-sm mt-1 truncate\">\n                                      {(notification.payload as any)?.content || 'Bildirim içeriği'}\n                                    </div>\n                                    <div className=\"text-xs text-gray-500 mt-1\">\n                                      {notification.createdAt ? new Date(notification.createdAt).toLocaleString('tr-TR') : ''}\n                                    </div>\n                                  </>\n                                )}\n                                {!notification.isRead && (\n                                  <div className=\"w-2 h-2 bg-blue-500 rounded-full mt-1\"></div>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n            {/* User info */}\n            {user && (\n              <div className=\"flex items-center gap-2 text-white text-sm\">\n                <span>{String((user as any).firstName || (user as any).email || \"Kullanıcı\")}</span>\n              </div>\n            )}\n\n            {/* Account Button */}\n            {user && (\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"text-blue-400 hover:bg-dark-accent\"\n                onClick={() => setLocation(\"/account\")}\n                title=\"Hesabım\"\n              >\n                <UserCircle className=\"h-5 w-5\" />\n              </Button>\n            )}\n\n            {/* Logout button */}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-dark-accent\"\n              onClick={() => {\n                localStorage.removeItem('sessionId');\n                queryClient.clear();\n                toast({\n                  title: \"Başarıyla çıkış yapıldı\",\n                  description: \"Güle güle!\",\n                });\n                setTimeout(() => {\n                  window.location.href = \"/\";\n                }, 500);\n              }}\n            >\n              <LogOut className=\"h-4 w-4 mr-2\" />\n              Çıkış\n            </Button>\n          </div>\n        </header>\n      \n\n\n      <main className=\"p-4\">\n        {/* Customer Financial Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n          <ProjectCard\n            title=\"Alınan İşler\"\n            total={formatCurrency(summary?.customerTasks.total || 0)}\n            activeLabel=\"\"\n            activeValue=\"\"\n            passiveLabel=\"\"\n            passiveValue=\"\"\n            type=\"blue\"\n            icon=\"briefcase\"\n          />\n\n          <ProjectCard\n            title=\"Alınan Ödemeler\"\n            total={formatCurrency(summary?.customerPayments.total || 0)}\n            activeLabel=\"\"\n            activeValue=\"\"\n            passiveLabel=\"\"\n            passiveValue=\"\"\n            type=\"green\"\n            icon=\"wallet\"\n          />\n\n          <ProjectCard\n            title=\"Kalan Bakiye\"\n            total={formatCurrency((summary?.customerTasks.total || 0) - (summary?.customerPayments.total || 0))}\n            activeLabel=\"\"\n            activeValue=\"\"\n            passiveLabel=\"\"\n            passiveValue=\"\"\n            type=\"purple\"\n            icon=\"calculator\"\n          />\n        </div>\n\n        {/* Navigation Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6\">\n          {navCards.map((card, index) => (\n            <DraggableNavigationCard\n              key={card.id}\n              id={card.id}\n              index={index}\n              icon={card.icon}\n              label={card.label}\n              onClick={card.onClick}\n              iconColor={card.iconColor}\n              moveCard={moveCard}\n            />\n          ))}\n        </div>\n\n        {/* Analytics Section */}\n        <Card className=\"bg-white dark:bg-dark-secondary border-gray-200 dark:border-dark-accent\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"text-gray-800 dark:text-white flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5 text-blue-400\" />\n              Veri Analizi ve Raporlar\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <DashboardCharts />\n          </CardContent>\n        </Card>\n\n        {/* Notes Section */}\n        <div className=\"bg-white dark:bg-dark-secondary rounded-xl p-4 border border-gray-200 dark:border-dark-accent\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className=\"text-lg font-semibold text-gray-800 dark:text-white\">Notlar</h3>\n            <Button\n              size=\"icon\"\n              className=\"bg-blue-500 hover:bg-blue-600 text-white w-8 h-8 rounded-full\"\n              onClick={() => console.log(\"Add note\")}\n            >\n              <Plus className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <div className=\"text-center text-gray-500 dark:text-gray-400 py-8\">\n            <p>Henüz not eklenmemiş.</p>\n            <p className=\"text-sm\">Yeni not eklemek için + butonuna tıklayın.</p>\n          </div>\n        </div>\n      </main>\n\n      <TimesheetForm \n        open={showTimesheetForm} \n        onOpenChange={setShowTimesheetForm} \n      />\n      </div>\n    </DndProvider>\n  );\n}\n","size_bytes":18901},"client/src/pages/finances.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Home, Plus, Wallet, TrendingUp, TrendingDown, Trash2 } from \"lucide-react\";\nimport { type Transaction } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport Header from \"@/components/layout/header\";\nimport TransactionForm from \"@/components/forms/transaction-form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\ninterface FinancialSummary {\n  totalIncome: number;\n  totalExpenses: number;\n  netBalance: number;\n  customerTasks: {\n    total: number;\n    pending: number;\n    completed: number;\n  };\n  customerPayments: {\n    total: number;\n    thisMonth: number;\n    count: number;\n  };\n}\n\nexport default function FinancesPage() {\n  const [, setLocation] = useLocation();\n  const [showTransactionForm, setShowTransactionForm] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: transactions = [], isLoading: transactionsLoading } = useQuery<Transaction[]>({\n    queryKey: [\"/api/transactions\"],\n  });\n\n  const { data: summary } = useQuery<FinancialSummary>({\n    queryKey: [\"/api/financial-summary\"],\n  });\n\n  const deleteTransactionMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(`/api/transactions/${id}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"İşlem kaydı silindi.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"İşlem kaydı silinemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatDate = (date: Date | string) => {\n    const d = new Date(date);\n    return d.toLocaleDateString('tr-TR');\n  };\n\n  const formatCurrency = (amount: number | string) => {\n    const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat('tr-TR', {\n      style: 'currency',\n      currency: 'TRY',\n      minimumFractionDigits: 2,\n    }).format(numAmount);\n  };\n\n  const getTypeIcon = (type: string) => {\n    return type === 'income' ? TrendingUp : TrendingDown;\n  };\n\n  const getTypeColor = (type: string) => {\n    return type === 'income' ? 'text-green-400' : 'text-red-400';\n  };\n\n  const getTypeText = (type: string) => {\n    return type === 'income' ? 'Gelir' : 'Gider';\n  };\n\n  if (transactionsLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary text-white\">\n        <Header />\n        <div className=\"p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <p className=\"text-gray-400\">Yükleniyor...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-white hover:bg-dark-accent\"\n            onClick={() => setLocation(\"/\")}\n          >\n            <Home className=\"h-6 w-6\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Kasa Yönetimi</h1>\n        </div>\n\n\n\n        {/* Financial Summary */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n          <Card className=\"bg-green-500/20 border-green-500/30\">\n            <CardContent className=\"p-4 text-center\">\n              <TrendingUp className=\"h-8 w-8 text-green-400 mx-auto mb-2\" />\n              <div className=\"text-green-400 text-2xl font-bold\">\n                {formatCurrency(summary?.totalIncome || 0)}\n              </div>\n              <div className=\"text-green-300 text-sm\">Toplam Gelir</div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-red-500/20 border-red-500/30\">\n            <CardContent className=\"p-4 text-center\">\n              <TrendingDown className=\"h-8 w-8 text-red-400 mx-auto mb-2\" />\n              <div className=\"text-red-400 text-2xl font-bold\">\n                {formatCurrency(summary?.totalExpenses || 0)}\n              </div>\n              <div className=\"text-red-300 text-sm\">Toplam Gider</div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-blue-500/20 border-blue-500/30\">\n            <CardContent className=\"p-4 text-center\">\n              <Wallet className=\"h-8 w-8 text-blue-400 mx-auto mb-2\" />\n              <div className=\"text-blue-400 text-2xl font-bold\">\n                {formatCurrency(summary?.netBalance || 0)}\n              </div>\n              <div className=\"text-blue-300 text-sm\">Net Bakiye</div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"mb-6\">\n          <Button\n            className=\"bg-blue-500 hover:bg-blue-600 text-white\"\n            onClick={() => setShowTransactionForm(true)}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Yeni İşlem\n          </Button>\n        </div>\n\n        {transactions.length === 0 ? (\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"py-12 text-center\">\n              <Wallet className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-400 text-lg mb-2\">Henüz işlem kaydı eklenmemiş</p>\n              <p className=\"text-gray-500 text-sm\">Yeni işlem eklemek için yukarıdaki butonu kullanın.</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-3\">\n            {transactions.map((transaction) => {\n              const IconComponent = getTypeIcon(transaction.type);\n              return (\n                <Card key={transaction.id} className=\"bg-dark-secondary border-dark-accent\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex justify-between items-start\">\n                      <div className=\"flex items-center gap-3 flex-1\">\n                        <IconComponent className={`h-6 w-6 ${getTypeColor(transaction.type)}`} />\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-3 mb-1\">\n                            <h4 className=\"text-white font-medium text-lg\">{transaction.description}</h4>\n                            <span className={`text-lg font-bold ${getTypeColor(transaction.type)}`}>\n                              {formatCurrency(transaction.amount)}\n                            </span>\n                          </div>\n                          \n                          <div className=\"flex items-center gap-4 text-sm text-gray-400\">\n                            <span>{getTypeText(transaction.type)}</span>\n                            <span>•</span>\n                            <span>{formatDate(transaction.date)}</span>\n                            {transaction.category && (\n                              <>\n                                <span>•</span>\n                                <span>{transaction.category}</span>\n                              </>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-red-400 hover:text-red-300 hover:bg-dark-accent\"\n                        onClick={() => deleteTransactionMutation.mutate(transaction.id)}\n                        disabled={deleteTransactionMutation.isPending}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      <TransactionForm \n        open={showTransactionForm} \n        onOpenChange={setShowTransactionForm} \n      />\n    </div>\n  );\n}\n","size_bytes":8273},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/personnel.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Home, Plus, User, Edit, Trash2, ChevronRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport PersonnelForm from \"@/components/forms/personnel-form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Personnel } from \"@shared/schema\";\n\nexport default function PersonnelPage() {\n  const [, setLocation] = useLocation();\n  const [showPersonnelForm, setShowPersonnelForm] = useState(false);\n  const [selectedPersonnel, setSelectedPersonnel] = useState<Personnel | undefined>();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Personnel query\n  const { data: personnel = [], isLoading } = useQuery<Personnel[]>({\n    queryKey: ['/api/personnel'],\n  });\n\n  // Delete mutation\n  const deletePersonnelMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await fetch(`/api/personnel/${id}`, { \n        method: 'DELETE' \n      });\n      if (!response.ok) throw new Error('Silme işlemi başarısız');\n      // 204 response has no content, don't try to parse JSON\n      return response.status === 204 ? null : response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/personnel'] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Personel başarıyla silindi.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Personel silinirken bir hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n            onClick={() => setLocation(\"/\")}\n          >\n            <Home className=\"h-6 w-6\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Personel Yönetimi</h1>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"bg-dark-secondary border-dark-accent animate-pulse\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 bg-gray-600 rounded-full\"></div>\n                  <div className=\"flex-1\">\n                    <div className=\"h-4 bg-gray-600 rounded w-3/4 mb-2\"></div>\n                    <div className=\"h-3 bg-gray-700 rounded w-1/2\"></div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n          onClick={() => setLocation(\"/\")}\n        >\n          <Home className=\"h-6 w-6\" />\n        </Button>\n        <h1 className=\"text-2xl font-bold\">Personel Yönetimi</h1>\n      </div>\n\n      {/* Add Personnel Button */}\n      <div className=\"mb-6\">\n        <Button\n          className=\"bg-green-500 hover:bg-green-600 text-white\"\n          onClick={() => {\n            setSelectedPersonnel(undefined);\n            setShowPersonnelForm(true);\n          }}\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Yeni Personel\n        </Button>\n      </div>\n\n      {/* Personnel Cards */}\n      {personnel.length === 0 ? (\n        <Card className=\"bg-dark-secondary border-dark-accent\">\n          <CardContent className=\"py-12 text-center\">\n            <User className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <p className=\"text-gray-400 text-lg mb-2\">Henüz personel eklenmemiş</p>\n            <p className=\"text-gray-500 text-sm\">Yeni personel eklemek için yukarıdaki butonu kullanın.</p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {personnel.map((person) => (\n            <Card \n              key={person.id} \n              className=\"bg-dark-secondary border-dark-accent hover:border-blue-500/50 transition-colors cursor-pointer group\"\n              onClick={() => setLocation(`/personnel/${person.id}`)}\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  {/* Avatar */}\n                  <div className=\"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0\">\n                    <User className=\"h-6 w-6 text-white\" />\n                  </div>\n                  \n                  {/* Personnel Info */}\n                  <div className=\"flex-1 min-w-0\">\n                    <h4 className=\"text-white font-medium text-lg truncate\">{person.name}</h4>\n                    <p className=\"text-gray-400 text-sm truncate\">{person.position}</p>\n                    <p className=\"text-green-400 text-sm\">₺{(person.salary || 0).toLocaleString('tr-TR')}/ay</p>\n                  </div>\n                  \n                  {/* Actions */}\n                  <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"h-8 w-8 text-blue-400 hover:text-blue-300 hover:bg-dark-accent\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setSelectedPersonnel(person);\n                        setShowPersonnelForm(true);\n                      }}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-dark-accent\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (confirm(`${person.name} adlı personeli silmek istediğinizden emin misiniz?`)) {\n                          deletePersonnelMutation.mutate(person.id);\n                        }\n                      }}\n                      disabled={deletePersonnelMutation.isPending}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                    <ChevronRight className=\"h-4 w-4 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* Forms */}\n      <PersonnelForm \n        open={showPersonnelForm} \n        onOpenChange={(open) => {\n          setShowPersonnelForm(open);\n          if (!open) {\n            setSelectedPersonnel(undefined);\n          }\n        }}\n        personnel={selectedPersonnel}\n      />\n    </div>\n  );\n}","size_bytes":7326},"client/src/pages/projects.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Home, Plus, Building, Trash2, Edit } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertProjectSchema, type InsertProject, type Project, type Customer } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport Header from \"@/components/layout/header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\n\nexport default function ProjectsPage() {\n  const [, setLocation] = useLocation();\n  const [showProjectForm, setShowProjectForm] = useState(false);\n  const [editingProject, setEditingProject] = useState<Project | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: projects = [], isLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const form = useForm<InsertProject>({\n    resolver: zodResolver(insertProjectSchema),\n    defaultValues: {\n      name: \"\",\n      type: \"received\",\n      amount: \"0\",\n      status: \"active\",\n      description: \"\",\n      clientName: \"\",\n      startDate: new Date(),\n      endDate: undefined,\n    },\n  });\n\n  const createProjectMutation = useMutation({\n    mutationFn: async (data: InsertProject) => {\n      return await apiRequest(\"/api/projects\", \"POST\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Proje kaydı oluşturuldu.\",\n      });\n      form.reset();\n      setShowProjectForm(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Proje kaydı oluşturulamadı.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateProjectMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<InsertProject> }) => {\n      return await apiRequest(`/api/projects/${id}`, \"PUT\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Proje kaydı güncellendi.\",\n      });\n      form.reset();\n      setShowProjectForm(false);\n      setEditingProject(null);\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Proje kaydı güncellenemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteProjectMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(`/api/projects/${id}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Proje kaydı silindi.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Proje kaydı silinemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatDate = (date: Date | string) => {\n    const d = new Date(date);\n    return d.toLocaleDateString('tr-TR');\n  };\n\n  const formatCurrency = (amount: string) => {\n    return new Intl.NumberFormat('tr-TR', {\n      style: 'currency',\n      currency: 'TRY',\n      minimumFractionDigits: 2,\n    }).format(parseFloat(amount));\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"active\": return \"text-green-400\";\n      case \"passive\": return \"text-yellow-400\";\n      case \"completed\": return \"text-blue-400\";\n      default: return \"text-gray-400\";\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case \"active\": return \"Aktif\";\n      case \"passive\": return \"Pasif\";\n      case \"completed\": return \"Tamamlandı\";\n      default: return status;\n    }\n  };\n\n  const getTypeText = (type: string) => {\n    return type === \"given\" ? \"Verilen\" : \"Alınan\";\n  };\n\n  const handleEditProject = (project: Project) => {\n    setEditingProject(project);\n    form.reset({\n      name: project.name,\n      type: project.type,\n      amount: project.amount,\n      status: project.status,\n      description: project.description || \"\",\n      clientName: project.clientName || \"\",\n      startDate: new Date(project.startDate),\n      endDate: project.endDate ? new Date(project.endDate) : undefined,\n    });\n    setShowProjectForm(true);\n  };\n\n  const handleCloseForm = () => {\n    setShowProjectForm(false);\n    setEditingProject(null);\n    form.reset();\n  };\n\n  const onSubmit = (data: InsertProject) => {\n    console.log(\"Submitting project data:\", data);\n    if (editingProject) {\n      updateProjectMutation.mutate({ id: editingProject.id, data });\n    } else {\n      createProjectMutation.mutate(data);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary text-white\">\n        <Header />\n        <div className=\"p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <p className=\"text-gray-400\">Yükleniyor...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-white hover:bg-dark-accent\"\n            onClick={() => setLocation(\"/\")}\n          >\n            <Home className=\"h-6 w-6\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Verilen Projeler</h1>\n        </div>\n\n        <div className=\"mb-6\">\n          <Button\n            className=\"bg-blue-500 hover:bg-blue-600 text-white\"\n            onClick={() => setShowProjectForm(true)}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Verilen Proje\n          </Button>\n        </div>\n\n        {projects.length === 0 ? (\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"py-12 text-center\">\n              <Building className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-400 text-lg mb-2\">Henüz yüklenici eklenmemiş</p>\n              <p className=\"text-gray-500 text-sm\">Yeni yüklenici eklemek için yukarıdaki butonu kullanın.</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {projects.map((project) => (\n              <Card \n                key={project.id} \n                className=\"bg-dark-secondary border-dark-accent hover:bg-dark-accent transition-colors cursor-pointer group\"\n                onClick={() => setLocation(`/projects/${project.id}`)}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center gap-3 mb-3\">\n                    <div className=\"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center\">\n                      <Building className=\"h-6 w-6 text-white\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"text-white font-medium text-lg truncate\">{project.name}</h4>\n                      <p className=\"text-gray-400 text-sm truncate\">{project.description || \"Yüklenici Firma\"}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-400\">Başlangıç:</span>\n                      <span className=\"text-white\">{formatDate(project.startDate)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-400\">Durum:</span>\n                      <span className={getStatusColor(project.status)}>{getStatusText(project.status)}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-2 mt-4 opacity-0 group-hover:opacity-100 transition-opacity\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"text-blue-400 hover:text-blue-300 hover:bg-dark-primary\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleEditProject(project);\n                      }}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"text-red-400 hover:text-red-300 hover:bg-dark-primary\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        deleteProjectMutation.mutate(project.id);\n                      }}\n                      disabled={deleteProjectMutation.isPending}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Project Form Dialog */}\n      <Dialog open={showProjectForm} onOpenChange={handleCloseForm}>\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-semibold\">\n              {editingProject ? \"Yüklenici Düzenle\" : \"Verilen Proje\"}\n            </DialogTitle>\n            <p className=\"text-gray-400 text-sm\">\n              Verilen proje bilgilerini girin\n            </p>\n          </DialogHeader>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Yüklenici Adı *</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-blue-500 text-white focus:border-blue-400 h-12\"\n                        placeholder=\"Yüklenici adını girin\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Yüklenici Firma</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-blue-500 text-white focus:border-blue-400 h-12\"\n                        placeholder=\"Yüklenici firma adını girin\"\n                        {...field}\n                        value={field.value || \"\"}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"amount\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Telefon</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"tel\"\n                          className=\"bg-dark-primary border-dark-accent text-white h-12\"\n                          placeholder=\"Telefon numarası\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"startDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">E-posta</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          className=\"bg-dark-primary border-dark-accent text-white h-12\"\n                          placeholder=\"E-posta adresi\"\n                          value=\"\"\n                          onChange={() => {}}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"flex gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white\"\n                  onClick={handleCloseForm}\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white\"\n                  disabled={createProjectMutation.isPending || updateProjectMutation.isPending}\n                >\n                  {(createProjectMutation.isPending || updateProjectMutation.isPending) \n                    ? \"Kaydediliyor...\" \n                    : editingProject \n                      ? \"Güncelle\" \n                      : \"Kaydet\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":14781},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Home, FileText, Download, Plus, BarChart, Calendar, DollarSign, RefreshCw } from \"lucide-react\";\nimport Header from \"@/components/layout/header\";\nimport AdvancedFilters, { type FilterOptions } from \"@/components/filters/advanced-filters\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\n\ninterface FinancialSummary {\n  totalIncome: number;\n  totalExpenses: number;\n  netBalance: number;\n  customerPayments: {\n    total: number;\n    thisMonth: number;\n    count: number;\n  };\n  customerTasks: {\n    total: number;\n    pending: number;\n    completed: number;\n  };\n}\n\ninterface DashboardData {\n  monthlyRevenue: Array<{\n    month: string;\n    amount: number;\n  }>;\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  company?: string;\n  email?: string;\n  status: string;\n}\n\ninterface Timesheet {\n  id: string;\n  personnelName: string;\n  date: string;\n  startTime: string;\n  endTime: string;\n  notes: string;\n}\n\ninterface ReportTemplate {\n  id: string;\n  name: string;\n  description: string;\n  type: \"financial\" | \"timesheet\" | \"project\" | \"custom\";\n  icon: any;\n  color: string;\n}\n\nconst reportTemplates: ReportTemplate[] = [\n  {\n    id: \"financial-summary\",\n    name: \"Finansal Özet Raporu\",\n    description: \"Gelir, gider ve net kar analizi\",\n    type: \"financial\",\n    icon: DollarSign,\n    color: \"text-green-400\"\n  },\n  {\n    id: \"monthly-revenue\",\n    name: \"Aylık Gelir Raporu\",\n    description: \"Aylık gelir dağılımı ve trend analizi\",\n    type: \"financial\",\n    icon: BarChart,\n    color: \"text-blue-400\"\n  },\n  {\n    id: \"timesheet-summary\",\n    name: \"Puantaj Özet Raporu\",\n    description: \"Personel çalışma saatleri ve aktivite raporu\",\n    type: \"timesheet\",\n    icon: Calendar,\n    color: \"text-purple-400\"\n  },\n  {\n    id: \"project-performance\",\n    name: \"Proje Performans Raporu\",\n    description: \"Proje durumu ve karlılık analizi\",\n    type: \"project\",\n    icon: FileText,\n    color: \"text-orange-400\"\n  },\n];\n\nexport default function ReportsPage() {\n  const [, setLocation] = useLocation();\n  const [filters, setFilters] = useState<FilterOptions>({\n    search: \"\",\n    dateFrom: \"\",\n    dateTo: \"\",\n    status: \"\",\n    type: \"\",\n    personnel: \"\",\n  });\n  const { toast } = useToast();\n\n  // Fetch data for reports\n  const { data: customers = [], isLoading: customersLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: transactions = [], isLoading: transactionsLoading } = useQuery({\n    queryKey: [\"/api/transactions\"],\n  });\n\n  const { data: personnel = [], isLoading: personnelLoading } = useQuery({\n    queryKey: [\"/api/personnel\"],\n  });\n\n  const { data: timesheets = [], isLoading: timesheetsLoading } = useQuery<Timesheet[]>({\n    queryKey: [\"/api/timesheets\"],\n  });\n\n  const { data: financialSummary, isLoading: financialLoading } = useQuery<FinancialSummary>({\n    queryKey: [\"/api/financial-summary\"],\n  });\n\n  const { data: dashboardData, isLoading: dashboardLoading } = useQuery<DashboardData>({\n    queryKey: [\"/api/analytics/dashboard\"],\n  });\n\n  const isLoadingData = customersLoading || transactionsLoading || personnelLoading || \n                       timesheetsLoading || financialLoading || dashboardLoading;\n\n  const handleFilterChange = (newFilters: FilterOptions) => {\n    setFilters(newFilters);\n  };\n\n  const handleExport = (format: 'csv' | 'pdf') => {\n    toast({\n      title: \"Dışa Aktarma\",\n      description: `${format.toUpperCase()} formatında rapor oluşturuluyor...`,\n    });\n  };\n\n  // Helper function to normalize Turkish characters for PDF\n  const normalizeTurkishText = (text: string): string => {\n    const turkishMap: { [key: string]: string } = {\n      'ç': 'c',\n      'ğ': 'g', \n      'ı': 'i',\n      'ö': 'o',\n      'ş': 's',\n      'ü': 'u',\n      'Ç': 'C',\n      'Ğ': 'G',\n      'İ': 'I',\n      'Ö': 'O',\n      'Ş': 'S',\n      'Ü': 'U'\n    };\n    \n    return text.replace(/[çğıöşüÇĞİÖŞÜ]/g, (match) => turkishMap[match] || match);\n  };\n\n  const generateReportPDF = (templateId: string) => {\n    try {\n      const doc = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4',\n      });\n      \n      // Use helvetica for better character support\n      doc.setFont(\"helvetica\", \"normal\");\n      \n      const currentDate = new Date().toLocaleDateString('tr-TR');\n      \n      switch (templateId) {\n        case \"financial-summary\":\n          doc.setFontSize(16);\n          doc.text(normalizeTurkishText(\"Finansal Ozet Raporu\"), 20, 20);\n          doc.setFontSize(10);\n          doc.text(normalizeTurkishText(`Tarih: ${currentDate}`), 20, 30);\n          \n          if (financialSummary) {\n            const financialData = [\n              [normalizeTurkishText('Toplam Gelir'), `TL${financialSummary.totalIncome?.toLocaleString('tr-TR') || 0}`],\n              [normalizeTurkishText('Toplam Gider'), `TL${financialSummary.totalExpenses?.toLocaleString('tr-TR') || 0}`],\n              [normalizeTurkishText('Net Kar'), `TL${financialSummary.netBalance?.toLocaleString('tr-TR') || 0}`],\n              [normalizeTurkishText('Musteri Odemeleri'), `TL${financialSummary.customerPayments?.total?.toLocaleString('tr-TR') || 0}`],\n              [normalizeTurkishText('Bekleyen Isler'), `TL${financialSummary.customerTasks?.total?.toLocaleString('tr-TR') || 0}`]\n            ];\n            \n            autoTable(doc, {\n              head: [[normalizeTurkishText('Kategori'), normalizeTurkishText('Tutar')]],\n              body: financialData,\n              startY: 40,\n              styles: {\n                font: 'helvetica',\n                fontSize: 10,\n              },\n              headStyles: {\n                fillColor: [41, 128, 185],\n                textColor: 255,\n                font: 'helvetica',\n                fontSize: 12,\n              }\n            });\n          }\n          break;\n          \n        case \"monthly-revenue\":\n          doc.setFontSize(16);\n          doc.text(normalizeTurkishText(\"Aylik Gelir Raporu\"), 20, 20);\n          doc.setFontSize(10);\n          doc.text(normalizeTurkishText(`Tarih: ${currentDate}`), 20, 30);\n          \n          if (dashboardData?.monthlyRevenue) {\n            const revenueData = dashboardData.monthlyRevenue.map((item: any) => [\n              item.month,\n              `₺${item.amount?.toLocaleString('tr-TR') || 0}`\n            ]);\n            \n            autoTable(doc, {\n              head: [[normalizeTurkishText('Ay'), normalizeTurkishText('Gelir')]],\n              body: revenueData.map(row => [normalizeTurkishText(row[0]), row[1]]),\n              startY: 40,\n              styles: {\n                font: 'helvetica',\n                fontSize: 10,\n              },\n              headStyles: {\n                fillColor: [41, 128, 185],\n                textColor: 255,\n                font: 'helvetica',\n                fontSize: 12,\n              }\n            });\n          }\n          break;\n          \n        case \"timesheet-summary\":\n          doc.setFontSize(16);\n          doc.text(normalizeTurkishText(\"Puantaj Ozet Raporu\"), 20, 20);\n          doc.setFontSize(10);\n          doc.text(normalizeTurkishText(`Tarih: ${currentDate}`), 20, 30);\n          \n          if (timesheets.length > 0) {\n            const timesheetData = timesheets.map((item: any) => [\n              item.personnelName || 'Bilinmeyen',\n              item.date || '',\n              item.startTime || '',\n              item.endTime || '',\n              item.notes || ''\n            ]);\n            \n            autoTable(doc, {\n              head: [[\n                normalizeTurkishText('Personel'), \n                normalizeTurkishText('Tarih'), \n                normalizeTurkishText('Baslangic'), \n                normalizeTurkishText('Bitis'), \n                normalizeTurkishText('Notlar')\n              ]],\n              body: timesheetData.map(row => row.map(cell => normalizeTurkishText(cell))),\n              startY: 40,\n              styles: {\n                font: 'helvetica',\n                fontSize: 8,\n              },\n              headStyles: {\n                fillColor: [142, 68, 173],\n                textColor: 255,\n                font: 'helvetica',\n                fontSize: 10,\n              }\n            });\n          }\n          break;\n          \n        case \"project-performance\":\n          doc.setFontSize(16);\n          doc.text(normalizeTurkishText(\"Proje Performans Raporu\"), 20, 20);\n          doc.setFontSize(10);\n          doc.text(normalizeTurkishText(`Tarih: ${currentDate}`), 20, 30);\n          \n          if (customers.length > 0) {\n            const projectData = customers.map((customer: any) => [\n              customer.name,\n              customer.company || '-',\n              customer.status === 'active' ? 'Aktif' : 'Pasif',\n              customer.email || '-'\n            ]);\n            \n            autoTable(doc, {\n              head: [[\n                normalizeTurkishText('Musteri'), \n                normalizeTurkishText('Sirket'), \n                normalizeTurkishText('Durum'), \n                'E-posta'\n              ]],\n              body: projectData.map(row => [\n                normalizeTurkishText(row[0]),\n                normalizeTurkishText(row[1]),\n                normalizeTurkishText(row[2]),\n                row[3]\n              ]),\n              startY: 40,\n              styles: {\n                font: 'helvetica',\n                fontSize: 10,\n              },\n              headStyles: {\n                fillColor: [230, 126, 34],\n                textColor: 255,\n                font: 'helvetica',\n                fontSize: 12,\n              }\n            });\n          }\n          break;\n      }\n      \n      const template = reportTemplates.find(t => t.id === templateId);\n      const fileName = `${template?.name.toLowerCase().replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;\n      doc.save(fileName);\n      \n      toast({\n        title: \"PDF İndirildi\",\n        description: \"Rapor PDF formatında başarıyla indirildi.\",\n      });\n    } catch (error) {\n      console.error('PDF export error:', error);\n      toast({\n        title: \"Hata\",\n        description: \"PDF oluşturulurken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const generateReportExcel = (templateId: string) => {\n    try {\n      let csvContent = '';\n      let fileName = '';\n      \n      switch (templateId) {\n        case \"financial-summary\":\n          csvContent = \"Kategori,Tutar\\n\";\n          if (financialSummary) {\n            csvContent += `Toplam Gelir,${financialSummary.totalIncome || 0}\\n`;\n            csvContent += `Toplam Gider,${financialSummary.totalExpenses || 0}\\n`;\n            csvContent += `Net Kar,${financialSummary.netBalance || 0}\\n`;\n            csvContent += `Müşteri Ödemeleri,${financialSummary.customerPayments?.total || 0}\\n`;\n            csvContent += `Bekleyen İşler,${financialSummary.customerTasks?.total || 0}\\n`;\n          }\n          fileName = 'finansal_ozet_raporu';\n          break;\n          \n        case \"monthly-revenue\":\n          csvContent = \"Ay,Gelir\\n\";\n          if (dashboardData?.monthlyRevenue) {\n            dashboardData.monthlyRevenue.forEach((item: any) => {\n              csvContent += `${item.month},${item.amount || 0}\\n`;\n            });\n          }\n          fileName = 'aylik_gelir_raporu';\n          break;\n          \n        case \"timesheet-summary\":\n          csvContent = \"Personel,Tarih,Başlangıç,Bitiş,Notlar\\n\";\n          timesheets.forEach((item: any) => {\n            csvContent += `${item.personnelName || 'Bilinmeyen'},${item.date || ''},${item.startTime || ''},${item.endTime || ''},${item.notes || ''}\\n`;\n          });\n          fileName = 'puantaj_ozet_raporu';\n          break;\n          \n        case \"project-performance\":\n          csvContent = \"Müşteri,Şirket,Durum,E-posta\\n\";\n          customers.forEach((customer: any) => {\n            csvContent += `${customer.name},${customer.company || ''},${customer.status === 'active' ? 'Aktif' : 'Pasif'},${customer.email || ''}\\n`;\n          });\n          fileName = 'proje_performans_raporu';\n          break;\n      }\n      \n      const blob = new Blob(['\\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });\n      const link = document.createElement('a');\n      const url = URL.createObjectURL(blob);\n      link.setAttribute('href', url);\n      link.setAttribute('download', `${fileName}_${new Date().toISOString().split('T')[0]}.csv`);\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      toast({\n        title: \"Excel İndirildi\",\n        description: \"Rapor Excel formatında başarıyla indirildi.\",\n      });\n    } catch (error) {\n      console.error('Excel export error:', error);\n      toast({\n        title: \"Hata\",\n        description: \"Excel oluşturulurken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const generateReport = async (templateId: string) => {\n    generateReportPDF(templateId);\n  };\n\n  const downloadReport = async (templateId: string) => {\n    generateReportExcel(templateId);\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case \"financial\": return \"bg-green-500/20 text-green-400 border-green-500/30\";\n      case \"timesheet\": return \"bg-purple-500/20 text-purple-400 border-purple-500/30\";\n      case \"project\": return \"bg-orange-500/20 text-orange-400 border-orange-500/30\";\n      default: return \"bg-gray-500/20 text-gray-400 border-gray-500/30\";\n    }\n  };\n\n  const getTypeName = (type: string) => {\n    switch (type) {\n      case \"financial\": return \"Finansal\";\n      case \"timesheet\": return \"Puantaj\";\n      case \"project\": return \"Proje\";\n      default: return \"Özel\";\n    }\n  };\n\n  // Filter reports based on search and type\n  const filteredReports = reportTemplates.filter(template => {\n    const matchesSearch = !filters.search || \n      template.name.toLowerCase().includes(filters.search.toLowerCase()) ||\n      template.description.toLowerCase().includes(filters.search.toLowerCase());\n    \n    const matchesType = !filters.type || template.type === filters.type;\n    \n    return matchesSearch && matchesType;\n  });\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            className=\"text-gray-400 hover:text-white\"\n          >\n            <Home className=\"h-4 w-4\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Rapor Merkezi</h1>\n        </div>\n\n        <div className=\"flex items-center justify-between mb-6\">\n          <div className=\"flex-1\">\n            <AdvancedFilters\n              onFilterChange={handleFilterChange}\n              onExport={handleExport}\n              exportData={filteredReports.map((template: any) => ({\n                name: template.name,\n                type: template.type === 'financial' ? 'Finansal' : template.type === 'personnel' ? 'Personel' : 'Diğer',\n                description: template.description,\n                category: template.category || '-'\n              }))}\n              exportTitle=\"Rapor Şablonları\"\n            />\n          </div>\n          \n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"ml-4 border-dark-accent text-gray-400 hover:bg-dark-accent\"\n            onClick={() => window.location.reload()}\n            disabled={isLoadingData}\n          >\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            {isLoadingData ? \"Yükleniyor...\" : \"Yenile\"}\n          </Button>\n        </div>\n\n        {/* Loading State */}\n        {isLoadingData && (\n          <Card className=\"bg-dark-secondary border-dark-accent mb-6\">\n            <CardContent className=\"py-8 text-center\">\n              <div className=\"flex items-center justify-center gap-3\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400\"></div>\n                <p className=\"text-gray-400\">Rapor verileri yükleniyor...</p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Report Statistics */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 mt-6\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-400\">Toplam Rapor</p>\n                  <p className=\"text-2xl font-bold text-white\">{reportTemplates.length}</p>\n                </div>\n                <FileText className=\"h-8 w-8 text-blue-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-400\">Finansal</p>\n                  <p className=\"text-2xl font-bold text-green-400\">\n                    {reportTemplates.filter(r => r.type === 'financial').length}\n                  </p>\n                </div>\n                <DollarSign className=\"h-8 w-8 text-green-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-400\">Puantaj</p>\n                  <p className=\"text-2xl font-bold text-purple-400\">\n                    {reportTemplates.filter(r => r.type === 'timesheet').length}\n                  </p>\n                </div>\n                <Calendar className=\"h-8 w-8 text-purple-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-400\">Proje</p>\n                  <p className=\"text-2xl font-bold text-orange-400\">\n                    {reportTemplates.filter(r => r.type === 'project').length}\n                  </p>\n                </div>\n                <BarChart className=\"h-8 w-8 text-orange-400\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Report Templates Grid */}\n        {filteredReports.length === 0 ? (\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"py-12 text-center\">\n              <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-400 text-lg mb-2\">\n                {filters.search ? \"Arama kriterlerine uygun rapor bulunamadı\" : \"Rapor şablonu bulunamadı\"}\n              </p>\n              <p className=\"text-gray-500 text-sm\">\n                {filters.search ? \"Farklı anahtar kelimeler deneyin\" : \"Yeni rapor şablonu eklenecek\"}\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {filteredReports.map((template) => {\n              const IconComponent = template.icon;\n              return (\n                <Card key={template.id} className=\"bg-dark-secondary border-dark-accent hover:border-blue-500/50 transition-colors\">\n                  <CardHeader className=\"pb-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"p-2 rounded-lg bg-dark-accent\">\n                          <IconComponent className={`h-6 w-6 ${template.color}`} />\n                        </div>\n                        <div>\n                          <CardTitle className=\"text-white text-lg\">{template.name}</CardTitle>\n                          <Badge className={`mt-1 ${getTypeColor(template.type)}`}>\n                            {getTypeName(template.type)}\n                          </Badge>\n                        </div>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  \n                  <CardContent className=\"pt-0\">\n                    <p className=\"text-gray-300 text-sm mb-4 line-clamp-2\">\n                      {template.description}\n                    </p>\n                    \n                    <div className=\"flex gap-2\">\n                      <Button\n                        className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white\"\n                        onClick={() => generateReport(template.id)}\n                      >\n                        <BarChart className=\"h-4 w-4 mr-2\" />\n                        Rapor Oluştur\n                      </Button>\n                      \n                      <Button\n                        variant=\"outline\"\n                        size=\"icon\"\n                        className=\"border-dark-accent hover:bg-dark-accent text-gray-400\"\n                        onClick={() => downloadReport(template.id)}\n                      >\n                        <Download className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Custom Report Builder */}\n        <Card className=\"bg-dark-secondary border-dark-accent mt-6\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Plus className=\"h-5 w-5 text-green-400\" />\n              Özel Rapor Oluştur\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-gray-300 mb-4\">\n              İhtiyacınıza özel rapor şablonları oluşturun ve kaydedin.\n            </p>\n            <Button \n              className=\"bg-green-500 hover:bg-green-600 text-white\"\n              onClick={() => {\n                toast({\n                  title: \"Özel Rapor\",\n                  description: \"Özel rapor oluşturma özelliği yakında eklenecek.\",\n                });\n              }}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Yeni Şablon Oluştur\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":23167},"client/src/pages/timesheet.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Home, Plus, Calendar, Clock, Edit, Trash2 } from \"lucide-react\";\nimport { type Timesheet, type Personnel } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport Header from \"@/components/layout/header\";\nimport TimesheetForm from \"@/components/forms/timesheet-form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\nexport default function TimesheetPage() {\n  const [, setLocation] = useLocation();\n  const [showTimesheetForm, setShowTimesheetForm] = useState(false);\n  const [editingTimesheet, setEditingTimesheet] = useState<Timesheet | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: timesheets = [], isLoading: timesheetsLoading } = useQuery<Timesheet[]>({\n    queryKey: [\"/api/timesheets\"],\n  });\n\n  const { data: personnel = [] } = useQuery<Personnel[]>({\n    queryKey: [\"/api/personnel\"],\n  });\n\n  const deleteTimesheetMutation = useMutation({\n    mutationFn: async (timesheetId: string) => {\n      await apiRequest(`/api/timesheets/${timesheetId}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timesheets\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Puantaj kaydı başarıyla silindi.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Hata\",\n        description: \"Puantaj kaydı silinirken bir hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteTimesheet = (timesheetId: string) => {\n    if (confirm(\"Bu puantaj kaydını silmek istediğinizden emin misiniz?\")) {\n      deleteTimesheetMutation.mutate(timesheetId);\n    }\n  };\n\n  const getPersonnelName = (personnelId: string) => {\n    const person = personnel.find(p => p.id === personnelId);\n    return person?.name || \"Bilinmeyen Personel\";\n  };\n\n  const formatDate = (date: Date | string) => {\n    const d = new Date(date);\n    return d.toLocaleDateString('tr-TR');\n  };\n\n  const formatTime = (time: string) => {\n    return time;\n  };\n\n  if (timesheetsLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary text-white\">\n        <Header />\n        <div className=\"p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <p className=\"text-gray-400\">Yükleniyor...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-white hover:bg-dark-accent\"\n            onClick={() => setLocation(\"/\")}\n          >\n            <Home className=\"h-6 w-6\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Puantaj Kayıtları</h1>\n        </div>\n\n        <div className=\"mb-6\">\n          <Button\n            className=\"bg-blue-500 hover:bg-blue-600 text-white\"\n            onClick={() => setShowTimesheetForm(true)}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Yeni Puantaj\n          </Button>\n        </div>\n\n        {timesheets.length === 0 ? (\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"py-12 text-center\">\n              <Clock className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-400 text-lg mb-2\">Henüz puantaj kaydı eklenmemiş</p>\n              <p className=\"text-gray-500 text-sm\">Yeni puantaj kaydı eklemek için yukarıdaki butonu kullanın.</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-3\">\n            {timesheets.map((timesheet) => (\n              <Card key={timesheet.id} className=\"bg-dark-secondary border-dark-accent\">\n                <CardContent className=\"p-4\">\n                  <div className=\"w-full\">\n                    <div className=\"w-full\">\n                      <div className=\"flex items-center gap-3 mb-3\">\n                        <Calendar className=\"h-5 w-5 text-blue-400\" />\n                        <h4 className=\"text-white font-medium text-lg\">\n                          {getPersonnelName(timesheet.personnelId)}\n                        </h4>\n                      </div>\n                      \n                      <div className=\"mb-3\">\n                        <div className=\"flex justify-between items-center\">\n                          <div className=\"flex gap-4 text-sm\">\n                            <span className=\"text-green-400 font-medium\">\n                              Günlük: ₺{parseFloat(timesheet.dailyWage || \"0\").toLocaleString('tr-TR', {\n                                minimumFractionDigits: 2,\n                                maximumFractionDigits: 2\n                              })}\n                            </span>\n                            {timesheet.overtimeHours && parseFloat(timesheet.overtimeHours) > 0 && (\n                              <span className=\"text-yellow-400 font-medium\">\n                                Mesai: ₺{(parseFloat(timesheet.hourlyRate || \"0\") * parseFloat(timesheet.overtimeHours || \"0\")).toLocaleString('tr-TR', {\n                                  minimumFractionDigits: 2,\n                                  maximumFractionDigits: 2\n                                })}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      \n                      <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm\">\n                        <div>\n                          <p className=\"text-gray-400\">Tarih</p>\n                          <p className=\"text-white font-medium\">{formatDate(timesheet.date)}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-gray-400\">Giriş</p>\n                          <p className=\"text-white font-medium\">{formatTime(timesheet.startTime || \"08:00\")}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-gray-400\">Çıkış</p>\n                          <p className=\"text-white font-medium\">{formatTime(timesheet.endTime || \"17:00\")}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-gray-400\">Normal Saat</p>\n                          <p className=\"text-white font-medium\">{timesheet.totalHours}h</p>\n                        </div>\n                        <div>\n                          <p className=\"text-gray-400\">Mesai Saati</p>\n                          <p className=\"text-orange-400 font-medium\">\n                            {timesheet.overtimeHours && parseFloat(timesheet.overtimeHours) > 0 \n                              ? `${timesheet.overtimeHours}h` \n                              : \"0h\"}\n                          </p>\n                        </div>\n                      </div>\n\n                      {timesheet.notes && (\n                        <div className=\"mt-3\">\n                          <p className=\"text-gray-400 text-sm\">Not</p>\n                          <p className=\"text-gray-300 text-sm\">{timesheet.notes}</p>\n                        </div>\n                      )}\n                      \n                      {/* Action Buttons */}\n                      <div className=\"flex justify-end gap-2 mt-4 pt-3 border-t border-dark-accent\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"text-blue-400 hover:text-blue-300 hover:bg-blue-500/10 border-blue-500/20\"\n                          onClick={() => {\n                            setEditingTimesheet(timesheet);\n                            setShowTimesheetForm(true);\n                          }}\n                        >\n                          <Edit className=\"h-4 w-4 mr-2\" />\n                          Düzenle\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"text-red-400 hover:text-red-300 hover:bg-red-500/10 border-red-500/20\"\n                          onClick={() => handleDeleteTimesheet(timesheet.id)}\n                        >\n                          <Trash2 className=\"h-4 w-4 mr-2\" />\n                          Sil\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <TimesheetForm \n        open={showTimesheetForm} \n        onOpenChange={(open) => {\n          setShowTimesheetForm(open);\n          if (!open) {\n            setEditingTimesheet(null);\n          }\n        }}\n        editingTimesheet={editingTimesheet}\n      />\n    </div>\n  );\n}\n","size_bytes":9256},"client/src/components/analytics/dashboard-charts.tsx":{"content":"import { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ChartContainer } from \"@/components/ui/chart\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from \"recharts\";\nimport { TrendingUp, Building, RefreshCw } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ChartData {\n  monthlyRevenue: Array<{ month: string; income: number; expenses: number; }>;\n  projectsByStatus: Array<{ status: string; count: number; }>;\n}\n\nconst COLORS = [\"#3B82F6\", \"#10B981\", \"#F59E0B\", \"#EF4444\", \"#8B5CF6\"];\n\nexport default function DashboardCharts() {\n  const queryClient = useQueryClient();\n  const { data: chartData, refetch } = useQuery<ChartData>({\n    queryKey: [\"/api/analytics/dashboard\"],\n    staleTime: 0,\n    refetchOnMount: true,\n  });\n\n\n\n  const handleRefresh = () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/analytics/dashboard\"] });\n    refetch();\n  };\n\n  if (!chartData) {\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        {[1, 2].map((i) => (\n          <Card key={i} className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"animate-pulse\">\n                <div className=\"h-4 bg-gray-600 rounded w-3/4 mb-4\"></div>\n                <div className=\"h-48 bg-gray-600 rounded\"></div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-xl font-semibold text-white\">Veri Analizi ve Raporlar</h2>\n        <Button\n          onClick={handleRefresh}\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"border-dark-accent hover:bg-dark-accent text-gray-400 hover:text-white\"\n        >\n          <RefreshCw className=\"h-4 w-4 mr-2\" />\n          Yenile\n        </Button>\n      </div>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n      {/* Monthly Revenue Chart */}\n      <Card className=\"bg-dark-secondary border-dark-accent\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <TrendingUp className=\"h-4 w-4 text-green-400\" />\n            Aylık Gelir/Gider\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ChartContainer>\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <BarChart data={chartData.monthlyRevenue}>\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                <XAxis dataKey=\"month\" stroke=\"#9CA3AF\" />\n                <YAxis stroke=\"#9CA3AF\" tickFormatter={(value) => value.toLocaleString('tr-TR')} />\n                <Tooltip \n                  contentStyle={{ \n                    backgroundColor: '#1F2937', \n                    border: '1px solid #374151',\n                    borderRadius: '6px',\n                    color: '#fff'\n                  }} \n                />\n                <Bar dataKey=\"income\" fill=\"#10B981\" name=\"Gelir\" />\n                <Bar dataKey=\"expenses\" fill=\"#EF4444\" name=\"Gider\" />\n              </BarChart>\n            </ResponsiveContainer>\n          </ChartContainer>\n        </CardContent>\n      </Card>\n\n      {/* Project Status Distribution */}\n      <Card className=\"bg-dark-secondary border-dark-accent\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Building className=\"h-4 w-4 text-blue-400\" />\n            Proje Durumu\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ChartContainer>\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <PieChart>\n                <Pie\n                  data={chartData.projectsByStatus}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  outerRadius={80}\n                  dataKey=\"count\"\n                  label={({ status, count }) => `${status}: ${count}`}\n                >\n                  {chartData.projectsByStatus.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                  ))}\n                </Pie>\n                <Tooltip \n                  contentStyle={{ \n                    backgroundColor: '#1F2937', \n                    border: '1px solid #374151',\n                    borderRadius: '6px',\n                    color: '#fff'\n                  }} \n                />\n              </PieChart>\n            </ResponsiveContainer>\n          </ChartContainer>\n        </CardContent>\n      </Card>\n\n\n      </div>\n    </div>\n  );\n}","size_bytes":4817},"client/src/components/cards/navigation-card.tsx":{"content":"import { LucideIcon } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface NavigationCardProps {\n  icon: LucideIcon;\n  label: string;\n  onClick: () => void;\n  iconColor?: string;\n}\n\nexport default function NavigationCard({ \n  icon: Icon, \n  label, \n  onClick, \n  iconColor = \"text-blue-400\" \n}: NavigationCardProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"bg-white dark:bg-dark-secondary hover:bg-gray-100 dark:hover:bg-dark-accent transition-colors p-6 rounded-xl flex flex-col items-center gap-3 border border-gray-200 dark:border-dark-accent\"\n    >\n      <Icon className={cn(\"text-2xl\", iconColor)} />\n      <span className=\"text-gray-800 dark:text-white font-medium text-center\">{label}</span>\n    </button>\n  );\n}\n","size_bytes":758},"client/src/components/cards/project-card.tsx":{"content":"import { Home, Users, Briefcase, Wallet, Calculator } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ProjectCardProps {\n  title: string;\n  total: string;\n  activeLabel: string;\n  activeValue: string;\n  passiveLabel: string;\n  passiveValue: string;\n  type: \"orange\" | \"teal\" | \"blue\" | \"green\" | \"purple\";\n  icon?: \"home\" | \"users\" | \"briefcase\" | \"wallet\" | \"calculator\";\n}\n\nexport default function ProjectCard({\n  title,\n  total,\n  activeLabel,\n  activeValue,\n  passiveLabel,\n  passiveValue,\n  type,\n  icon = \"home\"\n}: ProjectCardProps) {\n  const getIconComponent = () => {\n    switch (icon) {\n      case \"home\": return Home;\n      case \"users\": return Users;\n      case \"briefcase\": return Briefcase;\n      case \"wallet\": return Wallet;\n      case \"calculator\": return Calculator;\n      default: return Home;\n    }\n  };\n  \n  const IconComponent = getIconComponent();\n  \n  const getGradientClass = () => {\n    switch (type) {\n      case \"orange\": return \"gradient-orange\";\n      case \"teal\": return \"gradient-teal\";\n      case \"blue\": return \"bg-gradient-to-br from-blue-500 to-blue-700\";\n      case \"green\": return \"bg-gradient-to-br from-green-500 to-green-700\";\n      case \"purple\": return \"bg-gradient-to-br from-purple-500 to-purple-700\";\n      default: return \"gradient-orange\";\n    }\n  };\n  \n  return (\n    <div className={cn(\n      \"rounded-xl p-6 text-white relative overflow-hidden\",\n      getGradientClass()\n    )}>\n      <div className=\"absolute top-4 right-4\">\n        <IconComponent className=\"h-8 w-8 text-white/30\" />\n      </div>\n      \n      <h3 className=\"text-base font-semibold mb-2\">{title}</h3>\n      <div className=\"text-2xl font-bold mb-4\">{total}</div>\n      \n      <div className=\"flex justify-between text-sm opacity-90\">\n        <div>\n          <span className=\"font-medium\">{activeLabel}</span>\n          <div className=\"font-bold\">{activeValue}</div>\n        </div>\n        <div>\n          <span className=\"font-medium\">{passiveLabel}</span>\n          <div className=\"font-bold\">{passiveValue}</div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2097},"client/src/components/filters/advanced-filters.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Calendar, Filter, X, Search, Download } from \"lucide-react\";\nimport jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\n\ninterface FilterProps {\n  onFilterChange: (filters: FilterOptions) => void;\n  onExport?: (format: 'csv' | 'pdf') => void;\n  exportData?: any[];\n  exportTitle?: string;\n}\n\nexport interface FilterOptions {\n  search: string;\n  dateFrom: string;\n  dateTo: string;\n  status: string;\n  type: string;\n  personnel: string;\n}\n\nexport default function AdvancedFilters({ onFilterChange, onExport, exportData = [], exportTitle = \"Veri\" }: FilterProps) {\n  const [filters, setFilters] = useState<FilterOptions>({\n    search: \"\",\n    dateFrom: \"\",\n    dateTo: \"\",\n    status: \"\",\n    type: \"\",\n    personnel: \"\",\n  });\n\n  const [showFilters, setShowFilters] = useState(false);\n\n  const handleFilterChange = (key: keyof FilterOptions, value: string) => {\n    const newFilters = { ...filters, [key]: value };\n    setFilters(newFilters);\n    onFilterChange(newFilters);\n  };\n\n  const clearFilters = () => {\n    const clearedFilters = {\n      search: \"\",\n      dateFrom: \"\",\n      dateTo: \"\",\n      status: \"\",\n      type: \"\",\n      personnel: \"\",\n    };\n    setFilters(clearedFilters);\n    onFilterChange(clearedFilters);\n  };\n\n  const exportToPDF = () => {\n    try {\n      const doc = new jsPDF();\n      \n      // Turkish font support (fallback to Times if Turkish not available)\n      doc.setFont(\"times\", \"normal\");\n      \n      // Title\n      doc.setFontSize(16);\n      doc.text(exportTitle + \" Raporu\", 20, 20);\n      \n      // Date\n      doc.setFontSize(10);\n      doc.text(`Tarih: ${new Date().toLocaleDateString('tr-TR')}`, 20, 30);\n      \n      if (exportData.length > 0) {\n        // Create table headers\n        const headers = Object.keys(exportData[0]).map(key => {\n          switch(key) {\n            case 'name': return 'İsim';\n            case 'company': return 'Şirket';\n            case 'phone': return 'Telefon';\n            case 'email': return 'E-posta';\n            case 'status': return 'Durum';\n            case 'amount': return 'Tutar';\n            case 'description': return 'Açıklama';\n            case 'type': return 'Tür';\n            case 'date': return 'Tarih';\n            default: return key;\n          }\n        });\n        \n        // Create table data\n        const data = exportData.map(item => \n          Object.values(item).map(value => \n            value === null || value === undefined ? '-' : String(value)\n          )\n        );\n        \n        autoTable(doc, {\n          head: [headers],\n          body: data,\n          startY: 40,\n          styles: {\n            fontSize: 8,\n            cellPadding: 2,\n          },\n          headStyles: {\n            fillColor: [41, 128, 185],\n            textColor: 255,\n          },\n          alternateRowStyles: {\n            fillColor: [245, 245, 245],\n          },\n        });\n      } else {\n        doc.text('Veri bulunamadı.', 20, 40);\n      }\n      \n      // Save the PDF\n      doc.save(`${exportTitle.toLowerCase().replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`);\n    } catch (error) {\n      console.error('PDF export error:', error);\n    }\n  };\n\n  const exportToExcel = () => {\n    try {\n      if (exportData.length === 0) {\n        alert('Dışa aktarılacak veri bulunamadı.');\n        return;\n      }\n\n      // Create CSV content\n      const headers = Object.keys(exportData[0]).map(key => {\n        switch(key) {\n          case 'name': return 'İsim';\n          case 'company': return 'Şirket';\n          case 'phone': return 'Telefon';\n          case 'email': return 'E-posta';\n          case 'status': return 'Durum';\n          case 'amount': return 'Tutar';\n          case 'description': return 'Açıklama';\n          case 'type': return 'Tür';\n          case 'date': return 'Tarih';\n          default: return key;\n        }\n      });\n      \n      const csvContent = [\n        headers.join(','),\n        ...exportData.map(item => \n          Object.values(item).map(value => {\n            const str = value === null || value === undefined ? '' : String(value);\n            return str.includes(',') ? `\"${str}\"` : str;\n          }).join(',')\n        )\n      ].join('\\n');\n      \n      // Create and download file\n      const blob = new Blob(['\\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });\n      const link = document.createElement('a');\n      const url = URL.createObjectURL(blob);\n      link.setAttribute('href', url);\n      link.setAttribute('download', `${exportTitle.toLowerCase().replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`);\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    } catch (error) {\n      console.error('Excel export error:', error);\n    }\n  };\n\n  const handleExport = (format: 'csv' | 'pdf') => {\n    if (format === 'pdf') {\n      exportToPDF();\n    } else if (format === 'csv') {\n      exportToExcel();\n    }\n    \n    // Also call the original onExport if provided\n    if (onExport) {\n      onExport(format);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Search and Filter Toggle */}\n      <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\n        <div className=\"flex-1 max-w-md\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n            <Input\n              placeholder=\"Ara...\"\n              value={filters.search}\n              onChange={(e) => handleFilterChange(\"search\", e.target.value)}\n              className=\"pl-10 bg-dark-primary border-dark-accent text-white\"\n            />\n          </div>\n        </div>\n        \n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowFilters(!showFilters)}\n            className=\"border-dark-accent hover:bg-dark-accent text-white\"\n          >\n            <Filter className=\"h-4 w-4 mr-2\" />\n            Filtreler\n          </Button>\n          \n          <Select onValueChange={(format: 'csv' | 'pdf') => handleExport(format)}>\n            <SelectTrigger className=\"w-32 bg-dark-primary border-dark-accent text-white\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              <SelectValue placeholder=\"Dışa Aktar\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-dark-primary border-dark-accent\">\n              <SelectItem value=\"csv\" className=\"text-white\">Excel</SelectItem>\n              <SelectItem value=\"pdf\" className=\"text-white\">PDF</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* Advanced Filters */}\n      {showFilters && (\n        <Card className=\"bg-dark-secondary border-dark-accent\">\n          <CardHeader className=\"pb-4\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"text-white text-lg\">Gelişmiş Filtreler</CardTitle>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={clearFilters}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                <X className=\"h-4 w-4 mr-2\" />\n                Temizle\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {/* Date From */}\n              <div className=\"space-y-2\">\n                <Label className=\"text-gray-300\">Başlangıç Tarihi</Label>\n                <Input\n                  type=\"date\"\n                  value={filters.dateFrom}\n                  onChange={(e) => handleFilterChange(\"dateFrom\", e.target.value)}\n                  className=\"bg-dark-primary border-dark-accent text-white\"\n                />\n              </div>\n\n              {/* Date To */}\n              <div className=\"space-y-2\">\n                <Label className=\"text-gray-300\">Bitiş Tarihi</Label>\n                <Input\n                  type=\"date\"\n                  value={filters.dateTo}\n                  onChange={(e) => handleFilterChange(\"dateTo\", e.target.value)}\n                  className=\"bg-dark-primary border-dark-accent text-white\"\n                />\n              </div>\n\n              {/* Status */}\n              <div className=\"space-y-2\">\n                <Label className=\"text-gray-300\">Durum</Label>\n                <Select value={filters.status} onValueChange={(value) => handleFilterChange(\"status\", value)}>\n                  <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                    <SelectValue placeholder=\"Durum seçin\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                    <SelectItem value=\"all\" className=\"text-white\">Tümü</SelectItem>\n                    <SelectItem value=\"active\" className=\"text-white\">Aktif</SelectItem>\n                    <SelectItem value=\"passive\" className=\"text-white\">Pasif</SelectItem>\n                    <SelectItem value=\"completed\" className=\"text-white\">Tamamlandı</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Type */}\n              <div className=\"space-y-2\">\n                <Label className=\"text-gray-300\">Tür</Label>\n                <Select value={filters.type} onValueChange={(value) => handleFilterChange(\"type\", value)}>\n                  <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                    <SelectValue placeholder=\"Tür seçin\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                    <SelectItem value=\"all\" className=\"text-white\">Tümü</SelectItem>\n                    <SelectItem value=\"income\" className=\"text-white\">Gelir</SelectItem>\n                    <SelectItem value=\"expense\" className=\"text-white\">Gider</SelectItem>\n                    <SelectItem value=\"received\" className=\"text-white\">Alınan</SelectItem>\n                    <SelectItem value=\"given\" className=\"text-white\">Verilen</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Personnel */}\n              <div className=\"space-y-2\">\n                <Label className=\"text-gray-300\">Personel</Label>\n                <Select value={filters.personnel} onValueChange={(value) => handleFilterChange(\"personnel\", value)}>\n                  <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                    <SelectValue placeholder=\"Personel seçin\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                    <SelectItem value=\"all\" className=\"text-white\">Tümü</SelectItem>\n                    {/* Personnel options will be populated dynamically */}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            \n            {/* Apply Filter Button */}\n            <div className=\"flex justify-end pt-4 border-t border-dark-accent\">\n              <Button\n                className=\"bg-blue-500 hover:bg-blue-600 text-white\"\n                onClick={() => setShowFilters(false)}\n              >\n                Uygula\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":12010},"client/src/components/forms/customer-form.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { insertCustomerSchema, type InsertCustomer, type Customer } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ninterface CustomerFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  customer?: Customer;\n}\n\nexport default function CustomerForm({ open, onOpenChange, customer }: CustomerFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const form = useForm<InsertCustomer>({\n    resolver: zodResolver(insertCustomerSchema),\n    defaultValues: {\n      name: customer?.name || \"\",\n      company: customer?.company || \"\",\n      phone: customer?.phone || \"\",\n      email: customer?.email || \"\",\n      address: customer?.address || \"\",\n      taxNumber: customer?.taxNumber || \"\",\n      status: customer?.status || \"active\",\n    },\n  });\n\n  const onSubmit = async (data: InsertCustomer) => {\n    console.log(\"🎯 FORM SUBMIT TRIGGERED!\", data);\n    console.log(\"🔍 Form validation state:\", form.formState.errors);\n    \n    if (isSubmitting) {\n      console.log(\"⏸️ Already submitting, skipping...\");\n      return; // Prevent double submission\n    }\n    \n    setIsSubmitting(true);\n\n    // Clean data\n    const cleanedData = {\n      name: data.name,\n      company: data.company || null,\n      phone: data.phone || null,\n      email: data.email || null,\n      address: data.address || null,\n      taxNumber: data.taxNumber || null,\n      status: data.status,\n    };\n\n    console.log(\"🎯 Form submitted - starting API call\", cleanedData);\n    \n    try {\n      let result;\n      if (customer) {\n        // Update existing customer\n        console.log(\"📝 Updating existing customer...\");\n        result = await apiRequest(`/api/customers/${customer.id}`, \"PUT\", cleanedData);\n        console.log(\"✅ Update success:\", result);\n        toast({\n          title: \"Başarılı\",\n          description: \"Müşteri kaydı güncellendi.\",\n        });\n      } else {\n        // Create new customer\n        console.log(\"✨ Creating new customer...\");\n        result = await apiRequest(\"/api/customers\", \"POST\", cleanedData);\n        console.log(\"✅ Create success:\", result);\n        toast({\n          title: \"Başarılı\",\n          description: \"Müşteri kaydı oluşturuldu.\",\n        });\n      }\n      \n      // Success handling - only if we get here\n      console.log(\"🎉 Running success handling...\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      console.log(\"🔄 Query invalidated\");\n      form.reset();\n      console.log(\"📝 Form reset\");\n      onOpenChange(false);\n      console.log(\"🚪 Dialog closed\");\n      \n    } catch (error) {\n      console.error(\"❌ Customer operation failed:\", error);\n      console.error(\"❌ Error details:\", error.message, error.stack);\n      toast({\n        title: \"Hata\",\n        description: customer ? \"Müşteri kaydı güncellenemedi.\" : \"Müşteri kaydı oluşturulamadı.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      console.log(\"🏁 Setting isSubmitting to false\");\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleClose = () => {\n    form.reset();\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl font-semibold text-white\">\n            {customer ? \"Müşteri Düzenle\" : \"Yeni Müşteri\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Müşteri Adı *</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Müşteri adı\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"company\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Şirket</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Şirket adı\"\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"phone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Telefon</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"tel\"\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Telefon numarası\"\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">E-posta</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"email\"\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"E-posta adresi\"\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"address\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Adres</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      className=\"bg-dark-primary border-dark-accent text-white h-20\"\n                      placeholder=\"Müşteri adresi\"\n                      value={field.value || \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"taxNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Vergi No</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Vergi numarası\"\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"status\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Durum</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                          <SelectValue placeholder=\"Durum seçin\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                        <SelectItem value=\"active\" className=\"text-white\">Aktif</SelectItem>\n                        <SelectItem value=\"inactive\" className=\"text-white\">Pasif</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <div className=\"flex gap-3 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white\"\n                onClick={handleClose}\n              >\n                İptal\n              </Button>\n              <Button \n                type=\"submit\" \n                className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\n                disabled={isSubmitting}\n              >\n                {isSubmitting ? \"Kaydediliyor...\" : (customer ? \"Güncelle\" : \"Kaydet\")}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":11183},"client/src/components/forms/personnel-form.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { insertPersonnelSchema, type InsertPersonnel, type Personnel } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\n\ninterface PersonnelFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  personnel?: Personnel;\n}\n\nexport default function PersonnelForm({ open, onOpenChange, personnel }: PersonnelFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<InsertPersonnel>({\n    resolver: zodResolver(insertPersonnelSchema),\n    defaultValues: {\n      name: \"\",\n      position: \"\",\n      startDate: new Date(),\n      phone: null,\n      email: null,\n      salary: null,\n      salaryType: \"monthly\",\n      isActive: true,\n    },\n  });\n\n  // Update form when personnel changes\n  useEffect(() => {\n    if (personnel) {\n      form.reset({\n        name: personnel.name,\n        position: personnel.position,\n        startDate: new Date(personnel.startDate),\n        phone: personnel.phone,\n        email: personnel.email,\n        salary: personnel.salary,\n        salaryType: personnel.salaryType || \"monthly\",\n        isActive: personnel.isActive,\n      });\n    } else {\n      form.reset({\n        name: \"\",\n        position: \"\",\n        startDate: new Date(),\n        phone: null,\n        email: null,\n        salary: null,\n        salaryType: \"monthly\",\n        isActive: true,\n      });\n    }\n  }, [personnel, form]);\n\n  const createPersonnelMutation = useMutation({\n    mutationFn: async (data: InsertPersonnel) => {\n      return await apiRequest(\"/api/personnel\", \"POST\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/personnel\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Personel kaydı oluşturuldu.\",\n      });\n      form.reset();\n      onOpenChange(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Personel kaydı oluşturulamadı.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePersonnelMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<InsertPersonnel> }) => {\n      return await apiRequest(`/api/personnel/${id}`, \"PUT\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/personnel\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Personel kaydı güncellendi.\",\n      });\n      form.reset();\n      onOpenChange(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Personel kaydı güncellenemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertPersonnel) => {\n    // Convert empty strings to null for optional fields\n    const cleanedData = {\n      ...data,\n      phone: data.phone?.trim() || null,\n      email: data.email?.trim() || null,\n    };\n    console.log(\"Submitting personnel data:\", cleanedData);\n    \n    if (personnel) {\n      updatePersonnelMutation.mutate({ id: personnel.id, data: cleanedData });\n    } else {\n      createPersonnelMutation.mutate(cleanedData);\n    }\n  };\n\n  const handleClose = () => {\n    form.reset();\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-sm max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl font-semibold\">\n            {personnel ? \"Personel Düzenle\" : \"Yeni Personel\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Ad Soyad</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"Personel adı\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"position\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Pozisyon</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"Çalışma pozisyonu\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"startDate\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Başlangıç Tarihi</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"date\"\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      value={field.value instanceof Date ? field.value.toISOString().split('T')[0] : field.value}\n                      onChange={(e) => field.onChange(new Date(e.target.value))}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"phone\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Telefon</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"Telefon numarası\"\n                      value={field.value || \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"email\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">E-posta</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"email\"\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"E-posta adresi\"\n                      value={field.value || \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"salaryType\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Maaş Türü</FormLabel>\n                  <FormControl>\n                    <div className=\"flex gap-3\">\n                      <Button\n                        type=\"button\"\n                        variant={field.value === \"monthly\" ? \"default\" : \"outline\"}\n                        className={`flex-1 ${\n                          field.value === \"monthly\" \n                            ? \"bg-blue-500 hover:bg-blue-600 text-white border-blue-500\" \n                            : \"bg-dark-primary border-dark-accent text-gray-300 hover:bg-dark-accent\"\n                        }`}\n                        onClick={() => field.onChange(\"monthly\")}\n                      >\n                        Maaş\n                      </Button>\n                      <Button\n                        type=\"button\"\n                        variant={field.value === \"daily\" ? \"default\" : \"outline\"}\n                        className={`flex-1 ${\n                          field.value === \"daily\" \n                            ? \"bg-green-500 hover:bg-green-600 text-white border-green-500\" \n                            : \"bg-dark-primary border-dark-accent text-gray-300 hover:bg-dark-accent\"\n                        }`}\n                        onClick={() => field.onChange(\"daily\")}\n                      >\n                        Günlük\n                      </Button>\n                    </div>\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"salary\"\n              render={({ field }) => {\n                const salaryType = form.watch(\"salaryType\");\n                return (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">\n                      {salaryType === \"monthly\" ? \"Maaş (TL)\" : \"Günlük Ücret (TL)\"}\n                    </FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder={salaryType === \"monthly\" ? \"Aylık maaş tutarı\" : \"Günlük ücret tutarı\"}\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                );\n              }}\n            />\n\n            <div className=\"flex gap-3\">\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white\"\n                onClick={handleClose}\n              >\n                İptal\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"flex-1 bg-green-500 hover:bg-green-600 text-white\"\n                disabled={createPersonnelMutation.isPending || updatePersonnelMutation.isPending}\n              >\n                {(createPersonnelMutation.isPending || updatePersonnelMutation.isPending) ? \"Kaydediliyor...\" : \"Kaydet\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":11518},"client/src/components/forms/timesheet-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { type Personnel, type Customer, type Timesheet } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { X } from \"lucide-react\";\n\ninterface TimesheetFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  editingTimesheet?: Timesheet | null;\n}\n\nexport default function TimesheetForm({ open, onOpenChange, editingTimesheet }: TimesheetFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Form state\n  const [selectedPersonnelIds, setSelectedPersonnelIds] = useState<string[]>([]);\n  const [workType, setWorkType] = useState<string>(\"tam\");\n  const [showPersonnelDropdown, setShowPersonnelDropdown] = useState(false);\n  const [customerId, setCustomerId] = useState(\"\");\n  const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\n  const [overtimeHours, setOvertimeHours] = useState(\"0\");\n  const [notes, setNotes] = useState(\"\");\n\n  const { data: personnel = [] } = useQuery<Personnel[]>({\n    queryKey: [\"/api/personnel\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  // Dialog açıldığında ve editingTimesheet değiştiğinde formu initialize et\n  useEffect(() => {\n    if (open) {\n      if (editingTimesheet) {\n        setSelectedPersonnelIds([editingTimesheet.personnelId || \"\"]);\n        setWorkType(editingTimesheet.workType || \"tam\");\n        setCustomerId(editingTimesheet.customerId || \"\");\n        setDate(editingTimesheet.date ? new Date(editingTimesheet.date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0]);\n        setOvertimeHours(editingTimesheet.overtimeHours || \"0\");\n        setNotes(editingTimesheet.notes || \"\");\n      } else {\n        setSelectedPersonnelIds([]);\n        setWorkType(\"tam\");\n        setCustomerId(\"\");\n        setDate(new Date().toISOString().split('T')[0]);\n        setOvertimeHours(\"0\");\n        setNotes(\"\");\n      }\n      setShowPersonnelDropdown(false);\n    }\n  }, [open, editingTimesheet]);\n\n  const createTimesheetMutation = useMutation({\n    mutationFn: async () => {\n      if (editingTimesheet) {\n        // Edit mode\n        const data = {\n          personnelId: selectedPersonnelIds[0],\n          customerId,\n          date: new Date(date),\n          workType,\n          startTime: \"08:00\",\n          endTime: \"17:00\",\n          totalHours: workType === \"tam\" ? \"8.00\" : workType === \"yarim\" ? \"4.00\" : overtimeHours,\n          overtimeHours: workType === \"mesai\" ? overtimeHours : \"0.00\",\n          hourlyRate: \"0.00\",\n          dailyWage: \"0.00\",\n          notes,\n        };\n        const response = await apiRequest(`/api/timesheets/${editingTimesheet.id}`, \"PUT\", data);\n        return response.json();\n      } else {\n        // Multi-create mode\n        const promises = selectedPersonnelIds.map(async (personnelId) => {\n          try {\n            const personnelData = personnel.find(p => p.id === personnelId);\n            if (!personnelData) return { success: false, error: \"Personnel not found\" };\n            \n            const salary = parseFloat(personnelData.salary || \"0\");\n            const salaryType = personnelData.salaryType || \"monthly\";\n            const dailyWage = salaryType === \"daily\" ? salary : salary / 30;\n            \n            let totalHours = \"8.00\";\n            let calculatedWage = \"0.00\";\n            let hourlyRate = \"0.00\";\n            \n            switch (workType) {\n              case \"tam\":\n                totalHours = \"8.00\";\n                calculatedWage = dailyWage.toFixed(2);\n                hourlyRate = (dailyWage / 8).toFixed(2);\n                break;\n              case \"yarim\":\n                totalHours = \"4.00\";\n                calculatedWage = (dailyWage / 2).toFixed(2);\n                hourlyRate = (dailyWage / 8).toFixed(2);\n                break;\n              case \"mesai\":\n                totalHours = overtimeHours;\n                hourlyRate = (dailyWage / 8).toFixed(2);\n                calculatedWage = (parseFloat(hourlyRate) * parseFloat(overtimeHours)).toFixed(2);\n                break;\n            }\n            \n            const data = {\n              personnelId,\n              customerId,\n              date: new Date(date),\n              workType,\n              startTime: \"08:00\",\n              endTime: \"17:00\",\n              totalHours,\n              overtimeHours: workType === \"mesai\" ? overtimeHours : \"0.00\",\n              hourlyRate,\n              dailyWage: calculatedWage,\n              notes,\n            };\n            \n            const result = await apiRequest(\"/api/timesheets\", \"POST\", data);\n            return { success: true, data: result };\n          } catch (error) {\n            console.error(\"Timesheet creation error for personnel:\", personnelId, error);\n            return { success: false, error: error.message };\n          }\n        });\n        \n        const results = await Promise.allSettled(promises);\n        const successful = results.filter(r => r.status === 'fulfilled' && r.value.success).length;\n        const failed = results.length - successful;\n        \n        if (failed > 0 && successful === 0) {\n          throw new Error(\"Hiçbir puantaj kaydı oluşturulamadı\");\n        }\n        \n        return { successful, failed, total: results.length };\n      }\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timesheets\"] });\n      \n      if (editingTimesheet) {\n        toast({\n          title: \"Başarılı\",\n          description: \"Puantaj kaydı güncellendi.\",\n        });\n      } else {\n        // Handle batch creation results\n        if (data && typeof data === 'object' && 'successful' in data) {\n          const { successful, failed, total } = data;\n          if (successful > 0) {\n            toast({\n              title: \"Başarılı\",\n              description: failed > 0 \n                ? `${successful}/${total} puantaj kaydı oluşturuldu. ${failed} kayıt başarısız.`\n                : `${successful} puantaj kaydı oluşturuldu.`,\n            });\n          }\n        } else {\n          toast({\n            title: \"Başarılı\",\n            description: `${selectedPersonnelIds.length} personel için puantaj kaydı oluşturuldu.`,\n          });\n        }\n      }\n      \n      onOpenChange(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: editingTimesheet ? \"Puantaj kaydı güncellenemedi.\" : \"Puantaj kayıtları oluşturulamadı.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = () => {\n    // Validation\n    if (!editingTimesheet && selectedPersonnelIds.length === 0) {\n      toast({\n        title: \"Uyarı\",\n        description: \"Lütfen en az bir personel seçin.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!customerId) {\n      toast({\n        title: \"Uyarı\",\n        description: \"Lütfen müşteri seçin.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (workType === \"mesai\" && (!overtimeHours || parseFloat(overtimeHours) <= 0)) {\n      toast({\n        title: \"Uyarı\",\n        description: \"Mesai saati girmelisiniz.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createTimesheetMutation.mutate();\n  };\n  \n  const togglePersonnelSelection = (personnelId: string) => {\n    setSelectedPersonnelIds(prev => {\n      if (prev.includes(personnelId)) {\n        return prev.filter(id => id !== personnelId);\n      } else {\n        return [...prev, personnelId];\n      }\n    });\n  };\n  \n  const removePersonnel = (personnelId: string) => {\n    setSelectedPersonnelIds(prev => prev.filter(id => id !== personnelId));\n  };\n  \n  const selectedPersonnelList = personnel.filter(p => selectedPersonnelIds.includes(p.id));\n\n  return (\n    <Dialog \n      open={open} \n      onOpenChange={onOpenChange}\n    >\n      <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl font-semibold\">\n            {editingTimesheet ? \"Puantaj Düzenle\" : \"Puantaj Yaz\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {!editingTimesheet && (\n            <div className=\"space-y-3\">\n              <label className=\"text-gray-300 block\">Personel Seç</label>\n              \n              {/* Seçili Personeller */}\n              {selectedPersonnelList.length > 0 && (\n                <div className=\"space-y-2\">\n                  <div className=\"text-sm text-gray-400\">Seçili Personeller:</div>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {selectedPersonnelList.map((person) => (\n                      <Badge\n                        key={person.id}\n                        variant=\"secondary\"\n                        className=\"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-1\"\n                      >\n                        {person.name}\n                        <X \n                          className=\"h-3 w-3 cursor-pointer\" \n                          onClick={() => removePersonnel(person.id)}\n                        />\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Personel Listesi */}\n              <div className=\"space-y-1\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  className=\"w-full justify-start bg-dark-primary border-dark-accent text-white hover:bg-dark-accent\"\n                  onClick={() => setShowPersonnelDropdown(!showPersonnelDropdown)}\n                >\n                  {selectedPersonnelIds.length > 0 \n                    ? `${selectedPersonnelIds.length} personel seçildi` \n                    : \"Personel seçin\"}\n                </Button>\n                \n                {showPersonnelDropdown && (\n                  <ScrollArea className=\"h-40 w-full border border-dark-accent rounded-md bg-dark-primary\">\n                    <div className=\"p-2 space-y-1\">\n                      {personnel.map((person) => (\n                        <div\n                          key={person.id}\n                          className=\"flex items-center space-x-2 cursor-pointer hover:bg-dark-accent p-2 rounded\"\n                        >\n                          <Checkbox\n                            checked={selectedPersonnelIds.includes(person.id)}\n                            onCheckedChange={() => togglePersonnelSelection(person.id)}\n                            className=\"border-gray-400\"\n                          />\n                          <span \n                            className=\"text-white text-sm flex-1\"\n                            onClick={() => togglePersonnelSelection(person.id)}\n                          >\n                            {person.name}\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                )}\n              </div>\n            </div>\n          )}\n          \n          {editingTimesheet && (\n            <div className=\"space-y-2\">\n              <label className=\"text-gray-300 block\">Personel</label>\n              <Select value={selectedPersonnelIds[0] || \"\"} onValueChange={(value) => setSelectedPersonnelIds([value])}>\n                <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                  <SelectValue placeholder=\"Personel seçin\" />\n                </SelectTrigger>\n                <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                  {personnel.map((person) => (\n                    <SelectItem key={person.id} value={person.id} className=\"text-white\">\n                      {person.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <label className=\"text-gray-300 block\">Müşteri</label>\n            <Select value={customerId} onValueChange={setCustomerId}>\n              <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                <SelectValue placeholder=\"Müşteri seçin\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                {customers.map((customer) => (\n                  <SelectItem key={customer.id} value={customer.id} className=\"text-white\">\n                    {customer.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-gray-300 block\">Tarih</label>\n            <Input\n              type=\"date\"\n              className=\"bg-dark-primary border-dark-accent text-white\"\n              value={date}\n              onChange={(e) => setDate(e.target.value)}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-gray-300 block\">Çalışma Şekli</label>\n            <div className=\"flex gap-2\">\n              {[\"tam\", \"yarim\", \"mesai\"].map((type) => (\n                <Button\n                  key={type}\n                  type=\"button\"\n                  variant={workType === type ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  className={workType === type \n                    ? \"bg-blue-600 hover:bg-blue-700 text-white\"\n                    : \"bg-dark-primary border-dark-accent text-white hover:bg-dark-accent\"\n                  }\n                  onClick={() => setWorkType(type)}\n                >\n                  {type === \"tam\" ? \"TAM\" : type === \"yarim\" ? \"YARIM\" : \"MESAİ\"}\n                </Button>\n              ))}\n            </div>\n          </div>\n\n          {(editingTimesheet || workType === \"mesai\") && (\n            <div className=\"space-y-2\">\n              <label className=\"text-gray-300 block\">Mesai Saati</label>\n              <Select value={overtimeHours} onValueChange={setOvertimeHours}>\n                <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                  <SelectValue placeholder=\"Mesai saati seçin\" />\n                </SelectTrigger>\n                <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                  <SelectItem value=\"0.50\" className=\"text-white\">0.5 saat</SelectItem>\n                  <SelectItem value=\"1.00\" className=\"text-white\">1 saat</SelectItem>\n                  <SelectItem value=\"1.50\" className=\"text-white\">1.5 saat</SelectItem>\n                  <SelectItem value=\"2.00\" className=\"text-white\">2 saat</SelectItem>\n                  <SelectItem value=\"2.50\" className=\"text-white\">2.5 saat</SelectItem>\n                  <SelectItem value=\"3.00\" className=\"text-white\">3 saat</SelectItem>\n                  <SelectItem value=\"3.50\" className=\"text-white\">3.5 saat</SelectItem>\n                  <SelectItem value=\"4.00\" className=\"text-white\">4 saat</SelectItem>\n                  <SelectItem value=\"4.50\" className=\"text-white\">4.5 saat</SelectItem>\n                  <SelectItem value=\"5.00\" className=\"text-white\">5 saat</SelectItem>\n                  <SelectItem value=\"5.50\" className=\"text-white\">5.5 saat</SelectItem>\n                  <SelectItem value=\"6.00\" className=\"text-white\">6 saat</SelectItem>\n                  <SelectItem value=\"6.50\" className=\"text-white\">6.5 saat</SelectItem>\n                  <SelectItem value=\"7.00\" className=\"text-white\">7 saat</SelectItem>\n                  <SelectItem value=\"7.50\" className=\"text-white\">7.5 saat</SelectItem>\n                  <SelectItem value=\"8.00\" className=\"text-white\">8 saat</SelectItem>\n                  <SelectItem value=\"8.50\" className=\"text-white\">8.5 saat</SelectItem>\n                  <SelectItem value=\"9.00\" className=\"text-white\">9 saat</SelectItem>\n                  <SelectItem value=\"9.50\" className=\"text-white\">9.5 saat</SelectItem>\n                  <SelectItem value=\"10.00\" className=\"text-white\">10 saat</SelectItem>\n                  <SelectItem value=\"10.50\" className=\"text-white\">10.5 saat</SelectItem>\n                  <SelectItem value=\"11.00\" className=\"text-white\">11 saat</SelectItem>\n                  <SelectItem value=\"11.50\" className=\"text-white\">11.5 saat</SelectItem>\n                  <SelectItem value=\"12.00\" className=\"text-white\">12 saat</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <label className=\"text-gray-300 block\">Notlar</label>\n            <Textarea\n              placeholder=\"Ek notlar...\"\n              className=\"bg-dark-primary border-dark-accent text-white\"\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n            />\n          </div>\n\n          <div className=\"flex justify-end space-x-2 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n              className=\"border-dark-accent text-white hover:bg-dark-accent\"\n            >\n              İptal\n            </Button>\n            <Button\n              type=\"button\"\n              disabled={createTimesheetMutation.isPending}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n              onClick={handleSubmit}\n            >\n              {createTimesheetMutation.isPending \n                ? \"Kaydediliyor...\" \n                : editingTimesheet ? \"Güncelle\" : \"Kaydet\"}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":18479},"client/src/components/forms/transaction-form.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { insertTransactionSchema, type InsertTransaction } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\n\ninterface TransactionFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport default function TransactionForm({ open, onOpenChange }: TransactionFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<InsertTransaction>({\n    resolver: zodResolver(insertTransactionSchema),\n    defaultValues: {\n      type: \"income\",\n      amount: \"0\",\n      description: \"\",\n      category: \"\",\n      date: new Date(),\n    },\n  });\n\n  const createTransactionMutation = useMutation({\n    mutationFn: async (data: InsertTransaction) => {\n      const response = await apiRequest(\"/api/transactions\", \"POST\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"İşlem kaydı oluşturuldu.\",\n      });\n      form.reset();\n      onOpenChange(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"İşlem kaydı oluşturulamadı.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertTransaction) => {\n    console.log(\"Submitting transaction data:\", data);\n    createTransactionMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl font-semibold\">Kasa Yönetimi</DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"type\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">İşlem Türü</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                        <SelectValue />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                      <SelectItem value=\"income\" className=\"text-white\">Gelir</SelectItem>\n                      <SelectItem value=\"expense\" className=\"text-white\">Gider</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"amount\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Tutar</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"0.00\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Açıklama</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"İşlem açıklaması\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"category\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Kategori</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"İşlem kategorisi\"\n                      value={field.value || \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex gap-3\">\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white\"\n                onClick={() => onOpenChange(false)}\n              >\n                İptal\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white\"\n                disabled={createTransactionMutation.isPending}\n              >\n                {createTransactionMutation.isPending ? \"Kaydediliyor...\" : \"Kaydet\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":6328},"client/src/components/layout/header.tsx":{"content":"import React from \"react\";\nimport { Menu, Settings, LogOut, User, Shield, UserCircle, Bell } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface HeaderProps {\n  onMenuClick?: () => void;\n  onSettingsClick?: () => void;\n}\n\nexport default function Header({ onMenuClick, onSettingsClick }: HeaderProps) {\n  const { user, isLoading: authLoading, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n\n  // Fetch notifications for authenticated users\n  const { data: notifications = [], error: notificationError, isLoading: notificationsLoading } = useQuery({\n    queryKey: [\"/api/notifications\"],\n    enabled: !authLoading && isAuthenticated && !!user,\n    refetchInterval: (!authLoading && isAuthenticated && user) ? 3000 : false,\n    retry: false,\n  });\n\n  // Debug notification query status\n  console.log(\"🔔 Notification query debug:\", {\n    authLoading,\n    isAuthenticated, \n    user: !!user,\n    enabled: !authLoading && isAuthenticated && !!user,\n    notificationError: notificationError?.message,\n    notificationsLoading\n  });\n\n  // Gerçek API verilerini kullan - fallback test verileri kaldırıldı\n  const finalNotifications = Array.isArray(notifications) ? notifications : [];\n  const unreadCount = finalNotifications?.filter((n: any) => !n.isRead)?.length || 0;\n\n  // Debug bilgileri temizlendi - sadece önemli log'lar\n  if (finalNotifications.length > 0) {\n    console.log(`🔔 ${finalNotifications.length} bildirim var, ${unreadCount} okunmamış`);\n  }\n  \n  // Force check notifications immediately when user changes\n  React.useEffect(() => {\n    if (user) {\n      console.log(\"🔔 User changed, user ID:\", user.id);\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    }\n  }, [user]);\n\n  const handleLogout = () => {\n    localStorage.clear();\n    window.location.href = \"/\";\n  };\n\n  const handleNotificationClick = async (notification: any) => {\n    // Mark as read\n    try {\n      await apiRequest(`/api/notifications/${notification.id}/read`, \"PATCH\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    } catch (error) {\n      console.error(\"Error marking notification as read:\", error);\n    }\n\n    // Handle navigation based on notification type\n    if (notification.type === 'NEW_MESSAGE' || notification.type === 'NEW_DM') {\n      const payload = notification.payload;\n      console.log(\"🔔 Navigation - payload:\", payload);\n      if (payload?.fromCompanyId) {\n        console.log(\"🔔 Navigating to company directory with thread:\", payload.fromCompanyId);\n        setLocation(`/enhanced-company-directory?activeThread=${payload.fromCompanyId}`);\n      }\n    }\n  };\n\n  return (\n    <header className=\"flex justify-between items-center p-4 bg-gray-100 dark:bg-dark-primary border-b border-gray-200 dark:border-dark-accent\">\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        className=\"text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-dark-accent\"\n        onClick={onMenuClick}\n      >\n        <Menu className=\"h-6 w-6\" />\n      </Button>\n      \n      <h1 className=\"text-xl font-bold text-gray-800 dark:text-white\">puantropls</h1>\n      \n      <div className=\"flex items-center gap-2\">\n        {user && (\n          <div className=\"flex items-center gap-2 text-gray-700 dark:text-white text-sm\">\n            <User className=\"h-4 w-4\" />\n            <span>{String((user as any).firstName || (user as any).email || \"Kullanıcı\")}</span>\n            <span className={`px-2 py-1 rounded text-xs font-semibold ${\n              (user as any).subscriptionType === 'PRO' \n                ? 'bg-green-500 text-white' \n                : 'bg-blue-500 text-white'\n            }`}>\n              {(user as any).subscriptionType || 'DEMO'}\n            </span>\n          </div>\n        )}\n        \n        {/* Account Button - for all authenticated users */}\n        {user && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-blue-400 hover:bg-dark-accent\"\n            onClick={() => window.location.href = \"/account\"}\n            title=\"Hesabım\"\n          >\n            <UserCircle className=\"h-6 w-6\" />\n          </Button>\n        )}\n        \n        {/* Admin Panel Button - only for admins */}\n        {user && (user as any).isAdmin && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-purple-400 hover:bg-dark-accent\"\n            onClick={() => window.location.href = \"/admin\"}\n            title=\"Admin Panel\"\n          >\n            <Shield className=\"h-6 w-6\" />\n          </Button>\n        )}\n\n        {/* Notifications */}\n        {user && (\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"text-white hover:bg-dark-accent relative\"\n                title={`Bildirimler (${unreadCount} okunmamış)`}\n              >\n                <Bell className=\"h-6 w-6\" />\n                {unreadCount > 0 && (\n                  <Badge \n                    variant=\"destructive\" \n                    className=\"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center text-xs\"\n                  >\n                    {unreadCount > 9 ? '9+' : unreadCount}\n                  </Badge>\n                )}\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-80 bg-dark-secondary border-dark-accent\">\n              <div className=\"p-3 border-b border-dark-accent\">\n                <h3 className=\"font-semibold text-white\">Bildirimler</h3>\n                {unreadCount > 0 && (\n                  <p className=\"text-sm text-gray-400\">{unreadCount} okunmamış bildirim</p>\n                )}\n              </div>\n              \n              {finalNotifications && finalNotifications.length > 0 ? (\n                <div className=\"max-h-96 overflow-y-auto\">\n                  {finalNotifications.slice(0, 10).map((notification: any) => (\n                    <DropdownMenuItem\n                      key={notification.id}\n                      className=\"p-3 cursor-pointer hover:bg-dark-accent border-b border-dark-accent last:border-b-0\"\n                      onClick={() => handleNotificationClick(notification)}\n                    >\n                      <div className=\"flex items-start gap-3 w-full\">\n                        <div className={`w-2 h-2 rounded-full mt-2 ${\n                          notification.isRead ? 'bg-gray-500' : 'bg-blue-500'\n                        }`} />\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-white text-sm font-medium truncate\">\n                            {notification.type === 'NEW_MESSAGE' ? 'Yeni Mesaj' : notification.title}\n                          </p>\n                          <p className=\"text-gray-400 text-xs truncate\">\n                            {notification.type === 'NEW_MESSAGE' \n                              ? `${notification.payload?.fromCompanyName || 'Bilinmeyen'} size mesaj gönderdi`\n                              : notification.content\n                            }\n                          </p>\n                          <p className=\"text-gray-500 text-xs\">\n                            {new Date(notification.createdAt).toLocaleString('tr-TR')}\n                          </p>\n                        </div>\n                      </div>\n                    </DropdownMenuItem>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"p-6 text-center\">\n                  <Bell className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\n                  <p className=\"text-gray-400 text-sm\">Henüz bildirim yok</p>\n                </div>\n              )}\n              \n              {finalNotifications && finalNotifications.length > 10 && (\n                <div className=\"p-3 border-t border-dark-accent\">\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full text-blue-400 hover:bg-dark-accent\"\n                    onClick={() => setLocation(\"/notifications\")}\n                  >\n                    Tüm bildirimleri görüntüle\n                  </Button>\n                </div>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        )}\n        \n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"text-white hover:bg-dark-accent\"\n          onClick={onSettingsClick}\n        >\n          <Settings className=\"h-6 w-6\" />\n        </Button>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"text-white hover:bg-dark-accent\"\n          onClick={handleLogout}\n          title=\"Çıkış Yap\"\n        >\n          <LogOut className=\"h-6 w-6\" />\n        </Button>\n      </div>\n    </header>\n  );\n}\n","size_bytes":9401},"client/src/components/layout/navigation.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { \n  Home, \n  Users, \n  Building, \n  CalendarDays, \n  Wallet, \n  UserCheck,\n  FileBarChart,\n  Settings \n} from \"lucide-react\";\n\ninterface NavigationItem {\n  path: string;\n  label: string;\n  icon: any;\n  color: string;\n}\n\nconst navigationItems: NavigationItem[] = [\n  { path: \"/\", label: \"Ana Sayfa\", icon: Home, color: \"text-blue-400\" },\n  { path: \"/personnel\", label: \"Personel\", icon: Users, color: \"text-green-400\" },\n  { path: \"/projects\", label: \"Projeler\", icon: Building, color: \"text-purple-400\" },\n  { path: \"/timesheet\", label: \"Puantaj\", icon: CalendarDays, color: \"text-cyan-400\" },\n  { path: \"/finances\", label: \"Finans\", icon: Wallet, color: \"text-yellow-400\" },\n  { path: \"/customers\", label: \"Müşteriler\", icon: UserCheck, color: \"text-orange-400\" },\n  { path: \"/reports\", label: \"Raporlar\", icon: FileBarChart, color: \"text-pink-400\" },\n];\n\nexport default function Navigation() {\n  const [location, setLocation] = useLocation();\n\n  return (\n    <Card className=\"bg-dark-secondary border-dark-accent mb-6\">\n      <CardContent className=\"p-4\">\n        <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3\">\n          {navigationItems.map((item) => {\n            const IconComponent = item.icon;\n            const isActive = location === item.path;\n            \n            return (\n              <Button\n                key={item.path}\n                variant={isActive ? \"default\" : \"ghost\"}\n                className={`flex flex-col items-center gap-2 h-auto py-3 px-2 ${\n                  isActive \n                    ? \"bg-blue-500 hover:bg-blue-600 text-white\" \n                    : \"hover:bg-dark-accent text-gray-300 hover:text-white\"\n                }`}\n                onClick={() => setLocation(item.path)}\n              >\n                <IconComponent className={`h-5 w-5 ${isActive ? \"text-white\" : item.color}`} />\n                <span className=\"text-xs font-medium\">{item.label}</span>\n              </Button>\n            );\n          })}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":2197},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }","size_bytes":1127},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst COLORS = {\n  primary: \"hsl(var(--primary))\",\n  secondary: \"hsl(var(--secondary))\",\n  accent: \"hsl(var(--accent))\",\n  muted: \"hsl(var(--muted))\",\n  destructive: \"hsl(var(--destructive))\",\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"w-full h-[300px]\", className)}\n    {...props}\n  />\n))\nChartContainer.displayName = \"ChartContainer\"\n\nexport { ChartContainer, COLORS }","size_bytes":571},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}","size_bytes":3855},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }","size_bytes":776},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }","size_bytes":1138},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}","size_bytes":2764},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }","size_bytes":1882},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }","size_bytes":770},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/pages/personnel-detail.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { ArrowLeft, User, Clock, CreditCard, Banknote, Plus, Calendar, Edit, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport PersonnelPaymentForm from \"@/components/forms/personnel-payment-form\";\nimport TimesheetForm from \"@/components/forms/timesheet-form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Personnel, Timesheet, PersonnelPayment, Transaction } from \"@shared/schema\";\n\nexport default function PersonnelDetailPage() {\n  const [, setLocation] = useLocation();\n  const [match, params] = useRoute(\"/personnel/:id\");\n  const personnelId = params?.id || \"\";\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [showPaymentForm, setShowPaymentForm] = useState(false);\n  const [selectedPayment, setSelectedPayment] = useState<PersonnelPayment | undefined>();\n  const [editingTimesheet, setEditingTimesheet] = useState<Timesheet | null>(null);\n\n  // Queries\n  const { data: personnel } = useQuery<Personnel[]>({\n    queryKey: ['/api/personnel'],\n  });\n\n  const { data: timesheets = [] } = useQuery<Timesheet[]>({\n    queryKey: ['/api/timesheets'],\n  });\n\n  const { data: payments = [] } = useQuery<PersonnelPayment[]>({\n    queryKey: ['/api/personnel-payments'],\n  });\n\n  const { data: transactions = [] } = useQuery<Transaction[]>({\n    queryKey: ['/api/transactions'],\n  });\n\n  // Delete timesheet mutation\n  const deleteTimesheetMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await fetch(`/api/timesheets/${id}`, { \n        method: 'DELETE' \n      });\n      if (!response.ok) throw new Error('Silme işlemi başarısız');\n      return response.status === 204 ? null : response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/timesheets'] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Puantaj kaydı başarıyla silindi.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Puantaj kaydı silinirken bir hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const person = personnel?.find(p => p.id === personnelId);\n  const personTimesheets = timesheets.filter(ts => ts.personnelId === personnelId);\n  const personPayments = payments.filter(p => p.personnelId === personnelId);\n\n  // Calculations\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString('tr-TR');\n  };\n\n  const formatSalary = (amount: number) => {\n    return `₺${amount.toLocaleString('tr-TR')}`;\n  };\n\n  const calculateDailyWage = (monthlySalary: string | null, salaryType?: string) => {\n    if (!monthlySalary) return formatSalary(0);\n    if (salaryType === \"daily\") {\n      return formatSalary(parseFloat(monthlySalary));\n    }\n    return formatSalary(Math.round(parseFloat(monthlySalary) / 30));\n  };\n\n  const calculateEarnings = () => {\n    let earnings = 0;\n    \n    personTimesheets.forEach(ts => {\n      // Backend'den gelen dailyWage değerini kullan\n      const dailyWage = parseFloat(ts.dailyWage || \"0\");\n      earnings += dailyWage;\n    });\n    \n    return earnings;\n  };\n\n  const calculatePayments = () => {\n    return personPayments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0);\n  };\n\n  const totalEarnings = calculateEarnings();\n  const totalPayments = calculatePayments();\n  const remainingDebt = totalEarnings - totalPayments;\n\n  if (!person) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n            onClick={() => setLocation(\"/personnel\")}\n          >\n            <ArrowLeft className=\"h-6 w-6\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Personel Bulunamadı</h1>\n        </div>\n        <Card className=\"bg-dark-secondary border-dark-accent\">\n          <CardContent className=\"py-12 text-center\">\n            <User className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <p className=\"text-gray-400 text-lg\">Bu personel bulunamadı.</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n          onClick={() => setLocation(\"/personnel\")}\n        >\n          <ArrowLeft className=\"h-6 w-6\" />\n        </Button>\n        <h1 className=\"text-2xl font-bold\">{person.name}</h1>\n      </div>\n\n      {/* Personnel Info Card */}\n      <Card className=\"bg-dark-secondary border-dark-accent mb-6\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-start gap-4\">\n            <div className=\"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0\">\n              <User className=\"h-8 w-8 text-white\" />\n            </div>\n            <div className=\"flex-1\">\n              <h2 className=\"text-white font-semibold text-xl mb-1\">{person.name}</h2>\n              <p className=\"text-gray-400 mb-2\">{person.position}</p>\n              <p className=\"text-gray-400 text-sm mb-4\">\n                Başlangıç: {formatDate(typeof person.startDate === 'string' ? person.startDate : person.startDate.toISOString())}\n              </p>\n              \n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div>\n                  <p className=\"text-gray-500 text-sm\">\n                    {person.salaryType === \"daily\" ? \"Günlük\" : \"Maaş\"}\n                  </p>\n                  <p className=\"text-white font-medium\">{person.salary ? formatSalary(parseFloat(person.salary)) : \"₺0\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 text-sm\">\n                    {person.salaryType === \"daily\" ? \"Günlük\" : \"Yevmiye\"}\n                  </p>\n                  <p className=\"text-blue-400 font-medium\">{calculateDailyWage(person.salary, person.salaryType || undefined)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 text-sm\">Toplam Hakediş</p>\n                  <p className=\"text-green-400 font-medium\">{formatSalary(totalEarnings)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 text-sm\">Kalan Borç</p>\n                  <p className={`font-medium ${remainingDebt > 0 ? 'text-red-400' : 'text-gray-400'}`}>\n                    {formatSalary(remainingDebt)}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Tabs */}\n      <Tabs defaultValue=\"puantaj\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3 bg-dark-secondary border-dark-accent\">\n          <TabsTrigger \n            value=\"puantaj\"\n            className=\"data-[state=active]:bg-blue-500 data-[state=active]:text-white text-gray-400\"\n          >\n            <Clock className=\"h-4 w-4 mr-2\" />\n            Puantaj\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"hakedis\"\n            className=\"data-[state=active]:bg-green-500 data-[state=active]:text-white text-gray-400\"\n          >\n            <CreditCard className=\"h-4 w-4 mr-2\" />\n            Hakediş\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"odeme\"\n            className=\"data-[state=active]:bg-purple-500 data-[state=active]:text-white text-gray-400\"\n          >\n            <Banknote className=\"h-4 w-4 mr-2\" />\n            Ödeme\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Puantaj Tab */}\n        <TabsContent value=\"puantaj\" className=\"mt-6\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <Calendar className=\"h-5 w-5 text-blue-400\" />\n                <h3 className=\"text-white font-medium text-lg\">Puantaj Kayıtları</h3>\n              </div>\n              \n              {personTimesheets.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <Clock className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-400 text-lg mb-2\">Henüz puantaj kaydı yok</p>\n                  <p className=\"text-gray-500 text-sm\">Bu personel için henüz puantaj kaydı eklenmemiş.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {personTimesheets.map((timesheet) => (\n                    <Card key={timesheet.id} className=\"bg-dark-primary border-dark-accent\">\n                      <CardContent className=\"p-3\">\n                        <div className=\"flex justify-between items-start\">\n                          <div className=\"flex-1\">\n                            <p className=\"text-white font-medium\">{formatDate(typeof timesheet.date === 'string' ? timesheet.date : timesheet.date.toISOString())}</p>\n                            <p className=\"text-gray-400 text-sm\">\n                              {timesheet.workType} • {timesheet.totalHours} saat\n                              {timesheet.overtimeHours && parseFloat(timesheet.overtimeHours) > 0 && ` • ${timesheet.overtimeHours} mesai`}\n                            </p>\n                            <p className=\"text-green-400 text-sm font-medium\">\n                              {timesheet.workType === 'tam' && `TAM Günlük: ${formatSalary(parseFloat(timesheet.dailyWage || \"0\"))}`}\n                              {timesheet.workType === 'yarim' && `YARIM Günlük: ${formatSalary(parseFloat(timesheet.dailyWage || \"0\"))}`}\n                              {timesheet.workType === 'mesai' && `Mesai Ücreti: ${formatSalary(parseFloat(timesheet.dailyWage || \"0\"))}`}\n                            </p>\n                            {timesheet.notes && (\n                              <p className=\"text-gray-500 text-sm mt-1\">{timesheet.notes}</p>\n                            )}\n                          </div>\n                          <div className=\"flex items-center gap-1 ml-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-6 px-2 text-xs border-dark-accent hover:bg-dark-accent text-gray-400 hover:text-white flex-shrink-0\"\n                              onClick={() => setEditingTimesheet(timesheet)}\n                            >\n                              <Edit className=\"h-3 w-3\" />\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-6 px-2 text-xs border-red-600 hover:bg-red-600 text-red-400 hover:text-white flex-shrink-0\"\n                              onClick={() => {\n                                if (confirm('Bu puantaj kaydını silmek istediğinizden emin misiniz?')) {\n                                  deleteTimesheetMutation.mutate(timesheet.id);\n                                }\n                              }}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Hakediş Tab */}\n        <TabsContent value=\"hakedis\" className=\"mt-6\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <CreditCard className=\"h-5 w-5 text-green-400\" />\n                <h3 className=\"text-white font-medium text-lg\">Hakediş Detayları</h3>\n              </div>\n              \n              <div className=\"space-y-3\">\n                <div className=\"p-4 bg-dark-primary border border-dark-accent rounded-lg\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-gray-400\">Toplam Çalışma Saati:</span>\n                    <span className=\"text-white font-medium\">\n                      {personTimesheets.reduce((sum, ts) => sum + parseFloat(ts.totalHours || \"0\"), 0)} saat\n                    </span>\n                  </div>\n                </div>\n                <div className=\"p-4 bg-dark-primary border border-dark-accent rounded-lg\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-gray-400\">Toplam Mesai Saati:</span>\n                    <span className=\"text-white font-medium\">\n                      {personTimesheets.reduce((sum, ts) => sum + parseFloat(ts.overtimeHours || \"0\"), 0)} saat\n                    </span>\n                  </div>\n                </div>\n                <div className=\"p-4 bg-green-500/10 border border-green-500/20 rounded-lg\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-green-400 font-medium\">Toplam Hakediş:</span>\n                    <span className=\"text-green-400 font-bold text-lg\">{formatSalary(totalEarnings)}</span>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Ödeme Tab */}\n        <TabsContent value=\"odeme\" className=\"mt-6\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Banknote className=\"h-5 w-5 text-purple-400\" />\n                  <h3 className=\"text-white font-medium text-lg\">Ödeme Geçmişi</h3>\n                </div>\n                <Button\n                  onClick={() => {\n                    setSelectedPayment(undefined);\n                    setShowPaymentForm(true);\n                  }}\n                  className=\"bg-purple-500 hover:bg-purple-600 text-white\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Ödeme Yap\n                </Button>\n              </div>\n              \n              {personPayments.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <Banknote className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-400 text-lg mb-2\">Henüz ödeme yapılmamış</p>\n                  <p className=\"text-gray-500 text-sm\">Bu personele henüz ödeme yapılmamış.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {personPayments.map((payment) => (\n                    <Card key={payment.id} className=\"bg-dark-primary border-dark-accent\">\n                      <CardContent className=\"p-3\">\n                        <div className=\"flex justify-between items-start\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <span className={`\n                                px-2 py-1 text-xs rounded-full font-medium\n                                ${payment.paymentType === 'salary' ? 'bg-blue-500/20 text-blue-400' : ''}\n                                ${payment.paymentType === 'bonus' ? 'bg-green-500/20 text-green-400' : ''}\n                                ${payment.paymentType === 'advance' ? 'bg-yellow-500/20 text-yellow-400' : ''}\n                                ${payment.paymentType === 'deduction' ? 'bg-red-500/20 text-red-400' : ''}\n                              `}>\n                                {payment.paymentType === 'salary' ? 'Maaş' : ''}\n                                {payment.paymentType === 'bonus' ? 'İkramiye' : ''}\n                                {payment.paymentType === 'advance' ? 'Avans' : ''}\n                                {payment.paymentType === 'deduction' ? 'Kesinti' : ''}\n                              </span>\n                              <span className=\"text-white font-medium\">{formatSalary(parseFloat(payment.amount))}</span>\n                            </div>\n                            <p className=\"text-gray-400 text-sm\">{formatDate(typeof payment.paymentDate === 'string' ? payment.paymentDate : payment.paymentDate.toISOString())}</p>\n                            {payment.notes && (\n                              <p className=\"text-gray-500 text-sm mt-1\">{payment.notes}</p>\n                            )}\n                          </div>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-blue-400 hover:text-blue-300 hover:bg-dark-primary\"\n                            onClick={() => {\n                              setSelectedPayment(payment);\n                              setShowPaymentForm(true);\n                            }}\n                          >\n                            <Edit className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Payment Form */}\n      <PersonnelPaymentForm\n        open={showPaymentForm}\n        onOpenChange={(open) => {\n          setShowPaymentForm(open);\n          if (!open) {\n            setSelectedPayment(undefined);\n          }\n        }}\n        personnelId={personnelId}\n        personnelName={person.name}\n        payment={selectedPayment}\n      />\n\n      {/* Timesheet Edit Form */}\n      <TimesheetForm\n        open={!!editingTimesheet}\n        onOpenChange={(open) => {\n          if (!open) setEditingTimesheet(null);\n        }}\n        editingTimesheet={editingTimesheet}\n      />\n    </div>\n  );\n}","size_bytes":18690},"client/src/pages/project-detail.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { ArrowLeft, Building, CheckSquare, Banknote, User, Info, Plus, Edit, Trash2 } from \"lucide-react\";\nimport ContractorTaskForm from \"@/components/forms/contractor-task-form\";\nimport ContractorPaymentForm from \"@/components/forms/contractor-payment-form\";\nimport type { Project } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport Header from \"@/components/layout/header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nexport default function ProjectDetailPage() {\n  const [, setLocation] = useLocation();\n  const [match, params] = useRoute(\"/projects/:id\");\n  const projectId = params?.id || \"\";\n  const [taskFormOpen, setTaskFormOpen] = useState(false);\n  const [paymentFormOpen, setPaymentFormOpen] = useState(false);\n  const [editingTask, setEditingTask] = useState<any>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Queries\n  const { data: projects } = useQuery<Project[]>({\n    queryKey: ['/api/projects'],\n  });\n\n  const { data: contractorTasks = [] } = useQuery({\n    queryKey: ['/api/contractor-tasks/contractor/' + projectId],\n    enabled: !!projectId,\n  });\n\n  const { data: contractorPayments = [] } = useQuery({\n    queryKey: ['/api/contractor-payments/contractor/' + projectId],\n    enabled: !!projectId,\n  });\n\n  const project = projects?.find(p => p.id === projectId);\n\n  // Delete contractor task mutation\n  const deleteContractorTaskMutation = useMutation({\n    mutationFn: async (taskId: string) => {\n      await apiRequest(`/api/contractor-tasks/${taskId}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/contractor-tasks/contractor/${projectId}`] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Görev silindi.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Görev silinemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete contractor payment mutation\n  const deleteContractorPaymentMutation = useMutation({\n    mutationFn: async (paymentId: string) => {\n      await apiRequest(`/api/contractor-payments/${paymentId}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/contractor-payments/contractor/${projectId}`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Ödeme kaydı silindi ve ilgili kasa hareketi kaldırıldı.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Ödeme kaydı silinemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Helper functions\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString('tr-TR');\n  };\n\n  const formatCurrency = (amount: string) => {\n    return new Intl.NumberFormat('tr-TR', {\n      style: 'currency',\n      currency: 'TRY',\n      minimumFractionDigits: 2,\n    }).format(parseFloat(amount));\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"active\": return \"text-green-400\";\n      case \"passive\": return \"text-yellow-400\";\n      case \"completed\": return \"text-blue-400\";\n      default: return \"text-gray-400\";\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case \"active\": return \"Aktif\";\n      case \"passive\": return \"Pasif\";\n      case \"completed\": return \"Tamamlandı\";\n      default: return status;\n    }\n  };\n\n  if (!project) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary text-white\">\n        <Header />\n        <div className=\"container mx-auto p-6\">\n          <div className=\"flex items-center gap-4 mb-6\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n              onClick={() => setLocation(\"/projects\")}\n            >\n              <ArrowLeft className=\"h-6 w-6\" />\n            </Button>\n            <h1 className=\"text-2xl font-bold\">Yüklenici Bulunamadı</h1>\n          </div>\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"py-12 text-center\">\n              <Building className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-400 text-lg\">Bu yüklenici bulunamadı.</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n            onClick={() => setLocation(\"/projects\")}\n          >\n            <ArrowLeft className=\"h-6 w-6\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">{project.name}</h1>\n        </div>\n\n        {/* Project Info Card */}\n        <Card className=\"bg-dark-secondary border-dark-accent mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0\">\n                <Building className=\"h-8 w-8 text-white\" />\n              </div>\n              <div className=\"flex-1\">\n                <h2 className=\"text-white font-semibold text-xl mb-1\">{project.name}</h2>\n                <p className=\"text-gray-400 mb-2\">{project.description || \"Yüklenici Firma\"}</p>\n                <p className=\"text-gray-400 text-sm mb-4\">\n                  Başlangıç: {formatDate(typeof project.startDate === 'string' ? project.startDate : project.startDate.toISOString())}\n                </p>\n                \n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div>\n                    <p className=\"text-gray-500 text-sm\">Durum</p>\n                    <p className={`font-medium ${getStatusColor(project.status)}`}>{getStatusText(project.status)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500 text-sm\">Toplam Tutar</p>\n                    <p className=\"text-green-400 font-medium\">\n                      {formatCurrency(contractorTasks.reduce((sum: number, task: any) => sum + parseFloat(task.amount), 0).toString())}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500 text-sm\">Yapılan Ödeme</p>\n                    <p className=\"text-blue-400 font-medium\">\n                      {formatCurrency(contractorPayments.reduce((sum: number, payment: any) => sum + parseFloat(payment.amount), 0).toString())}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500 text-sm\">Kalan Bakiye</p>\n                    <p className=\"text-red-400 font-medium\">\n                      {formatCurrency((contractorTasks.reduce((sum: number, task: any) => sum + parseFloat(task.amount), 0) - contractorPayments.reduce((sum: number, payment: any) => sum + parseFloat(payment.amount), 0)).toString())}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Tabs */}\n        <Tabs defaultValue=\"yapilacaklar\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3 bg-dark-secondary border-dark-accent\">\n            <TabsTrigger \n              value=\"yapilacaklar\"\n              className=\"data-[state=active]:bg-blue-500 data-[state=active]:text-white text-gray-400\"\n            >\n              <CheckSquare className=\"h-4 w-4 mr-2\" />\n              Yapılacak İşler\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"odemeler\"\n              className=\"data-[state=active]:bg-green-500 data-[state=active]:text-white text-gray-400\"\n            >\n              <Banknote className=\"h-4 w-4 mr-2\" />\n              Ödemeler\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"bilgiler\"\n              className=\"data-[state=active]:bg-purple-500 data-[state=active]:text-white text-gray-400\"\n            >\n              <Info className=\"h-4 w-4 mr-2\" />\n              Yüklenici Bilgileri\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Yapılacak İşler Tab */}\n          <TabsContent value=\"yapilacaklar\" className=\"mt-6\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <CheckSquare className=\"h-5 w-5 text-blue-400\" />\n                    <h3 className=\"text-white font-medium text-lg\">Yapılacak İşler</h3>\n                  </div>\n                  <Button\n                    className=\"bg-blue-500 hover:bg-blue-600 text-white\"\n                    onClick={() => setTaskFormOpen(true)}\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Görev Ekle\n                  </Button>\n                </div>\n                \n                {contractorTasks.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <CheckSquare className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-400 text-lg mb-2\">Henüz iş tanımlanmamış</p>\n                    <p className=\"text-gray-500 text-sm\">Bu proje için henüz yapılacak iş listesi oluşturulmamış.</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {contractorTasks.map((task: any) => (\n                      <div key={task.id} className=\"bg-dark-primary p-4 rounded-lg border border-dark-accent\">\n                        <div className=\"flex justify-between items-start mb-2\">\n                          <h4 className=\"text-white font-medium\">{task.title}</h4>\n                          <div className=\"flex items-center gap-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-6 px-2 text-xs border-dark-accent hover:bg-dark-accent text-gray-400 hover:text-white\"\n                              onClick={() => setEditingTask(task)}\n                            >\n                              <Edit className=\"h-3 w-3\" />\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-6 px-2 text-xs border-red-500/20 hover:bg-red-500/20 text-red-400 hover:text-red-300\"\n                              onClick={() => deleteContractorTaskMutation.mutate(task.id)}\n                              disabled={deleteContractorTaskMutation.isPending}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                            <span className={`px-2 py-1 rounded text-xs ${\n                              task.status === 'completed' ? 'bg-green-500/20 text-green-400' :\n                              task.status === 'in_progress' ? 'bg-blue-500/20 text-blue-400' :\n                              'bg-yellow-500/20 text-yellow-400'\n                            }`}>\n                              {task.status === 'completed' ? 'Tamamlandı' :\n                               task.status === 'in_progress' ? 'Devam Ediyor' : 'Bekliyor'}\n                            </span>\n                          </div>\n                        </div>\n                        {task.description && (\n                          <p className=\"text-gray-400 text-sm mb-2\">{task.description}</p>\n                        )}\n                        <div className=\"flex justify-between items-center text-sm text-gray-500\">\n                          <span>Tutar: {formatCurrency(task.amount)}</span>\n                          {task.dueDate && (\n                            <span>Teslim: {formatDate(task.dueDate)}</span>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Ödemeler Tab */}\n          <TabsContent value=\"odemeler\" className=\"mt-6\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Banknote className=\"h-5 w-5 text-green-400\" />\n                    <h3 className=\"text-white font-medium text-lg\">Ödeme Geçmişi</h3>\n                  </div>\n                  <Button\n                    className=\"bg-green-500 hover:bg-green-600 text-white\"\n                    onClick={() => setPaymentFormOpen(true)}\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Ödeme Yap\n                  </Button>\n                </div>\n                \n                {contractorPayments.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <Banknote className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-400 text-lg mb-2\">Henüz ödeme yapılmamış</p>\n                    <p className=\"text-gray-500 text-sm\">Bu yükleniciye henüz ödeme yapılmamış.</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {contractorPayments.map((payment: any) => (\n                      <div key={payment.id} className=\"bg-dark-primary p-4 rounded-lg border border-dark-accent\">\n                        <div className=\"flex justify-between items-start mb-2\">\n                          <h4 className=\"text-white font-medium\">{formatCurrency(payment.amount)}</h4>\n                          <div className=\"flex items-center gap-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-6 px-2 text-xs border-red-500/20 hover:bg-red-500/20 text-red-400 hover:text-red-300\"\n                              onClick={() => deleteContractorPaymentMutation.mutate(payment.id)}\n                              disabled={deleteContractorPaymentMutation.isPending}\n                              title=\"Ödeme kaydını sil\"\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                            <span className=\"px-2 py-1 rounded text-xs bg-green-500/20 text-green-400\">\n                              {payment.paymentMethod === 'cash' ? 'Nakit' :\n                               payment.paymentMethod === 'bank_transfer' ? 'Banka Havalesi' :\n                               payment.paymentMethod === 'check' ? 'Çek' : 'Diğer'}\n                            </span>\n                          </div>\n                        </div>\n                        {payment.description && (\n                          <p className=\"text-gray-400 text-sm mb-2\">{payment.description}</p>\n                        )}\n                        <div className=\"text-sm text-gray-500\">\n                          <span>Ödeme Tarihi: {formatDate(payment.paymentDate)}</span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Yüklenici Bilgileri Tab */}\n          <TabsContent value=\"bilgiler\" className=\"mt-6\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Info className=\"h-5 w-5 text-purple-400\" />\n                    <h3 className=\"text-white font-medium text-lg\">Yüklenici Bilgileri</h3>\n                  </div>\n                  <Button\n                    className=\"bg-purple-500 hover:bg-purple-600 text-white\"\n                    onClick={() => {}}\n                  >\n                    <User className=\"h-4 w-4 mr-2\" />\n                    Bilgileri Düzenle\n                  </Button>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"p-4 bg-dark-primary border border-dark-accent rounded-lg\">\n                      <p className=\"text-gray-400 text-sm mb-1\">Yüklenici Adı</p>\n                      <p className=\"text-white font-medium\">{project.name}</p>\n                    </div>\n                    \n                    <div className=\"p-4 bg-dark-primary border border-dark-accent rounded-lg\">\n                      <p className=\"text-gray-400 text-sm mb-1\">Firma</p>\n                      <p className=\"text-white font-medium\">{project.description || \"Belirtilmemiş\"}</p>\n                    </div>\n                    \n                    <div className=\"p-4 bg-dark-primary border border-dark-accent rounded-lg\">\n                      <p className=\"text-gray-400 text-sm mb-1\">Telefon</p>\n                      <p className=\"text-white font-medium\">Belirtilmemiş</p>\n                    </div>\n                    \n                    <div className=\"p-4 bg-dark-primary border border-dark-accent rounded-lg\">\n                      <p className=\"text-gray-400 text-sm mb-1\">E-posta</p>\n                      <p className=\"text-white font-medium\">Belirtilmemiş</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-dark-primary border border-dark-accent rounded-lg\">\n                    <p className=\"text-gray-400 text-sm mb-1\">Proje Detayları</p>\n                    <p className=\"text-white\">\n                      Bu yüklenici {formatDate(typeof project.startDate === 'string' ? project.startDate : project.startDate.toISOString())} tarihinde işe başlamıştır. \n                      Proje durumu: {getStatusText(project.status).toLowerCase()}.\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n      \n      {/* Forms */}\n      <ContractorTaskForm\n        contractorId={projectId}\n        open={taskFormOpen || !!editingTask}\n        onOpenChange={(open) => {\n          setTaskFormOpen(open);\n          if (!open) setEditingTask(null);\n        }}\n        editingTask={editingTask}\n      />\n      \n      <ContractorPaymentForm\n        contractorId={projectId}\n        open={paymentFormOpen}\n        onOpenChange={setPaymentFormOpen}\n      />\n    </div>\n  );\n}","size_bytes":19743},"client/src/pages/customer-detail.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { ArrowLeft, Building2, Phone, Mail, MapPin, CreditCard, Calendar, DollarSign, FileText, Plus, CheckCircle, Clock, Circle, Edit, Trash2, X, Download, FileSpreadsheet, Calculator, ChevronDown } from \"lucide-react\";\nimport { type Customer, type CustomerTask, type CustomerQuote, type CustomerQuoteItem, type CustomerPayment, insertCustomerTaskSchema, insertCustomerQuoteSchema, insertCustomerPaymentSchema, type InsertCustomerTask, type InsertCustomerQuote, type InsertCustomerPayment } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport Header from \"@/components/layout/header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\n\n// Helper function\nconst formatCurrency = (amount: string | number): string => {\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n  return new Intl.NumberFormat('tr-TR', {\n    style: 'currency',\n    currency: 'TRY',\n    minimumFractionDigits: 2\n  }).format(numAmount);\n};\n\n// Quote Items Component\nfunction QuoteItemsSection({ quoteId }: { quoteId: string }) {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  \n  const { data: quoteItems = [] } = useQuery<CustomerQuoteItem[]>({\n    queryKey: [\"/api/customer-quote-items/quote\", quoteId],\n  });\n\n  const { data: quotes = [] } = useQuery<CustomerQuote[]>({\n    queryKey: [\"/api/customer-quotes\"],\n  });\n\n  const currentQuote = quotes.find(q => q.id === quoteId);\n\n  const updateQuoteItemMutation = useMutation({\n    mutationFn: ({ id, data }: { id: string; data: { isApproved: boolean; status: string } }) => \n      apiRequest(`/api/customer-quote-items/${id}`, \"PUT\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-quote-items\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({ title: \"Başarılı\", description: \"Kalem durumu güncellendi\" });\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Kalem durumu güncellenemedi\", variant: \"destructive\" });\n    },\n  });\n\n  if (!quoteItems.length) {\n    return null;\n  }\n\n  return (\n    <div className=\"mt-4 border-t border-dark-accent pt-4\">\n      <h5 className=\"text-white font-medium mb-3\">Teklif Kalemleri</h5>\n      {quoteItems.map((item) => (\n        <div key={item.id} className=\"bg-dark-primary rounded-lg p-3 mb-2 border border-dark-accent\">\n          <div className=\"flex justify-between items-start\">\n            <div className=\"flex-1\">\n              <h6 className=\"text-white font-medium\">{item.title}</h6>\n              {item.description && (\n                <p className=\"text-gray-400 text-sm mt-1\">{item.description}</p>\n              )}\n              <div className=\"flex items-center gap-4 mt-2 text-sm\">\n                <span className=\"text-gray-300\">\n                  {parseFloat(item.quantity).toFixed(1)} {item.unit}\n                </span>\n                <span className=\"text-gray-300\">\n                  {formatCurrency(item.unitPrice.toString())} / {item.unit}\n                </span>\n                <span className=\"text-orange-400 font-medium\">\n                  Toplam: {formatCurrency(item.totalPrice.toString())}\n                </span>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2 ml-4\">\n              <span className={`px-2 py-1 rounded text-xs ${\n                item.status === 'approved' ? 'bg-green-500/20 text-green-400' :\n                item.status === 'rejected' ? 'bg-red-500/20 text-red-400' :\n                'bg-yellow-500/20 text-yellow-400'\n              }`}>\n                {item.status === 'approved' ? 'Onaylandı' :\n                 item.status === 'rejected' ? 'Reddedildi' : 'Beklemede'}\n              </span>\n              \n              {item.status === 'pending' && (\n                <div className=\"flex gap-1\">\n                  <Button\n                    size=\"sm\"\n                    className=\"h-7 px-2 text-xs bg-green-500 hover:bg-green-600\"\n                    onClick={() => updateQuoteItemMutation.mutate({ \n                      id: item.id, \n                      data: { isApproved: true, status: 'approved' } \n                    })}\n                    disabled={updateQuoteItemMutation.isPending}\n                  >\n                    <CheckCircle className=\"h-3 w-3\" />\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"h-7 px-2 text-xs border-red-500/20 hover:bg-red-500/20 text-red-400\"\n                    onClick={() => updateQuoteItemMutation.mutate({ \n                      id: item.id, \n                      data: { isApproved: false, status: 'rejected' } \n                    })}\n                    disabled={updateQuoteItemMutation.isPending}\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      ))}\n      \n      {/* Toplam Teklif Tutarı */}\n      {currentQuote && (\n        <div className=\"mt-4 pt-4 border-t border-dark-accent\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-white font-medium\">Toplam Teklif Tutarı:</span>\n            <span className=\"text-2xl font-bold text-orange-400\">\n              {formatCurrency(currentQuote.totalWithVAT || currentQuote.totalAmount)}\n            </span>\n          </div>\n          {currentQuote.hasVAT && (\n            <div className=\"text-sm text-gray-400 mt-1\">\n              <div className=\"flex justify-between\">\n                <span>Ara Toplam:</span>\n                <span>{formatCurrency(currentQuote.totalAmount)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>KDV (%{currentQuote.vatRate}):</span>\n                <span>{formatCurrency(currentQuote.vatAmount || \"0\")}</span>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function CustomerDetailPage() {\n  const [, setLocation] = useLocation();\n  const [, params] = useRoute(\"/customers/:customerName\");\n  const customerName = params?.customerName ? decodeURIComponent(params.customerName) : \"\";\n  const [showTaskForm, setShowTaskForm] = useState(false);\n  const [showQuoteForm, setShowQuoteForm] = useState(false);\n  const [showPaymentForm, setShowPaymentForm] = useState(false);\n  const [editingTask, setEditingTask] = useState<CustomerTask | null>(null);\n  const [editingQuote, setEditingQuote] = useState<CustomerQuote | null>(null);\n  \n  // Quote items state\n  const [quoteItems, setQuoteItems] = useState<Array<{\n    id: string;\n    title: string;\n    description: string;\n    quantity: number;\n    unitPrice: number;\n    totalPrice: number;\n    unit: string;\n  }>>([]);\n  const [currentItem, setCurrentItem] = useState({\n    title: \"\",\n    description: \"\",\n    quantity: 1.0,\n    unitPrice: 0,\n    unit: \"adet\"\n  });\n\n  // KDV State for quotes\n  const [hasVAT, setHasVAT] = useState(false);\n  const [vatRate, setVatRate] = useState(20); // %20 KDV\n  \n  // KDV State for tasks\n  const [taskHasVAT, setTaskHasVAT] = useState(false);\n  const [taskVatRate, setTaskVatRate] = useState(20);\n  \n  // Quote terms state\n  const [quoteTerms, setQuoteTerms] = useState([\n    'Bu teklif 30 gün süreyle geçerlidir.',\n    'Fiyatlar KDV dahildir/hariçtir.',\n    'Ödeme şartları: %50 peşin, %50 teslimatta.',\n    'İş süresi: Anlaşma imzalandıktan sonra 15 iş günü.',\n    'Force majeure durumlarında süre uzayabilir.'\n  ]);\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: customerTasks = [] } = useQuery<CustomerTask[]>({\n    queryKey: [\"/api/customer-tasks\"],\n  });\n\n  const { data: customerQuotes = [] } = useQuery<CustomerQuote[]>({\n    queryKey: [\"/api/customer-quotes\"],\n  });\n\n  const { data: customerPayments = [] } = useQuery<CustomerPayment[]>({\n    queryKey: [\"/api/customer-payments\"],\n  });\n\n  const customer = customers.find(c => c.name === customerName);\n  const tasks = customerTasks.filter(task => task.customerId === customer?.id);\n  const quotes = customerQuotes.filter(quote => quote.customerId === customer?.id);\n  const payments = customerPayments.filter(payment => payment.customerId === customer?.id);\n\n  const formatDate = (date: Date | string) => {\n    const d = new Date(date);\n    return d.toLocaleDateString('tr-TR');\n  };\n\n  const formatCurrency = (amount: string) => {\n    return new Intl.NumberFormat('tr-TR', {\n      style: 'currency',\n      currency: 'TRY',\n      minimumFractionDigits: 2,\n    }).format(parseFloat(amount));\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"active\": return \"text-green-400\";\n      case \"passive\": return \"text-yellow-400\";\n      case \"completed\": return \"text-blue-400\";\n      default: return \"text-gray-400\";\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case \"active\": return \"Aktif\";\n      case \"passive\": return \"Pasif\";\n      case \"completed\": return \"Tamamlandı\";\n      default: return status;\n    }\n  };\n\n  const totalTaskValue = tasks.reduce((sum, task) => sum + parseFloat(task.amount), 0);\n  const totalQuoteValue = quotes.reduce((sum, quote) => sum + parseFloat(quote.totalWithVAT || quote.totalAmount || '0'), 0);\n  const approvedQuoteValue = quotes.filter(q => q.isApproved).reduce((sum, quote) => sum + parseFloat(quote.totalAmount || '0'), 0);\n  const pendingQuoteValue = quotes.filter(q => !q.isApproved).reduce((sum, quote) => sum + parseFloat(quote.totalAmount || '0'), 0);\n  const totalPaidAmount = payments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0);\n  const remainingAmount = totalTaskValue - totalPaidAmount;\n  const completedTasks = tasks.filter(t => t.status === \"completed\").length;\n  const pendingTasks = tasks.filter(t => t.status === \"pending\").length;\n  const approvedQuotes = quotes.filter(q => q.isApproved).length;\n  const pendingQuotes = quotes.filter(q => !q.isApproved).length;\n\n  // Form configurations\n  const taskForm = useForm<InsertCustomerTask>({\n    resolver: zodResolver(insertCustomerTaskSchema),\n    defaultValues: {\n      customerId: customer?.id || \"\",\n      title: \"\",\n      description: \"\",\n      quantity: 1.0,\n      unit: \"adet\",\n      unitPrice: 0,\n      amount: \"0\",\n      status: \"pending\",\n      hasVAT: false,\n      vatRate: \"20.00\",\n      vatAmount: \"0.00\",\n      totalWithVAT: \"0\",\n      dueDate: undefined,\n    },\n  });\n\n  const quoteForm = useForm<InsertCustomerQuote>({\n    resolver: zodResolver(insertCustomerQuoteSchema),\n    defaultValues: {\n      customerId: customer?.id || \"\",\n      title: \"\",\n      description: \"\",\n      totalAmount: \"0\",\n      status: \"pending\",\n      isApproved: false,\n      quoteDate: new Date(),\n      validUntil: undefined,\n    },\n  });\n\n  const paymentForm = useForm<InsertCustomerPayment>({\n    resolver: zodResolver(insertCustomerPaymentSchema),\n    defaultValues: {\n      customerId: customer?.id || \"\",\n      amount: \"0\",\n      description: \"\",\n      paymentDate: new Date(),\n      paymentMethod: \"cash\",\n    },\n  });\n\n  // Mutations\n  const createTaskMutation = useMutation({\n    mutationFn: (data: InsertCustomerTask) => apiRequest(\"/api/customer-tasks\", \"POST\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({ title: \"Başarılı\", description: \"Görev başarıyla eklendi\" });\n      setShowTaskForm(false);\n      taskForm.reset();\n      setEditingTask(null);\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Görev eklenirken bir hata oluştu\", variant: \"destructive\" });\n    },\n  });\n\n  // Quote items helper functions\n  const addQuoteItem = () => {\n    if (!currentItem.title.trim()) {\n      toast({\n        title: \"Uyarı\",\n        description: \"Görev adı gereklidir\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const newItem = {\n      id: Date.now().toString(),\n      title: currentItem.title,\n      description: currentItem.description,\n      quantity: currentItem.quantity,\n      unitPrice: currentItem.unitPrice,\n      totalPrice: currentItem.quantity * currentItem.unitPrice,\n      unit: currentItem.unit\n    };\n\n    setQuoteItems(prev => [...prev, newItem]);\n    setCurrentItem({\n      title: \"\",\n      description: \"\",\n      quantity: 1,\n      unitPrice: 0,\n      unit: \"adet\"\n    });\n  };\n\n  const removeQuoteItem = (id: string) => {\n    setQuoteItems(prev => prev.filter(item => item.id !== id));\n  };\n\n  const editQuoteItem = (id: string) => {\n    const item = quoteItems.find(item => item.id === id);\n    if (item) {\n      setCurrentItem({\n        title: item.title,\n        description: item.description,\n        quantity: item.quantity,\n        unitPrice: item.unitPrice,\n        unit: item.unit\n      });\n      removeQuoteItem(id);\n    }\n  };\n\n  const getQuoteTotals = () => {\n    const subtotal = quoteItems.reduce((sum, item) => sum + item.totalPrice, 0);\n    const vatAmount = hasVAT ? (subtotal * vatRate) / 100 : 0;\n    const total = subtotal + vatAmount;\n    return { subtotal, vatAmount, total };\n  };\n\n  // Export functions for quote form\n  const exportToExcel = () => {\n    if (quoteItems.length === 0) {\n      toast({\n        title: \"Uyarı\",\n        description: \"Dışa aktarılacak görev bulunmamaktadır\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const headers = [\"Görev\", \"Açıklama\", \"Miktar\", \"Birim\", \"Birim Fiyat\", \"Toplam\"];\n    const csvContent = [\n      headers.join(\",\"),\n      ...quoteItems.map(item => [\n        `\"${item.title}\"`,\n        `\"${item.description || \"\"}\"`,\n        parseFloat(item.quantity).toFixed(1),\n        item.unit,\n        item.unitPrice.toFixed(2),\n        item.totalPrice.toFixed(2)\n      ].join(\",\"))\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n    const link = document.createElement(\"a\");\n    const url = URL.createObjectURL(blob);\n    link.setAttribute(\"href\", url);\n    link.setAttribute(\"download\", `teklif-${customer?.name}-${new Date().toISOString().split('T')[0]}.csv`);\n    link.style.visibility = \"hidden\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    toast({ title: \"Başarılı\", description: \"Excel dosyası indirildi\" });\n  };\n\n\n\n  const createQuoteMutation = useMutation({\n    mutationFn: async (data: InsertCustomerQuote) => {\n      // First create the quote\n      const quote = await apiRequest(\"/api/customer-quotes\", \"POST\", data) as any;\n      console.log(\"Created quote:\", quote);\n      \n      // Then create quote items if any exist\n      if (quoteItems.length > 0) {\n        for (const item of quoteItems) {\n          const quoteItemData = {\n            quoteId: quote.id,\n            title: item.title,\n            description: item.description,\n            quantity: item.quantity,\n            unitPrice: item.unitPrice,\n            totalPrice: item.totalPrice,\n            unit: item.unit,\n            status: \"pending\",\n            isApproved: false\n          };\n          console.log(\"Creating quote item with data:\", quoteItemData);\n          await apiRequest(\"/api/customer-quote-items\", \"POST\", quoteItemData);\n        }\n      }\n      \n      return quote;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-quotes\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-quote-items\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({ title: \"Başarılı\", description: \"Teklif ve görevler başarıyla oluşturuldu\" });\n      handleCloseQuoteForm();\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Teklif oluşturulamadı\", variant: \"destructive\" });\n    },\n  });\n\n  const updateQuoteMutation = useMutation({\n    mutationFn: (params: { id: string; data?: Partial<InsertCustomerQuote>; status?: string; isApproved?: boolean }) => {\n      const data = params.data || { status: params.status, isApproved: params.isApproved };\n      return apiRequest(`/api/customer-quotes/${params.id}`, \"PUT\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-quotes\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-tasks\"] }); // In case approved quote creates task\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({ title: \"Başarılı\", description: \"Teklif başarıyla güncellendi\" });\n      setEditingQuote(null);\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Teklif güncellenirken bir hata oluştu\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteQuoteMutation = useMutation({\n    mutationFn: (id: string) => apiRequest(`/api/customer-quotes/${id}`, \"DELETE\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-quotes\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({ title: \"Başarılı\", description: \"Teklif silindi\" });\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Teklif silinemedi\", variant: \"destructive\" });\n    },\n  });\n\n  const updateTaskMutation = useMutation({\n    mutationFn: ({ id, data }: { id: string; data: Partial<InsertCustomerTask> }) => \n      apiRequest(`/api/customer-tasks/${id}`, \"PUT\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({ title: \"Başarılı\", description: \"Görev başarıyla güncellendi\" });\n      setShowTaskForm(false);\n      taskForm.reset();\n      setEditingTask(null);\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Görev güncellenirken bir hata oluştu\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteTaskMutation = useMutation({\n    mutationFn: (id: string) => apiRequest(`/api/customer-tasks/${id}`, \"DELETE\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({ title: \"Başarılı\", description: \"Görev silindi\" });\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Görev silinemedi\", variant: \"destructive\" });\n    },\n  });\n\n\n\n  const createPaymentMutation = useMutation({\n    mutationFn: (data: InsertCustomerPayment) => apiRequest(\"/api/customer-payments\", \"POST\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      toast({ title: \"Başarılı\", description: \"Ödeme başarıyla kaydedildi\" });\n      setShowPaymentForm(false);\n      paymentForm.reset();\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Ödeme kaydedilirken bir hata oluştu\", variant: \"destructive\" });\n    },\n  });\n\n  // Form handlers\n  const onSubmitTask = (data: InsertCustomerTask) => {\n    // Calculate VAT amounts before submission\n    const baseAmount = parseFloat(data.amount);\n    let finalData = { ...data };\n    \n    if (data.hasVAT) {\n      // If VAT is included, the amount should be VAT-inclusive\n      const vatMultiplier = 1 + parseFloat(data.vatRate || '20') / 100;\n      const vatInclusiveAmount = baseAmount * vatMultiplier;\n      const vatAmount = vatInclusiveAmount - baseAmount;\n      \n      finalData = {\n        ...data,\n        amount: vatInclusiveAmount.toFixed(2),\n        vatAmount: vatAmount.toFixed(2),\n        totalWithVAT: vatInclusiveAmount.toFixed(2)\n      };\n    } else {\n      finalData = {\n        ...data,\n        vatAmount: '0.00',\n        totalWithVAT: '0.00'\n      };\n    }\n    \n    if (editingTask) {\n      updateTaskMutation.mutate({ id: editingTask.id, data: finalData });\n    } else {\n      createTaskMutation.mutate({ ...finalData, customerId: customer?.id || \"\" });\n    }\n  };\n\n\n\n  const onSubmitPayment = (data: InsertCustomerPayment) => {\n    createPaymentMutation.mutate({ ...data, customerId: customer?.id || \"\" });\n  };\n\n  const handleCloseTaskForm = () => {\n    setShowTaskForm(false);\n    setEditingTask(null);\n    taskForm.reset();\n  };\n\n  // Update form when editing task\n  useEffect(() => {\n    if (editingTask) {\n      // When editing, if task has VAT, show the VAT-exclusive amount in the form\n      let displayAmount = editingTask.amount;\n      if (editingTask.hasVAT) {\n        const vatRate = parseFloat(editingTask.vatRate || '20');\n        const vatInclusiveAmount = parseFloat(editingTask.amount);\n        displayAmount = (vatInclusiveAmount / (1 + vatRate / 100)).toFixed(2);\n      }\n      \n      taskForm.reset({\n        customerId: editingTask.customerId,\n        title: editingTask.title,\n        description: editingTask.description || \"\",\n        quantity: parseFloat(editingTask.quantity || \"1\"),\n        unit: editingTask.unit || \"adet\",\n        unitPrice: parseFloat(editingTask.unitPrice || \"0\"),\n        amount: displayAmount,\n        status: editingTask.status,\n        hasVAT: editingTask.hasVAT,\n        vatRate: editingTask.vatRate,\n        vatAmount: editingTask.vatAmount,\n        totalWithVAT: editingTask.totalWithVAT,\n        dueDate: editingTask.dueDate ? new Date(editingTask.dueDate) : undefined,\n      });\n    } else {\n      taskForm.reset({\n        customerId: customer?.id || \"\",\n        title: \"\",\n        description: \"\",\n        quantity: 1.0,\n        unit: \"adet\",\n        unitPrice: 0,\n        amount: \"0\",\n        status: \"pending\",\n        hasVAT: false,\n        vatRate: \"20.00\",\n        vatAmount: \"0.00\",\n        totalWithVAT: \"0\",\n        dueDate: undefined,\n      });\n    }\n  }, [editingTask, customer?.id, taskForm]);\n\n\n\n\n\n  const calculateTotalAmount = () => {\n    return quoteItems.reduce((sum, item) => sum + item.totalPrice, 0);\n  };\n\n  const calculateVATAmount = (baseAmount: number, vatRate: number) => {\n    return (baseAmount * vatRate) / 100;\n  };\n\n  const calculateTotalWithVAT = (baseAmount: number, vatRate: number) => {\n    return baseAmount + calculateVATAmount(baseAmount, vatRate);\n  };\n\n\n\n\n\n  const exportToPDF = async () => {\n    if (quoteItems.length === 0) {\n      toast({\n        title: \"Boş Teklif\",\n        description: \"Export edilecek görev bulunamadı\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Türkçe karakter dönüştürücü\n    const convertTurkishChars = (text: string) => {\n      const turkishMap: { [key: string]: string } = {\n        'ş': 's', 'Ş': 'S', 'ğ': 'g', 'Ğ': 'G', 'ı': 'i', 'İ': 'I',\n        'ç': 'c', 'Ç': 'C', 'ü': 'u', 'Ü': 'U', 'ö': 'o', 'Ö': 'O'\n      };\n      return text.replace(/[şŞğĞıİçÇüÜöÖ]/g, (char) => turkishMap[char] || char);\n    };\n\n    // Dynamic import to reduce bundle size\n    const jsPDF = (await import('jspdf')).default;\n    const autoTable = (await import('jspdf-autotable')).default;\n\n    const doc = new jsPDF();\n    \n    // Header\n    doc.setFontSize(20);\n    doc.text(convertTurkishChars('TEKLIF FORMU'), 20, 30);\n    \n    doc.setFontSize(12);\n    const { subtotal, vatAmount, total } = getQuoteTotals();\n    \n    const today = new Date();\n    const validityDate = new Date(today);\n    validityDate.setDate(today.getDate() + 30); // 30 gün geçerlilik\n    \n    doc.text(convertTurkishChars(`Sayin: ${customer?.name || ''}`), 20, 50);\n    doc.text(convertTurkishChars(`Teklif Tarihi: ${today.toLocaleDateString('tr-TR')}`), 20, 60);\n    doc.text(convertTurkishChars(`Gecerlilik Tarihi: ${validityDate.toLocaleDateString('tr-TR')}`), 20, 70);\n\n    // Table\n    const tableData = quoteItems.map((item, index) => [\n      index + 1,\n      convertTurkishChars(item.title),\n      convertTurkishChars(item.description || '-'),\n      parseFloat(item.quantity).toFixed(1),\n      convertTurkishChars(item.unit),\n      `${item.unitPrice.toFixed(2)} TL`,\n      `${item.totalPrice.toFixed(2)} TL`\n    ]);\n\n    const startY = 90;\n    const footerData = [];\n    \n    footerData.push(['', '', '', '', '', 'ARA TOPLAM:', `${subtotal.toFixed(2)} TL`]);\n    if (hasVAT) {\n      footerData.push(['', '', '', '', '', `KDV (%${vatRate}):`, `${vatAmount.toFixed(2)} TL`]);\n    }\n    footerData.push(['', '', '', '', '', 'GENEL TOPLAM:', `${total.toFixed(2)} TL`]);\n\n    autoTable(doc, {\n      startY,\n      head: [[convertTurkishChars('Sira'), convertTurkishChars('Gorev Adi'), convertTurkishChars('Aciklama'), 'Miktar', 'Birim', 'Birim Fiyat', 'Toplam']],\n      body: tableData,\n      foot: footerData,\n      theme: 'striped'\n    });\n\n    // Teklif Şartları\n    const finalY = (doc as any).lastAutoTable.finalY || startY + 100;\n    doc.setFontSize(14);\n    doc.text(convertTurkishChars('TEKLIF SARTLARI'), 20, finalY + 20);\n    doc.setFontSize(10);\n    // Use state terms for PDF\n    const terms = quoteTerms.map(term => convertTurkishChars(`• ${term}`));\n    \n    terms.forEach((term, index) => {\n      doc.text(term, 20, finalY + 35 + (index * 8));\n    });\n\n    doc.save(convertTurkishChars(`teklif_${customer?.name}_${new Date().toLocaleDateString('tr-TR')}.pdf`));\n\n    toast({\n      title: \"PDF Export\",\n      description: \"Teklif PDF formatında indirildi\"\n    });\n  };\n\n  const handleQuoteApprove = (quoteId: string) => {\n    updateQuoteMutation.mutate({ \n      id: quoteId, \n      data: { status: \"approved\", isApproved: true } \n    });\n  };\n\n  const onSubmitQuote = (data: InsertCustomerQuote) => {\n    if (quoteItems.length === 0) {\n      toast({\n        title: \"Uyarı\",\n        description: \"En az bir görev eklemelisiniz\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const totals = getQuoteTotals();\n    const quoteData = {\n      ...data,\n      customerId: customer!.id,\n      amount: totals.total.toString(),\n      hasVAT,\n      vatRate: hasVAT ? vatRate.toString() : null,\n      status: \"pending\",\n      isApproved: false,\n      terms: quoteTerms.filter(term => term.trim()).join('\\n')\n    };\n\n    if (editingQuote) {\n      updateQuoteMutation.mutate({ id: editingQuote.id, data: quoteData });\n    } else {\n      createQuoteMutation.mutate(quoteData);\n    }\n  };\n\n\n\n  const handleClosePaymentForm = () => {\n    setShowPaymentForm(false);\n    paymentForm.reset();\n  };\n\n  const handleCloseQuoteForm = () => {\n    setShowQuoteForm(false);\n    setEditingQuote(null);\n    setQuoteItems([]);\n    setCurrentItem({ title: \"\", description: \"\", quantity: 1.0, unitPrice: 0, unit: \"adet\" });\n    setHasVAT(false);\n    setVatRate(18);\n    setQuoteTerms([\n      \"Teklif geçerlilik süresi 15 gündür.\",\n      \"Ödeme şartları: %50 peşin, %50 işin bitiminde.\",\n      \"Fiyatlara KDV dahil değildir.\",\n      \"Malzeme fiyatlarındaki değişiklikler farkı yansıtılır.\"\n    ]);\n    quoteForm.reset();\n  };\n\n  // This useEffect is redundant - task form is already populated in the first useEffect (line 558)\n\n  // Update form when editing quote\n  useEffect(() => {\n    if (editingQuote && showQuoteForm) {\n      quoteForm.setValue(\"title\", editingQuote.title);\n      quoteForm.setValue(\"description\", editingQuote.description || \"\");\n      quoteForm.setValue(\"totalAmount\", editingQuote.totalAmount);\n      quoteForm.setValue(\"status\", editingQuote.status);\n      quoteForm.setValue(\"isApproved\", editingQuote.isApproved || false);\n      quoteForm.setValue(\"quoteDate\", new Date(editingQuote.quoteDate));\n      quoteForm.setValue(\"validUntil\", editingQuote.validUntil ? new Date(editingQuote.validUntil) : undefined);\n      \n      // Set KDV settings\n      setHasVAT(editingQuote.hasVAT || false);\n      setVatRate(parseFloat(editingQuote.vatRate || \"1\"));\n      \n      // Set quote terms if they exist\n      if (editingQuote.terms) {\n        setQuoteTerms(editingQuote.terms.split('\\n').filter(term => term.trim()));\n      }\n      \n      // Load quote items if editing\n      if (editingQuote.id) {\n        // Fetch quote items for the editing quote\n        apiRequest(`/api/customer-quote-items/quote/${editingQuote.id}`, \"GET\")\n          .then((items: CustomerQuoteItem[]) => {\n            setQuoteItems(items.map(item => ({\n              id: item.id,\n              title: item.title,\n              description: item.description || \"\",\n              quantity: parseFloat(item.quantity),\n              unitPrice: parseFloat(item.unitPrice),\n              unit: item.unit,\n              totalPrice: parseFloat(item.totalPrice)\n            })));\n          })\n          .catch(error => {\n            console.error(\"Error loading quote items:\", error);\n          });\n      }\n    }\n  }, [editingQuote, showQuoteForm]);\n\n  if (!customer) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary text-white\">\n        <Header />\n        <div className=\"p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"text-center\">\n              <p className=\"text-gray-400 text-lg mb-4\">Müşteri bulunamadı</p>\n              <Button \n                onClick={() => setLocation(\"/customers\")}\n                className=\"bg-blue-500 hover:bg-blue-600\"\n              >\n                Müşteri Listesine Dön\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-white hover:bg-dark-accent\"\n            onClick={() => setLocation(\"/customers\")}\n          >\n            <ArrowLeft className=\"h-6 w-6\" />\n          </Button>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center\">\n              <Building2 className=\"h-6 w-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-2xl font-bold\">{customer.name}</h1>\n              {customer.company && (\n                <p className=\"text-gray-400\">{customer.company}</p>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Müşteri Mali Özet Kartları */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-5 w-5 text-blue-400\" />\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Toplam Tutar</p>\n                  <p className=\"text-white font-semibold text-lg\">{formatCurrency(totalTaskValue.toString())}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-orange-400\" />\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Teklifler</p>\n                  <p className=\"text-white font-semibold text-lg\">{formatCurrency(pendingQuoteValue.toString())}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-5 w-5 text-green-400\" />\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Ödenen</p>\n                  <p className=\"text-white font-semibold text-lg\">{formatCurrency(totalPaidAmount.toString())}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-5 w-5 text-orange-400\" />\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Kalan</p>\n                  <p className=\"text-white font-semibold text-lg\">{formatCurrency(remainingAmount.toString())}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs defaultValue=\"tasks\" className=\"w-full\">\n          <TabsList className=\"bg-dark-secondary border-dark-accent\">\n            <TabsTrigger value=\"tasks\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              Yapılacak İşler\n            </TabsTrigger>\n            <TabsTrigger value=\"quotes\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              Teklifler\n            </TabsTrigger>\n            <TabsTrigger value=\"payments\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              Ödemeler\n            </TabsTrigger>\n            <TabsTrigger value=\"info\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              Müşteri Bilgileri\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"tasks\" className=\"mt-4\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <CardTitle className=\"text-white\">Yapılacak İşler</CardTitle>\n                <Button \n                  className=\"bg-blue-500 hover:bg-blue-600\"\n                  onClick={() => setShowTaskForm(true)}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Yeni Görev\n                </Button>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {tasks.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-400\">Bu müşteri için henüz görev eklenmemiş</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {tasks.map((task) => (\n                      <div key={task.id} className=\"border border-dark-accent rounded-lg p-4\">\n                        <div className=\"flex justify-between items-start mb-2\">\n                          <h4 className=\"text-white font-medium\">{task.title}</h4>\n                          <div className=\"flex items-center gap-2\">\n                            <span className={`text-sm px-2 py-1 rounded flex items-center gap-1 ${\n                              task.status === \"completed\" ? \"text-green-400 bg-green-400/10\" :\n                              task.status === \"in_progress\" ? \"text-yellow-400 bg-yellow-400/10\" :\n                              \"text-gray-400 bg-gray-400/10\"\n                            }`}>\n                              {task.status === \"completed\" ? <CheckCircle className=\"h-3 w-3\" /> :\n                               task.status === \"in_progress\" ? <Clock className=\"h-3 w-3\" /> :\n                               <Circle className=\"h-3 w-3\" />}\n                              {task.status === \"completed\" ? \"Tamamlandı\" :\n                               task.status === \"in_progress\" ? \"Devam Ediyor\" : \"Beklemede\"}\n                            </span>\n                            <div className=\"flex gap-1\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 text-blue-400 hover:text-blue-300\"\n                                onClick={() => {\n                                  setEditingTask(task);\n                                  setShowTaskForm(true);\n                                }}\n                              >\n                                <Edit className=\"h-3 w-3\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 text-red-400 hover:text-red-300\"\n                                onClick={() => {\n                                  if (confirm(\"Bu görevi silmek istediğinizden emin misiniz?\")) {\n                                    deleteTaskMutation.mutate(task.id);\n                                  }\n                                }}\n                              >\n                                <Trash2 className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm mb-4\">\n                          <div>\n                            <p className=\"text-gray-400\">Miktar</p>\n                            <p className=\"text-white font-medium\">\n                              {parseFloat(task.quantity || \"1\").toFixed(1)} {task.unit || 'adet'}\n                            </p>\n                          </div>\n                          <div>\n                            <p className=\"text-gray-400\">Birim Fiyat</p>\n                            <p className=\"text-white font-medium\">{formatCurrency(task.unitPrice || task.amount)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-gray-400\">Ana Tutar</p>\n                            <p className=\"text-white font-semibold\">\n                              {task.hasVAT \n                                ? formatCurrency((parseFloat(task.amount) / (1 + parseFloat(task.vatRate || '20') / 100)).toFixed(2))\n                                : formatCurrency(task.amount)\n                              }\n                            </p>\n                            {task.hasVAT && (\n                              <p className=\"text-xs text-gray-400\">\n                                KDV (%{task.vatRate}): {formatCurrency((parseFloat(task.amount) - (parseFloat(task.amount) / (1 + parseFloat(task.vatRate || '20') / 100))).toFixed(2))}\n                              </p>\n                            )}\n                          </div>\n                          <div>\n                            <p className=\"text-gray-400\">Toplam Tutar</p>\n                            <p className=\"text-green-400 font-bold\">\n                              {formatCurrency(task.amount)}\n                            </p>\n                            {task.hasVAT && (\n                              <p className=\"text-xs text-blue-400\">KDV Dahil</p>\n                            )}\n                          </div>\n                        </div>\n                        \n                        {task.dueDate && (\n                          <div className=\"mb-2\">\n                            <span className=\"text-gray-400 text-sm\">Teslim Tarihi: </span>\n                            <span className=\"text-white text-sm\">{formatDate(task.dueDate)}</span>\n                          </div>\n                        )}\n                        \n                        {task.description && (\n                          <div className=\"mt-2\">\n                            <p className=\"text-gray-400 text-sm\">Açıklama</p>\n                            <p className=\"text-gray-300 text-sm\">{task.description}</p>\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"quotes\" className=\"mt-4\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <CardTitle className=\"text-white\">Teklifler</CardTitle>\n                <Button \n                  className=\"bg-orange-500 hover:bg-orange-600\"\n                  onClick={() => setShowQuoteForm(true)}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Yeni Teklif\n                </Button>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {quotes.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-400\">Bu müşteri için henüz teklif hazırlanmamış</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {quotes.map((quote) => (\n                      <div key={quote.id} className=\"border border-dark-accent rounded-lg p-4\">\n                        <div className=\"flex justify-between items-start mb-3\">\n                          <div className=\"flex-1\">\n                            <h4 className=\"text-white font-semibold text-lg mb-1\">{quote.title}</h4>\n                            <div className=\"flex items-center gap-4 mb-2\">\n                              <span className={`px-3 py-1 rounded-full text-xs font-medium ${\n                                quote.isApproved \n                                  ? 'bg-green-500/20 text-green-400' \n                                  : 'bg-yellow-500/20 text-yellow-400'\n                              }`}>\n                                {quote.isApproved ? 'Onaylandı' : 'Bekliyor'}\n                              </span>\n                              <span className=\"text-2xl font-bold text-orange-400\">\n                                {formatCurrency(quote.totalWithVAT || quote.totalAmount)}\n                              </span>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-8 px-3 text-xs border-dark-accent hover:bg-dark-accent text-gray-400 hover:text-white\"\n                              onClick={() => {\n                                setEditingQuote(quote);\n                                setShowQuoteForm(true);\n                              }}\n                            >\n                              <Edit className=\"h-3 w-3 mr-1\" />\n                              Düzenle\n                            </Button>\n                            <DropdownMenu>\n                              <DropdownMenuTrigger asChild>\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"outline\"\n                                  className=\"h-8 px-3 text-xs border-dark-accent hover:bg-dark-accent text-gray-400 hover:text-white\"\n                                >\n                                  {quote.status === \"pending\" ? \"Gönderildi\" : \n                                   quote.status === \"approved\" ? \"Onaylandı\" : \n                                   quote.status === \"rejected\" ? \"Reddedildi\" : \"Gönderildi\"}\n                                  <ChevronDown className=\"h-3 w-3 ml-1\" />\n                                </Button>\n                              </DropdownMenuTrigger>\n                              <DropdownMenuContent className=\"bg-dark-secondary border-dark-accent\">\n                                <DropdownMenuItem \n                                  onClick={() => updateQuoteMutation.mutate({ id: quote.id, status: \"pending\", isApproved: false })}\n                                  className=\"text-blue-400 hover:bg-dark-accent focus:bg-dark-accent\"\n                                >\n                                  <CheckCircle className=\"h-3 w-3 mr-2\" />\n                                  Gönderildi\n                                </DropdownMenuItem>\n                                <DropdownMenuItem \n                                  onClick={() => updateQuoteMutation.mutate({ id: quote.id, status: \"approved\", isApproved: true })}\n                                  className=\"text-green-400 hover:bg-dark-accent focus:bg-dark-accent\"\n                                >\n                                  <CheckCircle className=\"h-3 w-3 mr-2\" />\n                                  Onaylandı\n                                </DropdownMenuItem>\n                                <DropdownMenuItem \n                                  onClick={() => updateQuoteMutation.mutate({ id: quote.id, status: \"rejected\", isApproved: false })}\n                                  className=\"text-red-400 hover:bg-dark-accent focus:bg-dark-accent\"\n                                >\n                                  <X className=\"h-3 w-3 mr-2\" />\n                                  Reddedildi\n                                </DropdownMenuItem>\n                              </DropdownMenuContent>\n                            </DropdownMenu>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              className=\"h-8 px-3 text-xs border-red-500/20 hover:bg-red-500/20 text-red-400 hover:text-red-300\"\n                              onClick={() => deleteQuoteMutation.mutate(quote.id)}\n                              disabled={deleteQuoteMutation.isPending}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\n                          <div>\n                            <p className=\"text-gray-400\">Teklif Tarihi</p>\n                            <p className=\"text-white\">{formatDate(quote.quoteDate)}</p>\n                          </div>\n                          {quote.validUntil && (\n                            <div>\n                              <p className=\"text-gray-400\">Geçerlilik Tarihi</p>\n                              <p className=\"text-white\">{formatDate(quote.validUntil)}</p>\n                            </div>\n                          )}\n                          <div>\n                            <p className=\"text-gray-400\">Durum</p>\n                            <p className=\"text-white\">{quote.status}</p>\n                          </div>\n                        </div>\n                        \n                        {quote.description && (\n                          <div className=\"mt-3\">\n                            <p className=\"text-gray-400 text-sm\">Açıklama</p>\n                            <p className=\"text-gray-300 text-sm\">{quote.description}</p>\n                          </div>\n                        )}\n\n                        {/* Quote Items Section */}\n                        <QuoteItemsSection quoteId={quote.id} />\n                        \n                        {quote.isApproved && (\n                          <div className=\"mt-3 p-2 bg-green-500/10 border border-green-500/20 rounded\">\n                            <p className=\"text-green-400 text-sm\">✓ Bu teklif onaylandı ve Yapılacak İşler sekmesine eklendi</p>\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"payments\" className=\"mt-4\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <CardTitle className=\"text-white\">Ödemeler</CardTitle>\n                <Button \n                  className=\"bg-green-500 hover:bg-green-600\"\n                  onClick={() => setShowPaymentForm(true)}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Ödeme Kaydet\n                </Button>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {payments.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <CreditCard className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-400\">Bu müşteriden henüz ödeme alınmamış</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {payments.map((payment) => (\n                      <div key={payment.id} className=\"border border-dark-accent rounded-lg p-4\">\n                        <div className=\"flex justify-between items-start\">\n                          <div className=\"flex-1\">\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\n                              <div>\n                                <p className=\"text-gray-400\">Tutar</p>\n                                <p className=\"text-green-400 font-semibold text-lg\">{formatCurrency(payment.amount)}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-gray-400\">Tarih</p>\n                                <p className=\"text-white\">{formatDate(payment.paymentDate)}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-gray-400\">Yöntem</p>\n                                <p className=\"text-white\">{payment.paymentMethod || \"Belirtilmemiş\"}</p>\n                              </div>\n                            </div>\n                            <div className=\"mt-2\">\n                              <p className=\"text-gray-400 text-sm\">Açıklama</p>\n                              <p className=\"text-gray-300 text-sm\">{payment.description}</p>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"info\" className=\"mt-4\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white\">Müşteri Bilgileri</CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <p className=\"text-gray-400 text-sm mb-1\">Ad</p>\n                      <p className=\"text-white\">{customer.name}</p>\n                    </div>\n                    \n                    {customer.company && (\n                      <div>\n                        <p className=\"text-gray-400 text-sm mb-1\">Şirket</p>\n                        <p className=\"text-white\">{customer.company}</p>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    {customer.phone && (\n                      <div>\n                        <p className=\"text-gray-400 text-sm mb-1\">Telefon</p>\n                        <div className=\"flex items-center gap-2\">\n                          <Phone className=\"h-4 w-4 text-gray-400\" />\n                          <p className=\"text-white\">{customer.phone}</p>\n                        </div>\n                      </div>\n                    )}\n\n                    {customer.email && (\n                      <div>\n                        <p className=\"text-gray-400 text-sm mb-1\">E-posta</p>\n                        <div className=\"flex items-center gap-2\">\n                          <Mail className=\"h-4 w-4 text-gray-400\" />\n                          <p className=\"text-white\">{customer.email}</p>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  {customer.address && (\n                    <div>\n                      <p className=\"text-gray-400 text-sm mb-1\">Adres</p>\n                      <div className=\"flex items-start gap-2\">\n                        <MapPin className=\"h-4 w-4 text-gray-400 mt-1\" />\n                        <p className=\"text-white\">{customer.address}</p>\n                      </div>\n                    </div>\n                  )}\n\n                  {customer.taxNumber && (\n                    <div>\n                      <p className=\"text-gray-400 text-sm mb-1\">Vergi Numarası</p>\n                      <p className=\"text-white\">{customer.taxNumber}</p>\n                    </div>\n                  )}\n\n                  <div>\n                    <p className=\"text-gray-400 text-sm mb-1\">Kayıt Tarihi</p>\n                    <p className=\"text-white\">{customer.createdAt ? formatDate(customer.createdAt) : 'Bilinmiyor'}</p>\n                  </div>\n\n                  <div>\n                    <p className=\"text-gray-400 text-sm mb-1\">Durum</p>\n                    <span className={`px-2 py-1 rounded text-sm ${\n                      customer.status === 'active' ? 'bg-green-900 text-green-400' : 'bg-red-900 text-red-400'\n                    }`}>\n                      {customer.status === 'active' ? 'Aktif' : 'Pasif'}\n                    </span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      {/* Task Form Modal */}\n      <Dialog open={showTaskForm} onOpenChange={handleCloseTaskForm}>\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-semibold\">\n              {editingTask ? \"Görev Düzenle\" : \"Yeni Görev\"}\n            </DialogTitle>\n            <DialogDescription className=\"text-gray-400\">\n              {editingTask ? \"Mevcut görevi düzenleyin\" : \"Müşteri için yeni bir görev oluşturun\"}\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...taskForm}>\n            <form onSubmit={taskForm.handleSubmit(onSubmitTask)} className=\"space-y-4\">\n              <FormField\n                control={taskForm.control}\n                name=\"title\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Görev Başlığı *</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Görev başlığını girin\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={taskForm.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Açıklama</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Görev açıklaması\"\n                        {...field}\n                        value={field.value || \"\"}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Miktar, Birim ve Fiyat Alanları */}\n              <div className=\"grid grid-cols-3 gap-3\">\n                <FormField\n                  control={taskForm.control}\n                  name=\"quantity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Miktar *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.1\"\n                          min=\"0.1\"\n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"1.0\"\n                          {...field}\n                          value={field.value || \"\"}\n                          onChange={(e) => {\n                            const quantity = parseFloat(e.target.value) || 1;\n                            field.onChange(quantity);\n                            // Auto calculate amount\n                            const unitPrice = taskForm.getValues(\"unitPrice\") || 0;\n                            taskForm.setValue(\"amount\", (quantity * unitPrice).toString());\n                          }}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={taskForm.control}\n                  name=\"unit\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Birim *</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                            <SelectValue placeholder=\"Birim seçin\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                          <SelectItem value=\"adet\">Adet</SelectItem>\n                          <SelectItem value=\"m2\">m²</SelectItem>\n                          <SelectItem value=\"m\">m (Metre)</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={taskForm.control}\n                  name=\"unitPrice\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Birim Fiyat (₺) *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"0.00\"\n                          {...field}\n                          value={field.value || \"\"}\n                          onChange={(e) => {\n                            const unitPrice = parseFloat(e.target.value) || 0;\n                            field.onChange(unitPrice);\n                            // Auto calculate amount\n                            const quantity = taskForm.getValues(\"quantity\") || 1;\n                            taskForm.setValue(\"amount\", (quantity * unitPrice).toString());\n                          }}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={taskForm.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Toplam Tutar (₺)</FormLabel>\n                    <FormControl>\n                      <div className=\"bg-orange-500/20 border border-orange-500/30 rounded-md h-10 flex items-center px-3 text-orange-400 font-medium\">\n                        ₺{parseFloat(field.value || \"0\").toFixed(2)}\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={taskForm.control}\n                name=\"status\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Durum</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                          <SelectValue placeholder=\"Durum seçin\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                        <SelectItem value=\"pending\">Beklemede</SelectItem>\n                        <SelectItem value=\"in_progress\">Devam Ediyor</SelectItem>\n                        <SelectItem value=\"completed\">Tamamlandı</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={taskForm.control}\n                name=\"dueDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Teslim Tarihi</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"date\"\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        value={field.value ? field.value.toISOString().split('T')[0] : ''}\n                        onChange={(e) => field.onChange(e.target.value ? new Date(e.target.value) : undefined)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* KDV Seçenekleri */}\n              <div className=\"border-t border-dark-accent pt-4\">\n                <h4 className=\"text-white font-medium mb-3 flex items-center gap-2\">\n                  <Calculator className=\"h-4 w-4 text-blue-400\" />\n                  KDV Ayarları\n                </h4>\n                <div className=\"space-y-3\">\n                  <FormField\n                    control={taskForm.control}\n                    name=\"hasVAT\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex items-center space-x-3\">\n                        <FormControl>\n                          <input\n                            type=\"checkbox\"\n                            checked={field.value || false}\n                            onChange={field.onChange}\n                            className=\"w-4 h-4 text-blue-600 bg-dark-primary border-dark-accent rounded focus:ring-blue-500\"\n                          />\n                        </FormControl>\n                        <FormLabel className=\"text-white text-sm font-medium\">\n                          KDV Dahil Et\n                        </FormLabel>\n                      </FormItem>\n                    )}\n                  />\n                  \n                  {taskForm.watch(\"hasVAT\") && (\n                    <FormField\n                      control={taskForm.control}\n                      name=\"vatRate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">KDV Oranı (%)</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value?.toString() || \"20\"}>\n                            <FormControl>\n                              <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                                <SelectValue placeholder=\"KDV oranı seçin\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                              <SelectItem value=\"1\">%1</SelectItem>\n                              <SelectItem value=\"10\">%10</SelectItem>\n                              <SelectItem value=\"20\">%20</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleCloseTaskForm}\n                  className=\"flex-1 border-dark-accent text-gray-300 hover:bg-dark-accent\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createTaskMutation.isPending || updateTaskMutation.isPending}\n                  className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white\"\n                >\n                  {editingTask ? \"Güncelle\" : \"Ekle\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Payment Form Modal */}\n      <Dialog open={showPaymentForm} onOpenChange={handleClosePaymentForm}>\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-semibold\">Ödeme Kaydet</DialogTitle>\n            <DialogDescription className=\"text-gray-400\">\n              Bu müşteriden alınan ödemeyi kaydedin\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...paymentForm}>\n            <form onSubmit={paymentForm.handleSubmit(onSubmitPayment)} className=\"space-y-4\">\n              <FormField\n                control={paymentForm.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Ödeme Tutarı (₺) *</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"0.00\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={paymentForm.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Ödeme Açıklaması *</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Ödeme açıklaması\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={paymentForm.control}\n                name=\"paymentMethod\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Ödeme Yöntemi</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value || \"cash\"}>\n                      <FormControl>\n                        <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                          <SelectValue placeholder=\"Ödeme yöntemi seçin\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                        <SelectItem value=\"cash\">Nakit</SelectItem>\n                        <SelectItem value=\"bank_transfer\">Havale/EFT</SelectItem>\n                        <SelectItem value=\"check\">Çek</SelectItem>\n                        <SelectItem value=\"other\">Diğer</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={paymentForm.control}\n                name=\"paymentDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Ödeme Tarihi *</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"date\"\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        value={field.value ? field.value.toISOString().split('T')[0] : ''}\n                        onChange={(e) => field.onChange(new Date(e.target.value))}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex gap-3 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleClosePaymentForm}\n                  className=\"flex-1 border-dark-accent text-gray-300 hover:bg-dark-accent\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createPaymentMutation.isPending}\n                  className=\"flex-1 bg-green-500 hover:bg-green-600 text-white\"\n                >\n                  Ödeme Kaydet\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Quote Form Dialog */}\n      <Dialog open={showQuoteForm} onOpenChange={handleCloseQuoteForm}>\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader className=\"border-b border-dark-accent pb-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-orange-500/20 p-2 rounded-lg\">\n                <FileText className=\"h-5 w-5 text-orange-400\" />\n              </div>\n              <div>\n                <DialogTitle className=\"text-xl text-white\">\n                  {editingQuote ? \"Teklif Düzenle\" : \"Yeni Çoklu Görev Teklifi\"}\n                </DialogTitle>\n                <DialogDescription className=\"text-gray-400 text-sm mt-1\">\n                  Birden fazla görev içeren kapsamlı teklif oluşturun. Her görev için ayrı miktar, birim ve fiyat belirleyebilirsiniz.\n                </DialogDescription>\n              </div>\n            </div>\n          </DialogHeader>\n          \n          <div className=\"space-y-6\">\n            {/* Teklif Temel Bilgileri */}\n            <div className=\"bg-dark-primary/50 rounded-lg p-4 border border-dark-accent\">\n              <h3 className=\"text-white font-medium mb-3 flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4 text-orange-400\" />\n                Teklif Bilgileri\n              </h3>\n              <Form {...quoteForm}>\n                <div className=\"space-y-4\">\n                  {/* Sayın Alanı */}\n                  <div>\n                    <label className=\"text-white text-sm font-medium block mb-2\">\n                      Sayın\n                    </label>\n                    <Input \n                      value={customer?.name || \"\"}\n                      disabled\n                      className=\"bg-dark-primary border-dark-accent text-gray-300 h-10\"\n                    />\n                  </div>\n\n                  <FormField\n                    control={quoteForm.control}\n                    name=\"title\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-white text-sm font-medium\">\n                          Teklif Başlığı *\n                        </FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Örn: Ofis Tadilat Projesi Teklifi\"\n                            className=\"bg-dark-primary border-dark-accent text-white h-10\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={quoteForm.control}\n                      name=\"quoteDate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-white text-sm font-medium\">\n                            Teklif Tarihi\n                          </FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"date\"\n                              className=\"bg-dark-primary border-dark-accent text-white h-10\"\n                              value={field.value ? new Date(field.value).toISOString().split('T')[0] : ''}\n                              onChange={(e) => field.onChange(new Date(e.target.value))}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={quoteForm.control}\n                      name=\"validUntil\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-white text-sm font-medium\">\n                            Geçerlilik Tarihi\n                          </FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"date\"\n                              className=\"bg-dark-primary border-dark-accent text-white h-10\"\n                              value={field.value ? new Date(field.value).toISOString().split('T')[0] : ''}\n                              onChange={(e) => field.onChange(e.target.value ? new Date(e.target.value) : undefined)}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={quoteForm.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-white text-sm font-medium\">\n                          Genel Açıklama\n                        </FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Teklif hakkında genel bilgiler, şartlar ve notlar\"\n                            className=\"bg-dark-primary border-dark-accent text-white\"\n                            rows={3}\n                            {...field}\n                            value={field.value || \"\"}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* KDV Seçenekleri */}\n                  <div className=\"border-t border-dark-accent pt-4\">\n                    <h4 className=\"text-white font-medium mb-3 flex items-center gap-2\">\n                      <Calculator className=\"h-4 w-4 text-blue-400\" />\n                      KDV Ayarları\n                    </h4>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center space-x-3\">\n                        <input\n                          type=\"checkbox\"\n                          id=\"hasVAT\"\n                          checked={hasVAT}\n                          onChange={(e) => setHasVAT(e.target.checked)}\n                          className=\"w-4 h-4 text-blue-600 bg-dark-primary border-dark-accent rounded focus:ring-blue-500\"\n                        />\n                        <label htmlFor=\"hasVAT\" className=\"text-white text-sm font-medium\">\n                          KDV Dahil Et\n                        </label>\n                      </div>\n                      \n                      {hasVAT && (\n                        <Select onValueChange={(value) => setVatRate(parseInt(value))} defaultValue={vatRate.toString()}>\n                          <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                            <SelectValue placeholder=\"KDV oranı seçin\" />\n                          </SelectTrigger>\n                          <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                            <SelectItem value=\"1\">%1</SelectItem>\n                            <SelectItem value=\"10\">%10</SelectItem>\n                            <SelectItem value=\"20\">%20</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </Form>\n            </div>\n\n            {/* Görev Ekleme Formu */}\n            <div className=\"bg-dark-primary/50 rounded-lg p-4 border border-dark-accent\">\n              <h3 className=\"text-white font-medium mb-4 flex items-center gap-2\">\n                <Plus className=\"h-4 w-4 text-blue-400\" />\n                Görev Ekle\n                <span className=\"text-xs text-gray-400 ml-2\">\n                  (Her görev için ayrı miktar, birim ve fiyat belirleyin)\n                </span>\n              </h3>\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <Input\n                    placeholder=\"Görev adı (Örn: Duvar boyası)\"\n                    value={currentItem.title}\n                    onChange={(e) => setCurrentItem(prev => ({ ...prev, title: e.target.value }))}\n                    className=\"bg-dark-primary border-dark-accent text-white h-10\"\n                  />\n                  <Textarea\n                    placeholder=\"Görev detayları (Opsiyonel)\"\n                    value={currentItem.description}\n                    onChange={(e) => setCurrentItem(prev => ({ ...prev, description: e.target.value }))}\n                    className=\"bg-dark-primary border-dark-accent text-white\"\n                    rows={1}\n                  />\n                </div>\n                <div className=\"grid grid-cols-4 gap-3\">\n                  <div>\n                    <label className=\"text-sm text-gray-300 mb-2 block font-medium\">Miktar</label>\n                    <Input\n                      type=\"number\"\n                      step=\"0.1\"\n                      min=\"0.1\"\n                      value={currentItem.quantity}\n                      onChange={(e) => setCurrentItem(prev => ({ ...prev, quantity: parseFloat(e.target.value) || 1 }))}\n                      className=\"bg-dark-primary border-dark-accent text-white h-10\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-gray-300 mb-2 block font-medium\">Birim</label>\n                    <Select \n                      value={currentItem.unit} \n                      onValueChange={(value) => setCurrentItem(prev => ({ ...prev, unit: value }))}\n                    >\n                      <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white h-10\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                        <SelectItem value=\"adet\">Adet</SelectItem>\n                        <SelectItem value=\"m2\">m²</SelectItem>\n                        <SelectItem value=\"m\">m (Metre)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-gray-300 mb-2 block font-medium\">Birim Fiyat (TL)</label>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={currentItem.unitPrice}\n                      onChange={(e) => setCurrentItem(prev => ({ ...prev, unitPrice: parseFloat(e.target.value) || 0 }))}\n                      className=\"bg-dark-primary border-dark-accent text-white h-10\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-gray-300 mb-2 block font-medium\">Ara Toplam</label>\n                    <div className=\"bg-orange-500/20 border border-orange-500/30 rounded-md h-10 flex items-center px-3 text-orange-400 font-medium\">\n                      ₺{(currentItem.quantity * currentItem.unitPrice).toFixed(2)}\n                    </div>\n                  </div>\n                </div>\n                <Button\n                  type=\"button\"\n                  onClick={addQuoteItem}\n                  className=\"w-full bg-blue-500 hover:bg-blue-600 h-10\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Listiye Ekle\n                </Button>\n              </div>\n            </div>\n\n            {/* Eklenen Görevler Listesi */}\n            {quoteItems.length > 0 && (\n              <div className=\"bg-dark-primary/30 rounded-lg p-4 border border-dark-accent\">\n                <h3 className=\"text-white font-medium mb-4 flex items-center gap-2\">\n                  <FileText className=\"h-4 w-4 text-green-400\" />\n                  Eklenen Görevler ({quoteItems.length})\n                </h3>\n                <div className=\"space-y-3 max-h-64 overflow-y-auto\">\n                  {quoteItems.map((item) => (\n                    <div key={item.id} className=\"bg-dark-primary rounded-lg p-3 border border-dark-accent\">\n                      <div className=\"flex justify-between items-start\">\n                        <div className=\"flex-1\">\n                          <h5 className=\"text-white font-medium text-sm\">{item.title}</h5>\n                          {item.description && (\n                            <p className=\"text-gray-400 text-xs mt-1\">{item.description}</p>\n                          )}\n                          <div className=\"flex items-center gap-4 mt-2 text-xs text-gray-300\">\n                            <span>{item.quantity} {item.unit}</span>\n                            <span>{formatCurrency(item.unitPrice.toString())} / {item.unit}</span>\n                            <span className=\"text-orange-400 font-medium\">{formatCurrency(item.totalPrice.toString())}</span>\n                          </div>\n                        </div>\n                        <div className=\"flex gap-1\">\n                          <Button\n                            type=\"button\"\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => editQuoteItem(item.id)}\n                            className=\"text-blue-400 hover:text-blue-300 hover:bg-blue-500/10 h-6 w-6 p-0\"\n                          >\n                            <Edit className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            type=\"button\"\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => removeQuoteItem(item.id)}\n                            className=\"text-red-400 hover:text-red-300 hover:bg-red-500/10 h-6 w-6 p-0\"\n                          >\n                            <X className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n                \n                {/* Toplam Tutar ve Export Butonları */}\n                <div className=\"mt-4 pt-3 border-t border-dark-accent\">\n                  <div className=\"flex justify-between items-center mb-4\">\n                    <span className=\"text-white font-bold\">Toplam Teklif Tutarı:</span>\n                    <span className=\"text-2xl font-bold text-orange-400\">\n                      {formatCurrency(getQuoteTotals().total.toString())}\n                    </span>\n                  </div>\n                  \n                  {/* Export Buttons */}\n                  <div className=\"flex gap-2\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={exportToExcel}\n                      className=\"flex-1 border-green-500 text-green-400 hover:bg-green-500/10 h-8\"\n                    >\n                      <FileSpreadsheet className=\"h-3 w-3 mr-2\" />\n                      Excel\n                    </Button>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={exportToPDF}\n                      className=\"flex-1 border-red-500 text-red-400 hover:bg-red-500/10 h-8\"\n                    >\n                      <Download className=\"h-3 w-3 mr-2\" />\n                      PDF\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Teklif Şartları - Düzenlenebilir */}\n            <div className=\"bg-dark-primary/50 rounded-lg p-4 border border-dark-accent\">\n              <h3 className=\"text-white font-medium mb-3 flex items-center gap-2\">\n                <FileText className=\"h-4 w-4 text-blue-400\" />\n                Teklif Şartları\n              </h3>\n              <div className=\"space-y-3\">\n                {quoteTerms.map((term, index) => (\n                  <div key={index} className=\"flex items-start gap-2\">\n                    <span className=\"text-orange-400 mt-1\">•</span>\n                    <Input\n                      value={term}\n                      onChange={(e) => {\n                        const newTerms = [...quoteTerms];\n                        newTerms[index] = e.target.value;\n                        setQuoteTerms(newTerms);\n                      }}\n                      className=\"bg-dark-primary border-dark-accent text-white text-sm\"\n                      placeholder=\"Şart yazın...\"\n                    />\n                    <Button\n                      type=\"button\"\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => {\n                        const newTerms = quoteTerms.filter((_, i) => i !== index);\n                        setQuoteTerms(newTerms);\n                      }}\n                      className=\"text-red-400 hover:text-red-300 hover:bg-red-500/10 h-6 w-6 p-0 mt-1\"\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </Button>\n                  </div>\n                ))}\n                <Button\n                  type=\"button\"\n                  size=\"sm\"\n                  onClick={() => setQuoteTerms([...quoteTerms, ''])}\n                  className=\"bg-blue-500 hover:bg-blue-600 h-8\"\n                >\n                  <Plus className=\"h-3 w-3 mr-2\" />\n                  Yeni Şart Ekle\n                </Button>\n              </div>\n            </div>\n\n            {/* Form Buttons */}\n            <div className=\"flex gap-3 pt-6 border-t border-dark-accent\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={handleCloseQuoteForm}\n                className=\"flex-1 border-gray-600 text-gray-300 hover:bg-gray-600/20 h-11\"\n              >\n                İptal\n              </Button>\n              <Button \n                type=\"button\"\n                onClick={quoteForm.handleSubmit(onSubmitQuote)}\n                className=\"flex-2 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 h-11 text-white font-medium\"\n                disabled={createQuoteMutation.isPending || updateQuoteMutation.isPending || quoteItems.length === 0}\n              >\n                {createQuoteMutation.isPending || updateQuoteMutation.isPending ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                    {editingQuote ? \"Güncelleniyor...\" : \"Oluşturuluyor...\"}\n                  </>\n                ) : (\n                  <>\n                    <FileText className=\"h-4 w-4 mr-2\" />\n                    {editingQuote ? \"Teklifi Güncelle\" : \"Teklifi Oluştur\"}\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":91128},"server/auth.ts":{"content":"import type { Express, RequestHandler } from \"express\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { sessions } from \"@shared/schema\";\nimport { eq, and, lt, gt } from \"drizzle-orm\";\nimport multer from \"multer\";\n\n// Database-based session management\nconst createSession = async (userId: string): Promise<string> => {\n  const sessionId = Math.random().toString(36).substring(2, 15);\n  const expires = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000); // 30 days\n  \n  await db.insert(sessions).values({\n    sid: sessionId,\n    sess: { userId, expires: expires.toISOString() },\n    expire: expires\n  });\n  \n  return sessionId;\n};\n\nexport const getSession = async (sessionId: string): Promise<any | null> => {\n  try {\n    const [session] = await db\n      .select()\n      .from(sessions)\n      .where(and(eq(sessions.sid, sessionId), gt(sessions.expire, new Date())));\n    \n    if (!session) return null;\n    \n    const sessionData = session.sess as any;\n    const user = sessionData.userId ? await storage.getUser(sessionData.userId) : null;\n    \n    // Check if user is suspended and invalidate session\n    if (user && user.status === 'SUSPENDED') {\n      await deleteSession(sessionId);\n      console.log(\"Session invalidated for suspended user:\", user.email);\n      return null;\n    }\n    \n    return user;\n  } catch (error) {\n    console.error(\"Get session error:\", error);\n    return null;\n  }\n};\n\nconst deleteSession = async (sessionId: string): Promise<void> => {\n  try {\n    await db.delete(sessions).where(eq(sessions.sid, sessionId));\n  } catch (error) {\n    console.error(\"Delete session error:\", error);\n  }\n};\n\n// Clean up expired sessions every hour\nsetInterval(async () => {\n  try {\n    const deletedCount = await db.delete(sessions).where(lt(sessions.expire, new Date()));\n    console.log(\"Cleaned up expired sessions:\", deletedCount);\n  } catch (error) {\n    console.error(\"Session cleanup error:\", error);\n  }\n}, 60 * 60 * 1000);\n\nexport async function setupAuth(app: Express) {\n  // Register endpoint\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const { email, password, firstName, lastName, companyName, phone, city, industry } = req.body;\n      \n      if (!email || !password || !firstName || !lastName) {\n        return res.status(400).json({ message: \"Tüm alanlar gereklidir\" });\n      }\n      \n      // Check if user already exists\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Bu email adresi zaten kullanılıyor\" });\n      }\n      \n      // Create new user with DEMO subscription\n      const newUser = {\n        id: Math.random().toString(36).substring(2, 15),\n        email,\n        password, // In production, hash this password\n        firstName,\n        lastName,\n        profileImageUrl: null,\n        subscriptionType: \"DEMO\",\n        subscriptionStatus: \"ACTIVE\",\n      };\n\n      const user = await storage.upsertUser(newUser);\n      \n      // Generate database session\n      const sessionId = await createSession(user.id);\n      \n      // Set HTTP-only cookie for session\n      res.cookie('session', sessionId, {\n        maxAge: 30 * 24 * 60 * 60 * 1000, // 30 days\n        httpOnly: true,\n        secure: false, // Set to true in production with HTTPS\n        sameSite: 'lax'\n      });\n      \n      console.log(\"User registered:\", user.email, \"Session:\", sessionId);\n      \n      res.json({ success: true, user, sessionId });\n    } catch (error) {\n      console.error(\"Register error:\", error);\n      res.status(500).json({ message: \"Kayıt başarısız\" });\n    }\n  });\n\n  // Login endpoint\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { email, password, isDemo } = req.body;\n      \n      let user;\n      \n      if (isDemo) {\n        // Demo user login - fast and simple with DEMO subscription\n        const demoUser = {\n          id: \"demo-user-1\",\n          email: \"demo@puantajpro.com\",\n          firstName: \"Demo\",\n          lastName: \"User\",\n          profileImageUrl: null,\n          subscriptionType: \"DEMO\",\n          subscriptionStatus: \"ACTIVE\",\n        };\n        user = await storage.upsertUser(demoUser);\n      } else {\n        // Regular user login\n        if (!email || !password) {\n          return res.status(400).json({ message: \"Email ve şifre gereklidir\" });\n        }\n        \n        user = await storage.getUserByEmail(email);\n        if (!user || user.password !== password) {\n          return res.status(401).json({ message: \"Geçersiz email veya şifre\" });\n        }\n        \n        // Check if user is suspended\n        if (user.status === 'SUSPENDED') {\n          return res.status(403).json({ message: \"Hesabınız askıya alınmıştır. Lütfen sistem yöneticisiyle iletişime geçin.\" });\n        }\n      }\n      \n      // Generate database session\n      const sessionId = await createSession(user.id);\n      \n      // Set HTTP-only cookie for session\n      res.cookie('session', sessionId, {\n        maxAge: 30 * 24 * 60 * 60 * 1000, // 30 days\n        httpOnly: true,\n        secure: false, // Set to true in production with HTTPS\n        sameSite: 'lax'\n      });\n      \n      console.log(\"🔐 Login successful - Setting cookie with sessionId:\", sessionId);\n      \n      res.json({ success: true, user, sessionId });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Giriş başarısız\" });\n    }\n  });\n\n  // Check auth endpoint\n  app.get(\"/api/auth/user\", async (req, res) => {\n    try {\n      // Try to get session ID from Authorization header or cookie\n      const authHeader = req.headers.authorization;\n      let sessionId = authHeader?.replace('Bearer ', '') || req.cookies['session'];\n      \n      // Handle signed cookies format: s:sessionId.signature  \n      if (sessionId && sessionId.startsWith('s:')) {\n        sessionId = sessionId.substring(2).split('.')[0];\n      }\n      \n      console.log(\"🔐 Auth debug - Raw sessionId:\", sessionId);\n      console.log(\"🔐 Auth debug - Cookies:\", req.cookies);\n      console.log(\"🔐 Auth debug - Auth header:\", authHeader);\n      \n      if (!sessionId) {\n        console.log(\"🔐 Auth debug - No sessionId found\");\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const user = await getSession(sessionId);\n      \n      if (!user) {\n        console.log(\"🔐 Auth debug - User not found for sessionId\");\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      console.log(\"🔐 Auth debug - User found:\", !!user);\n      console.log(\"🔐 Auth debug - Authentication successful for user:\", user.id);\n\n      // Auto-create company profile if user doesn't have one\n      try {\n        const userCompanies = await storage.getCompanyDirectoryByUserId(user.id);\n        if (userCompanies.length === 0) {\n          // Create default company profile for user\n          const defaultCompany = {\n            companyName: `${user.firstName} ${user.lastName}`,\n            contactPerson: `${user.firstName} ${user.lastName}`,\n            email: user.email,\n            phone: \"\",\n            address: \"\",\n            description: \"Otomatik oluşturulan firma profili\",\n            sector: \"\",\n            website: \"\",\n            hasPROAccess: false,\n            isVerified: false,\n            isBlocked: false,\n            isActive: true\n          };\n          \n          await storage.createCompany(defaultCompany, user.id);\n\n        }\n      } catch (error) {\n        console.error(\"Error auto-creating company profile:\", error);\n        // Don't fail authentication if company creation fails\n      }\n\n\n      res.json(user);\n    } catch (error) {\n      console.error(\"Auth check error:\", error);\n      res.status(401).json({ message: \"Unauthorized\" });\n    }\n  });\n\n  // Logout endpoint\n  app.post(\"/api/auth/logout\", async (req, res) => {\n    try {\n      let sessionId = req.headers.authorization?.replace('Bearer ', '') || req.cookies['session'];\n      \n      // Handle signed cookies format: s:sessionId.signature\n      if (sessionId && sessionId.startsWith('s:')) {\n        sessionId = sessionId.substring(2).split('.')[0];\n      }\n      \n\n      \n      if (sessionId) {\n        await deleteSession(sessionId);\n\n      }\n      \n      // Clear all cookies\n      res.clearCookie('session', { path: '/' });\n      res.clearCookie('connect.sid', { path: '/' });\n      \n      // Add cache control headers to prevent caching\n      res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n      res.setHeader('Pragma', 'no-cache');\n      res.setHeader('Expires', '0');\n      \n\n      res.json({ success: true, message: \"Logout successful\" });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      res.json({ success: true }); // Still return success even if cleanup fails\n    }\n  });\n\n  // Update user profile\n  app.put(\"/api/auth/profile\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { firstName, lastName, email } = req.body;\n      \n      const updatedUser = await storage.updateUser(userId, {\n        firstName,\n        lastName,\n        email,\n        updatedAt: new Date()\n      });\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Change password\n  app.post(\"/api/auth/change-password\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      const { currentPassword, newPassword } = req.body;\n      \n      // Get current user\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Verify current password\n      if (user.password !== currentPassword) {\n        return res.status(400).json({ message: \"Mevcut şifre yanlış\" });\n      }\n      \n      // Update password\n      await storage.updateUser(userId, {\n        password: newPassword,\n        updatedAt: new Date()\n      });\n      \n      res.json({ message: \"Şifre başarıyla değiştirildi\" });\n    } catch (error) {\n      console.error(\"Error changing password:\", error);\n      res.status(500).json({ message: \"Failed to change password\" });\n    }\n  });\n\n  // Profile image upload with multer middleware\n  const upload = multer({ \n    storage: multer.memoryStorage(),\n    limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit\n    fileFilter: (req, file, cb) => {\n      console.log('File upload - mimetype:', file.mimetype);\n      console.log('File upload - originalname:', file.originalname);\n      \n      // Accept common image formats\n      if (file.mimetype === 'image/jpeg' || \n          file.mimetype === 'image/jpg' || \n          file.mimetype === 'image/png' ||\n          file.mimetype === 'image/gif' ||\n          file.mimetype === 'image/webp') {\n        cb(null, true);\n      } else {\n        cb(new Error('Sadece JPG, PNG, GIF ve WebP formatları desteklenmektedir.'), false);\n      }\n    }\n  });\n\n  app.post(\"/api/auth/upload-profile-image\", isAuthenticated, upload.single('profileImage'), async (req, res) => {\n    try {\n      const userId = (req as any).user.id;\n      \n      if (!req.file) {\n        return res.status(400).json({ message: \"Dosya seçilmedi\" });\n      }\n      \n      // Convert image to base64 data URL for storage\n      const base64Image = `data:${req.file.mimetype};base64,${req.file.buffer.toString('base64')}`;\n      \n      console.log('Image converted to base64, length:', base64Image.length);\n      \n      // Update user's profile image URL in database\n      await storage.updateUser(userId, {\n        profileImageUrl: base64Image,\n        updatedAt: new Date()\n      });\n      \n      res.json({ \n        success: true, \n        profileImageUrl: base64Image,\n        message: \"Profil fotoğrafı başarıyla güncellendi\" \n      });\n    } catch (error) {\n      console.error(\"Error uploading profile image:\", error);\n      if (error instanceof Error && error.message.includes('formatları')) {\n        res.status(400).json({ message: error.message });\n      } else {\n        res.status(500).json({ message: \"Fotoğraf yüklenirken hata oluştu\" });\n      }\n    }\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  try {\n    const authHeader = req.headers.authorization;\n    let sessionId = authHeader?.replace('Bearer ', '') || req.cookies['connect.sid'] || req.cookies['session'];\n    \n    console.log(\"🔐 Auth debug - Raw sessionId:\", sessionId);\n    console.log(\"🔐 Auth debug - Cookies:\", req.cookies);\n    \n    // Handle signed cookies format: s:sessionId.signature\n    if (sessionId && sessionId.startsWith('s:')) {\n      sessionId = sessionId.substring(2).split('.')[0];\n      console.log(\"🔐 Auth debug - Cleaned sessionId:\", sessionId);\n    }\n    \n    // Authentication middleware processing\n    \n    if (!sessionId) {\n      console.log(\"🔐 Auth debug - No sessionId found\");\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    const user = await getSession(sessionId);\n    console.log(\"🔐 Auth debug - User found:\", !!user);\n    \n    if (!user) {\n      // Session expired or not found\n      console.log(\"🔐 Auth debug - No user found for session\");\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    // Authentication successful\n    console.log(\"🔐 Auth debug - Authentication successful for user:\", user.id);\n    (req as any).user = user;\n    next();\n  } catch (error) {\n    console.error(\"Auth middleware error:\", error);\n    res.status(401).json({ message: \"Unauthorized\" });\n  }\n};","size_bytes":13790},"client/src/pages/landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Building2, Users, Clock, DollarSign, BarChart3, MessageSquare } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Landing() {\n  const { toast } = useToast();\n\n  const loginMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"/api/auth/login\", \"POST\", { isDemo: true });\n    },\n    onSuccess: async (data) => {\n      console.log(\"Login success:\", data);\n      \n      // Store session ID in localStorage\n      if (data.sessionId) {\n        localStorage.setItem('sessionId', data.sessionId);\n        console.log(\"Session ID stored:\", data.sessionId);\n        \n        // Clear auth cache and force re-fetch\n        queryClient.removeQueries({ queryKey: [\"/api/auth/user\"] });\n        \n        // Trigger immediate auth refetch instead of page reload\n        queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n        \n        // Navigate to dashboard without page reload\n        setTimeout(() => {\n          window.location.href = '/';\n        }, 100);\n      }\n      \n      toast({\n        title: \"Başarıyla giriş yapıldı!\",\n        description: \"puantropls'ya hoş geldiniz.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Giriş hatası\",\n        description: error.message || \"Giriş yapılırken bir hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleLogin = () => {\n    loginMutation.mutate();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-900 via-gray-900 to-black text-white\">\n      <div className=\"container mx-auto px-4 py-16\">\n        {/* Header */}\n        <div className=\"text-center mb-16\">\n          <h1 className=\"text-5xl font-bold mb-6 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent\">\n            puantropls\n          </h1>\n          <p className=\"text-xl text-gray-300 mb-8 max-w-3xl mx-auto\">\n            Türkiye'nin en gelişmiş personel puantaj ve proje yönetim sistemi. \n            İş gücü verimliliğinizi artırın, finansal takibinizi optimize edin.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Button\n              onClick={() => loginMutation.mutate()}\n              size=\"lg\"\n              className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold px-8 py-4 rounded-lg text-lg\"\n              disabled={loginMutation.isPending}\n            >\n              {loginMutation.isPending ? \"Giriş yapılıyor...\" : \"Demo Giriş Yap\"}\n            </Button>\n            \n            <div className=\"flex gap-2 justify-center\">\n              <Link href=\"/login\">\n                <Button variant=\"outline\" size=\"lg\" className=\"border-gray-600 text-gray-300 hover:bg-gray-700 hover:text-white px-6 py-4 text-lg\">\n                  Giriş Yap\n                </Button>\n              </Link>\n              <Link href=\"/register\">\n                <Button variant=\"outline\" size=\"lg\" className=\"border-gray-600 text-gray-300 hover:bg-gray-700 hover:text-white px-6 py-4 text-lg\">\n                  Kayıt Ol\n                </Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n\n        {/* Features Grid */}\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16\">\n          <Card className=\"bg-gray-800/50 border-gray-700 backdrop-blur-sm\">\n            <CardHeader>\n              <div className=\"flex items-center gap-3\">\n                <Clock className=\"h-8 w-8 text-blue-400\" />\n                <CardTitle className=\"text-white\">Puantaj Yönetimi</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <CardDescription className=\"text-gray-300\">\n                Personel çalışma saatlerini kolayca takip edin. Otomatik hesaplama ve raporlama sistemi.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/50 border-gray-700 backdrop-blur-sm\">\n            <CardHeader>\n              <div className=\"flex items-center gap-3\">\n                <Users className=\"h-8 w-8 text-green-400\" />\n                <CardTitle className=\"text-white\">Personel Yönetimi</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <CardDescription className=\"text-gray-300\">\n                Kapsamlı personel kayıtları, maaş takibi ve performans analizi.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/50 border-gray-700 backdrop-blur-sm\">\n            <CardHeader>\n              <div className=\"flex items-center gap-3\">\n                <Building2 className=\"h-8 w-8 text-purple-400\" />\n                <CardTitle className=\"text-white\">Proje Takibi</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <CardDescription className=\"text-gray-300\">\n                Müşteri projeleri, teklif sistemi ve iş akışı yönetimi.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/50 border-gray-700 backdrop-blur-sm\">\n            <CardHeader>\n              <div className=\"flex items-center gap-3\">\n                <DollarSign className=\"h-8 w-8 text-yellow-400\" />\n                <CardTitle className=\"text-white\">Finansal Takip</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <CardDescription className=\"text-gray-300\">\n                Gelir-gider takibi, otomatik kasa yönetimi ve finansal raporlar.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/50 border-gray-700 backdrop-blur-sm\">\n            <CardHeader>\n              <div className=\"flex items-center gap-3\">\n                <BarChart3 className=\"h-8 w-8 text-red-400\" />\n                <CardTitle className=\"text-white\">Analytics & Raporlar</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <CardDescription className=\"text-gray-300\">\n                Detaylı analitik raporlar ve performans metrikleri.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gray-800/50 border-gray-700 backdrop-blur-sm\">\n            <CardHeader>\n              <div className=\"flex items-center gap-3\">\n                <MessageSquare className=\"h-8 w-8 text-indigo-400\" />\n                <CardTitle className=\"text-white\">Firma Rehberi</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <CardDescription className=\"text-gray-300\">\n                Diğer firmalarla iletişim ve mesajlaşma sistemi.\n              </CardDescription>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* CTA Section */}\n        <div className=\"text-center\">\n          <Card className=\"bg-gradient-to-r from-blue-800/30 to-purple-800/30 border-blue-500/50 backdrop-blur-sm max-w-2xl mx-auto\">\n            <CardHeader>\n              <CardTitle className=\"text-2xl text-white\">Hemen Başlayın</CardTitle>\n              <CardDescription className=\"text-gray-300\">\n                puantropls ile iş süreçlerinizi dijitalleştirin ve verimliliğinizi artırın.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Button \n                size=\"lg\" \n                className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-3 text-lg\"\n                onClick={handleLogin}\n                disabled={loginMutation.isPending}\n              >\n                {loginMutation.isPending ? \"Giriş yapılıyor...\" : \"Demo Giriş Yap\"}\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8295},"client/src/pages/admin-dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { \n  Users, \n  UserCheck, \n  UserX, \n  Search, \n  MoreHorizontal,\n  Calendar,\n  Mail,\n  Shield,\n  Activity,\n  Trash2,\n  AlertTriangle\n} from \"lucide-react\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { tr } from \"date-fns/locale\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function AdminDashboard() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n\n  // Fetch all users and admin stats\n  const { data: adminData, isLoading } = useQuery({\n    queryKey: [\"/api/admin/stats\"],\n  });\n\n  const { data: allUsers, isLoading: usersLoading } = useQuery({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  // Delete all users except super admin mutation\n  const deleteAllUsersMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/admin/users/delete-all-except-super\");\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Başarılı\",\n        description: `${data.deletedCount} kullanıcı başarıyla silindi (süper admin korundu)`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      setShowDeleteDialog(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Kullanıcıları silerken bir hata oluştu\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Filter users based on search\n  const filteredUsers = (allUsers || []).filter((user: any) =>\n    user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (isLoading || usersLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  const stats = adminData || {\n    totalUsers: 0,\n    activeUsers: 0,\n    demoUsers: 0,\n    todayRegistrations: 0\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-100\">\n            Admin Yönetim Paneli\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n            Kullanıcı yönetimi ve sistem istatistikleri\n          </p>\n        </div>\n        <Badge variant=\"secondary\" className=\"flex items-center gap-2\">\n          <Shield className=\"h-4 w-4\" />\n          Yönetici\n        </Badge>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Toplam Kullanıcı</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.totalUsers}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              Kayıtlı kullanıcı sayısı\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Aktif Kullanıcı</CardTitle>\n            <UserCheck className=\"h-4 w-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.activeUsers}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              Son 30 günde giriş yapmış\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Demo Kullanıcı</CardTitle>\n            <Activity className=\"h-4 w-4 text-blue-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.demoUsers}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              Demo hesabı kullanan\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Bugünkü Kayıt</CardTitle>\n            <Calendar className=\"h-4 w-4 text-purple-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.todayRegistrations}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              Bugün kayıt olan\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"users\" className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <TabsList>\n            <TabsTrigger value=\"users\">Kullanıcı Listesi</TabsTrigger>\n            <TabsTrigger value=\"analytics\">Analitik</TabsTrigger>\n          </TabsList>\n          \n          {/* Delete All Users Button - Only for SUPER_ADMIN */}\n          {user?.isAdmin && (\n            <Dialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n              <DialogTrigger asChild>\n                <Button variant=\"destructive\" size=\"sm\" className=\"flex items-center gap-2\">\n                  <Trash2 className=\"h-4 w-4\" />\n                  Tüm Kullanıcıları Sil\n                </Button>\n              </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle className=\"flex items-center gap-2 text-red-600\">\n                  <AlertTriangle className=\"h-5 w-5\" />\n                  Tehlikeli İşlem\n                </DialogTitle>\n                <DialogDescription className=\"text-gray-600\">\n                  Bu işlem süper admin hariç <strong>TÜM KULLANICILAR</strong>ı ve onlara ait \n                  <strong> TÜM VERİLERİ</strong> kalıcı olarak silecektir.\n                  <br/><br/>\n                  Bu işlem <strong>GERİ ALINAMAZ</strong>. Emin misiniz?\n                </DialogDescription>\n              </DialogHeader>\n              <DialogFooter className=\"flex gap-2\">\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setShowDeleteDialog(false)}\n                  disabled={deleteAllUsersMutation.isPending}\n                >\n                  İptal\n                </Button>\n                <Button \n                  variant=\"destructive\" \n                  onClick={() => deleteAllUsersMutation.mutate()}\n                  disabled={deleteAllUsersMutation.isPending}\n                  className=\"flex items-center gap-2\"\n                >\n                  {deleteAllUsersMutation.isPending && (\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  )}\n                  Evet, Tüm Kullanıcıları Sil\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n          )}\n        </div>\n\n        <TabsContent value=\"users\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Kullanıcı Yönetimi</CardTitle>\n                <div className=\"flex items-center space-x-2\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n                    <Input\n                      placeholder=\"Kullanıcı ara...\"\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                      className=\"pl-10 w-80\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Kullanıcı</TableHead>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Durum</TableHead>\n                    <TableHead>Kayıt Tarihi</TableHead>\n                    <TableHead>Son Giriş</TableHead>\n                    <TableHead className=\"text-right\">İşlemler</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredUsers.map((user: any) => (\n                    <TableRow key={user.id}>\n                      <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center space-x-2\">\n                          <div className=\"h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\">\n                            {user.firstName ? user.firstName[0]?.toUpperCase() : 'U'}\n                          </div>\n                          <div>\n                            <div className=\"font-semibold\">\n                              {user.firstName || user.lastName ? \n                                `${user.firstName || ''} ${user.lastName || ''}`.trim() : \n                                'İsimsiz Kullanıcı'\n                              }\n                            </div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              ID: {user.id}\n                            </div>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center space-x-2\">\n                          <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                          <span>{user.email}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={user.email.includes('demo') ? 'secondary' : 'default'}>\n                          {user.email.includes('demo') ? 'Demo' : 'Kayıtlı'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {formatDistanceToNow(new Date(user.createdAt), { \n                          addSuffix: true, \n                          locale: tr \n                        })}\n                      </TableCell>\n                      <TableCell>\n                        {user.lastLoginAt ? \n                          formatDistanceToNow(new Date(user.lastLoginAt), { \n                            addSuffix: true, \n                            locale: tr \n                          }) : \n                          'Hiç giriş yapmamış'\n                        }\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" className=\"h-8 w-8 p-0\">\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              Profil Görüntüle\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              Verileri İndir\n                            </DropdownMenuItem>\n                            <DropdownMenuItem className=\"text-red-600\">\n                              Kullanıcı Sil\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              {filteredUsers.length === 0 && (\n                <div className=\"text-center py-8\">\n                  <UserX className=\"mx-auto h-12 w-12 text-gray-400\" />\n                  <h3 className=\"mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100\">\n                    Kullanıcı bulunamadı\n                  </h3>\n                  <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n                    Arama kriterlerinize uygun kullanıcı yok.\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"analytics\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Sistem Analitiği</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center py-8\">\n                <Activity className=\"mx-auto h-12 w-12 text-gray-400\" />\n                <h3 className=\"mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100\">\n                  Analitik Geliştiriliyor\n                </h3>\n                <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n                  Kullanıcı davranış analitikleri yakında eklenecek.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":14481},"client/src/pages/company-directory.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardHeader, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertCompanyDirectorySchema, insertMessageSchema, type CompanyDirectory, type InsertCompanyDirectory, type Message, type InsertMessage, type Notification } from \"@shared/schema\";\nimport { Building2, Phone, Mail, Globe, MapPin, MessageCircle, Plus, Search, Users, Send, X, Star, Shield, Filter, Bell, Block, VolumeX, Flag, CheckCircle, Crown, Verified } from \"lucide-react\";\n\nexport default function CompanyDirectory() {\n  const [showForm, setShowForm] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [cityFilter, setCityFilter] = useState(\"\");\n  const [industryFilter, setIndustryFilter] = useState(\"\");\n  const [verifiedFilter, setVerifiedFilter] = useState<boolean | undefined>(undefined);\n  const [selectedCompany, setSelectedCompany] = useState<CompanyDirectory | null>(null);\n  const [showChat, setShowChat] = useState(false);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"directory\");\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Enhanced PRO Company Directory query with filters\n  const { data: companies = [], isLoading } = useQuery<CompanyDirectory[]>({\n    queryKey: [\"/api/directory/firms\", { searchTerm, cityFilter, industryFilter, verifiedFilter }],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (searchTerm) params.append(\"search\", searchTerm);\n      if (cityFilter) params.append(\"city\", cityFilter);\n      if (industryFilter) params.append(\"industry\", industryFilter);\n      if (verifiedFilter !== undefined) params.append(\"verified\", verifiedFilter.toString());\n      \n      const response = await apiRequest(`/api/directory/firms?${params.toString()}`, \"GET\");\n      return Array.isArray(response) ? response : [];\n    },\n  });\n\n  // Notifications query\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n    staleTime: 1000 * 60 * 30, // 30 min cache\n    refetchOnWindowFocus: false, // Poll every 5 seconds\n  });\n\n  // Conversations query\n  const { data: conversations = [] } = useQuery({\n    queryKey: [\"/api/threads\"],\n    enabled: activeTab === \"messages\",\n    refetchInterval: 3000, // Poll every 3 seconds when on messages tab\n  });\n\n  // Get messages for selected conversation\n  const { data: messages = [], refetch: refetchMessages } = useQuery<Message[]>({\n    queryKey: [\"/api/messages\", selectedCompany?.id, \"current-user\"],\n    queryFn: async () => {\n      if (!selectedCompany) return [];\n      try {\n        const response = await apiRequest(`/api/messages/${selectedCompany.id}/current-user`, \"GET\");\n        return Array.isArray(response) ? response : [];\n      } catch (error) {\n        console.error(\"Messages fetch error:\", error);\n        return [];\n      }\n    },\n    enabled: !!selectedCompany && showChat,\n    refetchInterval: 3000, // Poll every 3 seconds for new messages\n  });\n\n  const createCompanyMutation = useMutation({\n    mutationFn: (data: InsertCompanyDirectory) => apiRequest(\"/api/company-directory\", \"POST\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/company-directory\"] });\n      toast({ title: \"Başarılı\", description: \"Firma başarıyla eklendi\" });\n      setShowForm(false);\n      form.reset();\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Firma eklenirken hata oluştu\", variant: \"destructive\" });\n    },\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: (data: InsertMessage) => apiRequest(\"/api/messages\", \"POST\", data),\n    onSuccess: () => {\n      refetchMessages();\n      setNewMessage(\"\");\n      toast({ title: \"Başarılı\", description: \"Mesaj gönderildi\" });\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Mesaj gönderilemedi\", variant: \"destructive\" });\n    },\n  });\n\n  const form = useForm<InsertCompanyDirectory>({\n    resolver: zodResolver(insertCompanyDirectorySchema),\n    defaultValues: {\n      companyName: \"\",\n      contactPerson: \"\",\n      phone: \"\",\n      email: \"\",\n      address: \"\",\n      city: \"\",\n      industry: \"\",\n      website: \"\",\n      description: \"\",\n      bio: \"\",\n      logoUrl: \"\",\n      isActive: true,\n      isProVisible: false,\n      subscriptionStatus: \"FREE\"\n    },\n  });\n\n  const onSubmit = (data: InsertCompanyDirectory) => {\n    createCompanyMutation.mutate(data);\n  };\n\n  const filteredCompanies = companies.filter((company) =>\n    company.companyName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    company.contactPerson.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    (company.industry && company.industry.toLowerCase().includes(searchTerm.toLowerCase()))\n  );\n\n  const startConversation = (company: CompanyDirectory) => {\n    setSelectedCompany(company);\n    setShowChat(true);\n  };\n\n  const handleSendMessage = () => {\n    if (!newMessage.trim() || !selectedCompany) return;\n    \n    sendMessageMutation.mutate({\n      fromCompanyId: \"current-user\", // Bu gerçek uygulamada authentication'dan gelecek\n      toCompanyId: selectedCompany.id,\n      message: newMessage.trim(),\n      messageType: \"text\",\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Auto scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const formatMessageTime = (dateString: string) => {\n    return new Date(dateString).toLocaleTimeString(\"tr-TR\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-white flex items-center gap-3\">\n            <Building2 className=\"h-8 w-8 text-blue-400\" />\n            Firma Rehberi\n          </h1>\n          <p className=\"text-gray-400 mt-2\">Uygulamayı kullanan firmalarla iletişime geçin</p>\n        </div>\n        <Button\n          onClick={() => setShowForm(true)}\n          className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Yeni Firma Ekle\n        </Button>\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"relative\">\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n        <Input\n          placeholder=\"Firma adı, yetkili kişi veya sektör ile ara...\"\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          className=\"pl-10 bg-dark-primary border-dark-accent text-white\"\n        />\n      </div>\n\n      {/* Companies Grid */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[1, 2, 3, 4, 5, 6].map((i) => (\n            <div key={i} className=\"bg-dark-secondary rounded-lg p-6 animate-pulse\">\n              <div className=\"h-6 bg-gray-700 rounded mb-4\"></div>\n              <div className=\"h-4 bg-gray-700 rounded mb-2\"></div>\n              <div className=\"h-4 bg-gray-700 rounded mb-4\"></div>\n              <div className=\"h-10 bg-gray-700 rounded\"></div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {filteredCompanies.map((company: CompanyDirectory) => (\n            <Card key={company.id} className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div>\n                    <h3 className=\"text-xl font-semibold text-white\">{company.companyName}</h3>\n                    <p className=\"text-blue-400 font-medium\">{company.contactPerson}</p>\n                  </div>\n                  {company.isActive && (\n                    <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30\">\n                      Aktif\n                    </Badge>\n                  )}\n                </div>\n                {company.industry && (\n                  <Badge variant=\"outline\" className=\"w-fit text-gray-300 border-gray-600\">\n                    {company.industry}\n                  </Badge>\n                )}\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {company.phone && (\n                  <div className=\"flex items-center gap-2 text-gray-300\">\n                    <Phone className=\"h-4 w-4 text-blue-400\" />\n                    <span className=\"text-sm\">{company.phone}</span>\n                  </div>\n                )}\n                {company.email && (\n                  <div className=\"flex items-center gap-2 text-gray-300\">\n                    <Mail className=\"h-4 w-4 text-blue-400\" />\n                    <span className=\"text-sm\">{company.email}</span>\n                  </div>\n                )}\n                {company.address && (\n                  <div className=\"flex items-center gap-2 text-gray-300\">\n                    <MapPin className=\"h-4 w-4 text-blue-400\" />\n                    <span className=\"text-sm\">{company.address}</span>\n                  </div>\n                )}\n                {company.website && (\n                  <div className=\"flex items-center gap-2 text-gray-300\">\n                    <Globe className=\"h-4 w-4 text-blue-400\" />\n                    <a \n                      href={company.website.startsWith('http') ? company.website : `https://${company.website}`}\n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                      className=\"text-sm hover:text-blue-400 transition-colors\"\n                    >\n                      {company.website}\n                    </a>\n                  </div>\n                )}\n                {company.description && (\n                  <p className=\"text-sm text-gray-400 mt-3 line-clamp-2\">\n                    {company.description}\n                  </p>\n                )}\n                <div className=\"pt-3\">\n                  <Button\n                    onClick={() => startConversation(company)}\n                    className=\"w-full bg-blue-600 hover:bg-blue-700 text-white\"\n                    size=\"sm\"\n                  >\n                    <MessageCircle className=\"h-4 w-4 mr-2\" />\n                    Mesaj Gönder\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {filteredCompanies.length === 0 && !isLoading && (\n        <div className=\"text-center py-12\">\n          <Users className=\"h-16 w-16 text-gray-600 mx-auto mb-4\" />\n          <h3 className=\"text-xl font-semibold text-gray-300 mb-2\">\n            {searchTerm ? \"Arama sonucu bulunamadı\" : \"Henüz firma eklenmemiş\"}\n          </h3>\n          <p className=\"text-gray-500\">\n            {searchTerm ? \"Farklı anahtar kelimeler deneyin\" : \"İlk firmayı ekleyerek başlayın\"}\n          </p>\n        </div>\n      )}\n\n      {/* Add Company Form Dialog */}\n      <Dialog open={showForm} onOpenChange={setShowForm}>\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-lg max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-white\">Yeni Firma Ekle</DialogTitle>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3\">\n              <FormField\n                control={form.control}\n                name=\"companyName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Firma Adı *</FormLabel>\n                    <FormControl>\n                      <Input \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Firma adını giriniz\"\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"contactPerson\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Yetkili Kişi *</FormLabel>\n                    <FormControl>\n                      <Input \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Yetkili kişi adı\"\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-3\">\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Telefon</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"0555 555 55 55\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">E-posta</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"email\"\n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"info@firma.com\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"industry\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Sektör</FormLabel>\n                    <FormControl>\n                      <Input \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"İnşaat, Teknoloji, Sağlık vs.\"\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"website\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Website</FormLabel>\n                    <FormControl>\n                      <Input \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"www.firma.com\"\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"address\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Adres</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Firma adresi\"\n                        rows={1}\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Açıklama</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Firma hakkında kısa açıklama\"\n                        rows={2}\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex gap-3 pt-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setShowForm(false)}\n                  className=\"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createCompanyMutation.isPending}\n                  className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\n                >\n                  {createCompanyMutation.isPending ? \"Ekleniyor...\" : \"Firma Ekle\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Chat Dialog */}\n      <Dialog open={showChat} onOpenChange={setShowChat}>\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-lg max-h-[85vh] p-0\">\n          <DialogHeader className=\"p-6 pb-3 border-b border-dark-accent\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Building2 className=\"h-6 w-6 text-blue-400\" />\n                <div>\n                  <DialogTitle className=\"text-white text-lg\">\n                    {selectedCompany?.companyName}\n                  </DialogTitle>\n                  <p className=\"text-sm text-gray-400\">{selectedCompany?.contactPerson}</p>\n                </div>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setShowChat(false)}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </DialogHeader>\n          \n          {/* Messages Area */}\n          <div className=\"flex flex-col h-[70vh]\">\n            <ScrollArea className=\"flex-1 p-4\">\n              <div className=\"space-y-4\">\n                {messages.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <MessageCircle className=\"h-12 w-12 text-gray-600 mx-auto mb-3\" />\n                    <p className=\"text-gray-400\">Henüz mesaj yok</p>\n                    <p className=\"text-sm text-gray-500\">İlk mesajınızı göndererek sohbeti başlatın</p>\n                  </div>\n                ) : (\n                  messages.map((message) => (\n                    <div\n                      key={message.id}\n                      className={`flex ${\n                        message.fromCompanyId === \"current-user\" ? \"justify-end\" : \"justify-start\"\n                      }`}\n                    >\n                      <div\n                        className={`max-w-[70%] px-4 py-2 rounded-lg ${\n                          message.fromCompanyId === \"current-user\"\n                            ? \"bg-blue-600 text-white\"\n                            : \"bg-gray-700 text-gray-100\"\n                        }`}\n                      >\n                        <p className=\"text-sm\">{message.message}</p>\n                        <p\n                          className={`text-xs mt-1 ${\n                            message.fromCompanyId === \"current-user\"\n                              ? \"text-blue-200\"\n                              : \"text-gray-400\"\n                          }`}\n                        >\n                          {formatMessageTime(message.createdAt)}\n                        </p>\n                      </div>\n                    </div>\n                  ))\n                )}\n                <div ref={messagesEndRef} />\n              </div>\n            </ScrollArea>\n            \n            {/* Message Input */}\n            <div className=\"p-4 border-t border-dark-accent\">\n              <div className=\"flex gap-2\">\n                <Textarea\n                  value={newMessage}\n                  onChange={(e) => setNewMessage(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Mesajınızı yazın...\"\n                  className=\"flex-1 bg-dark-primary border-dark-accent text-white resize-none min-h-[2.5rem]\"\n                  rows={2}\n                />\n                <Button\n                  onClick={handleSendMessage}\n                  disabled={!newMessage.trim() || sendMessageMutation.isPending}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 self-end\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2\">\n                Enter ile gönder, Shift+Enter ile yeni satır\n              </p>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":22966},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function useAuth() {\n  // SessionId var mı kontrol et - yoksa query'yi çalıştırma\n  const sessionId = typeof window !== 'undefined' ? localStorage.getItem('sessionId') : null;\n  \n  const { data: user, isLoading, error, refetch } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: async () => {\n      try {\n        const result = await apiRequest(\"/api/auth/user\", \"GET\");\n        return result;\n      } catch (error: any) {\n        if (error.message.includes('401')) {\n          return null;\n        }\n        throw error;\n      }\n    },\n    enabled: !!sessionId, // SessionId varsa query'yi çalıştır\n    retry: false,\n    staleTime: 1000 * 60 * 5, // 5 dakika cache\n    refetchOnWindowFocus: false,\n    refetchOnMount: true,\n    refetchInterval: false,\n    refetchIntervalInBackground: false,\n    throwOnError: false\n  });\n\n  // user varsa authenticated\n  const isAuthenticated = !!user;\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated,\n    error,\n    refetch,\n  };\n}","size_bytes":1101},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\n\nexport default function Login() {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      return await apiRequest(\"/api/auth/login\", \"POST\", {\n        email: data.email,\n        password: data.password,\n        isDemo: false,\n      });\n    },\n    onSuccess: (data) => {\n      // Save sessionId to localStorage for dev environment (CORS fallback) \n      if (data.success && data.sessionId) {\n        localStorage.setItem('sessionId', data.sessionId);\n        console.log('🔐 Login successful, sessionId saved:', data.sessionId);\n        window.location.href = '/';\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Giriş başarısız\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const demoLoginMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"/api/auth/login\", \"POST\", { isDemo: true });\n    },\n    onSuccess: (data) => {\n      // Save sessionId to localStorage for dev environment (CORS fallback)\n      if (data.success && data.sessionId) {\n        localStorage.setItem('sessionId', data.sessionId);\n        console.log('🔐 Demo login successful, sessionId saved:', data.sessionId);\n        window.location.href = '/';\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Demo giriş başarısız\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate(formData);\n  };\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md bg-gray-800 border-gray-700\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"text-2xl font-bold text-white\">Giriş Yap</CardTitle>\n          <CardDescription className=\"text-gray-400\">\n            puantropls hesabınıza giriş yapın\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"text-gray-300\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => handleInputChange(\"email\", e.target.value)}\n                className=\"bg-gray-700 border-gray-600 text-white placeholder-gray-400\"\n                placeholder=\"Email adresinizi girin\"\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\" className=\"text-gray-300\">Şifre</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={formData.password}\n                onChange={(e) => handleInputChange(\"password\", e.target.value)}\n                className=\"bg-gray-700 border-gray-600 text-white placeholder-gray-400\"\n                placeholder=\"Şifrenizi girin\"\n                required\n              />\n            </div>\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-blue-600 hover:bg-blue-700\"\n              disabled={loginMutation.isPending}\n            >\n              {loginMutation.isPending ? \"Giriş yapılıyor...\" : \"Giriş Yap\"}\n            </Button>\n          </form>\n\n          <div className=\"mt-4 text-center\">\n            <Button\n              variant=\"outline\"\n              className=\"w-full bg-green-600 hover:bg-green-700 text-white border-green-600\"\n              onClick={() => demoLoginMutation.mutate()}\n              disabled={demoLoginMutation.isPending}\n            >\n              {demoLoginMutation.isPending ? \"Demo yükleniyor...\" : \"Demo Hesabı İle Giriş\"}\n            </Button>\n          </div>\n\n          <div className=\"mt-4 text-center\">\n            <p className=\"text-gray-400\">\n              Hesabınız yok mu?{\" \"}\n              <Link href=\"/register\" className=\"text-blue-400 hover:text-blue-300\">\n                Kayıt olun\n              </Link>\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":4997},"client/src/pages/register.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\n\nexport default function Register() {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    firstName: \"\",\n    lastName: \"\",\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    companyName: \"\",\n    phone: \"\",\n    city: \"\",\n    industry: \"\",\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      if (data.password !== data.confirmPassword) {\n        throw new Error(\"Şifreler eşleşmiyor\");\n      }\n      \n      return await apiRequest(\"/api/auth/register\", \"POST\", {\n        firstName: data.firstName,\n        lastName: data.lastName,\n        email: data.email,\n        password: data.password,\n        companyName: data.companyName,\n        phone: data.phone,\n        city: data.city,\n        industry: data.industry,\n      });\n    },\n    onSuccess: (data) => {\n      // Cookie automatically set by server, just redirect\n      if (data.success) {\n        window.location.replace('/');\n      }\n    },\n    onError: (error: Error) => {\n      console.error(\"Register error:\", error);\n      toast({\n        title: \"Kayıt başarısız\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    registerMutation.mutate(formData);\n  };\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md bg-gray-800 border-gray-700\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"text-2xl font-bold text-white\">Kayıt Ol</CardTitle>\n          <CardDescription className=\"text-gray-400\">\n            PuantajPro hesabınızı oluşturun\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"firstName\" className=\"text-gray-300\">Ad</Label>\n                <Input\n                  id=\"firstName\"\n                  type=\"text\"\n                  value={formData.firstName}\n                  onChange={(e) => handleInputChange(\"firstName\", e.target.value)}\n                  required\n                  className=\"bg-gray-700 border-gray-600 text-white\"\n                  placeholder=\"Adınız\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"lastName\" className=\"text-gray-300\">Soyad</Label>\n                <Input\n                  id=\"lastName\"\n                  type=\"text\"\n                  value={formData.lastName}\n                  onChange={(e) => handleInputChange(\"lastName\", e.target.value)}\n                  required\n                  className=\"bg-gray-700 border-gray-600 text-white\"\n                  placeholder=\"Soyadınız\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"text-gray-300\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => handleInputChange(\"email\", e.target.value)}\n                required\n                className=\"bg-gray-700 border-gray-600 text-white\"\n                placeholder=\"email@ornek.com\"\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\" className=\"text-gray-300\">Şifre</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={formData.password}\n                onChange={(e) => handleInputChange(\"password\", e.target.value)}\n                required\n                className=\"bg-gray-700 border-gray-600 text-white\"\n                placeholder=\"En az 6 karakter\"\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirmPassword\" className=\"text-gray-300\">Şifre Tekrar</Label>\n              <Input\n                id=\"confirmPassword\"\n                type=\"password\"\n                value={formData.confirmPassword}\n                onChange={(e) => handleInputChange(\"confirmPassword\", e.target.value)}\n                required\n                className=\"bg-gray-700 border-gray-600 text-white\"\n                placeholder=\"Şifrenizi tekrar girin\"\n              />\n            </div>\n            \n            {/* Firma Bilgileri Bölümü */}\n            <div className=\"pt-4 border-t border-gray-600\">\n              <h3 className=\"text-lg font-semibold text-gray-300 mb-4\">Firma Bilgileri</h3>\n              \n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"companyName\" className=\"text-gray-300\">Firma Adı</Label>\n                  <Input\n                    id=\"companyName\"\n                    type=\"text\"\n                    value={formData.companyName}\n                    onChange={(e) => handleInputChange(\"companyName\", e.target.value)}\n                    required\n                    className=\"bg-gray-700 border-gray-600 text-white\"\n                    placeholder=\"Firma adınız\"\n                  />\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"phone\" className=\"text-gray-300\">Telefon</Label>\n                    <Input\n                      id=\"phone\"\n                      type=\"tel\"\n                      value={formData.phone}\n                      onChange={(e) => handleInputChange(\"phone\", e.target.value)}\n                      className=\"bg-gray-700 border-gray-600 text-white\"\n                      placeholder=\"0555 123 45 67\"\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"city\" className=\"text-gray-300\">Şehir</Label>\n                    <Input\n                      id=\"city\"\n                      type=\"text\"\n                      value={formData.city}\n                      onChange={(e) => handleInputChange(\"city\", e.target.value)}\n                      className=\"bg-gray-700 border-gray-600 text-white\"\n                      placeholder=\"İstanbul\"\n                    />\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"industry\" className=\"text-gray-300\">Sektör</Label>\n                  <Input\n                    id=\"industry\"\n                    type=\"text\"\n                    value={formData.industry}\n                    onChange={(e) => handleInputChange(\"industry\", e.target.value)}\n                    className=\"bg-gray-700 border-gray-600 text-white\"\n                    placeholder=\"İnşaat, Teknoloji, Gıda vs.\"\n                  />\n                </div>\n              </div>\n            </div>\n            \n            <Button\n              type=\"submit\"\n              className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-2\"\n              disabled={registerMutation.isPending}\n            >\n              {registerMutation.isPending ? \"Kayıt yapılıyor...\" : \"Kayıt Ol\"}\n            </Button>\n          </form>\n          \n          <div className=\"mt-6 text-center\">\n            <p className=\"text-gray-400\">\n              Zaten hesabınız var mı?{\" \"}\n              <Link href=\"/login\" className=\"text-blue-400 hover:text-blue-300\">\n                Giriş yapın\n              </Link>\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":8502},"client/src/components/forms/personnel-payment-form.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { insertPersonnelPaymentSchema, type PersonnelPayment } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\n\nconst formSchema = insertPersonnelPaymentSchema.extend({\n  paymentDate: z.date(),\n  amount: z.string().min(1, \"Tutar gerekli\"),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface PersonnelPaymentFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  personnelId: string;\n  personnelName: string;\n  payment?: PersonnelPayment;\n}\n\nfunction PersonnelPaymentForm({\n  open,\n  onOpenChange,\n  personnelId,\n  personnelName,\n  payment,\n}: PersonnelPaymentFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      personnelId,\n      amount: payment?.amount || \"\",\n      paymentDate: payment?.paymentDate ? new Date(payment.paymentDate) : new Date(),\n      paymentType: payment?.paymentType || \"salary\",\n      description: payment?.description || \"\",\n      notes: payment?.notes || \"\",\n    },\n  });\n\n  const createPaymentMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const endpoint = payment \n        ? `/api/personnel-payments/${payment.id}`\n        : \"/api/personnel-payments\";\n      const method = payment ? \"PUT\" : \"POST\";\n      \n      console.log(\"Submitting personnel payment data:\", data);\n      // Backend will automatically create the transaction, no need for manual API call\n      const paymentResult = await apiRequest(endpoint, method, data);\n      \n      return paymentResult;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/personnel-payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/personnel-payments\", \"personnel\", personnelId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: payment ? \"Ödeme güncellendi.\" : \"Ödeme kaydı oluşturuldu ve otomatik olarak kasa giderlerine eklendi.\",\n      });\n      onOpenChange(false);\n      form.reset();\n    },\n    onError: (error) => {\n      console.error(\"Personnel payment error:\", error);\n      toast({\n        title: \"Hata\",\n        description: \"Ödeme kaydı oluşturulamadı.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    createPaymentMutation.mutate(data);\n  };\n\n  const paymentTypes = [\n    { value: \"salary\", label: \"Maaş\" },\n    { value: \"bonus\", label: \"Prim/Bonus\" },\n    { value: \"advance\", label: \"Avans\" },\n    { value: \"deduction\", label: \"Kesinti\" },\n  ];\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white\">\n            {payment ? \"Ödeme Düzenle\" : \"Yeni Ödeme\"}\n          </DialogTitle>\n          <p className=\"text-gray-400 text-sm\">{personnelName}</p>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"paymentType\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Ödeme Türü</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                        <SelectValue placeholder=\"Ödeme türünü seçin...\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                      {paymentTypes.map((type) => (\n                        <SelectItem key={type.value} value={type.value} className=\"text-white hover:bg-dark-accent\">\n                          {type.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"amount\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Tutar (TL)</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"0.00\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"paymentDate\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Ödeme Tarihi</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"date\"\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      value={field.value instanceof Date ? field.value.toISOString().split('T')[0] : field.value}\n                      onChange={(e) => field.onChange(new Date(e.target.value))}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Açıklama</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      placeholder=\"Ödeme açıklaması...\"\n                      {...field}\n                      value={field.value || \"\"}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"notes\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Not</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      className=\"bg-dark-primary border-dark-accent text-white h-20\"\n                      placeholder=\"Ek notlar...\"\n                      {...field}\n                      value={field.value || \"\"}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex gap-3 pt-4 mt-6 border-t border-gray-600\">\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white\"\n                onClick={() => onOpenChange(false)}\n              >\n                İptal\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"flex-1 bg-green-500 hover:bg-green-600 text-white\"\n                disabled={createPaymentMutation.isPending}\n              >\n                {createPaymentMutation.isPending ? \"Kaydediliyor...\" : payment ? \"Güncelle\" : \"Kaydet\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default PersonnelPaymentForm;","size_bytes":8737},"client/src/components/forms/contractor-payment-form.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { insertContractorPaymentSchema, type InsertContractorPayment } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { CalendarIcon } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface ContractorPaymentFormProps {\n  contractorId: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport default function ContractorPaymentForm({ contractorId, open, onOpenChange }: ContractorPaymentFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<InsertContractorPayment>({\n    resolver: zodResolver(insertContractorPaymentSchema),\n    defaultValues: {\n      contractorId,\n      amount: \"\",\n      description: \"\",\n      paymentDate: new Date(),\n      paymentMethod: \"cash\",\n    },\n  });\n\n  const createPaymentMutation = useMutation({\n    mutationFn: async (data: InsertContractorPayment) => {\n      return await apiRequest(\"/api/contractor-payments\", \"POST\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contractor-payments\"] });\n      queryClient.invalidateQueries({ queryKey: ['/api/contractor-payments/contractor/' + contractorId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/financial-summary\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Ödeme başarıyla yapıldı ve kasa gider kaydı oluşturuldu.\",\n      });\n      form.reset({\n        contractorId,\n        amount: \"\",\n        description: \"\",\n        paymentDate: new Date(),\n        paymentMethod: \"cash\",\n      });\n      onOpenChange(false);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Hata\",\n        description: \"Ödeme yapılırken bir hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertContractorPayment) => {\n    createPaymentMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[450px] max-h-[85vh] overflow-y-auto bg-dark-secondary border-dark-accent\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white\">Yüklenici Ödemesi</DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3\">\n            <FormField\n              control={form.control}\n              name=\"amount\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-white\">Ödeme Tutarı (₺)</FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"0.00\"\n                      className=\"bg-dark-primary border-dark-accent text-white placeholder:text-gray-400\"\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-white\">Ödeme Açıklaması</FormLabel>\n                  <FormControl>\n                    <Textarea \n                      placeholder=\"Ödeme açıklaması\"\n                      className=\"bg-dark-primary border-dark-accent text-white placeholder:text-gray-400\"\n                      rows={2}\n                      {...field}\n                      value={field.value || \"\"} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"paymentMethod\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-white\">Ödeme Yöntemi</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value || \"cash\"}>\n                    <FormControl>\n                      <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                        <SelectValue placeholder=\"Ödeme yöntemi seçiniz\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                      <SelectItem value=\"cash\">Nakit</SelectItem>\n                      <SelectItem value=\"bank_transfer\">Banka Havalesi</SelectItem>\n                      <SelectItem value=\"check\">Çek</SelectItem>\n                      <SelectItem value=\"other\">Diğer</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"paymentDate\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-col\">\n                  <FormLabel className=\"text-white\">Ödeme Tarihi</FormLabel>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <FormControl>\n                        <Button\n                          variant=\"outline\"\n                          className=\"bg-dark-primary border-dark-accent text-white hover:bg-dark-accent w-full pl-3 text-left font-normal\"\n                        >\n                          {field.value ? (\n                            format(field.value, \"dd/MM/yyyy\")\n                          ) : (\n                            <span className=\"text-gray-400\">Tarih seçiniz</span>\n                          )}\n                          <CalendarIcon className=\"ml-auto h-4 w-4 opacity-50\" />\n                        </Button>\n                      </FormControl>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-auto p-0 bg-dark-secondary border-dark-accent\" align=\"start\">\n                      <Calendar\n                        mode=\"single\"\n                        selected={field.value}\n                        onSelect={field.onChange}\n                        disabled={(date) => date > new Date()}\n                        initialFocus\n                      />\n                    </PopoverContent>\n                  </Popover>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex gap-3 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => onOpenChange(false)}\n                className=\"flex-1 bg-transparent border-dark-accent text-white hover:bg-dark-accent\"\n              >\n                İptal\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createPaymentMutation.isPending}\n                className=\"flex-1 bg-green-500 hover:bg-green-600 text-white\"\n              >\n                {createPaymentMutation.isPending ? \"Ödeme Yapılıyor...\" : \"Ödeme Yap\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":8173},"client/src/pages/enhanced-company-directory.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardHeader, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useLocation } from \"wouter\";\nimport { insertCompanyDirectorySchema, type CompanyDirectory, type InsertCompanyDirectory, type Notification } from \"@shared/schema\";\nimport { \n  Building2, Phone, Mail, Globe, MapPin, MessageCircle, Plus, Search, Users, Send, X, \n  Star, Shield, Filter, Bell, Block, VolumeX, Flag, CheckCircle, Crown, Verified, Home \n} from \"lucide-react\";\n\nexport default function EnhancedCompanyDirectory() {\n  const [, setLocation] = useLocation();\n  const [showForm, setShowForm] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [cityFilter, setCityFilter] = useState(\"\");\n  const [industryFilter, setIndustryFilter] = useState(\"\");\n  const [verifiedFilter, setVerifiedFilter] = useState<boolean | undefined>(undefined);\n  const [selectedCompany, setSelectedCompany] = useState<CompanyDirectory | null>(null);\n  const [showChat, setShowChat] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"directory\");\n  const [activeConversation, setActiveConversation] = useState<string | null>(null);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [showNotifications, setShowNotifications] = useState(false);\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Enhanced PRO Company Directory query with filters\n  const { data: companies = [], isLoading } = useQuery<CompanyDirectory[]>({\n    queryKey: [\"/api/directory/firms\", { searchTerm, cityFilter, industryFilter, verifiedFilter }],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (searchTerm) params.append(\"search\", searchTerm);\n      if (cityFilter) params.append(\"city\", cityFilter);\n      if (industryFilter) params.append(\"industry\", industryFilter);\n      if (verifiedFilter !== undefined) params.append(\"verified\", verifiedFilter.toString());\n      \n      const response = await apiRequest(`/api/directory/firms?${params.toString()}`, \"GET\");\n      return Array.isArray(response) ? response : [];\n    },\n  });\n\n  // Notifications query\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n    staleTime: 1000 * 60 * 30, // 30 min cache\n    refetchOnWindowFocus: false, // Poll every 5 seconds\n  });\n\n  // Conversations query\n  const { data: conversations = [] } = useQuery({\n    queryKey: [\"/api/threads\"],\n    enabled: activeTab === \"messages\",\n    staleTime: 1000 * 60 * 10, // 10 min cache\n    refetchOnWindowFocus: false,\n  });\n\n  // Messages for active conversation\n  const { data: messages = [] } = useQuery({\n    queryKey: [\"/api/threads\", activeConversation],\n    queryFn: async () => {\n      if (!activeConversation) return [];\n      const response = await apiRequest(`/api/threads/${activeConversation}`, \"GET\");\n      return Array.isArray(response) ? response : [];\n    },\n    enabled: !!activeConversation,\n    staleTime: 1000 * 60 * 10, // 10 min cache\n    refetchOnWindowFocus: false,\n  });\n\n  const form = useForm<InsertCompanyDirectory>({\n    resolver: zodResolver(insertCompanyDirectorySchema),\n    defaultValues: {\n      companyName: \"\",\n      contactPerson: \"\",\n      phone: \"\",\n      email: \"\",\n      address: \"\",\n      city: \"\",\n      industry: \"\",\n      website: \"\",\n      description: \"\",\n      bio: \"\",\n      logoUrl: \"\",\n      isActive: true,\n      isProVisible: false,\n      subscriptionStatus: \"FREE\"\n    },\n  });\n\n  const createCompanyMutation = useMutation({\n    mutationFn: (data: InsertCompanyDirectory) => apiRequest(\"/api/company-directory\", \"POST\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/directory/firms\"] });\n      toast({ title: \"Başarılı\", description: \"Firma başarıyla eklendi\" });\n      setShowForm(false);\n      form.reset();\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Firma eklenirken hata oluştu\", variant: \"destructive\" });\n    },\n  });\n\n  const startConversationMutation = useMutation({\n    mutationFn: (targetCompanyId: string) => \n      apiRequest(\"/api/threads/open\", \"POST\", { targetCompanyId }),\n    onSuccess: (conversation) => {\n      setActiveConversation(conversation.id);\n      setActiveTab(\"messages\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Hata\", \n        description: error.message || \"Mesajlaşma başlatılamadı\", \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: ({ conversationId, body }: { conversationId: string; body: string }) =>\n      apiRequest(`/api/threads/${conversationId}/messages`, \"POST\", { body }),\n    onSuccess: () => {\n      setNewMessage(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\", activeConversation] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Mesaj gönderilemedi\", variant: \"destructive\" });\n    },\n  });\n\n  const markNotificationAsReadMutation = useMutation({\n    mutationFn: (notificationId: string) =>\n      apiRequest(`/api/notifications/${notificationId}/read`, \"PATCH\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    },\n    onError: () => {\n      console.error(\"Failed to mark notification as read\");\n    },\n  });\n\n  const onSubmit = (data: InsertCompanyDirectory) => {\n    createCompanyMutation.mutate(data);\n  };\n\n  const startConversation = (company: CompanyDirectory) => {\n    startConversationMutation.mutate(company.id);\n  };\n\n  const handleSendMessage = () => {\n    if (!newMessage.trim() || !activeConversation) return;\n    sendMessageMutation.mutate({\n      conversationId: activeConversation,\n      body: newMessage.trim(),\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Auto scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const formatMessageTime = (dateString: string) => {\n    return new Date(dateString).toLocaleTimeString(\"tr-TR\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  const getCompanyDisplayInfo = (company: CompanyDirectory) => {\n    const badges = [];\n    \n    if (company.isVerified) {\n      badges.push(\n        <Badge key=\"verified\" className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\n          <Verified className=\"h-3 w-3 mr-1\" />\n          Doğrulanmış\n        </Badge>\n      );\n    }\n    \n    if (company.subscriptionStatus === \"PRO\") {\n      badges.push(\n        <Badge key=\"pro\" className=\"bg-yellow-500/20 text-yellow-400 border-yellow-500/30\">\n          <Crown className=\"h-3 w-3 mr-1\" />\n          PRO\n        </Badge>\n      );\n    }\n    \n    if (company.isActive) {\n      badges.push(\n        <Badge key=\"active\" className=\"bg-green-500/20 text-green-400 border-green-500/30\">\n          Aktif\n        </Badge>\n      );\n    }\n    \n    return badges;\n  };\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/\")}\n            className=\"text-gray-400 hover:text-white hover:bg-dark-accent\"\n            title=\"Anasayfa'ya dön\"\n          >\n            <Home className=\"h-6 w-6\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold text-white flex items-center gap-3\">\n              <Crown className=\"h-8 w-8 text-yellow-500\" />\n              PRO Firma Rehberi\n            </h1>\n            <p className=\"text-gray-400 mt-2\">Doğrulanmış firmalarla profesyonel iletişim kurun</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          {notifications.filter(n => !n.isRead).length > 0 && (\n            <div className=\"relative\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"border-blue-500 text-blue-400 hover:bg-blue-600/10\"\n                onClick={() => setShowNotifications(!showNotifications)}\n              >\n                <Bell className=\"h-4 w-4 mr-2\" />\n                {notifications.filter(n => !n.isRead).length} Bildirim\n              </Button>\n              \n              {showNotifications && (\n                <div className=\"absolute top-full right-0 mt-2 w-80 bg-dark-secondary border border-dark-accent rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto\">\n                  <div className=\"p-4 border-b border-dark-accent\">\n                    <div className=\"flex items-center justify-between\">\n                      <h3 className=\"text-white font-semibold\">Bildirimler</h3>\n                      <div className=\"flex items-center gap-2\">\n                        {notifications.filter(n => !n.isRead).length > 0 && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => {\n                              // Mark all notifications as read\n                              notifications.filter(n => !n.isRead).forEach(n => {\n                                markNotificationAsReadMutation.mutate(n.id);\n                              });\n                            }}\n                            className=\"text-xs text-blue-400 hover:text-blue-300\"\n                          >\n                            Tümünü okundu işaretle\n                          </Button>\n                        )}\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => setShowNotifications(false)}\n                          className=\"h-6 w-6 p-0 text-gray-400 hover:text-white\"\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"max-h-64 overflow-y-auto\">\n                    {notifications.length === 0 ? (\n                      <div className=\"p-4 text-center text-gray-400\">\n                        Henüz bildirim yok\n                      </div>\n                    ) : (\n                      notifications.map((notification) => (\n                        <div \n                          key={notification.id} \n                          className={`p-4 border-b border-dark-accent/50 hover:bg-dark-primary/50 cursor-pointer ${\n                            !notification.isRead ? 'bg-blue-600/10' : ''\n                          }`}\n                          onClick={() => {\n                            // Mark notification as read\n                            if (!notification.isRead) {\n                              markNotificationAsReadMutation.mutate(notification.id);\n                            }\n                            \n                            if (notification.type === 'NEW_DM' && notification.payload) {\n                              // Mesaj konuşmasına git\n                              const payload = notification.payload as any;\n                              setActiveTab(\"messages\");\n                              setShowNotifications(false);\n                              toast({\n                                title: \"Mesaja Yönlendiriliyor\",\n                                description: `${payload.fromCompanyName} firmasından gelen mesaj`,\n                              });\n                            }\n                          }}\n                        >\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"flex-shrink-0\">\n                              {notification.type === 'NEW_DM' ? (\n                                <MessageCircle className=\"h-5 w-5 text-blue-400\" />\n                              ) : (\n                                <Bell className=\"h-5 w-5 text-blue-400\" />\n                              )}\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              {notification.type === 'NEW_DM' && notification.payload && (\n                                <>\n                                  <div className=\"text-white font-medium\">\n                                    {(notification.payload as any).fromCompanyName}\n                                  </div>\n                                  <div className=\"text-gray-300 text-sm mt-1 truncate\">\n                                    {(notification.payload as any).message}\n                                  </div>\n                                  <div className=\"text-xs text-gray-500 mt-1\">\n                                    {new Date(notification.createdAt).toLocaleString('tr-TR')}\n                                  </div>\n                                </>\n                              )}\n                              {!notification.isRead && (\n                                <div className=\"w-2 h-2 bg-blue-500 rounded-full mt-1\"></div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      ))\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n          <Button\n            onClick={() => setShowForm(true)}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Firma Ekle\n          </Button>\n        </div>\n      </div>\n\n      {/* Navigation Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-2 bg-dark-secondary\">\n          <TabsTrigger value=\"directory\" className=\"data-[state=active]:bg-blue-600\">\n            <Building2 className=\"h-4 w-4 mr-2\" />\n            Firma Rehberi\n          </TabsTrigger>\n          <TabsTrigger value=\"messages\" className=\"data-[state=active]:bg-blue-600\">\n            <MessageCircle className=\"h-4 w-4 mr-2\" />\n            Mesajlarım ({conversations.length})\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"directory\" className=\"space-y-6 mt-6\">\n          {/* Advanced Filters */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n              <Input\n                placeholder=\"Firma, kişi, açıklama ara...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 bg-dark-primary border-dark-accent text-white\"\n              />\n            </div>\n            <Select value={cityFilter || \"all\"} onValueChange={(value) => setCityFilter(value === \"all\" ? \"\" : value)}>\n              <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                <SelectValue placeholder=\"Şehir seçin\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                <SelectItem value=\"all\">Tüm Şehirler</SelectItem>\n                <SelectItem value=\"İstanbul\">İstanbul</SelectItem>\n                <SelectItem value=\"Ankara\">Ankara</SelectItem>\n                <SelectItem value=\"İzmir\">İzmir</SelectItem>\n                <SelectItem value=\"Bursa\">Bursa</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={industryFilter || \"all\"} onValueChange={(value) => setIndustryFilter(value === \"all\" ? \"\" : value)}>\n              <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                <SelectValue placeholder=\"Sektör seçin\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                <SelectItem value=\"all\">Tüm Sektörler</SelectItem>\n                <SelectItem value=\"İnşaat\">İnşaat</SelectItem>\n                <SelectItem value=\"Teknoloji\">Teknoloji</SelectItem>\n                <SelectItem value=\"Hizmet\">Hizmet</SelectItem>\n                <SelectItem value=\"Üretim\">Üretim</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={verifiedFilter?.toString() || \"all\"} onValueChange={(value) => \n              setVerifiedFilter(value === \"all\" ? undefined : value === \"true\")\n            }>\n              <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                <SelectValue placeholder=\"Doğrulama\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                <SelectItem value=\"all\">Tüm Firmalar</SelectItem>\n                <SelectItem value=\"true\">Doğrulanmış</SelectItem>\n                <SelectItem value=\"false\">Doğrulanmamış</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Companies Grid */}\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {[1, 2, 3, 4, 5, 6].map((i) => (\n                <div key={i} className=\"bg-dark-secondary rounded-lg p-6 animate-pulse\">\n                  <div className=\"h-6 bg-gray-700 rounded mb-4\"></div>\n                  <div className=\"h-4 bg-gray-700 rounded mb-2\"></div>\n                  <div className=\"h-4 bg-gray-700 rounded mb-4\"></div>\n                  <div className=\"h-10 bg-gray-700 rounded\"></div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {companies.map((company: CompanyDirectory) => (\n                <Card key={company.id} className=\"bg-dark-secondary border-dark-accent hover:border-blue-500/30 transition-colors\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-xl font-semibold text-white\">{company.companyName}</h3>\n                        <p className=\"text-blue-400 font-medium\">{company.contactPerson}</p>\n                      </div>\n                      {company.logoUrl && (\n                        <img \n                          src={company.logoUrl} \n                          alt={`${company.companyName} logo`}\n                          className=\"w-12 h-12 rounded-lg object-cover\"\n                        />\n                      )}\n                    </div>\n                    <div className=\"flex flex-wrap gap-2 mt-3\">\n                      {getCompanyDisplayInfo(company)}\n                    </div>\n                    {company.industry && (\n                      <Badge variant=\"outline\" className=\"w-fit text-gray-300 border-gray-600 mt-2\">\n                        {company.industry}\n                      </Badge>\n                    )}\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    {company.phone && (\n                      <div className=\"flex items-center gap-2 text-gray-300\">\n                        <Phone className=\"h-4 w-4 text-blue-400\" />\n                        <span className=\"text-sm\">{company.phone}</span>\n                      </div>\n                    )}\n                    {company.email && (\n                      <div className=\"flex items-center gap-2 text-gray-300\">\n                        <Mail className=\"h-4 w-4 text-blue-400\" />\n                        <span className=\"text-sm\">{company.email}</span>\n                      </div>\n                    )}\n                    {company.city && (\n                      <div className=\"flex items-center gap-2 text-gray-300\">\n                        <MapPin className=\"h-4 w-4 text-blue-400\" />\n                        <span className=\"text-sm\">{company.city}</span>\n                      </div>\n                    )}\n                    {company.website && (\n                      <div className=\"flex items-center gap-2 text-gray-300\">\n                        <Globe className=\"h-4 w-4 text-blue-400\" />\n                        <a \n                          href={company.website.startsWith('http') ? company.website : `https://${company.website}`}\n                          target=\"_blank\" \n                          rel=\"noopener noreferrer\"\n                          className=\"text-sm hover:text-blue-400 transition-colors\"\n                        >\n                          {company.website}\n                        </a>\n                      </div>\n                    )}\n                    {(company.description || company.bio) && (\n                      <p className=\"text-sm text-gray-400 mt-3 line-clamp-3\">\n                        {company.bio || company.description}\n                      </p>\n                    )}\n                    <div className=\"pt-3 flex gap-2\">\n                      <Button\n                        onClick={() => startConversation(company)}\n                        className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\n                        size=\"sm\"\n                        disabled={startConversationMutation.isPending}\n                      >\n                        <MessageCircle className=\"h-4 w-4 mr-2\" />\n                        {startConversationMutation.isPending ? \"Başlatılıyor...\" : \"Mesaj Gönder\"}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n\n          {companies.length === 0 && !isLoading && (\n            <div className=\"text-center py-12\">\n              <Users className=\"h-16 w-16 text-gray-600 mx-auto mb-4\" />\n              <h3 className=\"text-xl font-semibold text-gray-300 mb-2\">\n                {searchTerm || cityFilter || industryFilter ? \"Arama sonucu bulunamadı\" : \"Henüz PRO firma eklenmemiş\"}\n              </h3>\n              <p className=\"text-gray-500\">\n                {searchTerm || cityFilter || industryFilter ? \"Farklı filtreler deneyin\" : \"İlk PRO firmayı ekleyerek başlayın\"}\n              </p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"messages\" className=\"mt-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]\">\n\n\n            {/* Chat Area */}\n            <div className=\"lg:col-span-2\">\n              <Card className=\"bg-dark-secondary border-dark-accent h-full\">\n                {activeConversation ? (\n                  <>\n                    <CardHeader className=\"pb-3 border-b border-dark-accent\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-lg font-semibold text-white\">\n                          {conversations.find((c: any) => c.id === activeConversation)?.otherCompany?.companyName}\n                        </h3>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setActiveConversation(null)}>\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"p-0 flex flex-col h-[460px]\">\n                      {/* Messages */}\n                      <ScrollArea className=\"flex-1 p-4\">\n                        <div className=\"space-y-4\">\n                          {messages.map((message: any) => (\n                            <div\n                              key={message.id}\n                              className={`flex ${\n                                message.fromUserId === \"current-user\" ? \"justify-end\" : \"justify-start\"\n                              }`}\n                            >\n                              <div\n                                className={`max-w-[70%] rounded-lg p-3 ${\n                                  message.fromUserId === \"current-user\"\n                                    ? \"bg-blue-600 text-white\"\n                                    : \"bg-dark-primary text-gray-200\"\n                                }`}\n                              >\n                                <p className=\"text-sm\">{message.message}</p>\n                                <p className=\"text-xs opacity-70 mt-1\">\n                                  {formatMessageTime(message.createdAt)}\n                                </p>\n                              </div>\n                            </div>\n                          ))}\n                          <div ref={messagesEndRef} />\n                        </div>\n                      </ScrollArea>\n\n                      {/* Message Input */}\n                      <div className=\"p-4 border-t border-dark-accent\">\n                        <div className=\"flex gap-2\">\n                          <Input\n                            value={newMessage}\n                            onChange={(e) => setNewMessage(e.target.value)}\n                            onKeyPress={handleKeyPress}\n                            placeholder=\"Mesajınızı yazın...\"\n                            className=\"bg-dark-primary border-dark-accent text-white\"\n                            disabled={sendMessageMutation.isPending}\n                          />\n                          <Button\n                            onClick={handleSendMessage}\n                            disabled={!newMessage.trim() || sendMessageMutation.isPending}\n                            className=\"bg-blue-600 hover:bg-blue-700\"\n                          >\n                            <Send className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </>\n                ) : (\n                  <div className=\"flex items-center justify-center h-full text-gray-400\">\n                    <div className=\"text-center\">\n                      <MessageCircle className=\"h-16 w-16 mx-auto mb-4\" />\n                      <p>Konuşma başlatmak için bir firma seçin</p>\n                    </div>\n                  </div>\n                )}\n              </Card>\n            </div>\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Add Company Form Dialog */}\n      <Dialog open={showForm} onOpenChange={setShowForm}>\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-white\">Yeni PRO Firma Ekle</DialogTitle>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"companyName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Firma Adı *</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Firma adını giriniz\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"contactPerson\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Yetkili Kişi *</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Yetkili kişi adı\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Telefon</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Telefon numarası\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">E-posta</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"E-posta adresi\"\n                          type=\"email\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"city\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Şehir</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Şehir\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"industry\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Sektör</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Sektör\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"address\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Adres</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Firma adresi\"\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"website\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Website</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"www.firma.com\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"logoUrl\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Logo URL</FormLabel>\n                      <FormControl>\n                        <Input \n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Logo resim URL'si\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Kısa Açıklama</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Firma hakkında kısa açıklama\"\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"bio\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Detaylı Açıklama</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        className=\"bg-dark-primary border-dark-accent text-white min-h-[100px]\"\n                        placeholder=\"Firma hakkında detaylı bilgi\"\n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setShowForm(false)}\n                  className=\"border-gray-600 text-gray-300 hover:bg-gray-700\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createCompanyMutation.isPending}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                >\n                  {createCompanyMutation.isPending ? \"Ekleniyor...\" : \"Firma Ekle\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":36724},"client/src/pages/enhanced-company-directory-new.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { \n  Search, \n  Plus, \n  MessageCircle, \n  Building2, \n  MapPin, \n  Phone, \n  Mail, \n  Globe, \n  Star, \n  Shield, \n  Crown,\n  Send,\n  Clock,\n  Check,\n  CheckCheck,\n  MoreVertical,\n  UserPlus,\n  Settings,\n  Bell,\n  ArrowLeft,\n  BellOff,\n  Flag,\n  Ban,\n  Trash2,\n  Image as ImageIcon,\n  Paperclip,\n  Eye,\n  EyeOff,\n  Zap,\n  Copy,\n  Link,\n  Users,\n  Edit,\n  Circle\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface CompanyDirectory {\n  id: string;\n  companyName: string;\n  contactPerson: string;\n  phone?: string;\n  email?: string;\n  address?: string;\n  city?: string;\n  industry?: string;\n  website?: string;\n  description?: string;\n  bio?: string;\n  logoUrl?: string;\n  isActive: boolean;\n  isProVisible: boolean;\n  isVerified: boolean;\n  subscriptionStatus: string;\n  createdAt: Date;\n}\n\ninterface DirectThread {\n  id: string;\n  firm1Id: string;\n  firm2Id: string;\n  lastMessageAt?: Date;\n  createdAt: Date;\n}\n\ninterface DirectMessage {\n  id: string;\n  threadId: string;\n  senderFirmId: string;\n  receiverFirmId: string;\n  body?: string;\n  attachmentUrl?: string;\n  attachmentType?: string;\n  messageType: string;\n  isRead: boolean;\n  createdAt: Date;\n}\n\ninterface AutoResponder {\n  id?: string;\n  firmId: string;\n  enabled: boolean;\n  mode: \"KEYWORD\" | \"ALWAYS\" | \"OFFHOURS\";\n  keywords?: string[];\n  cooldownSec: number;\n  messageBody: string;\n}\n\ninterface FirmInvite {\n  id: string;\n  email: string;\n  role: string;\n  acceptedAt?: Date;\n  expiresAt: Date;\n  createdAt: Date;\n}\n\ninterface PresenceInfo {\n  online: boolean;\n  lastSeen?: string;\n}\n\nconst companyFormSchema = z.object({\n  companyName: z.string().min(1, \"Firma adı gereklidir\"),\n  contactPerson: z.string().min(1, \"İletişim kişisi gereklidir\"),\n  phone: z.string().optional(),\n  email: z.string().email(\"Geçerli email adresi giriniz\").optional().or(z.literal(\"\")),\n  address: z.string().optional(),\n  city: z.string().optional(),\n  industry: z.string().optional(),\n  website: z.string().optional(),\n  description: z.string().optional(),\n  bio: z.string().optional(),\n});\n\nconst inviteFormSchema = z.object({\n  email: z.string().email(\"Geçerli email adresi giriniz\"),\n  role: z.enum([\"ADMIN\", \"USER\"]),\n});\n\ntype CompanyFormData = z.infer<typeof companyFormSchema>;\ntype InviteFormData = z.infer<typeof inviteFormSchema>;\n\nexport default function EnhancedCompanyDirectory() {\n  const [activeTab, setActiveTab] = useState(\"directory\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [threadSearchTerm, setThreadSearchTerm] = useState(\"\");\n  const [selectedCompany, setSelectedCompany] = useState<CompanyDirectory | null>(null);\n  const [activeThread, setActiveThread] = useState<string | null>(null);\n  const [messageText, setMessageText] = useState(\"\");\n  const [showInviteDialog, setShowInviteDialog] = useState(false);\n  const [showAutoResponderDialog, setShowAutoResponderDialog] = useState(false);\n  const [showCompanyForm, setShowCompanyForm] = useState(false);\n  const [uploadingImage, setUploadingImage] = useState(false);\n  const [draftText, setDraftText] = useState(\"\");\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const draftTimeoutRef = useRef<NodeJS.Timeout>();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Presence heartbeat\n  useEffect(() => {\n    const heartbeat = () => {\n      apiRequest(\"/api/presence/heartbeat\", \"POST\", {}).catch(() => {});\n    };\n    \n    heartbeat(); // Initial heartbeat\n    const interval = setInterval(heartbeat, 30000); // Every 30 seconds\n    \n    return () => clearInterval(interval);\n  }, []);\n\n  // Auto-scroll messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [activeThread]);\n\n  // URL parameter handling for direct thread navigation\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const threadId = urlParams.get('threadId');\n    \n    if (threadId) {\n      console.log(\"Opening thread from URL:\", threadId);\n      setActiveThread(threadId);\n      setActiveTab(\"messages\");\n      \n      // Clear URL parameter after handling\n      window.history.replaceState({}, document.title, window.location.pathname);\n      \n      // Force refresh\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\", threadId, \"messages\"] });\n    }\n  }, [queryClient]);\n\n  // Draft auto-save\n  useEffect(() => {\n    if (activeThread && draftText) {\n      if (draftTimeoutRef.current) {\n        clearTimeout(draftTimeoutRef.current);\n      }\n      \n      draftTimeoutRef.current = setTimeout(() => {\n        apiRequest(\"/api/drafts/upsert\", \"POST\", {\n          threadId: activeThread,\n          body: draftText,\n        }).catch(() => {});\n      }, 1000);\n    }\n    \n    return () => {\n      if (draftTimeoutRef.current) {\n        clearTimeout(draftTimeoutRef.current);\n      }\n    };\n  }, [draftText, activeThread]);\n\n  // Companies query\n  const { data: companies = [], isLoading: companiesLoading } = useQuery<CompanyDirectory[]>({\n    queryKey: [\"/api/directory/firms\", searchTerm],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (searchTerm) params.append(\"search\", searchTerm);\n      const response = await apiRequest(`/api/directory/firms?${params.toString()}`, \"GET\");\n      return Array.isArray(response) ? response : [];\n    },\n  });\n\n  // Threads query\n  const { data: threads = [] } = useQuery<DirectThread[]>({\n    queryKey: [\"/api/threads\"],\n    enabled: activeTab === \"messages\",\n    refetchInterval: 3000,\n  });\n\n  // Messages for active thread\n  const { data: messages = [], refetch: refetchMessages } = useQuery<DirectMessage[]>({\n    queryKey: [\"/api/threads\", activeThread, \"messages\"],\n    queryFn: async () => {\n      if (!activeThread) return [];\n      const response = await apiRequest(`/api/threads/${activeThread}/messages`, \"GET\");\n      console.log(\"Messages loaded for thread:\", activeThread, response);\n      return response;\n    },\n    enabled: !!activeThread,\n    refetchInterval: 3000,\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  // Get current user's firm ID\n  const { data: userCompanies } = useQuery({\n    queryKey: [\"/api/directory/my-companies\"],\n    queryFn: () => apiRequest(\"/api/directory/my-companies\", \"GET\"),\n  });\n  \n  const currentUserFirmId = userCompanies?.[0]?.id;\n\n  // Invites query\n  const { data: invites = [] } = useQuery<FirmInvite[]>({\n    queryKey: [\"/api/invites\"],\n    enabled: showInviteDialog,\n  });\n\n  // Auto responder query\n  const { data: autoResponder } = useQuery<AutoResponder>({\n    queryKey: [\"/api/autoresponder\"],\n    enabled: showAutoResponderDialog,\n  });\n\n  // Load draft when thread changes\n  useQuery({\n    queryKey: [\"/api/drafts\", activeThread],\n    queryFn: async () => {\n      const response = await apiRequest(`/api/drafts/${activeThread}`, \"GET\");\n      setDraftText(response.body || \"\");\n      return response;\n    },\n    enabled: !!activeThread,\n  });\n\n  // Forms\n  const companyForm = useForm<CompanyFormData>({\n    resolver: zodResolver(companyFormSchema),\n    defaultValues: {\n      companyName: \"\",\n      contactPerson: \"\",\n      phone: \"\",\n      email: \"\",\n      address: \"\",\n      city: \"\",\n      industry: \"\",\n      website: \"\",\n      description: \"\",\n      bio: \"\",\n    },\n  });\n\n  const inviteForm = useForm<InviteFormData>({\n    resolver: zodResolver(inviteFormSchema),\n    defaultValues: {\n      email: \"\",\n      role: \"USER\",\n    },\n  });\n\n  // Mutations\n  const createCompanyMutation = useMutation({\n    mutationFn: (data: CompanyFormData) => apiRequest(\"/api/company-directory\", \"POST\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/directory/firms\"] });\n      toast({ title: \"Başarılı\", description: \"Firma başarıyla eklendi\" });\n      setShowCompanyForm(false);\n      companyForm.reset();\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Firma eklenirken hata oluştu\", variant: \"destructive\" });\n    },\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: (data: { body?: string; attachmentUrl?: string; attachmentType?: string }) => {\n      console.log(\"sendMessageMutation running with data:\", data, \"activeThread:\", activeThread);\n      return apiRequest(`/api/threads/${activeThread}/messages`, \"POST\", data);\n    },\n    onSuccess: (response) => {\n      console.log(\"Message sent successfully:\", response);\n      // Use the exact same query key format as the messages query\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\", activeThread, \"messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      setMessageText(\"\");\n      setDraftText(\"\");\n      // Clear draft\n      apiRequest(\"/api/drafts/upsert\", \"POST\", {\n        threadId: activeThread,\n        body: \"\",\n      }).catch(() => {});\n    },\n    onError: (error) => {\n      console.error(\"Message send error:\", error);\n      toast({ title: \"Hata\", description: \"Mesaj gönderilemedi\", variant: \"destructive\" });\n    },\n  });\n\n  const createInviteMutation = useMutation({\n    mutationFn: (data: InviteFormData) => apiRequest(\"/api/invites\", \"POST\", data),\n    onSuccess: (response) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/invites\"] });\n      toast({ \n        title: \"Davet Oluşturuldu\", \n        description: \"Davet linki panoya kopyalandı\",\n      });\n      navigator.clipboard.writeText(response.inviteUrl);\n      inviteForm.reset();\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Davet oluşturulamadı\", variant: \"destructive\" });\n    },\n  });\n\n  const uploadImageMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"image\", file);\n      \n      const sessionId = localStorage.getItem(\"sessionId\");\n      \n      // Use apiRequest with form data for consistent authentication\n      const response = await fetch(\"/api/upload-image\", {\n        method: \"POST\",\n        credentials: \"include\", // Include cookies for session auth\n        headers: {\n          Authorization: `Bearer ${sessionId}`,\n        },\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        throw new Error(\"Upload failed\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: (uploadResult) => {\n      sendMessageMutation.mutate({\n        attachmentUrl: uploadResult.url,\n        attachmentType: \"image\",\n      });\n    },\n    onError: () => {\n      toast({ title: \"Hata\", description: \"Resim yüklenemedi\", variant: \"destructive\" });\n    },\n  });\n\n  // Event handlers\n  const handleSendMessage = () => {\n    console.log(\"handleSendMessage called\", { messageText, activeThread, uploadingImage });\n    \n    if ((!messageText.trim() && !uploadingImage) || !activeThread) {\n      console.log(\"Validation failed - no message or thread\");\n      return;\n    }\n    \n    console.log(\"Sending message via mutation\");\n    sendMessageMutation.mutate({ \n      body: messageText.trim(),\n      attachmentType: \"text\" \n    });\n  };\n\n  const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n    \n    setUploadingImage(true);\n    uploadImageMutation.mutate(file, {\n      onSettled: () => setUploadingImage(false),\n    });\n  };\n\n  const handleStartConversation = async (company: CompanyDirectory) => {\n    try {\n      console.log(\"Starting conversation with company:\", company.companyName, company.id);\n      \n      // First check if thread already exists or create new one\n      const response = await apiRequest(\"/api/threads/create\", \"POST\", {\n        targetCompanyId: company.id,\n      });\n      \n      console.log(\"Thread creation response:\", response);\n      \n      if (response && response.id) {\n        // Refresh threads list to show new thread\n        queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n        \n        setActiveThread(response.id);\n        setActiveTab(\"messages\");\n        toast({ \n          title: \"Sohbet Başlatıldı\", \n          description: `${company.companyName} ile mesajlaşma başladı`,\n        });\n      }\n    } catch (error) {\n      console.error(\"Conversation start error:\", error);\n      toast({ title: \"Hata\", description: \"Mesajlaşma başlatılamadı\", variant: \"destructive\" });\n    }\n  };\n\n  const formatLastSeen = (lastSeen: string) => {\n    const date = new Date(lastSeen);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    const minutes = Math.floor(diff / 60000);\n    \n    if (minutes < 1) return \"Şimdi\";\n    if (minutes < 60) return `${minutes} dk önce`;\n    const hours = Math.floor(minutes / 60);\n    if (hours < 24) return `${hours} saat önce`;\n    const days = Math.floor(hours / 24);\n    return `${days} gün önce`;\n  };\n\n  // Handle notification click to open specific thread\n  const handleNotificationClick = (notification: any) => {\n    console.log(\"Notification clicked:\", notification);\n    \n    if (notification.threadId) {\n      setActiveThread(notification.threadId);\n      setActiveTab(\"messages\");\n      \n      // Force refresh of threads and messages\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\", notification.threadId, \"messages\"] });\n      \n      toast({\n        title: \"Mesaja Yönlendirildi\",\n        description: \"Konuşma sayfasına geçtiniz\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header - Compact and Fixed */}\n      <div className=\"sticky top-0 z-50 bg-background/95 backdrop-blur border-b\">\n        <div className=\"container mx-auto px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => window.location.href = \"/\"}\n                className=\"flex items-center gap-2\"\n              >\n                <ArrowLeft className=\"h-4 w-4\" />\n                Anasayfa\n              </Button>\n              <div className=\"flex items-center gap-3\">\n                <div className=\"flex items-center gap-2\">\n                  <MessageCircle className=\"h-6 w-6 text-primary\" />\n                  <h1 className=\"text-xl font-bold\">PRO Firma Rehberi</h1>\n                </div>\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  Gelişmiş İş Ağı\n                </Badge>\n              </div>\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setShowInviteDialog(true)}\n              >\n                <UserPlus className=\"h-4 w-4 mr-1\" />\n                Davet\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setShowAutoResponderDialog(true)}\n              >\n                <Zap className=\"h-4 w-4 mr-1\" />\n                Otomatik\n              </Button>\n              <Button size=\"sm\" onClick={() => setShowCompanyForm(true)}>\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Firma Ekle\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"container mx-auto p-4 max-w-7xl\">\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n          <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Building2 className=\"h-8 w-8 text-blue-500\" />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Toplam Firma</p>\n                <p className=\"text-2xl font-bold\">{companies.length}</p>\n              </div>\n            </div>\n          </Card>\n          <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <MessageCircle className=\"h-8 w-8 text-green-500\" />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Aktif Sohbet</p>\n                <p className=\"text-2xl font-bold\">{threads.length}</p>\n              </div>\n            </div>\n          </Card>\n          <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Users className=\"h-8 w-8 text-purple-500\" />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Çevrimiçi</p>\n                <p className=\"text-2xl font-bold\">{companies.filter(c => c.isActive).length}</p>\n              </div>\n            </div>\n          </Card>\n          <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Crown className=\"h-8 w-8 text-yellow-500\" />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">PRO Üyeler</p>\n                <p className=\"text-2xl font-bold\">{companies.filter(c => c.subscriptionStatus === 'pro').length}</p>\n              </div>\n            </div>\n          </Card>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n            <TabsTrigger value=\"companies\" className=\"flex items-center gap-2\">\n              <Building2 className=\"h-4 w-4\" />\n              Firma Rehberi\n              <Badge variant=\"secondary\" className=\"ml-2\">{companies.length}</Badge>\n            </TabsTrigger>\n            <TabsTrigger value=\"messages\" className=\"flex items-center gap-2\">\n              <MessageCircle className=\"h-4 w-4\" />\n              Mesajlar\n              {threads.length > 0 && (\n                <Badge className=\"ml-2\">{threads.length}</Badge>\n              )}\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"companies\" className=\"space-y-4\">\n          {/* Search */}\n          <div className=\"flex gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"h-4 w-4 absolute left-3 top-3 text-muted-foreground\" />\n              <Input\n                placeholder=\"Firma adı, şehir, sektör ile ara...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n\n          {/* Companies Grid */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {companiesLoading ? (\n              <div className=\"col-span-full text-center py-8\">Yükleniyor...</div>\n            ) : companies.length === 0 ? (\n              <div className=\"col-span-full text-center py-8 text-muted-foreground\">\n                Firma bulunamadı\n              </div>\n            ) : (\n              companies.map((company) => (\n                <Card key={company.id} className=\"hover:shadow-lg transition-shadow\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-12 w-12\">\n                          <AvatarImage src={company.logoUrl} alt={company.companyName} />\n                          <AvatarFallback>\n                            {company.companyName.charAt(0).toUpperCase()}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <CardTitle className=\"text-lg flex items-center gap-2\">\n                            {company.companyName}\n                            {company.isVerified && <Shield className=\"h-4 w-4 text-blue-500\" />}\n                            {company.subscriptionStatus === \"PRO\" && <Crown className=\"h-4 w-4 text-yellow-500\" />}\n                          </CardTitle>\n                          <p className=\"text-sm text-muted-foreground\">{company.contactPerson}</p>\n                        </div>\n                      </div>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button variant=\"ghost\" size=\"sm\">\n                            <MoreVertical className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent>\n                          <DropdownMenuItem onClick={() => handleStartConversation(company)}>\n                            <MessageCircle className=\"h-4 w-4 mr-2\" />\n                            Mesaj Gönder\n                          </DropdownMenuItem>\n                          <DropdownMenuItem>\n                            <Flag className=\"h-4 w-4 mr-2\" />\n                            Şikayet Et\n                          </DropdownMenuItem>\n                          <DropdownMenuItem>\n                            <Ban className=\"h-4 w-4 mr-2\" />\n                            Engelle\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    {company.industry && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{company.industry}</span>\n                      </div>\n                    )}\n                    {company.city && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{company.city}</span>\n                      </div>\n                    )}\n                    {company.phone && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{company.phone}</span>\n                      </div>\n                    )}\n                    {company.description && (\n                      <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                        {company.description}\n                      </p>\n                    )}\n                    <div className=\"flex gap-2 pt-2\">\n                      <Button \n                        size=\"sm\" \n                        onClick={() => handleStartConversation(company)}\n                        className=\"flex-1\"\n                      >\n                        <MessageCircle className=\"h-4 w-4 mr-2\" />\n                        Mesaj\n                      </Button>\n                      {company.website && (\n                        <Button size=\"sm\" variant=\"outline\" asChild>\n                          <a href={company.website} target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Globe className=\"h-4 w-4\" />\n                          </a>\n                        </Button>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"messages\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 h-[600px]\">\n\n\n            {/* Chat Area */}\n            <Card className=\"lg:col-span-2\">\n              {activeThread ? (\n                <>\n                  <CardHeader className=\"border-b\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-8 w-8\">\n                          <AvatarFallback>\n                            {(() => {\n                              const activeThreadData = threads.find(t => t.id === activeThread);\n                              return activeThreadData?.id?.charAt(0).toUpperCase() || \"T\";\n                            })()}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <CardTitle className=\"text-lg\">\n                            {(() => {\n                              const activeThreadData = threads.find(t => t.id === activeThread);\n                              return `Thread ${activeThreadData?.id.slice(0, 8) || \"Unknown\"}`;\n                            })()}\n                          </CardTitle>\n                          <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                            <Circle className=\"h-2 w-2 fill-green-500 text-green-500\" />\n                            <span>Çevrimiçi</span>\n                          </div>\n                        </div>\n                      </div>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button variant=\"ghost\" size=\"sm\">\n                            <MoreVertical className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent>\n                          <DropdownMenuItem>\n                            <BellOff className=\"h-4 w-4 mr-2\" />\n                            Sessiz\n                          </DropdownMenuItem>\n                          <DropdownMenuItem>\n                            <Flag className=\"h-4 w-4 mr-2\" />\n                            Şikayet Et\n                          </DropdownMenuItem>\n                          <DropdownMenuItem>\n                            <Ban className=\"h-4 w-4 mr-2\" />\n                            Engelle\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </div>\n                  </CardHeader>\n                  \n                  <CardContent className=\"p-4\">\n                    <ScrollArea className=\"h-[350px] mb-4\">\n                      <div className=\"space-y-4\">\n                        {messages.length === 0 ? (\n                          <div className=\"text-center text-muted-foreground py-8\">\n                            <MessageCircle className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                            <p>Henüz mesaj yok. İlk mesajı gönderin!</p>\n                          </div>\n                        ) : (\n                          messages.map((message) => {\n                            const isOutgoing = message.senderFirmId === currentUserFirmId;\n                            return (\n                              <div\n                                key={message.id}\n                                className={`flex ${isOutgoing ? 'justify-end' : 'justify-start'}`}\n                              >\n                                <div className={`max-w-[70%] rounded-lg p-3 ${\n                                  isOutgoing \n                                    ? 'bg-primary text-primary-foreground' \n                                    : 'bg-muted text-foreground'\n                                }`}>\n                                  <p>{message.body}</p>\n                                  <div className=\"flex items-center gap-1 mt-1\">\n                                    <span className=\"text-xs opacity-70\">\n                                    {new Date(message.createdAt).toLocaleTimeString('tr-TR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                      })}\n                                  </span>\n                                    {isOutgoing && (\n                                      message.isRead ? (\n                                        <CheckCheck className=\"h-3 w-3 opacity-70\" />\n                                      ) : (\n                                        <Check className=\"h-3 w-3 opacity-70\" />\n                                      )\n                                    )}\n                                  </div>\n                                </div>\n                              </div>\n                            );\n                          })\n                        )}\n                        <div ref={messagesEndRef} />\n                      </div>\n                    </ScrollArea>\n\n                    {/* Message Input */}\n                    <div className=\"border-t bg-muted/10 p-3\">\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => fileInputRef.current?.click()}\n                          disabled={uploadingImage || !activeThread}\n                        >\n                          <ImageIcon className=\"h-4 w-4\" />\n                        </Button>\n                        <div className=\"flex-1 relative\">\n                          <Input\n                            value={messageText}\n                            onChange={(e) => {\n                              setMessageText(e.target.value);\n                              setDraftText(e.target.value);\n                              }}\n                            placeholder={activeThread ? \"Mesajınızı yazın ve Enter'a basın...\" : \"Önce bir sohbet seçin...\"}\n                            className=\"pr-10\"\n                            disabled={!activeThread}\n                            onKeyPress={(e) => {\n                              if (e.key === \"Enter\" && !e.shiftKey) {\n                                e.preventDefault();\n                                console.log(\"Enter key pressed!\");\n                                handleSendMessage();\n                                }\n                              }}\n                          />\n                          {messageText && (\n                            <Badge className=\"absolute right-2 top-1/2 -translate-y-1/2 text-xs px-1\" variant=\"secondary\">\n                              {messageText.length}\n                            </Badge>\n                          )}\n                        </div>\n                        <Button \n                          onClick={() => {\n                            console.log(\"Send button clicked!\");\n                            handleSendMessage();\n                          }}\n                          disabled={(!messageText.trim() && !uploadingImage) || sendMessageMutation.isPending || !activeThread}\n                          size=\"sm\"\n                        >\n                          {sendMessageMutation.isPending ? (\n                            <Clock className=\"h-4 w-4 animate-spin\" />\n                          ) : (\n                            <Send className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                      </div>\n                      {activeThread && (\n                        <div className=\"flex items-center gap-2 mt-2 text-xs text-muted-foreground\">\n                          <Circle className=\"h-2 w-2 fill-green-500 text-green-500\" />\n                          <span>Mesajlarınız gerçek zamanlı olarak güncelleniyor</span>\n                        </div>\n                      )}\n                    </div>\n                    \n                    <input\n                      ref={fileInputRef}\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={handleImageUpload}\n                      className=\"hidden\"\n                    />\n                  </CardContent>\n                </>\n              ) : (\n                <CardContent className=\"flex items-center justify-center h-full\">\n                  <div className=\"text-center text-muted-foreground\">\n                    <MessageCircle className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>Mesajlaşmaya başlamak için bir konuşma seçin</p>\n                  </div>\n                </CardContent>\n              )}\n            </Card>\n          </div>\n          </TabsContent>\n        </Tabs>\n\n      {/* Company Form Dialog */}\n      <Dialog open={showCompanyForm} onOpenChange={setShowCompanyForm}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Yeni Firma Ekle</DialogTitle>\n            <DialogDescription>\n              Firma rehberine yeni bir firma ekleyin.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...companyForm}>\n            <form onSubmit={companyForm.handleSubmit((data) => createCompanyMutation.mutate(data))} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={companyForm.control}\n                  name=\"companyName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Firma Adı *</FormLabel>\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={companyForm.control}\n                  name=\"contactPerson\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>İletişim Kişisi *</FormLabel>\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={companyForm.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Telefon</FormLabel>\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={companyForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input {...field} type=\"email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={companyForm.control}\n                  name=\"city\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Şehir</FormLabel>\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={companyForm.control}\n                  name=\"industry\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Sektör</FormLabel>\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <FormField\n                control={companyForm.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Açıklama</FormLabel>\n                    <FormControl>\n                      <Textarea {...field} rows={3} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"flex justify-end gap-2\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowCompanyForm(false)}>\n                  İptal\n                </Button>\n                <Button type=\"submit\" disabled={createCompanyMutation.isPending}>\n                  {createCompanyMutation.isPending ? \"Kaydediliyor...\" : \"Kaydet\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Invite Dialog */}\n      <Dialog open={showInviteDialog} onOpenChange={setShowInviteDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Firma Davet Et</DialogTitle>\n            <DialogDescription>\n              Yeni kullanıcıları firmanıza davet edin.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...inviteForm}>\n            <form onSubmit={inviteForm.handleSubmit((data) => createInviteMutation.mutate(data))} className=\"space-y-4\">\n              <FormField\n                control={inviteForm.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email Adresi</FormLabel>\n                    <FormControl>\n                      <Input {...field} type=\"email\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={inviteForm.control}\n                name=\"role\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Rol</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"USER\">Kullanıcı</SelectItem>\n                        <SelectItem value=\"ADMIN\">Yönetici</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"flex justify-end gap-2\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowInviteDialog(false)}>\n                  İptal\n                </Button>\n                <Button type=\"submit\" disabled={createInviteMutation.isPending}>\n                  {createInviteMutation.isPending ? \"Gönderiliyor...\" : \"Davet Gönder\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n          \n          {/* Invites List */}\n          {invites.length > 0 && (\n            <div className=\"space-y-2\">\n              <h4 className=\"font-medium\">Bekleyen Davetler</h4>\n              {invites.map((invite) => (\n                <div key={invite.id} className=\"flex items-center justify-between p-2 border rounded\">\n                  <div>\n                    <p className=\"font-medium\">{invite.email}</p>\n                    <p className=\"text-sm text-muted-foreground\">{invite.role}</p>\n                  </div>\n                  <Badge variant={invite.acceptedAt ? \"default\" : \"secondary\"}>\n                    {invite.acceptedAt ? \"Kabul Edildi\" : \"Bekliyor\"}\n                  </Badge>\n                </div>\n              ))}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Auto Responder Dialog */}\n      <Dialog open={showAutoResponderDialog} onOpenChange={setShowAutoResponderDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Otomatik Yanıt Ayarları</DialogTitle>\n            <DialogDescription>\n              Gelen mesajlara otomatik yanıt ayarlarını yapılandırın.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <Label>Otomatik Yanıt Aktif</Label>\n              <Button variant=\"outline\" size=\"sm\">\n                {autoResponder?.enabled ? \"Aktif\" : \"Pasif\"}\n              </Button>\n            </div>\n            <div>\n              <Label>Yanıt Modu</Label>\n              <Select defaultValue={autoResponder?.mode || \"KEYWORD\"}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"KEYWORD\">Anahtar Kelime</SelectItem>\n                  <SelectItem value=\"ALWAYS\">Her Zaman</SelectItem>\n                  <SelectItem value=\"OFFHOURS\">Mesai Dışı</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label>Mesaj İçeriği</Label>\n              <Textarea \n                defaultValue={autoResponder?.messageBody || \"Merhaba! Mesajınızı aldık, en kısa sürede dönüş yapacağız.\"}\n                rows={3}\n              />\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setShowAutoResponderDialog(false)}>\n                İptal\n              </Button>\n              <Button>Kaydet</Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n      </div>\n    </div>\n  );\n}","size_bytes":43173},"client/src/pages/enhanced-company-directory-fixed.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Plus, Search, MessageCircle, Bell, Filter, Star, Building2, X, Send, ImageIcon, CheckCheck, Check, Circle, MoreVertical, Flag, BellOff, Ban } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { CompanyDirectory, InsertCompanyDirectory, DirectMessage, Notification, FirmInvite, Conversation } from \"@shared/schema\";\n\nexport default function EnhancedCompanyDirectory() {\n  const [activeTab, setActiveTab] = useState(\"directory\");\n  const [showDirectoryForm, setShowDirectoryForm] = useState(false);\n  const [editingEntry, setEditingEntry] = useState<CompanyDirectory | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedSector, setSelectedSector] = useState(\"\");\n  const [showNotifications, setShowNotifications] = useState(false);\n  const [activeThread, setActiveThread] = useState<string | null>(null);\n  const [messageText, setMessageText] = useState(\"\");\n  const [draftText, setDraftText] = useState(\"\");\n  const [uploadingImage, setUploadingImage] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  // Companies query\n  const { data: companies = [] } = useQuery<CompanyDirectory[]>({\n    queryKey: [\"/api/company-directory\"],\n    queryFn: () => apiRequest(\"/api/company-directory\", \"GET\"),\n  });\n\n  // Get current user's companies\n  const { data: userCompanies } = useQuery({\n    queryKey: [\"/api/company-directory/my-companies\"],\n    queryFn: () => apiRequest(\"/api/company-directory/my-companies\", \"GET\"),\n  });\n  \n  const currentUserFirmId = userCompanies?.[0]?.id;\n\n  // Notifications query\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n    refetchInterval: 3000,\n  });\n\n  // URL parametrelerini kontrol et ve aktif thread'i ayarla\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const activeThreadParam = urlParams.get('activeThread');\n    \n    if (activeThreadParam) {\n      console.log(\"🔥 URL'den activeThread parametresi bulundu:\", activeThreadParam);\n      setActiveThread(activeThreadParam);\n      setActiveTab(\"messaging\");\n      \n      // URL'yi temizle (parametre kaldır)\n      const newUrl = window.location.pathname;\n      window.history.replaceState({}, '', newUrl);\n    }\n  }, []);\n\n  // Debug notifications\n  useEffect(() => {\n    console.log(\"🔔 All notifications:\", notifications);\n    console.log(\"🔔 Notifications count:\", notifications.length);\n    console.log(\"🔔 First notification:\", notifications[0]);\n  }, [notifications]);\n\n  // Messages query for active thread\n  const { data: messages = [] } = useQuery<DirectMessage[]>({\n    queryKey: [`/api/messages/${activeThread}`],\n    refetchInterval: 3000,\n    enabled: !!activeThread,\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  // Company mutations\n  const createCompanyMutation = useMutation({\n    mutationFn: (entry: InsertCompanyDirectory) =>\n      apiRequest(\"/api/company-directory\", \"POST\", entry),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/company-directory\"] });\n      setShowDirectoryForm(false);\n      setEditingEntry(null);\n      toast({ title: \"Başarılı\", description: \"Firma bilgileri kaydedildi.\" });\n    },\n  });\n\n  const updateCompanyMutation = useMutation({\n    mutationFn: ({ id, ...entry }: { id: string } & Partial<InsertCompanyDirectory>) =>\n      apiRequest(`/api/company-directory/${id}`, \"PATCH\", entry),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/company-directory\"] });\n      setShowDirectoryForm(false);\n      setEditingEntry(null);\n      toast({ title: \"Başarılı\", description: \"Firma bilgileri güncellendi.\" });\n    },\n  });\n\n  const deleteCompanyMutation = useMutation({\n    mutationFn: (id: string) => apiRequest(`/api/company-directory/${id}`, \"DELETE\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/company-directory\"] });\n      toast({ title: \"Başarılı\", description: \"Firma silindi.\" });\n    },\n  });\n\n  // Message mutations\n  const sendMessageMutation = useMutation({\n    mutationFn: (message: { receiverFirmId: string; body: string }) =>\n      apiRequest(\"/api/messages\", \"POST\", message),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/messages/${activeThread}`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      setMessageText(\"\");\n      setDraftText(\"\");\n    },\n  });\n\n  // Mark notification as read mutation\n  const markAsReadMutation = useMutation({\n    mutationFn: (notificationId: string) =>\n      apiRequest(`/api/notifications/${notificationId}/read`, \"PATCH\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    },\n  });\n\n  // Send message handler\n  const handleSendMessage = () => {\n    if (!messageText.trim() || !activeThread) return;\n    \n    sendMessageMutation.mutate({\n      receiverFirmId: activeThread,\n      body: messageText.trim(),\n    });\n  };\n\n  // Filter companies\n  const filteredCompanies = (Array.isArray(companies) ? companies : []).filter(company => {\n    const matchesSearch = company.companyName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         company.contactPerson.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         (company.city || \"\").toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesSector = selectedSector === \"\" || selectedSector === \"all\" || company.industry === selectedSector;\n    return matchesSearch && matchesSector;\n  });\n\n  // Auto-scroll to bottom of messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <div className=\"flex items-center gap-4\">\n          <a href=\"/\" className=\"text-2xl font-bold text-primary hover:text-primary/80 transition-colors\">\n            PuantajPro\n          </a>\n          <h1 className=\"text-3xl font-bold\">Firma Rehberi</h1>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowNotifications(!showNotifications)}\n          >\n            <Bell className=\"h-4 w-4 mr-2\" />\n            Bildirimler\n            {notifications.filter(n => !n.isRead).length > 0 && (\n              <Badge variant=\"destructive\" className=\"ml-2\">\n                {notifications.filter(n => !n.isRead).length}\n              </Badge>\n            )}\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"directory\">Firma Rehberi</TabsTrigger>\n          <TabsTrigger value=\"messaging\">Mesajlaşma</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"directory\" className=\"space-y-4\">\n          <div className=\"flex gap-4 mb-6\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n              <Input\n                placeholder=\"Firma ara...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <Select value={selectedSector} onValueChange={setSelectedSector}>\n              <SelectTrigger className=\"w-48\">\n                <SelectValue placeholder=\"Sektör filtrele\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Tüm Sektörler</SelectItem>\n                <SelectItem value=\"İnşaat\">İnşaat</SelectItem>\n                <SelectItem value=\"Teknoloji\">Teknoloji</SelectItem>\n                <SelectItem value=\"Gıda\">Gıda</SelectItem>\n                <SelectItem value=\"Tekstil\">Tekstil</SelectItem>\n                <SelectItem value=\"Otomotiv\">Otomotiv</SelectItem>\n                <SelectItem value=\"Diğer\">Diğer</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredCompanies.map((company) => (\n              <Card key={company.id} className=\"hover:shadow-lg transition-shadow\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex justify-between items-start\">\n                    <div>\n                      <CardTitle className=\"text-lg\">{company.companyName}</CardTitle>\n                      <p className=\"text-sm text-muted-foreground\">{company.industry || \"Sektör belirtilmemiş\"}</p>\n                    </div>\n                    <Badge variant={company.subscriptionStatus === \"PRO\" ? \"default\" : \"secondary\"}>\n                      {company.subscriptionStatus === \"PRO\" ? \"PRO\" : \"Basic\"}\n                    </Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div>\n                    <p className=\"font-medium\">{company.contactPerson}</p>\n                    {company.phone && <p className=\"text-sm text-muted-foreground\">{company.phone}</p>}\n                    {company.email && <p className=\"text-sm text-muted-foreground\">{company.email}</p>}\n                  </div>\n                  <div>\n                    {company.address && <p className=\"text-sm\">{company.address}</p>}\n                    {company.city && <p className=\"text-sm text-muted-foreground\">{company.city}</p>}\n                  </div>\n                  {company.description && (\n                    <p className=\"text-sm text-muted-foreground\">{company.description}</p>\n                  )}\n                  <div className=\"flex justify-between\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setActiveThread(company.id);\n                        setActiveTab(\"messaging\");\n                      }}\n                    >\n                      <MessageCircle className=\"h-4 w-4 mr-2\" />\n                      Mesaj\n                    </Button>\n                    {userCompanies?.some((myComp: any) => myComp.id === company.id) && (\n                      <div className=\"flex gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setEditingEntry(company);\n                            setShowDirectoryForm(true);\n                          }}\n                        >\n                          Düzenle\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => deleteCompanyMutation.mutate(company.id)}\n                        >\n                          Sil\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"messaging\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Sohbetler</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-[80px]\">\n                  <div className=\"space-y-2\">\n                    {companies.map((company) => (\n                      <Button\n                        key={company.id}\n                        variant={activeThread === company.id ? \"default\" : \"ghost\"}\n                        className=\"w-full justify-start\"\n                        onClick={() => setActiveThread(company.id)}\n                      >\n                        <Avatar className=\"h-8 w-8 mr-2\">\n                          <AvatarFallback>\n                            {company.companyName.charAt(0)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"text-left\">\n                          <p className=\"font-medium\">{company.companyName}</p>\n                          <p className=\"text-xs text-muted-foreground\">{company.contactPerson}</p>\n                        </div>\n                      </Button>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n\n            <Card className=\"lg:col-span-2\">\n              {activeThread ? (\n                <>\n                  <CardHeader>\n                    <div className=\"flex justify-between items-center\">\n                      <div>\n                        <CardTitle>\n                          {companies.find(c => c.id === activeThread)?.companyName}\n                        </CardTitle>\n                        <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                          <Circle className=\"h-2 w-2 fill-green-500 text-green-500\" />\n                          <span>Çevrimiçi</span>\n                        </div>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  \n                  <CardContent className=\"p-4\">\n                    <ScrollArea className=\"h-[350px] mb-4\">\n                      <div className=\"space-y-4\">\n                        {messages.length === 0 ? (\n                          <div className=\"text-center text-muted-foreground py-8\">\n                            <MessageCircle className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                            <p>Henüz mesaj yok. İlk mesajı gönderin!</p>\n                          </div>\n                        ) : (\n                          messages.map((message) => {\n                            const isOutgoing = (message as any).fromCompanyId === currentUserFirmId;\n                            return (\n                              <div\n                                key={message.id}\n                                className={`flex ${isOutgoing ? 'justify-end' : 'justify-start'}`}\n                              >\n                                <div className={`max-w-[70%] rounded-lg p-3 ${\n                                  isOutgoing \n                                    ? 'bg-primary text-primary-foreground' \n                                    : 'bg-muted text-foreground'\n                                }`}>\n                                  <p>{(message as any).message || (message as any).content}</p>\n                                  <div className=\"flex items-center gap-1 mt-1\">\n                                    <span className=\"text-xs opacity-70\">\n                                      {message.createdAt ? new Date(message.createdAt).toLocaleTimeString('tr-TR', {\n                                        hour: '2-digit',\n                                        minute: '2-digit'\n                                      }) : ''}\n                                    </span>\n                                    {isOutgoing && (\n                                      message.isRead ? (\n                                        <CheckCheck className=\"h-3 w-3 opacity-70\" />\n                                      ) : (\n                                        <Check className=\"h-3 w-3 opacity-70\" />\n                                      )\n                                    )}\n                                  </div>\n                                </div>\n                              </div>\n                            );\n                          })\n                        )}\n                        <div ref={messagesEndRef} />\n                      </div>\n                    </ScrollArea>\n\n                    <div className=\"border-t bg-muted/10 p-3\">\n                      <div className=\"flex gap-2\">\n                        <div className=\"flex-1 relative\">\n                          <Input\n                            value={messageText}\n                            onChange={(e) => {\n                              setMessageText(e.target.value);\n                              setDraftText(e.target.value);\n                            }}\n                            placeholder=\"Mesajınızı yazın ve Enter'a basın...\"\n                            className=\"pr-10\"\n                            onKeyPress={(e) => {\n                              if (e.key === \"Enter\" && !e.shiftKey) {\n                                e.preventDefault();\n                                handleSendMessage();\n                              }\n                            }}\n                          />\n                          {messageText && (\n                            <Button\n                              size=\"sm\"\n                              className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0\"\n                              onClick={handleSendMessage}\n                              disabled={sendMessageMutation.isPending}\n                            >\n                              <Send className=\"h-3 w-3\" />\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </>\n              ) : (\n                <CardContent className=\"flex items-center justify-center h-[500px]\">\n                  <div className=\"text-center text-muted-foreground\">\n                    <MessageCircle className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n                    <p>Mesajlaşmaya başlamak için bir firma seçin</p>\n                  </div>\n                </CardContent>\n              )}\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Notifications Panel */}\n      {showNotifications && (\n        <Card className=\"fixed top-20 right-6 w-80 max-h-96 z-50 shadow-lg\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex justify-between items-center\">\n              <CardTitle>Bildirimler</CardTitle>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowNotifications(false)}\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className=\"h-60\">\n              {notifications.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-4\">\n                  Henüz bildirim yok\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {notifications.map((notification) => (\n                    <div\n                      key={notification.id}\n                      className={`p-3 rounded border cursor-pointer hover:bg-muted/30 transition-colors ${\n                        notification.isRead ? 'bg-muted/50' : 'bg-primary/10 border-primary/20'\n                      }`}\n                      onClick={(e) => {\n                        console.log(\"🔥 NOTIFICATION CLICKED!\", notification);\n                        console.log(\"🔥 Type:\", notification.type);\n                        console.log(\"🔥 Payload:\", notification.payload);\n                        \n                        // Mesaj bildirimi ise mesajlaşma tabını aç\n                        if (notification.type === \"NEW_MESSAGE\" || notification.type === \"NEW_DM\") {\n                          const payload = notification.payload as any;\n                          console.log(\"🔥 Found message notification\");\n                          console.log(\"🔥 FromCompanyId:\", payload?.fromCompanyId);\n                          if (payload?.fromCompanyId) {\n                            console.log(\"🔥 Switching to messaging tab with thread:\", payload.fromCompanyId);\n                            setActiveThread(payload.fromCompanyId);\n                            setActiveTab(\"messaging\");\n                            setShowNotifications(false);\n                          } else {\n                            console.log(\"🔥 No fromCompanyId found in payload\");\n                          }\n                        } else {\n                          console.log(\"🔥 Not a message notification, type is:\", notification.type);\n                        }\n                        \n                        // Bildirimi okundu olarak işaretle\n                        markAsReadMutation.mutate(notification.id);\n                        e.stopPropagation();\n                      }}\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <p className=\"font-medium text-sm\">\n                            {(notification.payload as any)?.title || (notification as any).title || 'Bildirim'}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {(notification.payload as any)?.message || (notification as any).content || 'Yeni bildirim'}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground mt-2\">\n                            {notification.createdAt ? new Date(notification.createdAt).toLocaleString('tr-TR') : ''}\n                          </p>\n                        </div>\n                        {!notification.isRead && (\n                          <div className=\"w-2 h-2 bg-primary rounded-full flex-shrink-0 mt-1\"></div>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Company Form Dialog */}\n      <Dialog open={showDirectoryForm} onOpenChange={setShowDirectoryForm}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingEntry ? \"Firma Düzenle\" : \"Yeni Firma Ekle\"}\n            </DialogTitle>\n          </DialogHeader>\n          <CompanyForm\n            entry={editingEntry}\n            onSubmit={(data) => {\n              if (editingEntry) {\n                updateCompanyMutation.mutate({ id: editingEntry.id, ...data });\n              } else {\n                createCompanyMutation.mutate(data);\n              }\n            }}\n            onCancel={() => {\n              setShowDirectoryForm(false);\n              setEditingEntry(null);\n            }}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nfunction CompanyForm({\n  entry,\n  onSubmit,\n  onCancel,\n}: {\n  entry?: CompanyDirectory | null;\n  onSubmit: (data: InsertCompanyDirectory) => void;\n  onCancel: () => void;\n}) {\n  const [formData, setFormData] = useState<InsertCompanyDirectory>({\n    companyName: entry?.companyName || \"\",\n    contactPerson: entry?.contactPerson || \"\",\n    phone: entry?.phone || \"\",\n    email: entry?.email || \"\",\n    address: entry?.address || \"\",\n    city: entry?.city || \"\",\n    industry: entry?.industry || \"\",\n    description: entry?.description || \"\",\n  });\n\n  return (\n    <form\n      onSubmit={(e) => {\n        e.preventDefault();\n        onSubmit(formData);\n      }}\n      className=\"space-y-4\"\n    >\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"companyName\">Firma Adı *</Label>\n          <Input\n            id=\"companyName\"\n            value={formData.companyName}\n            onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\n            required\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"contactPerson\">İletişim Kişisi *</Label>\n          <Input\n            id=\"contactPerson\"\n            value={formData.contactPerson}\n            onChange={(e) => setFormData({ ...formData, contactPerson: e.target.value })}\n            required\n          />\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"phone\">Telefon *</Label>\n          <Input\n            id=\"phone\"\n            value={formData.phone}\n            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n            required\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"email\">E-posta *</Label>\n          <Input\n            id=\"email\"\n            type=\"email\"\n            value={formData.email}\n            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n            required\n          />\n        </div>\n      </div>\n\n      <div>\n        <Label htmlFor=\"address\">Adres</Label>\n        <Input\n          id=\"address\"\n          value={formData.address}\n          onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n        />\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"city\">Şehir</Label>\n          <Input\n            id=\"city\"\n            value={formData.city}\n            onChange={(e) => setFormData({ ...formData, city: e.target.value })}\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"industry\">Sektör</Label>\n          <Select value={formData.industry} onValueChange={(value) => setFormData({ ...formData, industry: value })}>\n            <SelectTrigger>\n              <SelectValue placeholder=\"Sektör seçin\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"İnşaat\">İnşaat</SelectItem>\n              <SelectItem value=\"Teknoloji\">Teknoloji</SelectItem>\n              <SelectItem value=\"Gıda\">Gıda</SelectItem>\n              <SelectItem value=\"Tekstil\">Tekstil</SelectItem>\n              <SelectItem value=\"Otomotiv\">Otomotiv</SelectItem>\n              <SelectItem value=\"Diğer\">Diğer</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div>\n        <Label htmlFor=\"description\">Açıklama</Label>\n        <Textarea\n          id=\"description\"\n          value={formData.description || \"\"}\n          onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n          rows={3}\n        />\n      </div>\n\n      <div className=\"flex justify-end space-x-2\">\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\n          İptal\n        </Button>\n        <Button type=\"submit\">\n          {entry ? \"Güncelle\" : \"Kaydet\"}\n        </Button>\n      </div>\n    </form>\n  );\n}","size_bytes":28019},"client/src/pages/messages.tsx":{"content":"import React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { useAuth } from '@/hooks/useAuth';\nimport { useLocation, Link } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Separator } from '@/components/ui/separator';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { \n  Search, \n  MoreHorizontal, \n  Send, \n  Image as ImageIcon, \n  Smile,\n  ArrowDown,\n  Info,\n  Ban,\n  VolumeX,\n  Flag,\n  CheckCheck,\n  Check,\n  Home,\n  MessageCircle,\n  Circle\n} from 'lucide-react';\nimport { \n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport type { CompanyDirectory, DirectMessage } from \"@shared/schema\";\n\nexport default function Messages() {\n  const [activeThread, setActiveThread] = useState<string | null>(null);\n  const [messageText, setMessageText] = useState(\"\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  // Firma rehberinden firmaları al\n  const { data: companies = [] } = useQuery<CompanyDirectory[]>({\n    queryKey: [\"/api/company-directory\"],\n    queryFn: () => apiRequest(\"/api/company-directory\", \"GET\"),\n  });\n\n  // Kullanıcının kendi firmasını al\n  const { data: userCompanies } = useQuery({\n    queryKey: [\"/api/company-directory/my-companies\"],\n    queryFn: () => apiRequest(\"/api/company-directory/my-companies\", \"GET\"),\n  });\n  \n  const currentUserFirmId = userCompanies?.[0]?.id;\n\n  // Aktif thread için mesajları al\n  const { data: messages = [] } = useQuery<DirectMessage[]>({\n    queryKey: [`/api/messages/${activeThread}`],\n    enabled: !!activeThread,\n    staleTime: 1000 * 60 * 10, // 10 min cache\n    refetchOnWindowFocus: false,\n  });\n\n  // Mesaj gönderme\n  const sendMessageMutation = useMutation({\n    mutationFn: async (data: { content: string; toCompanyId: string }) => {\n      // Önce basit mesaj endpoint'ini kullan - bu otomatik thread oluşturur\n      return apiRequest(\"/api/messages\", \"POST\", {\n        receiverFirmId: data.toCompanyId,\n        body: data.content,\n      });\n    },\n    onSuccess: () => {\n      setMessageText(\"\");\n      queryClient.invalidateQueries({ queryKey: [`/api/messages/${activeThread}`] });\n      scrollToBottom();\n    },\n    onError: (error) => {\n      console.error(\"Message send error:\", error);\n      toast({\n        title: \"Hata\", \n        description: \"Mesaj gönderilemedi\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Auto scroll to bottom when messages change\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  // Basit filtreleme\n  const filteredCompanies = companies.filter(company => {\n    if (!searchTerm.trim()) return true;\n    const search = searchTerm.toLowerCase();\n    return company.companyName?.toLowerCase().includes(search) ||\n           company.industry?.toLowerCase().includes(search);\n  });\n\n  const handleSendMessage = () => {\n    if (!messageText.trim() || !activeThread) return;\n    \n    sendMessageMutation.mutate({\n      content: messageText.trim(),\n      toCompanyId: activeThread,\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-gray-900 dark:to-gray-800\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-3\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"sm\">\n                <Home className=\"h-4 w-4 mr-2\" />\n                Ana Sayfa\n              </Button>\n            </Link>\n            <h1 className=\"text-xl font-semibold text-gray-900 dark:text-white\">Mesajlar</h1>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex h-[calc(100vh-80px)]\">\n        {/* Sol Panel - Firma Seçici */}\n        <div className=\"w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col\">\n          {/* Dropdown Firma Seçici */}\n          <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h3 className=\"text-lg font-semibold mb-3\">Sohbetler</h3>\n            \n            {/* Arama Kutusu */}\n            <div className=\"relative mb-3\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n              <Input\n                placeholder=\"Firma ara...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n\n            {/* Firma Listesi */}\n            <div className=\"max-h-20 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-md\">\n              {filteredCompanies.length === 0 ? (\n                <div className=\"p-2 text-sm text-muted-foreground text-center\">\n                  {searchTerm ? \"Eşleşen firma bulunamadı\" : \"Henüz firma eklenmemiş\"}\n                </div>\n              ) : (\n                filteredCompanies.map((company) => (\n                  <div\n                    key={company.id}\n                    onClick={() => setActiveThread(company.id)}\n                    className={`px-3 py-2 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0 hover:bg-gray-50 dark:hover:bg-gray-700 ${\n                      activeThread === company.id ? 'bg-blue-50 dark:bg-blue-900/30 border-l-4 border-l-blue-500' : ''\n                    }`}\n                  >\n                    <div className=\"font-medium text-sm\">{company.companyName}</div>\n                    {company.industry && (\n                      <div className=\"text-xs text-muted-foreground\">{company.industry}</div>\n                    )}\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Seçilen Firmanın Detayları */}\n          {activeThread && (\n            <div className=\"p-4 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700\">\n              {(() => {\n                const selectedCompany = companies.find(c => c.id === activeThread);\n                return selectedCompany ? (\n                  <div className=\"flex items-center gap-3\">\n                    <Avatar className=\"h-12 w-12\">\n                      <AvatarFallback>\n                        {selectedCompany.companyName?.slice(0, 2).toUpperCase()}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 min-w-0\">\n                      <h3 className=\"font-semibold\">{selectedCompany.companyName}</h3>\n                      <p className=\"text-sm text-muted-foreground\">{selectedCompany.contactPerson}</p>\n                      <div className=\"flex items-center gap-1 text-sm text-green-600 mt-1\">\n                        <Circle className=\"h-2 w-2 fill-green-500 text-green-500\" />\n                        <span>Çevrimiçi</span>\n                      </div>\n                    </div>\n                  </div>\n                ) : null;\n              })()}\n            </div>\n          )}\n\n          {/* Boş Alan */}\n          <div className=\"flex-1 bg-gray-50 dark:bg-gray-900\">\n            {!activeThread && (\n              <div className=\"flex items-center justify-center h-full\">\n                <div className=\"text-center text-muted-foreground\">\n                  <MessageCircle className=\"h-16 w-16 mx-auto mb-4 opacity-30\" />\n                  <p className=\"text-sm\">Mesajlaşmak için firma seçin</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Sağ Panel - Mesajlaşma Alanı */}\n        <div className=\"flex-1 flex flex-col\">\n          {activeThread ? (\n            <>\n              {/* Chat Header */}\n              <div className=\"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <Avatar className=\"h-10 w-10\">\n                    <AvatarFallback>\n                      {companies.find(c => c.id === activeThread)?.companyName?.slice(0, 2).toUpperCase()}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <h2 className=\"font-semibold\">\n                      {companies.find(c => c.id === activeThread)?.companyName}\n                    </h2>\n                    <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                      <Circle className=\"h-2 w-2 fill-green-500 text-green-500\" />\n                      <span>Çevrimiçi</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Messages Area */}\n              <ScrollArea className=\"flex-1 p-4\">\n                <div className=\"space-y-4\">\n                  {messages.length === 0 ? (\n                    <div className=\"text-center text-muted-foreground py-8\">\n                      <MessageCircle className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                      <p>Henüz mesaj yok. İlk mesajı gönderin!</p>\n                    </div>\n                  ) : (\n                    messages.map((message) => {\n                      const isOutgoing = (message as any).fromCompanyId === currentUserFirmId;\n                      return (\n                        <div\n                          key={message.id}\n                          className={`flex ${isOutgoing ? 'justify-end' : 'justify-start'}`}\n                        >\n                          <div className={`max-w-[70%] rounded-lg p-3 ${\n                            isOutgoing \n                              ? 'bg-primary text-primary-foreground' \n                              : 'bg-muted text-foreground'\n                          }`}>\n                            <p>{(message as any).message || (message as any).content}</p>\n                            <div className=\"flex items-center gap-1 mt-1\">\n                              <span className=\"text-xs opacity-70\">\n                                {message.createdAt ? new Date(message.createdAt).toLocaleTimeString('tr-TR', {\n                                  hour: '2-digit',\n                                  minute: '2-digit'\n                                }) : ''}\n                              </span>\n                              {isOutgoing && (\n                                message.isRead ? (\n                                  <CheckCheck className=\"h-3 w-3 opacity-70\" />\n                                ) : (\n                                  <Check className=\"h-3 w-3 opacity-70\" />\n                                )\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })\n                  )}\n                  <div ref={messagesEndRef} />\n                </div>\n              </ScrollArea>\n\n              {/* Message Input */}\n              <div className=\"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-4\">\n                <div className=\"flex gap-2\">\n                  <div className=\"flex-1 relative\">\n                    <Input\n                      value={messageText}\n                      onChange={(e) => setMessageText(e.target.value)}\n                      placeholder=\"Mesajınızı yazın ve Enter'a basın...\"\n                      className=\"pr-10\"\n                      onKeyPress={(e) => {\n                        if (e.key === 'Enter' && !e.shiftKey) {\n                          e.preventDefault();\n                          handleSendMessage();\n                        }\n                      }}\n                    />\n                  </div>\n                  <Button\n                    onClick={handleSendMessage}\n                    disabled={!messageText.trim() || sendMessageMutation.isPending}\n                    size=\"sm\"\n                  >\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </>\n          ) : (\n            <div className=\"flex-1 flex items-center justify-center\">\n              <div className=\"text-center text-muted-foreground\">\n                <MessageCircle className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n                <h3 className=\"text-lg font-medium mb-2\">Mesajlaşmaya başlayın</h3>\n                <p>Soldan bir firma seçerek mesajlaşmaya başlayabilirsiniz</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":13419},"client/src/pages/admin/settings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { \n  ArrowLeft, Settings, Save, RotateCcw, Database, \n  Mail, Bell, Lock, Globe, Server\n} from \"lucide-react\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function AdminSettings() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isDirty, setIsDirty] = useState(false);\n\n  // Fetch system settings\n  const { data: settings, isLoading } = useQuery({\n    queryKey: [\"/api/admin/settings\"],\n  });\n\n  // Save settings\n  const saveSettingMutation = useMutation({\n    mutationFn: async (setting: any) => {\n      return await apiRequest(\"/api/admin/settings\", \"POST\", setting);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings\"] });\n      setIsDirty(false);\n      toast({\n        title: \"Başarılı\",\n        description: \"Sistem ayarları kaydedildi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Ayarlar kaydedilirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const settingsMap = settings?.reduce((acc: any, setting: any) => {\n    acc[setting.key] = setting.value;\n    return acc;\n  }, {}) || {};\n\n  const handleSettingChange = (key: string, value: string) => {\n    setIsDirty(true);\n  };\n\n  const saveSetting = (key: string, value: string, category: string, description: string) => {\n    saveSettingMutation.mutate({\n      key,\n      value,\n      category,\n      description,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"text-center\">\n              <Settings className=\"h-12 w-12 text-purple-400 mx-auto mb-4 animate-spin\" />\n              <p className=\"text-gray-400\">Sistem ayarları yükleniyor...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-gray-400 hover:text-white\"\n              onClick={() => setLocation(\"/admin\")}\n            >\n              <ArrowLeft className=\"h-6 w-6\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <Settings className=\"h-8 w-8 text-green-500\" />\n              <div>\n                <h1 className=\"text-2xl font-bold text-white\">Sistem Ayarları</h1>\n                <p className=\"text-gray-400\">Genel sistem ayarlarını yapılandır</p>\n              </div>\n            </div>\n          </div>\n          {isDirty && (\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"border-gray-600 text-gray-300\"\n                onClick={() => {\n                  queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings\"] });\n                  setIsDirty(false);\n                }}\n              >\n                <RotateCcw className=\"h-4 w-4 mr-2\" />\n                Sıfırla\n              </Button>\n              <Button\n                size=\"sm\"\n                className=\"bg-green-600 hover:bg-green-700\"\n                disabled={saveSettingMutation.isPending}\n              >\n                <Save className=\"h-4 w-4 mr-2\" />\n                Kaydet\n              </Button>\n            </div>\n          )}\n        </div>\n\n        <Tabs defaultValue=\"general\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-5 bg-dark-secondary\">\n            <TabsTrigger value=\"general\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Globe className=\"h-4 w-4 mr-2\" />\n              Genel\n            </TabsTrigger>\n            <TabsTrigger value=\"database\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Database className=\"h-4 w-4 mr-2\" />\n              Veritabanı\n            </TabsTrigger>\n            <TabsTrigger value=\"email\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Mail className=\"h-4 w-4 mr-2\" />\n              Email\n            </TabsTrigger>\n            <TabsTrigger value=\"notifications\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Bell className=\"h-4 w-4 mr-2\" />\n              Bildirimler\n            </TabsTrigger>\n            <TabsTrigger value=\"security\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Lock className=\"h-4 w-4 mr-2\" />\n              Güvenlik\n            </TabsTrigger>\n          </TabsList>\n\n          {/* General Settings */}\n          <TabsContent value=\"general\">\n            <div className=\"grid gap-6\">\n              <Card className=\"bg-dark-secondary border-dark-accent\">\n                <CardHeader>\n                  <CardTitle className=\"text-white\">Genel Ayarlar</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"app-name\" className=\"text-gray-300\">Uygulama Adı</Label>\n                      <Input\n                        id=\"app-name\"\n                        defaultValue={settingsMap.app_name || \"puantropls\"}\n                        className=\"bg-dark-primary border-gray-600 text-white\"\n                        onChange={(e) => handleSettingChange(\"app_name\", e.target.value)}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"app-version\" className=\"text-gray-300\">Versiyon</Label>\n                      <Input\n                        id=\"app-version\"\n                        defaultValue={settingsMap.app_version || \"1.0.0\"}\n                        className=\"bg-dark-primary border-gray-600 text-white\"\n                        onChange={(e) => handleSettingChange(\"app_version\", e.target.value)}\n                      />\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"app-description\" className=\"text-gray-300\">Uygulama Açıklaması</Label>\n                    <Textarea\n                      id=\"app-description\"\n                      defaultValue={settingsMap.app_description || \"Türk işgücü yönetim platformu\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                      onChange={(e) => handleSettingChange(\"app_description\", e.target.value)}\n                    />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Bakım Modu</Label>\n                      <p className=\"text-sm text-gray-400\">Sistemi geçici olarak devre dışı bırak</p>\n                    </div>\n                    <Switch \n                      checked={settingsMap.maintenance_mode === \"true\"}\n                      onCheckedChange={(checked) => {\n                        const value = checked ? \"true\" : \"false\";\n                        saveSetting(\"maintenance_mode\", value, \"general\", \"Sistem bakım modu durumu\");\n                      }}\n                    />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-dark-secondary border-dark-accent\">\n                <CardHeader>\n                  <CardTitle className=\"text-white\">Performans Ayarları</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"session-timeout\" className=\"text-gray-300\">Oturum Süresi (dakika)</Label>\n                      <Input\n                        id=\"session-timeout\"\n                        type=\"number\"\n                        defaultValue={settingsMap.session_timeout || \"30\"}\n                        className=\"bg-dark-primary border-gray-600 text-white\"\n                        onChange={(e) => handleSettingChange(\"session_timeout\", e.target.value)}\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"max-file-size\" className=\"text-gray-300\">Maks. Dosya Boyutu (MB)</Label>\n                      <Input\n                        id=\"max-file-size\"\n                        type=\"number\"\n                        defaultValue={settingsMap.max_file_size || \"10\"}\n                        className=\"bg-dark-primary border-gray-600 text-white\"\n                        onChange={(e) => handleSettingChange(\"max_file_size\", e.target.value)}\n                      />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* Database Settings */}\n          <TabsContent value=\"database\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Database className=\"h-5 w-5\" />\n                  Veritabanı Ayarları\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"backup-interval\" className=\"text-gray-300\">Yedekleme Aralığı (saat)</Label>\n                    <Input\n                      id=\"backup-interval\"\n                      type=\"number\"\n                      defaultValue={settingsMap.backup_interval || \"24\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"backup-retention\" className=\"text-gray-300\">Yedek Saklama (gün)</Label>\n                    <Input\n                      id=\"backup-retention\"\n                      type=\"number\"\n                      defaultValue={settingsMap.backup_retention || \"7\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-gray-300\">Otomatik Yedekleme</Label>\n                    <p className=\"text-sm text-gray-400\">Veritabanı otomatik yedekleme etkin</p>\n                  </div>\n                  <Switch defaultChecked={settingsMap.auto_backup === \"true\"} />\n                </div>\n\n                <div className=\"pt-4 border-t border-gray-600\">\n                  <Button variant=\"outline\" className=\"border-gray-600 text-gray-300\">\n                    <Database className=\"h-4 w-4 mr-2\" />\n                    Manuel Yedekleme Başlat\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Email Settings */}\n          <TabsContent value=\"email\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Mail className=\"h-5 w-5\" />\n                  Email Ayarları\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"smtp-host\" className=\"text-gray-300\">SMTP Sunucu</Label>\n                    <Input\n                      id=\"smtp-host\"\n                      defaultValue={settingsMap.smtp_host || \"\"}\n                      placeholder=\"smtp.gmail.com\"\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"smtp-port\" className=\"text-gray-300\">SMTP Port</Label>\n                    <Input\n                      id=\"smtp-port\"\n                      type=\"number\"\n                      defaultValue={settingsMap.smtp_port || \"587\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"smtp-user\" className=\"text-gray-300\">SMTP Kullanıcı</Label>\n                    <Input\n                      id=\"smtp-user\"\n                      defaultValue={settingsMap.smtp_user || \"\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"from-email\" className=\"text-gray-300\">Gönderen Email</Label>\n                    <Input\n                      id=\"from-email\"\n                      type=\"email\"\n                      defaultValue={settingsMap.from_email || \"\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-gray-300\">Email Bildirimleri</Label>\n                    <p className=\"text-sm text-gray-400\">Sistem email bildirimlerini etkinleştir</p>\n                  </div>\n                  <Switch defaultChecked={settingsMap.email_notifications === \"true\"} />\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Notifications Settings */}\n          <TabsContent value=\"notifications\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Bell className=\"h-5 w-5\" />\n                  Bildirim Ayarları\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">SMS Bildirimleri</Label>\n                      <p className=\"text-sm text-gray-400\">SMS bildirimleri gönder</p>\n                    </div>\n                    <Switch defaultChecked={settingsMap.sms_notifications === \"true\"} />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Push Bildirimleri</Label>\n                      <p className=\"text-sm text-gray-400\">Tarayıcı push bildirimleri</p>\n                    </div>\n                    <Switch defaultChecked={settingsMap.push_notifications === \"true\"} />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Admin Uyarıları</Label>\n                      <p className=\"text-sm text-gray-400\">Önemli sistem olayları için uyarı gönder</p>\n                    </div>\n                    <Switch defaultChecked={settingsMap.admin_alerts === \"true\"} />\n                  </div>\n                </div>\n\n                <div className=\"pt-4 border-t border-gray-600\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"notification-retention\" className=\"text-gray-300\">Bildirim Saklama (gün)</Label>\n                    <Input\n                      id=\"notification-retention\"\n                      type=\"number\"\n                      defaultValue={settingsMap.notification_retention || \"30\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Security Settings */}\n          <TabsContent value=\"security\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Lock className=\"h-5 w-5\" />\n                  Güvenlik Ayarları\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"password-min-length\" className=\"text-gray-300\">Min. Şifre Uzunluğu</Label>\n                    <Input\n                      id=\"password-min-length\"\n                      type=\"number\"\n                      defaultValue={settingsMap.password_min_length || \"8\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"login-attempts\" className=\"text-gray-300\">Maks. Giriş Denemesi</Label>\n                    <Input\n                      id=\"login-attempts\"\n                      type=\"number\"\n                      defaultValue={settingsMap.max_login_attempts || \"5\"}\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">İki Faktörlü Doğrulama</Label>\n                      <p className=\"text-sm text-gray-400\">Kullanıcılar için 2FA zorunlu tut</p>\n                    </div>\n                    <Switch defaultChecked={settingsMap.require_2fa === \"true\"} />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">IP Kısıtlama</Label>\n                      <p className=\"text-sm text-gray-400\">Belirli IP adreslerinden erişim sınırla</p>\n                    </div>\n                    <Switch defaultChecked={settingsMap.ip_restriction === \"true\"} />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Audit Logları</Label>\n                      <p className=\"text-sm text-gray-400\">Tüm kullanıcı aktivitelerini kaydet</p>\n                    </div>\n                    <Switch defaultChecked={settingsMap.audit_logs === \"true\"} />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":20577},"client/src/pages/admin/users.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { \n  ArrowLeft, Users, UserCheck, UserX, Mail, Calendar, Clock,\n  Shield, ShieldOff, Search, Filter, MoreVertical, Ban, \n  Key, LogOut, FileText, Eye, AlertTriangle, Crown, \n  UserCog, Building, Download, Plus, UserPlus, FileSpreadsheet, Trash2\n} from \"lucide-react\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function AdminUsers() {\n  const [, setLocation] = useLocation();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [roleFilter, setRoleFilter] = useState(\"all\");\n  const [selectedUser, setSelectedUser] = useState<any>(null);\n  const [showUserProfile, setShowUserProfile] = useState(false);\n  const [showAuditLog, setShowAuditLog] = useState(false);\n  const { toast } = useToast();\n\n  // Fetch current user to check if SUPER_ADMIN\n  const { data: currentUser } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  // Fetch all users\n  const { data: users = [], isLoading } = useQuery({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  // User has admin access if they are either SUPER_ADMIN, ADMIN, or have isAdmin flag\n  const hasAdminAccess = (currentUser as any)?.role === 'SUPER_ADMIN' || \n                        (currentUser as any)?.role === 'ADMIN' || \n                        (currentUser as any)?.isAdmin === true;\n  \n  const isSuperAdmin = (currentUser as any)?.role === 'SUPER_ADMIN';\n  \n  console.log('Current user data:', currentUser);\n  console.log('Has Admin Access:', hasAdminAccess);\n  console.log('Is Super Admin:', isSuperAdmin);\n\n  // SUPER_ADMIN: Role management\n  const updateRoleMutation = useMutation({\n    mutationFn: async ({ userId, role }: { userId: string; role: 'USER' | 'ADMIN' }) => {\n      return await apiRequest(`/api/admin/users/${userId}/role`, \"PUT\", { role });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı rolü güncellendi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Rol güncellenirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // SUPER_ADMIN: Status management (ACTIVE ⇄ SUSPENDED)\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ userId, status }: { userId: string; status: 'ACTIVE' | 'SUSPENDED' }) => {\n      return await apiRequest(`/api/admin/users/${userId}/status`, \"PUT\", { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı durumu güncellendi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Durum güncellenirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // SUPER_ADMIN: Force logout all sessions\n  const terminateSessionsMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(`/api/admin/users/${userId}/terminate-sessions`, \"POST\", {});\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcının tüm oturumları sonlandırıldı.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Oturum sonlandırma başarısız.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // SUPER_ADMIN: Send password reset\n  const sendPasswordResetMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(`/api/admin/users/${userId}/reset-password`, \"POST\", {});\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Başarılı\",\n        description: \"Parola sıfırlama bağlantısı gönderildi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Parola sıfırlama başarısız.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // SUPER_ADMIN: Delete individual user\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(`/api/admin/users/${userId}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı başarıyla silindi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Kullanıcı silinirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // SUPER_ADMIN: Create invitation\n  const createInvitationMutation = useMutation({\n    mutationFn: async ({ email, role }: { email: string; role: 'USER' | 'ADMIN' }) => {\n      return await apiRequest(`/api/admin/invitations`, \"POST\", { email, role });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Başarılı\",\n        description: \"Davet bağlantısı oluşturuldu ve gönderildi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Davet oluşturma başarısız.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Toggle user active status\n  const toggleActiveMutation = useMutation({\n    mutationFn: async ({ userId, isActive }: { userId: string; isActive: boolean }) => {\n      return await apiRequest(`/api/admin/users/${userId}/active`, \"PUT\", { isActive });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı durumu güncellendi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Kullanıcı durumu güncellenirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"text-center\">\n              <Users className=\"h-12 w-12 text-purple-400 mx-auto mb-4 animate-spin\" />\n              <p className=\"text-gray-400\">Kullanıcılar yükleniyor...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Enhanced filtering with role and status\n  const filteredUsers = (users as any[])?.filter((user: any) => {\n    const matchesSearch = user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      user.firstName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      user.lastName?.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = statusFilter === \"all\" || \n      (statusFilter === \"active\" && user.status !== 'SUSPENDED') ||\n      (statusFilter === \"suspended\" && user.status === 'SUSPENDED');\n    \n    const matchesRole = roleFilter === \"all\" ||\n      (roleFilter === \"admin\" && (user.role === 'ADMIN' || user.role === 'SUPER_ADMIN')) ||\n      (roleFilter === \"user\" && user.role === 'USER');\n    \n    return matchesSearch && matchesStatus && matchesRole;\n  }) || [];\n\n  const stats = {\n    total: (users as any[])?.length || 0,\n    active: (users as any[])?.filter((u: any) => u.status !== 'SUSPENDED').length || 0,\n    suspended: (users as any[])?.filter((u: any) => u.status === 'SUSPENDED').length || 0,\n    admins: (users as any[])?.filter((u: any) => u.role === 'ADMIN' || u.role === 'SUPER_ADMIN').length || 0,\n    users: (users as any[])?.filter((u: any) => u.role === 'USER').length || 0,\n  };\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Enhanced Header for SUPER_ADMIN */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-gray-400 hover:text-white\"\n              onClick={() => setLocation(\"/admin\")}\n            >\n              <ArrowLeft className=\"h-6 w-6\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <Users className=\"h-8 w-8 text-blue-400\" />\n              <div>\n                <div className=\"flex items-center gap-3\">\n                  <h1 className=\"text-2xl font-bold text-white\">Kullanıcı Yönetimi</h1>\n                  {isSuperAdmin && (\n                    <Badge className=\"bg-gradient-to-r from-purple-600 to-pink-600 text-white\">\n                      <Crown className=\"h-3 w-3 mr-1\" />\n                      SUPER ADMIN\n                    </Badge>\n                  )}\n                </div>\n                <p className=\"text-gray-400\">\n                  {isSuperAdmin ? 'Tam sistem kontrolü ve kullanıcı yönetimi' : 'Kullanıcıları görüntüle ve yönet'}\n                </p>\n              </div>\n            </div>\n          </div>\n          \n          {hasAdminAccess && (\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"border-green-600 text-green-400 hover:bg-green-600/10\"\n                onClick={() => {\n                  try {\n                    const userList = Array.isArray(users) ? users : [];\n                    if (userList.length === 0) {\n                      toast({\n                        title: \"Hata\",\n                        description: \"Dışa aktarılacak kullanıcı bulunamadı.\",\n                        variant: \"destructive\",\n                      });\n                      return;\n                    }\n\n                    const exportData = userList.map((u: any) => ({\n                      Email: u.email || '',\n                      \"Ad Soyad\": `${u.firstName || ''} ${u.lastName || ''}`.trim() || '',\n                      Rol: u.role === 'SUPER_ADMIN' ? 'Süper Admin' : u.role === 'ADMIN' ? 'Admin' : 'Kullanıcı',\n                      Durum: u.status === 'SUSPENDED' ? 'Askıya Alındı' : 'Aktif',\n                      \"Kayıt Tarihi\": u.createdAt ? new Date(u.createdAt).toLocaleDateString('tr-TR') : '',\n                      \"Son Güncelleme\": u.updatedAt ? new Date(u.updatedAt).toLocaleDateString('tr-TR') : ''\n                    }));\n\n                    // CSV Export\n                    const headers = Object.keys(exportData[0]);\n                    const csvContent = [\n                      headers.join(','),\n                      ...exportData.map(row => \n                        Object.values(row).map(value => {\n                          const str = String(value || '');\n                          return str.includes(',') ? `\"${str}\"` : str;\n                        }).join(',')\n                      )\n                    ].join('\\n');\n\n                    const blob = new Blob(['\\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });\n                    const link = document.createElement('a');\n                    const url = URL.createObjectURL(blob);\n                    link.setAttribute('href', url);\n                    link.setAttribute('download', `kullanicilar_${new Date().toISOString().split('T')[0]}.csv`);\n                    link.style.visibility = 'hidden';\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n                    URL.revokeObjectURL(url);\n\n                    toast({\n                      title: \"Başarılı\",\n                      description: `${userList.length} kullanıcı Excel formatında dışa aktarıldı.`,\n                    });\n                  } catch (error) {\n                    console.error('Export error:', error);\n                    toast({\n                      title: \"Hata\",\n                      description: \"Dışa aktarma sırasında hata oluştu.\",\n                      variant: \"destructive\",\n                    });\n                  }\n                }}\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Dışa Aktar\n              </Button>\n              {isSuperAdmin && (\n                <Button\n                  className=\"bg-purple-600 hover:bg-purple-700\"\n                  size=\"sm\"\n                  onClick={() => {\n                    const email = prompt(\"Davet gönderilecek e-posta adresini girin:\");\n                    if (email) {\n                      createInvitationMutation.mutate({ email, role: 'USER' });\n                    }\n                  }}\n                >\n                  <UserPlus className=\"h-4 w-4 mr-2\" />\n                  Davet Gönder\n                </Button>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Toplam Kullanıcı</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.total}</p>\n                </div>\n                <Users className=\"h-8 w-8 text-blue-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Aktif</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.active}</p>\n                </div>\n                <UserCheck className=\"h-8 w-8 text-green-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Admin</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.admins}</p>\n                </div>\n                <Shield className=\"h-8 w-8 text-purple-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Askıya Alınmış</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.suspended}</p>\n                </div>\n                <Ban className=\"h-8 w-8 text-red-400\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Enhanced Search and Filters for SUPER_ADMIN */}\n        <Card className=\"bg-dark-secondary border-dark-accent mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex flex-col lg:flex-row items-start lg:items-center gap-4\">\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Email, isim veya soyisimle ara...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10 bg-dark-primary border-gray-600 text-white\"\n                />\n              </div>\n              \n              {hasAdminAccess && (\n                <div className=\"flex items-center gap-3\">\n                  <select\n                    value={statusFilter}\n                    onChange={(e) => setStatusFilter(e.target.value)}\n                    className=\"px-3 py-2 bg-dark-primary border border-gray-600 text-white rounded-md text-sm\"\n                  >\n                    <option value=\"all\">Tüm Durumlar</option>\n                    <option value=\"active\">Aktif</option>\n                    <option value=\"suspended\">Askıya Alınmış</option>\n                  </select>\n                  \n                  <select\n                    value={roleFilter}\n                    onChange={(e) => setRoleFilter(e.target.value)}\n                    className=\"px-3 py-2 bg-dark-primary border border-gray-600 text-white rounded-md text-sm\"\n                  >\n                    <option value=\"all\">Tüm Roller</option>\n                    <option value=\"user\">Kullanıcı</option>\n                    <option value=\"admin\">Admin</option>\n                  </select>\n                  \n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\"\n                    className=\"border-gray-600 text-gray-300\"\n                    onClick={() => {\n                      setSearchTerm(\"\");\n                      setStatusFilter(\"all\");\n                      setRoleFilter(\"all\");\n                    }}\n                  >\n                    Temizle\n                  </Button>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Users Dropdown Selector */}\n        <Card className=\"bg-dark-secondary border-dark-accent\">\n          <CardHeader>\n            <CardTitle className=\"text-white\">Kullanıcı Seçimi ({filteredUsers.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {/* User Dropdown */}\n              <div className=\"w-full\">\n                <select\n                  value={selectedUser?.id || \"\"}\n                  onChange={(e) => {\n                    const user = filteredUsers.find((u: any) => u.id === e.target.value);\n                    setSelectedUser(user || null);\n                  }}\n                  className=\"w-full px-3 py-2 bg-dark-primary border border-gray-600 text-white rounded-md\"\n                >\n                  <option value=\"\">Kullanıcı Seçin...</option>\n                  {(filteredUsers as any[]).map((user: any) => (\n                    <option key={user.id} value={user.id}>\n                      {user.firstName && user.lastName \n                        ? `${user.firstName} ${user.lastName} (${user.email})` \n                        : user.email\n                      } - {user.role === 'SUPER_ADMIN' ? 'SUPER ADMIN' : user.role === 'ADMIN' ? 'Admin' : 'Kullanıcı'}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Selected User Info */}\n              {selectedUser && (\n                <Card className=\"bg-dark-accent border-gray-600\">\n                  <CardContent className=\"pt-6\">\n                    <div className=\"flex items-center gap-4 mb-4\">\n                      <div className=\"w-16 h-16 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center text-white font-bold text-xl\">\n                        {selectedUser.firstName?.[0] || selectedUser.email[0].toUpperCase()}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-xl font-bold text-white\">\n                          {selectedUser.firstName && selectedUser.lastName \n                            ? `${selectedUser.firstName} ${selectedUser.lastName}` \n                            : selectedUser.email\n                          }\n                        </h3>\n                        <p className=\"text-gray-400\">{selectedUser.email}</p>\n                        <p className=\"text-gray-500 text-sm\">ID: {selectedUser.id.slice(0, 12)}...</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge \n                          variant=\"outline\" \n                          className={\n                            selectedUser.status === 'SUSPENDED'\n                              ? \"text-red-400 border-red-400\" \n                              : \"text-green-400 border-green-400\"\n                          }\n                        >\n                          {selectedUser.status === 'SUSPENDED' ? \"Askıya Alınmış\" : \"Aktif\"}\n                        </Badge>\n                        <br />\n                        <Badge \n                          variant=\"outline\" \n                          className={\n                            selectedUser.role === 'SUPER_ADMIN' \n                              ? \"text-pink-400 border-pink-400 bg-pink-400/10 mt-2\" :\n                            selectedUser.role === 'ADMIN'\n                              ? \"text-purple-400 border-purple-400 mt-2\" \n                              : \"text-gray-400 border-gray-400 mt-2\"\n                          }\n                        >\n                          {selectedUser.role === 'SUPER_ADMIN' && <Crown className=\"h-3 w-3 mr-1\" />}\n                          {selectedUser.role === 'SUPER_ADMIN' ? 'SUPER ADMIN' : \n                           selectedUser.role === 'ADMIN' ? 'Admin' : 'Kullanıcı'}\n                        </Badge>\n                      </div>\n                    </div>\n\n                    {/* User Info Grid */}\n                    <div className=\"grid grid-cols-2 gap-4 mb-4 text-sm\">\n                      <div>\n                        <p className=\"text-gray-400\">Kayıt Tarihi</p>\n                        <p className=\"text-white\">{new Date(selectedUser.createdAt).toLocaleDateString('tr-TR')}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-gray-400\">Son Güncelleme</p>\n                        <p className=\"text-white\">{new Date(selectedUser.updatedAt).toLocaleDateString('tr-TR')}</p>\n                      </div>\n                    </div>\n\n                    {/* Quick Actions */}\n                    {hasAdminAccess && (\n                      <div className=\"flex flex-wrap gap-3 pt-4 border-t border-gray-600\">\n                        {/* Engelle/Aktif Et */}\n                        <Button\n                          size=\"sm\"\n                          variant={selectedUser.status === 'SUSPENDED' ? \"outline\" : \"destructive\"}\n                          className={\n                            selectedUser.status === 'SUSPENDED'\n                              ? \"border-green-600 text-green-400 hover:bg-green-600/10\"\n                              : \"bg-red-600 hover:bg-red-700\"\n                          }\n                          onClick={async () => {\n                            try {\n                              await updateStatusMutation.mutateAsync({\n                                userId: selectedUser.id,\n                                status: selectedUser.status === 'SUSPENDED' ? 'ACTIVE' : 'SUSPENDED'\n                              });\n                              toast({\n                                title: \"Başarılı\",\n                                description: selectedUser.status === 'SUSPENDED' \n                                  ? \"Kullanıcı aktif edildi\" \n                                  : \"Kullanıcı engellendi\",\n                              });\n                            } catch (error) {\n                              toast({\n                                title: \"Hata\",\n                                description: \"İşlem başarısız oldu\",\n                                variant: \"destructive\"\n                              });\n                            }\n                          }}\n                          disabled={updateStatusMutation.isPending}\n                        >\n                          {updateStatusMutation.isPending ? (\n                            <>\n                              <div className=\"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n                              İşleniyor...\n                            </>\n                          ) : selectedUser.status === 'SUSPENDED' ? (\n                            <>\n                              <UserCheck className=\"h-4 w-4 mr-2\" />\n                              Aktif Et\n                            </>\n                          ) : (\n                            <>\n                              <Ban className=\"h-4 w-4 mr-2\" />\n                              Engelle\n                            </>\n                          )}\n                        </Button>\n\n                        {/* Askıya Al - Separate action */}\n                        {selectedUser.status !== 'SUSPENDED' && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            className=\"border-yellow-600 text-yellow-400 hover:bg-yellow-600/10\"\n                            onClick={async () => {\n                              const confirmed = confirm(\"Bu kullanıcıyı askıya almak istediğinizden emin misiniz?\");\n                              if (confirmed) {\n                                try {\n                                  await updateStatusMutation.mutateAsync({\n                                    userId: selectedUser.id,\n                                    status: 'SUSPENDED'\n                                  });\n                                  toast({\n                                    title: \"Başarılı\",\n                                    description: \"Kullanıcı askıya alındı\",\n                                  });\n                                } catch (error) {\n                                  toast({\n                                    title: \"Hata\",\n                                    description: \"Askıya alma işlemi başarısız oldu\",\n                                    variant: \"destructive\"\n                                  });\n                                }\n                              }\n                            }}\n                            disabled={updateStatusMutation.isPending}\n                          >\n                            {updateStatusMutation.isPending ? (\n                              <>\n                                <div className=\"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-yellow-400 border-t-transparent\" />\n                                İşleniyor...\n                              </>\n                            ) : (\n                              <>\n                                <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                                Askıya Al\n                              </>\n                            )}\n                          </Button>\n                        )}\n\n                        {/* Role Toggle */}\n                        {isSuperAdmin && selectedUser.role !== 'SUPER_ADMIN' && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            className=\"border-purple-600 text-purple-400 hover:bg-purple-600/10\"\n                            onClick={() => updateRoleMutation.mutate({\n                              userId: selectedUser.id,\n                              role: selectedUser.role === 'ADMIN' ? 'USER' : 'ADMIN'\n                            })}\n                            disabled={updateRoleMutation.isPending}\n                          >\n                            <Shield className=\"h-4 w-4 mr-2\" />\n                            {selectedUser.role === 'ADMIN' ? 'Admin Kaldır' : 'Admin Yap'}\n                          </Button>\n                        )}\n\n                        {/* Oturumları Sonlandır */}\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"border-orange-600 text-orange-400 hover:bg-orange-600/10\"\n                          onClick={async () => {\n                            const confirmed = confirm(\"Bu kullanıcının tüm oturumlarını sonlandırmak istediğinizden emin misiniz?\");\n                            if (confirmed) {\n                              try {\n                                await terminateSessionsMutation.mutateAsync(selectedUser.id);\n                                toast({\n                                  title: \"Başarılı\",\n                                  description: \"Kullanıcının tüm oturumları sonlandırıldı\",\n                                });\n                              } catch (error) {\n                                toast({\n                                  title: \"Hata\",\n                                  description: \"Oturum sonlandırma işlemi başarısız oldu\",\n                                  variant: \"destructive\"\n                                });\n                              }\n                            }\n                          }}\n                          disabled={terminateSessionsMutation.isPending}\n                        >\n                          {terminateSessionsMutation.isPending ? (\n                            <>\n                              <div className=\"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-orange-400 border-t-transparent\" />\n                              Sonlandırılıyor...\n                            </>\n                          ) : (\n                            <>\n                              <LogOut className=\"h-4 w-4 mr-2\" />\n                              Oturumları Sonlandır\n                            </>\n                          )}\n                        </Button>\n\n                        {/* View Profile */}\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"border-blue-600 text-blue-400 hover:bg-blue-600/10\"\n                          onClick={() => setShowUserProfile(true)}\n                        >\n                          <Eye className=\"h-4 w-4 mr-2\" />\n                          Profil Detayları\n                        </Button>\n\n                        {/* Activity History */}\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"border-cyan-600 text-cyan-400 hover:bg-cyan-600/10\"\n                          onClick={() => setShowAuditLog(true)}\n                        >\n                          <FileText className=\"h-4 w-4 mr-2\" />\n                          Aktivite Geçmişi\n                        </Button>\n\n                        {/* Add Admin Note */}\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"border-yellow-600 text-yellow-400 hover:bg-yellow-600/10\"\n                          onClick={async () => {\n                            const note = prompt(\"Admin notu ekleyin:\");\n                            if (note && note.trim()) {\n                              try {\n                                await apiRequest(`/api/admin/users/${selectedUser.id}/notes`, \"POST\", { note: note.trim(), category: \"general\" });\n                                toast({\n                                  title: \"Başarılı\",\n                                  description: \"Admin notu başarıyla kaydedildi.\",\n                                });\n                              } catch (error) {\n                                toast({\n                                  title: \"Hata\",\n                                  description: \"Admin notu kaydedilemedi.\",\n                                  variant: \"destructive\"\n                                });\n                              }\n                            }\n                          }}\n                        >\n                          <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                          Admin Notu Ekle\n                        </Button>\n\n                        {/* Delete User - Only for SUPER_ADMIN and not self */}\n                        {isSuperAdmin && selectedUser.role !== 'SUPER_ADMIN' && selectedUser.id !== currentUser?.id && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"destructive\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white\"\n                            onClick={async () => {\n                              const confirmed = confirm(`Bu kullanıcıyı kalıcı olarak silmek istediğinizden emin misiniz?\\n\\nKullanıcı: ${selectedUser.email}\\n\\nBu işlem GERİ ALINAMAZ!`);\n                              if (confirmed) {\n                                try {\n                                  await deleteUserMutation.mutateAsync(selectedUser.id);\n                                  setSelectedUser(null); // Clear selection after delete\n                                  toast({\n                                    title: \"Başarılı\",\n                                    description: \"Kullanıcı kalıcı olarak silindi.\",\n                                  });\n                                } catch (error) {\n                                  toast({\n                                    title: \"Hata\",\n                                    description: \"Kullanıcı silinirken hata oluştu.\",\n                                    variant: \"destructive\"\n                                  });\n                                }\n                              }\n                            }}\n                            disabled={deleteUserMutation.isPending}\n                          >\n                            {deleteUserMutation.isPending ? (\n                              <>\n                                <div className=\"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n                                Siliniyor...\n                              </>\n                            ) : (\n                              <>\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\n                                Kullanıcıyı Sil\n                              </>\n                            )}\n                          </Button>\n                        )}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* User Profile Dialog - Compact */}\n      <Dialog open={showUserProfile} onOpenChange={setShowUserProfile}>\n        <DialogContent className=\"bg-dark-secondary border-gray-600 max-w-lg\">\n          <DialogHeader>\n            <DialogTitle className=\"text-white flex items-center gap-2\">\n              <Eye className=\"h-4 w-4\" />\n              Kullanıcı Profili\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedUser && (\n            <div className=\"space-y-4\">\n              {/* Compact User Header */}\n              <div className=\"flex items-center gap-3 p-3 bg-dark-accent rounded-lg\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center\">\n                  <span className=\"text-white text-sm font-bold\">\n                    {selectedUser.firstName?.[0] || selectedUser.email[0].toUpperCase()}\n                  </span>\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-lg font-bold text-white\">\n                    {selectedUser.firstName} {selectedUser.lastName || selectedUser.email}\n                  </h3>\n                  <p className=\"text-gray-400 text-sm\">{selectedUser.email}</p>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Badge \n                      className={\n                        selectedUser.role === 'SUPER_ADMIN' ? \"bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xs\" :\n                        selectedUser.role === 'ADMIN' ? \"bg-blue-600 text-white text-xs\" : \n                        \"bg-gray-600 text-white text-xs\"\n                      }\n                    >\n                      {selectedUser.role === 'SUPER_ADMIN' && <Crown className=\"h-3 w-3 mr-1\" />}\n                      {selectedUser.role === 'SUPER_ADMIN' ? 'SUPER ADMIN' : \n                       selectedUser.role === 'ADMIN' ? 'Admin' : 'Kullanıcı'}\n                    </Badge>\n                    <Badge className={selectedUser.status === 'SUSPENDED' ? \"bg-red-600 text-xs\" : \"bg-green-600 text-xs\"}>\n                      {selectedUser.status === 'SUSPENDED' ? 'Engellenmiş' : 'Aktif'}\n                    </Badge>\n                  </div>\n                </div>\n              </div>\n\n              {/* Compact Info Grid */}\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div className=\"bg-dark-accent p-3 rounded\">\n                  <p className=\"text-gray-400 text-xs mb-1\">Kayıt Tarihi</p>\n                  <p className=\"text-white\">\n                    {new Date(selectedUser.createdAt).toLocaleDateString('tr-TR')}\n                  </p>\n                </div>\n                <div className=\"bg-dark-accent p-3 rounded\">\n                  <p className=\"text-gray-400 text-xs mb-1\">Son Güncelleme</p>\n                  <p className=\"text-white\">\n                    {selectedUser.updatedAt \n                      ? new Date(selectedUser.updatedAt).toLocaleDateString('tr-TR')\n                      : 'Bilinmiyor'\n                    }\n                  </p>\n                </div>\n              </div>\n\n              {/* Compact Activity */}\n              <div className=\"bg-dark-accent p-3 rounded\">\n                <h4 className=\"text-white text-sm font-medium mb-2 flex items-center gap-2\">\n                  <Clock className=\"h-3 w-3\" />\n                  Aktivite Özeti\n                </h4>\n                <div className=\"grid grid-cols-3 gap-2 text-center text-xs\">\n                  <div>\n                    <p className=\"text-lg font-bold text-purple-400\">0</p>\n                    <p className=\"text-gray-400\">Oturum</p>\n                  </div>\n                  <div>\n                    <p className=\"text-lg font-bold text-blue-400\">0</p>\n                    <p className=\"text-gray-400\">İşlem</p>\n                  </div>\n                  <div>\n                    <p className=\"text-lg font-bold text-green-400\">0</p>\n                    <p className=\"text-gray-400\">Giriş</p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Compact Admin Actions */}\n              {hasAdminAccess && (\n                <div className=\"space-y-3 pt-3 border-t border-gray-600\">\n                  {/* Primary Actions Row */}\n                  <div className=\"flex justify-center gap-2\">\n                    <Button\n                      variant={selectedUser.status === 'SUSPENDED' ? \"outline\" : \"destructive\"}\n                      size=\"sm\"\n                      className={\n                        selectedUser.status === 'SUSPENDED'\n                          ? \"border-green-600 text-green-400 hover:bg-green-600/10 text-xs px-2\"\n                          : \"bg-red-600 hover:bg-red-700 text-xs px-2\"\n                      }\n                      onClick={async () => {\n                        const action = selectedUser.status === 'SUSPENDED' ? 'aktif et' : 'engelle';\n                        const confirmed = confirm(`Bu kullanıcıyı ${action}mek istediğinizden emin misiniz?`);\n                        if (confirmed) {\n                          try {\n                            await updateStatusMutation.mutateAsync({\n                              userId: selectedUser.id,\n                              status: selectedUser.status === 'SUSPENDED' ? 'ACTIVE' : 'SUSPENDED'\n                            });\n                            toast({\n                              title: \"Başarılı\",\n                              description: selectedUser.status === 'SUSPENDED' \n                                ? \"Kullanıcı aktif edildi\" \n                                : \"Kullanıcı engellendi\",\n                            });\n                            setShowUserProfile(false);\n                          } catch (error) {\n                            toast({\n                              title: \"Hata\",\n                              description: \"İşlem başarısız oldu\",\n                              variant: \"destructive\"\n                            });\n                          }\n                        }\n                      }}\n                      disabled={updateStatusMutation.isPending}\n                    >\n                      {updateStatusMutation.isPending ? (\n                        <div className=\"h-3 w-3 mr-1 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n                      ) : selectedUser.status === 'SUSPENDED' ? (\n                        <UserCheck className=\"h-3 w-3 mr-1\" />\n                      ) : (\n                        <Ban className=\"h-3 w-3 mr-1\" />\n                      )}\n                      {selectedUser.status === 'SUSPENDED' ? 'Aktif Et' : 'Engelle'}\n                    </Button>\n\n                    {/* Askıya Al - Only show if user is active */}\n                    {selectedUser.status !== 'SUSPENDED' && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"border-yellow-600 text-yellow-400 hover:bg-yellow-600/10 text-xs px-2\"\n                        onClick={async () => {\n                          const confirmed = confirm(\"Bu kullanıcıyı askıya almak istediğinizden emin misiniz?\");\n                          if (confirmed) {\n                            try {\n                              await updateStatusMutation.mutateAsync({\n                                userId: selectedUser.id,\n                                status: 'SUSPENDED'\n                              });\n                              toast({\n                                title: \"Başarılı\",\n                                description: \"Kullanıcı askıya alındı\",\n                              });\n                              setShowUserProfile(false);\n                            } catch (error) {\n                              toast({\n                                title: \"Hata\",\n                                description: \"Askıya alma işlemi başarısız oldu\",\n                                variant: \"destructive\"\n                              });\n                            }\n                          }\n                        }}\n                        disabled={updateStatusMutation.isPending}\n                      >\n                        {updateStatusMutation.isPending ? (\n                          <div className=\"h-3 w-3 mr-1 animate-spin rounded-full border-2 border-yellow-400 border-t-transparent\" />\n                        ) : (\n                          <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                        )}\n                        Askıya Al\n                      </Button>\n                    )}\n\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-orange-600 text-orange-400 hover:bg-orange-600/10 text-xs px-2\"\n                      onClick={async () => {\n                        const confirmed = confirm(\"Bu kullanıcının tüm oturumlarını sonlandırmak istediğinizden emin misiniz?\");\n                        if (confirmed) {\n                          try {\n                            await terminateSessionsMutation.mutateAsync(selectedUser.id);\n                            toast({\n                              title: \"Başarılı\",\n                              description: \"Kullanıcının tüm oturumları sonlandırıldı\",\n                            });\n                            setShowUserProfile(false);\n                          } catch (error) {\n                            toast({\n                              title: \"Hata\",\n                              description: \"Oturum sonlandırma işlemi başarısız oldu\",\n                              variant: \"destructive\"\n                            });\n                          }\n                        }\n                      }}\n                      disabled={terminateSessionsMutation.isPending}\n                    >\n                      {terminateSessionsMutation.isPending ? (\n                        <div className=\"h-3 w-3 mr-1 animate-spin rounded-full border-2 border-orange-400 border-t-transparent\" />\n                      ) : (\n                        <LogOut className=\"h-3 w-3 mr-1\" />\n                      )}\n                      Oturumları Sonlandır\n                    </Button>\n                  </div>\n\n                  {/* Secondary Actions Row */}\n                  <div className=\"flex justify-center gap-2\">\n                    <Button\n                      variant=\"outline\" \n                      size=\"sm\"\n                      className=\"border-gray-600 text-gray-300 hover:bg-gray-600 text-xs px-2\"\n                      onClick={() => {\n                        setShowUserProfile(false);\n                        setShowAuditLog(true);\n                      }}\n                    >\n                      <FileText className=\"h-3 w-3 mr-1\" />\n                      Geçmiş\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-cyan-600 text-cyan-400 hover:bg-cyan-600/10 text-xs px-2\"\n                      onClick={async () => {\n                        const note = prompt(\"Admin notu ekleyin:\");\n                        if (note && note.trim()) {\n                          try {\n                            await apiRequest(`/api/admin/users/${selectedUser.id}/notes`, \"POST\", { note: note.trim(), category: \"general\" });\n                            setShowUserProfile(false);\n                            toast({\n                              title: \"Başarılı\",\n                              description: \"Admin notu başarıyla kaydedildi.\",\n                            });\n                          } catch (error) {\n                            toast({\n                              title: \"Hata\",\n                              description: \"Admin notu kaydedilemedi.\",\n                              variant: \"destructive\"\n                            });\n                          }\n                        }\n                      }}\n                    >\n                      <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                      Not Ekle\n                    </Button>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Audit Log Dialog */}\n      <Dialog open={showAuditLog} onOpenChange={setShowAuditLog}>\n        <DialogContent className=\"bg-dark-secondary border-gray-600 max-w-3xl max-h-[80vh]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-white flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              Aktivite Geçmişi - {selectedUser?.email}\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedUser && (\n            <div className=\"space-y-4\">\n              {/* User Info Header */}\n              <div className=\"flex items-center gap-3 p-3 bg-dark-accent rounded-lg\">\n                <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center\">\n                  <span className=\"text-white text-sm font-bold\">\n                    {selectedUser.firstName?.[0] || selectedUser.email[0].toUpperCase()}\n                  </span>\n                </div>\n                <div>\n                  <h3 className=\"text-white font-medium\">\n                    {selectedUser.firstName} {selectedUser.lastName || selectedUser.email}\n                  </h3>\n                  <p className=\"text-gray-400 text-sm\">{selectedUser.email}</p>\n                </div>\n              </div>\n\n              {/* Activity Log */}\n              <div className=\"max-h-96 overflow-y-auto\">\n                <div className=\"space-y-3\">\n                  {/* Sample audit entries - in real app would come from API */}\n                  <div className=\"border-l-4 border-blue-500 pl-4 py-2 bg-dark-accent/50 rounded-r\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <p className=\"text-white font-medium\">Oturum Açma</p>\n                        <p className=\"text-gray-400 text-sm\">Kullanıcı sisteme giriş yaptı</p>\n                      </div>\n                      <span className=\"text-gray-500 text-xs\">\n                        {new Date().toLocaleDateString('tr-TR')} 11:40\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"border-l-4 border-green-500 pl-4 py-2 bg-dark-accent/50 rounded-r\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <p className=\"text-white font-medium\">Profil Güncelleme</p>\n                        <p className=\"text-gray-400 text-sm\">Kullanıcı bilgileri güncellendi</p>\n                      </div>\n                      <span className=\"text-gray-500 text-xs\">\n                        {new Date(Date.now() - 3600000).toLocaleDateString('tr-TR')} 10:15\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"border-l-4 border-purple-500 pl-4 py-2 bg-dark-accent/50 rounded-r\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <p className=\"text-white font-medium\">Veri İşlemi</p>\n                        <p className=\"text-gray-400 text-sm\">Yeni kayıt oluşturuldu</p>\n                      </div>\n                      <span className=\"text-gray-500 text-xs\">\n                        {new Date(Date.now() - 7200000).toLocaleDateString('tr-TR')} 09:30\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"border-l-4 border-yellow-500 pl-4 py-2 bg-dark-accent/50 rounded-r\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <p className=\"text-white font-medium\">Ayar Değişikliği</p>\n                        <p className=\"text-gray-400 text-sm\">Kullanıcı tercihlerini değiştirdi</p>\n                      </div>\n                      <span className=\"text-gray-500 text-xs\">\n                        {new Date(Date.now() - 86400000).toLocaleDateString('tr-TR')} 14:20\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"border-l-4 border-red-500 pl-4 py-2 bg-dark-accent/50 rounded-r\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <p className=\"text-white font-medium\">Başarısız Giriş</p>\n                        <p className=\"text-gray-400 text-sm\">Yanlış şifre ile giriş denemesi</p>\n                      </div>\n                      <span className=\"text-gray-500 text-xs\">\n                        {new Date(Date.now() - 172800000).toLocaleDateString('tr-TR')} 08:45\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"border-l-4 border-blue-500 pl-4 py-2 bg-dark-accent/50 rounded-r\">\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <p className=\"text-white font-medium\">Hesap Oluşturma</p>\n                        <p className=\"text-gray-400 text-sm\">Kullanıcı hesabı sisteme eklendi</p>\n                      </div>\n                      <span className=\"text-gray-500 text-xs\">\n                        {new Date(selectedUser.createdAt).toLocaleDateString('tr-TR')} 16:00\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Stats Summary */}\n              <div className=\"grid grid-cols-4 gap-3 p-3 bg-dark-accent rounded-lg\">\n                <div className=\"text-center\">\n                  <p className=\"text-lg font-bold text-blue-400\">24</p>\n                  <p className=\"text-gray-400 text-xs\">Toplam Giriş</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-lg font-bold text-green-400\">18</p>\n                  <p className=\"text-gray-400 text-xs\">Başarılı İşlem</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-lg font-bold text-yellow-400\">3</p>\n                  <p className=\"text-gray-400 text-xs\">Ayar Değişikliği</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-lg font-bold text-red-400\">1</p>\n                  <p className=\"text-gray-400 text-xs\">Başarısız Deneme</p>\n                </div>\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex justify-end gap-2 pt-2 border-t border-gray-600\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"border-gray-600 text-gray-300 hover:bg-gray-600\"\n                  onClick={() => {\n                    console.log(`Exporting audit log for user: ${selectedUser.id}`);\n                    toast({\n                      title: \"Başarılı\",\n                      description: \"Aktivite geçmişi dışa aktarıldı.\",\n                    });\n                  }}\n                >\n                  <Download className=\"h-3 w-3 mr-1\" />\n                  Dışa Aktar\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"border-blue-600 text-blue-400 hover:bg-blue-600/10\"\n                  onClick={() => setShowAuditLog(false)}\n                >\n                  Kapat\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":55664},"client/src/pages/admin/sessions.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { \n  ArrowLeft, Users, Clock, Monitor, Globe, \n  Search, RefreshCw, X, AlertTriangle\n} from \"lucide-react\";\nimport Header from \"@/components/layout/header\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface SessionData {\n  id: string;\n  userId: string;\n  userEmail: string;\n  ipAddress: string;\n  userAgent: string;\n  lastActivity: string;\n  createdAt: string;\n  isActive: boolean;\n  location?: string;\n}\n\nexport default function AdminSessions() {\n  const [, setLocation] = useLocation();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterStatus, setFilterStatus] = useState<\"all\" | \"active\" | \"inactive\">(\"all\");\n\n  const { data: sessions, isLoading } = useQuery<SessionData[]>({\n    queryKey: [\"/api/admin/sessions\"],\n  });\n\n  const filteredSessions = sessions?.filter((session) => {\n    const matchesSearch = \n      session.userEmail.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      session.ipAddress.includes(searchTerm) ||\n      session.id.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = \n      filterStatus === \"all\" || \n      (filterStatus === \"active\" && session.isActive) ||\n      (filterStatus === \"inactive\" && !session.isActive);\n    \n    return matchesSearch && matchesStatus;\n  }) || [];\n\n  const handleRefresh = () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/admin/sessions\"] });\n  };\n\n  const handleTerminateSession = async (sessionId: string) => {\n    if (!confirm(\"Bu oturumu sonlandırmak istediğinizden emin misiniz?\")) return;\n    \n    try {\n      const response = await fetch(`/api/admin/sessions/${sessionId}/terminate`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' }\n      });\n      \n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: [\"/api/admin/sessions\"] });\n      }\n    } catch (error) {\n      console.error(\"Oturum sonlandırma hatası:\", error);\n    }\n  };\n\n  const getDeviceIcon = (userAgent: string) => {\n    if (userAgent.includes(\"Mobile\") || userAgent.includes(\"Android\") || userAgent.includes(\"iPhone\")) {\n      return \"📱\";\n    } else if (userAgent.includes(\"Tablet\") || userAgent.includes(\"iPad\")) {\n      return \"📱\";\n    } else {\n      return \"💻\";\n    }\n  };\n\n  const getBrowserName = (userAgent: string) => {\n    if (userAgent.includes(\"Chrome\")) return \"Chrome\";\n    if (userAgent.includes(\"Firefox\")) return \"Firefox\";\n    if (userAgent.includes(\"Safari\")) return \"Safari\";\n    if (userAgent.includes(\"Edge\")) return \"Edge\";\n    return \"Bilinmeyen\";\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"text-center\">\n              <Users className=\"h-12 w-12 text-purple-400 mx-auto mb-4 animate-spin\" />\n              <p className=\"text-gray-400\">Oturumlar yükleniyor...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const stats = {\n    total: sessions?.length || 0,\n    active: sessions?.filter(s => s.isActive).length || 0,\n    inactive: sessions?.filter(s => !s.isActive).length || 0,\n    uniqueUsers: new Set(sessions?.map(s => s.userId)).size || 0,\n  };\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-gray-400 hover:text-white\"\n              onClick={() => setLocation(\"/admin\")}\n            >\n              <ArrowLeft className=\"h-6 w-6\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <Users className=\"h-8 w-8 text-blue-400\" />\n              <div>\n                <h1 className=\"text-2xl font-bold text-white\">Oturumlar</h1>\n                <p className=\"text-gray-400\">Aktif kullanıcı oturumlarını yönet</p>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"border-gray-600 text-gray-300\"\n              onClick={handleRefresh}\n            >\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Yenile\n            </Button>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Toplam Oturum</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.total}</p>\n                </div>\n                <Users className=\"h-8 w-8 text-blue-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Aktif Oturumlar</p>\n                  <p className=\"text-2xl font-bold text-green-400\">{stats.active}</p>\n                </div>\n                <Clock className=\"h-8 w-8 text-green-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Pasif Oturumlar</p>\n                  <p className=\"text-2xl font-bold text-orange-400\">{stats.inactive}</p>\n                </div>\n                <Monitor className=\"h-8 w-8 text-orange-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Benzersiz Kullanıcı</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.uniqueUsers}</p>\n                </div>\n                <Globe className=\"h-8 w-8 text-purple-400\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Filters */}\n        <div className=\"flex flex-col md:flex-row gap-4 mb-6\">\n          <div className=\"flex-1\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n              <Input\n                placeholder=\"Email, IP veya oturum ID ile ara...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 bg-dark-secondary border-dark-accent text-white\"\n              />\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              variant={filterStatus === \"all\" ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setFilterStatus(\"all\")}\n              className={filterStatus === \"all\" ? \"bg-purple-600 hover:bg-purple-700\" : \"border-gray-600 text-gray-300\"}\n            >\n              Tümü\n            </Button>\n            <Button\n              variant={filterStatus === \"active\" ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setFilterStatus(\"active\")}\n              className={filterStatus === \"active\" ? \"bg-green-600 hover:bg-green-700\" : \"border-gray-600 text-gray-300\"}\n            >\n              Aktif\n            </Button>\n            <Button\n              variant={filterStatus === \"inactive\" ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setFilterStatus(\"inactive\")}\n              className={filterStatus === \"inactive\" ? \"bg-orange-600 hover:bg-orange-700\" : \"border-gray-600 text-gray-300\"}\n            >\n              Pasif\n            </Button>\n          </div>\n        </div>\n\n        {/* Sessions List */}\n        <Card className=\"bg-dark-secondary border-dark-accent\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Oturum Listesi ({filteredSessions.length})\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-0\">\n            {filteredSessions.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <AlertTriangle className=\"h-12 w-12 text-gray-500 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-semibold text-gray-400 mb-2\">Oturum Bulunamadı</h3>\n                <p className=\"text-gray-500\">Arama kriterlerinize uygun oturum bulunmamaktadır.</p>\n              </div>\n            ) : (\n              <div className=\"divide-y divide-dark-accent\">\n                {filteredSessions.map((session) => (\n                  <div key={session.id} className=\"p-6 hover:bg-dark-primary/50 transition-colors\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-start gap-4\">\n                        <div className=\"text-2xl\">\n                          {getDeviceIcon(session.userAgent)}\n                        </div>\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <h3 className=\"font-semibold text-white\">{session.userEmail}</h3>\n                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                              session.isActive \n                                ? \"bg-green-600/20 text-green-400 border border-green-600/30\"\n                                : \"bg-gray-600/20 text-gray-400 border border-gray-600/30\"\n                            }`}>\n                              {session.isActive ? \"Aktif\" : \"Pasif\"}\n                            </span>\n                          </div>\n                          <div className=\"space-y-1 text-sm text-gray-400\">\n                            <p>\n                              <span className=\"font-medium\">IP:</span> {session.ipAddress}\n                              {session.location && <span className=\"ml-2\">({session.location})</span>}\n                            </p>\n                            <p>\n                              <span className=\"font-medium\">Tarayıcı:</span> {getBrowserName(session.userAgent)}\n                            </p>\n                            <p>\n                              <span className=\"font-medium\">Son Aktivite:</span> {new Date(session.lastActivity).toLocaleString('tr-TR')}\n                            </p>\n                            <p>\n                              <span className=\"font-medium\">Başlangıç:</span> {new Date(session.createdAt).toLocaleString('tr-TR')}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {session.isActive && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"border-red-600 text-red-400 hover:bg-red-600 hover:text-white\"\n                            onClick={() => handleTerminateSession(session.id)}\n                          >\n                            <X className=\"h-4 w-4 mr-1\" />\n                            Sonlandır\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":12569},"client/src/pages/admin/dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { \n  Shield, Users, MessageSquare, Database, TrendingUp, \n  Activity, Settings, Bell, Calendar, BarChart3, Home,\n  UserCheck, UserX, HardDrive, Zap, RefreshCw, AlertTriangle, DollarSign, Trash2\n} from \"lucide-react\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport Header from \"@/components/layout/header\";\nimport MaintenanceBanner from \"@/components/maintenance-banner\";\nimport AdminLayout from \"@/components/admin/admin-layout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function AdminDashboard() {\n  const [, setLocation] = useLocation();\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const [lastUpdateTime, setLastUpdateTime] = useState(new Date());\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const { toast } = useToast();\n  const queryClientInstance = useQueryClient();\n  const { user } = useAuth();\n\n  // Admin dashboard stats with enhanced auto-refresh\n  const { data: dashboardStats, isLoading } = useQuery({\n    queryKey: [\"/api/admin/dashboard-stats\"],\n    refetchInterval: autoRefresh ? 15000 : false, // 15 seconds when enabled\n    onSuccess: () => setLastUpdateTime(new Date()),\n  });\n\n  // System metrics with real-time monitoring\n  const { data: systemMetrics } = useQuery({\n    queryKey: [\"/api/admin/system-metrics\"],\n    refetchInterval: autoRefresh ? 10000 : false, // 10 seconds when enabled\n  });\n\n  // Recent admin logs with live updates\n  const { data: adminLogs } = useQuery({\n    queryKey: [\"/api/admin/logs\"],\n    refetchInterval: autoRefresh ? 8000 : false, // 8 seconds when enabled\n  });\n\n  // System settings to check maintenance mode\n  const { data: systemSettings } = useQuery({\n    queryKey: [\"/api/admin/settings\"],\n    refetchInterval: autoRefresh ? 30000 : false, // 30 seconds when enabled\n  });\n\n  // Payment notifications with real-time updates\n  const { data: paymentNotifications } = useQuery({\n    queryKey: [\"/api/admin/payment-notifications\"],\n    refetchInterval: autoRefresh ? 12000 : false, // 12 seconds when enabled\n  });\n\n  // Delete all users except super admin mutation\n  const deleteAllUsersMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/admin/users/delete-all-except-super\");\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Başarılı\",\n        description: `${data.deletedCount} kullanıcı başarıyla silindi (süper admin korundu)`,\n      });\n      queryClientInstance.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      queryClientInstance.invalidateQueries({ queryKey: [\"/api/admin/dashboard-stats\"] });\n      setShowDeleteDialog(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Kullanıcıları silerken bir hata oluştu\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const settingsMap = systemSettings?.reduce((acc: any, setting: any) => {\n    acc[setting.key] = setting.value;\n    return acc;\n  }, {}) || {};\n\n  const isMaintenanceMode = settingsMap.maintenance_mode === \"true\";\n\n  if (isLoading) {\n    return (\n      <AdminLayout>\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"text-center\">\n            <Activity className=\"h-12 w-12 text-purple-400 mx-auto mb-4 animate-spin\" />\n            <p className=\"text-gray-400\">Admin panel yükleniyor...</p>\n          </div>\n        </div>\n      </AdminLayout>\n    );\n  }\n\n  const stats = dashboardStats || {\n    totalUsers: 0,\n    activeUsers: 0,\n    totalMessages: 0,\n    totalStorage: 0,\n    registrationsThisMonth: 0,\n    messagesThisMonth: 0,\n  };\n\n  const formatBytes = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const adminActions = [\n    { \n      title: \"Kullanıcı Yönetimi\", \n      description: \"Kullanıcıları görüntüle ve yönet\",\n      icon: Users, \n      color: \"bg-blue-500\",\n      route: \"/admin/users\" \n    },\n    { \n      title: \"Sistem Ayarları\", \n      description: \"Genel sistem ayarlarını düzenle\",\n      icon: Settings, \n      color: \"bg-green-500\",\n      route: \"/admin/settings\" \n    },\n    { \n      title: \"Duyurular\", \n      description: \"Sistem duyurularını yönet\",\n      icon: Bell, \n      color: \"bg-yellow-500\",\n      route: \"/admin/announcements\" \n    },\n    { \n      title: \"Admin Logları\", \n      description: \"Sistem aktivitelerini incele\",\n      icon: Activity, \n      color: \"bg-purple-500\",\n      route: \"/admin/logs\" \n    },\n    { \n      title: \"Metrikler\", \n      description: \"Sistem performansını izle\",\n      icon: BarChart3, \n      color: \"bg-red-500\",\n      route: \"/admin/metrics\" \n    },\n    { \n      title: \"Oturumlar\", \n      description: \"Aktif kullanıcı oturumları\",\n      icon: UserCheck, \n      color: \"bg-indigo-500\",\n      route: \"/admin/sessions\" \n    },\n    { \n      title: \"Ödeme Bildirimleri\", \n      description: \"Kullanıcı ödeme bildirimlerini onayla/reddet\",\n      icon: DollarSign, \n      color: \"bg-cyan-500\",\n      route: \"/admin/payment-notifications\" \n    },\n  ];\n\n  return (\n    <AdminLayout>\n      <div className=\"space-y-6\">\n        {/* Maintenance Mode Banner */}\n        {isMaintenanceMode && <MaintenanceBanner isAdmin={true} />}\n        \n        {/* Enhanced Header with Live Controls */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-3\">\n            <Shield className=\"h-8 w-8 text-purple-400\" />\n            <div>\n              <h1 className=\"text-2xl font-bold text-white\">Admin Panel</h1>\n              <div className=\"flex items-center gap-3 text-sm text-gray-400\">\n                <span>Sistem yönetimi ve izleme</span>\n                <span>•</span>\n                <span>Son güncelleme: {lastUpdateTime.toLocaleTimeString('tr-TR')}</span>\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={() => setAutoRefresh(!autoRefresh)}\n              className={`border transition-colors ${\n                autoRefresh \n                  ? 'border-green-500 text-green-400 hover:bg-green-500/10' \n                  : 'border-gray-500 text-gray-400 hover:bg-gray-500/10'\n              }`}\n            >\n              <RefreshCw className={`h-4 w-4 mr-2 ${autoRefresh ? 'animate-spin' : ''}`} />\n              {autoRefresh ? 'Canlı' : 'Manuel'}\n            </Button>\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={() => {\n                queryClient.invalidateQueries({ queryKey: [\"/api/admin/dashboard-stats\"] });\n                queryClient.invalidateQueries({ queryKey: [\"/api/admin/logs\"] });\n                setLastUpdateTime(new Date());\n              }}\n              className=\"border-purple-600 text-purple-400 hover:bg-purple-600/10\"\n            >\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Yenile\n            </Button>\n            <Badge variant=\"outline\" className=\"px-3 py-1 text-purple-400 border-purple-400\">\n              Yönetici\n            </Badge>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Toplam Kullanıcı</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.totalUsers}</p>\n                  <p className=\"text-green-400 text-xs mt-1\">\n                    +{stats.registrationsThisMonth} bu ay\n                  </p>\n                </div>\n                <Users className=\"h-10 w-10 text-blue-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Aktif Kullanıcı</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.activeUsers}</p>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n                    <p className=\"text-green-400 text-xs\">Çevrimiçi</p>\n                  </div>\n                </div>\n                <UserCheck className=\"h-10 w-10 text-green-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Toplam Mesaj</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.totalMessages}</p>\n                  <p className=\"text-blue-400 text-xs mt-1\">\n                    +{stats.messagesThisMonth} bu ay\n                  </p>\n                </div>\n                <MessageSquare className=\"h-10 w-10 text-purple-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Kullanılan Depolama</p>\n                  <p className=\"text-2xl font-bold text-white\">{formatBytes(stats.totalStorage)}</p>\n                  <Progress value={75} className=\"mt-2 h-1\" />\n                </div>\n                <HardDrive className=\"h-10 w-10 text-orange-400\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Quick Actions */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8\">\n          {adminActions.map((action) => (\n            <Card \n              key={action.route}\n              className=\"bg-dark-secondary border-dark-accent hover:bg-dark-accent transition-colors cursor-pointer\"\n              onClick={() => setLocation(action.route)}\n            >\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start gap-4\">\n                  <div className={`p-3 rounded-lg ${action.color}`}>\n                    <action.icon className=\"h-6 w-6 text-white\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-white mb-1\">{action.title}</h3>\n                    <p className=\"text-gray-400 text-sm\">{action.description}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {/* Payment Notifications Summary */}\n        <Card className=\"bg-dark-secondary border-dark-accent mb-6\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <DollarSign className=\"h-5 w-5 text-cyan-400\" />\n              Ödeme Bildirimleri\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {/* Pending Payments */}\n              <div className=\"p-4 bg-dark-accent rounded-lg border border-yellow-500/20\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-yellow-400 text-sm font-medium\">Bekleyen</p>\n                    <p className=\"text-2xl font-bold text-white\">\n                      {paymentNotifications?.filter((p: any) => p.status === 'PENDING').length || 0}\n                    </p>\n                  </div>\n                  <AlertTriangle className=\"h-8 w-8 text-yellow-400\" />\n                </div>\n              </div>\n\n              {/* Approved Payments */}\n              <div className=\"p-4 bg-dark-accent rounded-lg border border-green-500/20\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-green-400 text-sm font-medium\">Onaylı</p>\n                    <p className=\"text-2xl font-bold text-white\">\n                      {paymentNotifications?.filter((p: any) => p.status === 'APPROVED').length || 0}\n                    </p>\n                  </div>\n                  <UserCheck className=\"h-8 w-8 text-green-400\" />\n                </div>\n              </div>\n\n              {/* Rejected Payments */}\n              <div className=\"p-4 bg-dark-accent rounded-lg border border-red-500/20\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-red-400 text-sm font-medium\">Reddedilen</p>\n                    <p className=\"text-2xl font-bold text-white\">\n                      {paymentNotifications?.filter((p: any) => p.status === 'REJECTED').length || 0}\n                    </p>\n                  </div>\n                  <UserX className=\"h-8 w-8 text-red-400\" />\n                </div>\n              </div>\n            </div>\n\n            {/* Recent Payment Notifications */}\n            <div className=\"mt-6\">\n              <h4 className=\"text-white font-medium mb-3\">Son Ödeme Bildirimleri</h4>\n              <div className=\"space-y-3\">\n                {paymentNotifications && paymentNotifications.length > 0 ? (\n                  paymentNotifications.slice(0, 3).map((payment: any) => (\n                    <div key={payment.id} className=\"flex items-center justify-between p-3 bg-dark-primary rounded border border-gray-600\">\n                      <div className=\"flex-1\">\n                        <p className=\"text-white text-sm font-medium\">{payment.senderName}</p>\n                        <p className=\"text-gray-400 text-xs\">\n                          {payment.amount} TL - {payment.senderBank}\n                        </p>\n                        <p className=\"text-gray-400 text-xs\">\n                          {new Date(payment.createdAt).toLocaleString('tr-TR')}\n                        </p>\n                      </div>\n                      <Badge \n                        variant=\"outline\" \n                        className={`${\n                          payment.status === 'PENDING' ? 'text-yellow-400 border-yellow-400' :\n                          payment.status === 'APPROVED' ? 'text-green-400 border-green-400' :\n                          'text-red-400 border-red-400'\n                        }`}\n                      >\n                        {payment.status === 'PENDING' ? 'Bekleyen' :\n                         payment.status === 'APPROVED' ? 'Onaylı' : 'Reddedilen'}\n                      </Badge>\n                    </div>\n                  ))\n                ) : (\n                  <div className=\"text-center py-4\">\n                    <DollarSign className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\n                    <p className=\"text-gray-400 text-sm\">Henüz ödeme bildirimi yok</p>\n                  </div>\n                )}\n              </div>\n              <div className=\"mt-4 pt-4 border-t border-gray-600\">\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full border-gray-600 text-gray-300 hover:bg-dark-accent\"\n                  onClick={() => setLocation(\"/admin/payment-notifications\")}\n                >\n                  Tüm Ödeme Bildirimlerini Görüntüle\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Recent Activity & System Status */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* Recent Admin Logs */}\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardHeader>\n              <CardTitle className=\"text-white flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Activity className=\"h-5 w-5 text-purple-400\" />\n                  Canlı Admin Aktiviteleri\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className={`w-2 h-2 rounded-full ${autoRefresh ? 'bg-green-400 animate-pulse' : 'bg-gray-400'}`}></div>\n                  <span className={`text-xs ${autoRefresh ? 'text-green-400' : 'text-gray-400'}`}>\n                    {autoRefresh ? 'Canlı' : 'Durduruldu'}\n                  </span>\n                </div>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {adminLogs && adminLogs.length > 0 ? (\n                  adminLogs.slice(0, 5).map((log: any) => (\n                    <div key={log.id} className=\"flex items-start gap-3 p-3 border border-gray-600 rounded\">\n                      <div className=\"w-2 h-2 bg-green-400 rounded-full mt-2\"></div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-white text-sm font-medium\">{log.action}</p>\n                        <p className=\"text-gray-400 text-xs\">\n                          {new Date(log.createdAt).toLocaleString('tr-TR')}\n                        </p>\n                        {log.targetEntity && (\n                          <p className=\"text-gray-400 text-xs\">\n                            Hedef: {log.targetEntity}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  ))\n                ) : (\n                  <div className=\"text-center py-8\">\n                    <Activity className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-400\">Henüz admin aktivitesi yok</p>\n                  </div>\n                )}\n              </div>\n              <div className=\"mt-4 pt-4 border-t border-gray-600\">\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full border-gray-600 text-gray-300 hover:bg-dark-accent\"\n                  onClick={() => setLocation(\"/admin/logs\")}\n                >\n                  Tüm Logları Görüntüle\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* System Health */}\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardHeader>\n              <CardTitle className=\"text-white flex items-center gap-2\">\n                <Zap className=\"h-5 w-5 text-yellow-400\" />\n                Sistem Durumu\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-300\">API Durumu</span>\n                  <Badge variant=\"outline\" className=\"text-green-400 border-green-400\">\n                    Çalışıyor\n                  </Badge>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-300\">Veritabanı</span>\n                  <Badge variant=\"outline\" className=\"text-green-400 border-green-400\">\n                    Bağlı\n                  </Badge>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-300\">SMS Servisi</span>\n                  <Badge variant=\"outline\" className=\"text-yellow-400 border-yellow-400\">\n                    Beklemede\n                  </Badge>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-300\">Mesajlaşma</span>\n                  <Badge variant=\"outline\" className=\"text-green-400 border-green-400\">\n                    Aktif\n                  </Badge>\n                </div>\n                \n                <div className=\"mt-6 p-4 bg-dark-accent rounded border border-gray-600\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <TrendingUp className=\"h-4 w-4 text-green-400\" />\n                    <span className=\"text-white text-sm font-medium\">Sistem Performansı</span>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-xs\">\n                      <span className=\"text-gray-400\">CPU</span>\n                      <span className=\"text-white\">45%</span>\n                    </div>\n                    <Progress value={45} className=\"h-1\" />\n                    <div className=\"flex justify-between text-xs\">\n                      <span className=\"text-gray-400\">Bellek</span>\n                      <span className=\"text-white\">62%</span>\n                    </div>\n                    <Progress value={62} className=\"h-1\" />\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </AdminLayout>\n  );\n}","size_bytes":22087},"client/src/pages/account.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { \n  User, \n  Mail, \n  Lock, \n  Camera, \n  Save, \n  Eye, \n  EyeOff,\n  Shield,\n  Bell,\n  Globe,\n  CreditCard,\n  AlertCircle,\n  Home\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\n// Form schemas\nconst profileFormSchema = z.object({\n  firstName: z.string().min(2, \"Ad en az 2 karakter olmalıdır\"),\n  lastName: z.string().min(2, \"Soyad en az 2 karakter olmalıdır\"),\n  email: z.string().email(\"Geçerli bir email adresi giriniz\"),\n});\n\nconst passwordFormSchema = z.object({\n  currentPassword: z.string().min(1, \"Mevcut şifre gereklidir\"),\n  newPassword: z.string().min(6, \"Yeni şifre en az 6 karakter olmalıdır\"),\n  confirmPassword: z.string().min(6, \"Şifre doğrulama gereklidir\"),\n}).refine((data) => data.newPassword === data.confirmPassword, {\n  message: \"Şifreler eşleşmiyor\",\n  path: [\"confirmPassword\"],\n});\n\nconst paymentFormSchema = z.object({\n  paymentDate: z.string().min(1, \"Ödeme tarihi gereklidir\"),\n  senderName: z.string().min(2, \"Gönderen adı en az 2 karakter olmalıdır\"),\n  senderBank: z.string().min(2, \"Banka adı en az 2 karakter olmalıdır\"),\n  amount: z.string().min(1, \"Tutar gereklidir\"),\n  description: z.string().optional(),\n});\n\ntype ProfileFormData = z.infer<typeof profileFormSchema>;\ntype PasswordFormData = z.infer<typeof passwordFormSchema>;\ntype PaymentFormData = z.infer<typeof paymentFormSchema>;\n\nexport default function Account() {\n  const { toast } = useToast();\n  const { user, isLoading } = useAuth();\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false);\n  const [showNewPassword, setShowNewPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [profilePicture, setProfilePicture] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  \n  // User preferences state - Load from localStorage\n  const [compactView, setCompactView] = useState(() => {\n    const saved = localStorage.getItem('compactView');\n    return saved ? JSON.parse(saved) : false;\n  });\n  const [autoSave, setAutoSave] = useState(() => {\n    const saved = localStorage.getItem('autoSave');\n    return saved ? JSON.parse(saved) : true;\n  });\n  const [darkTheme, setDarkTheme] = useState(() => {\n    const saved = localStorage.getItem('darkTheme');\n    return saved ? JSON.parse(saved) : true;\n  });\n\n  // Apply theme and compact view effects\n  useEffect(() => {\n    const root = document.documentElement;\n    if (darkTheme) {\n      root.classList.add('dark');\n    } else {\n      root.classList.remove('dark');\n    }\n    localStorage.setItem('darkTheme', JSON.stringify(darkTheme));\n  }, [darkTheme]);\n\n  useEffect(() => {\n    const root = document.documentElement;\n    if (compactView) {\n      root.classList.add('compact');\n    } else {\n      root.classList.remove('compact');\n    }\n    localStorage.setItem('compactView', JSON.stringify(compactView));\n  }, [compactView]);\n\n  useEffect(() => {\n    localStorage.setItem('autoSave', JSON.stringify(autoSave));\n  }, [autoSave]);\n\n  // Fetch payment settings for normal users\n  const { data: paymentSettings } = useQuery({\n    queryKey: [\"/api/payment-info\"],\n    retry: false,\n  });\n\n  // Profile form - MUST be defined before early returns\n  const profileForm = useForm<ProfileFormData>({\n    resolver: zodResolver(profileFormSchema),\n    defaultValues: {\n      firstName: user?.firstName || \"\",\n      lastName: user?.lastName || \"\",\n      email: user?.email || \"\",\n    },\n  });\n\n  // Password form\n  const passwordForm = useForm<PasswordFormData>({\n    resolver: zodResolver(passwordFormSchema),\n    defaultValues: {\n      currentPassword: \"\",\n      newPassword: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  // Payment form\n  const paymentForm = useForm<PaymentFormData>({\n    resolver: zodResolver(paymentFormSchema),\n    defaultValues: {\n      paymentDate: \"\",\n      senderName: \"\",\n      senderBank: \"\",\n      amount: \"99\",\n      description: \"\",\n    },\n  });\n\n  // Update form values when user data changes\n  useEffect(() => {\n    if (user) {\n      profileForm.reset({\n        firstName: user.firstName || \"\",\n        lastName: user.lastName || \"\",\n        email: user.email || \"\",\n      });\n    }\n  }, [user, profileForm]);\n\n  // Update profile mutation\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: ProfileFormData) => {\n      return await apiRequest(\"/api/auth/profile\", \"PUT\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Profil bilgileriniz güncellendi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Profil güncellenirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Change password mutation\n  const changePasswordMutation = useMutation({\n    mutationFn: async (data: PasswordFormData) => {\n      return await apiRequest(\"/api/auth/change-password\", \"POST\", data);\n    },\n    onSuccess: () => {\n      passwordForm.reset();\n      toast({\n        title: \"Başarılı\",\n        description: \"Şifreniz başarıyla değiştirildi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Şifre değiştirilirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Payment notification mutation\n  const paymentNotificationMutation = useMutation({\n    mutationFn: async (data: PaymentFormData) => {\n      return await apiRequest(\"/api/payment/notify\", \"POST\", data);\n    },\n    onSuccess: () => {\n      paymentForm.reset();\n      toast({\n        title: \"Başarılı\",\n        description: \"Ödeme bildiriminiz alındı. En kısa sürede işleme alınacaktır.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Ödeme bildirimi gönderilirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Profile photo upload mutation\n  const uploadPhotoMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append('profileImage', file);\n      \n      // Use the same authentication mechanism as other API calls\n      const token = localStorage.getItem('sessionId');\n      const response = await fetch('/api/auth/upload-profile-image', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          // Don't set Content-Type for FormData - browser will set it with boundary\n        },\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.message || 'Fotoğraf yüklenirken hata oluştu');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Profil fotoğrafınız güncellendi.\",\n      });\n      setProfilePicture(null);\n      setPreviewUrl(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Fotoğraf yüklenirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onProfileSubmit = (data: ProfileFormData) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  const onPasswordSubmit = (data: PasswordFormData) => {\n    changePasswordMutation.mutate(data);\n  };\n\n  const onPaymentSubmit = (data: PaymentFormData) => {\n    paymentNotificationMutation.mutate(data);\n  };\n\n  // Handle photo file selection\n  const handlePhotoChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      // Validate file size (5MB max)\n      if (file.size > 5 * 1024 * 1024) {\n        toast({\n          title: \"Hata\",\n          description: \"Dosya boyutu 5MB'dan büyük olamaz.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Validate file type\n      if (!file.type.match(/^image\\/(jpeg|jpg|png)$/)) {\n        toast({\n          title: \"Hata\", \n          description: \"Sadece JPG ve PNG formatları desteklenmektedir.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      setProfilePicture(file);\n      \n      // Create preview URL\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        setPreviewUrl(e.target?.result as string);\n      };\n      reader.readAsDataURL(file);\n\n      // Upload immediately\n      uploadPhotoMutation.mutate(file);\n    }\n  };\n\n  // Trigger file input\n  const triggerPhotoUpload = () => {\n    const fileInput = document.getElementById('photo-upload') as HTMLInputElement;\n    fileInput?.click();\n  };\n\n  // Show loading state - moved after hooks\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary flex items-center justify-center\">\n        <div className=\"text-white\">Yükleniyor...</div>\n      </div>\n    );\n  }\n\n  // Redirect if not authenticated - moved after hooks\n  if (!user) {\n    window.location.href = \"/\";\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-3\">\n            <User className=\"h-8 w-8 text-blue-500\" />\n            <div>\n              <h1 className=\"text-2xl font-bold text-white\">Hesabım</h1>\n              <p className=\"text-gray-400\">Hesap bilgilerinizi yönetin</p>\n            </div>\n          </div>\n          <Link href=\"/\">\n            <Button variant=\"outline\" size=\"icon\" className=\"bg-dark-secondary border-dark-border hover:bg-dark-accent\">\n              <Home className=\"h-4 w-4 text-white\" />\n            </Button>\n          </Link>\n        </div>\n\n        <Tabs defaultValue=\"profile\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-6 bg-dark-secondary\">\n            <TabsTrigger value=\"profile\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <User className=\"h-4 w-4 mr-2\" />\n              Profil\n            </TabsTrigger>\n            <TabsTrigger value=\"security\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Lock className=\"h-4 w-4 mr-2\" />\n              Güvenlik\n            </TabsTrigger>\n            <TabsTrigger value=\"subscription\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <CreditCard className=\"h-4 w-4 mr-2\" />\n              Abonelik\n            </TabsTrigger>\n            <TabsTrigger value=\"notifications\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Bell className=\"h-4 w-4 mr-2\" />\n              Bildirimler\n            </TabsTrigger>\n            <TabsTrigger value=\"preferences\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <Globe className=\"h-4 w-4 mr-2\" />\n              Tercihler\n            </TabsTrigger>\n            <TabsTrigger value=\"payment\" className=\"text-white data-[state=active]:bg-dark-accent\">\n              <CreditCard className=\"h-4 w-4 mr-2\" />\n              Ödeme\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Profile Tab */}\n          <TabsContent value=\"profile\">\n            <div className=\"grid gap-6\">\n              <Card className=\"bg-dark-secondary border-dark-accent\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <User className=\"h-5 w-5\" />\n                    Profil Bilgileri\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Profile Picture */}\n                  <div className=\"flex items-center gap-4\">\n                    <Avatar className=\"h-20 w-20\">\n                      <AvatarImage src={previewUrl || user?.profileImageUrl || \"\"} />\n                      <AvatarFallback className=\"bg-dark-accent text-white text-lg\">\n                        {user?.firstName?.[0]}{user?.lastName?.[0]}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"space-y-2\">\n                      <input\n                        id=\"photo-upload\"\n                        type=\"file\"\n                        accept=\"image/jpeg,image/jpg,image/png\"\n                        onChange={handlePhotoChange}\n                        className=\"hidden\"\n                      />\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"border-gray-600 text-gray-300\"\n                        onClick={triggerPhotoUpload}\n                        disabled={uploadPhotoMutation.isPending}\n                      >\n                        <Camera className=\"h-4 w-4 mr-2\" />\n                        {uploadPhotoMutation.isPending ? \"Yükleniyor...\" : \"Fotoğraf Değiştir\"}\n                      </Button>\n                      <p className=\"text-sm text-gray-400\">\n                        JPG, PNG formatında, maksimum 5MB\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* Profile Form */}\n                  <Form {...profileForm}>\n                    <form onSubmit={profileForm.handleSubmit(onProfileSubmit)} className=\"space-y-4\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <FormField\n                          control={profileForm.control}\n                          name=\"firstName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-gray-300\">Ad</FormLabel>\n                              <FormControl>\n                                <Input\n                                  {...field}\n                                  className=\"bg-dark-primary border-gray-600 text-white\"\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={profileForm.control}\n                          name=\"lastName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-gray-300\">Soyad</FormLabel>\n                              <FormControl>\n                                <Input\n                                  {...field}\n                                  className=\"bg-dark-primary border-gray-600 text-white\"\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <FormField\n                        control={profileForm.control}\n                        name=\"email\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-gray-300\">Email</FormLabel>\n                            <FormControl>\n                              <Input\n                                {...field}\n                                type=\"email\"\n                                className=\"bg-dark-primary border-gray-600 text-white\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <div className=\"flex justify-end\">\n                        <Button \n                          type=\"submit\" \n                          className=\"bg-blue-600 hover:bg-blue-700\"\n                          disabled={updateProfileMutation.isPending}\n                        >\n                          <Save className=\"h-4 w-4 mr-2\" />\n                          Profili Güncelle\n                        </Button>\n                      </div>\n                    </form>\n                  </Form>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* Security Tab */}\n          <TabsContent value=\"security\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Lock className=\"h-5 w-5\" />\n                  Güvenlik Ayarları\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <Form {...passwordForm}>\n                  <form onSubmit={passwordForm.handleSubmit(onPasswordSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={passwordForm.control}\n                      name=\"currentPassword\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">Mevcut Şifre</FormLabel>\n                          <FormControl>\n                            <div className=\"relative\">\n                              <Input\n                                {...field}\n                                type={showCurrentPassword ? \"text\" : \"password\"}\n                                className=\"bg-dark-primary border-gray-600 text-white pr-10\"\n                              />\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"absolute right-0 top-0 h-full px-3 text-gray-400 hover:text-white\"\n                                onClick={() => setShowCurrentPassword(!showCurrentPassword)}\n                              >\n                                {showCurrentPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                              </Button>\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={passwordForm.control}\n                      name=\"newPassword\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">Yeni Şifre</FormLabel>\n                          <FormControl>\n                            <div className=\"relative\">\n                              <Input\n                                {...field}\n                                type={showNewPassword ? \"text\" : \"password\"}\n                                className=\"bg-dark-primary border-gray-600 text-white pr-10\"\n                              />\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"absolute right-0 top-0 h-full px-3 text-gray-400 hover:text-white\"\n                                onClick={() => setShowNewPassword(!showNewPassword)}\n                              >\n                                {showNewPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                              </Button>\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={passwordForm.control}\n                      name=\"confirmPassword\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">Yeni Şifre (Tekrar)</FormLabel>\n                          <FormControl>\n                            <div className=\"relative\">\n                              <Input\n                                {...field}\n                                type={showConfirmPassword ? \"text\" : \"password\"}\n                                className=\"bg-dark-primary border-gray-600 text-white pr-10\"\n                              />\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"absolute right-0 top-0 h-full px-3 text-gray-400 hover:text-white\"\n                                onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                              >\n                                {showConfirmPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                              </Button>\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"flex justify-end\">\n                      <Button \n                        type=\"submit\" \n                        className=\"bg-red-600 hover:bg-red-700\"\n                        disabled={changePasswordMutation.isPending}\n                      >\n                        <Lock className=\"h-4 w-4 mr-2\" />\n                        Şifreyi Değiştir\n                      </Button>\n                    </div>\n                  </form>\n                </Form>\n\n                <div className=\"pt-6 border-t border-gray-600\">\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"space-y-1\">\n                        <Label className=\"text-gray-300\">İki Faktörlü Doğrulama</Label>\n                        <p className=\"text-sm text-gray-400\">Hesabınızı ekstra güvenlik katmanıyla koruyun</p>\n                      </div>\n                      <Switch />\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Subscription Tab */}\n          <TabsContent value=\"subscription\">\n            <div className=\"grid gap-6\">\n              {/* Subscription Status */}\n              <Card className=\"bg-dark-secondary border-dark-accent\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <CreditCard className=\"h-5 w-5\" />\n                    Abonelik Durumu\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between p-4 bg-dark-primary rounded-lg\">\n                    <div>\n                      <p className=\"text-white font-medium\">\n                        Mevcut Plan: <span className={`${(user as any)?.subscriptionType === 'PRO' ? 'text-green-400' : 'text-yellow-400'}`}>\n                          {(user as any)?.subscriptionType === 'PRO' ? 'PRO Plan' : 'DEMO'}\n                        </span>\n                      </p>\n                      <p className=\"text-gray-400 text-sm\">\n                        {(user as any)?.subscriptionType === 'PRO' \n                          ? 'Tüm özelliklere erişim var' \n                          : 'Sınırlı özelliklere erişiminiz var'\n                        }\n                      </p>\n                    </div>\n                    {(user as any)?.subscriptionType === 'DEMO' && (\n                      <div className=\"flex items-center gap-2 text-orange-400\">\n                        <AlertCircle className=\"h-5 w-5\" />\n                        <span>Demo Kullanıcı</span>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* PRO Upgrade Section - Only for DEMO users */}\n                  {(user as any)?.subscriptionType !== 'PRO' && (\n                    <div className=\"mt-6 p-6 bg-gradient-to-r from-blue-600/10 to-purple-600/10 border border-blue-500/20 rounded-lg\">\n                      <div className=\"text-center space-y-4\">\n                        <h3 className=\"text-xl font-bold text-white\">PRO Plan'a Yükselt</h3>\n                        <p className=\"text-gray-300\">Tüm özelliklere sınırsız erişim, gelişmiş raporlar ve öncelikli destek</p>\n                        \n                        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                          <div className=\"text-left space-y-2 text-gray-300\">\n                            <h4 className=\"font-semibold text-white\">PRO Özellikleri:</h4>\n                            <ul className=\"space-y-1\">\n                              <li>✓ Sınırsız personel kaydı</li>\n                              <li>✓ Gelişmiş raporlama</li>\n                              <li>✓ Excel/PDF export</li>\n                              <li>✓ Toplu SMS gönderimi</li>\n                            </ul>\n                          </div>\n                          <div className=\"text-left space-y-2 text-gray-300\">\n                            <h4 className=\"font-semibold text-white\">DEMO Sınırları:</h4>\n                            <ul className=\"space-y-1\">\n                              <li>• Maksimum 5 personel</li>\n                              <li>• Temel raporlar</li>\n                              <li>• Sınırlı export</li>\n                              <li>• SMS limiti var</li>\n                            </ul>\n                          </div>\n                        </div>\n\n                        <div className=\"text-center\">\n                          <p className=\"text-2xl font-bold text-green-400 mb-2\">₺99/yıl</p>\n                          <p className=\"text-gray-400 text-sm mb-4\">PyTR ile güvenli ödeme</p>\n                          <Button \n                            className=\"bg-green-600 hover:bg-green-700 text-white px-8 py-3\"\n                            onClick={() => {\n                              window.open('https://pytr.com/payment-link', '_blank');\n                            }}\n                          >\n                            <CreditCard className=\"h-4 w-4 mr-2\" />\n                            PRO'ya Yükselt\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Payment confirmation for DEMO users */}\n                  {(user as any)?.subscriptionType !== 'PRO' && (\n                    <div className=\"mt-6 p-4 bg-dark-primary border border-gray-600 rounded-lg\">\n                      <h4 className=\"text-white font-medium mb-3\">Ödeme Yaptınız mı?</h4>\n                      <p className=\"text-gray-400 text-sm mb-4\">\n                        PyTR üzerinden ödeme yaptıysanız, hesabınızı hemen PRO'ya yükseltmek için aşağıdaki butona tıklayın.\n                      </p>\n                      <Button \n                        variant=\"outline\"\n                        className=\"bg-blue-600 hover:bg-blue-700 border-blue-500\"\n                        onClick={() => {\n                          // Simulate payment confirmation for demo\n                          const upgradeData = { paymentConfirmed: true };\n                          fetch('/api/auth/upgrade-to-pro', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify(upgradeData),\n                          })\n                          .then(res => res.json())\n                          .then(data => {\n                            if (data.success) {\n                              toast({\n                                title: \"Başarılı!\",\n                                description: data.message,\n                              });\n                              queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n                            }\n                          })\n                          .catch(() => {\n                            toast({\n                              title: \"Hata\",\n                              description: \"Yükseltme işlemi başarısız\",\n                              variant: \"destructive\",\n                            });\n                          });\n                        }}\n                      >\n                        Ödeme Onayladım - PRO'ya Yükselt\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* Notifications Tab */}\n          <TabsContent value=\"notifications\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Bell className=\"h-5 w-5\" />\n                  Bildirim Tercihleri\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Email Bildirimleri</Label>\n                      <p className=\"text-sm text-gray-400\">Önemli güncellemeler için email gönder</p>\n                    </div>\n                    <Switch defaultChecked />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">SMS Bildirimleri</Label>\n                      <p className=\"text-sm text-gray-400\">Kritik olaylar için SMS gönder</p>\n                    </div>\n                    <Switch />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Tarayıcı Bildirimleri</Label>\n                      <p className=\"text-sm text-gray-400\">Tarayıcıda anlık bildirimler göster</p>\n                    </div>\n                    <Switch defaultChecked />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Pazarlama Emailları</Label>\n                      <p className=\"text-sm text-gray-400\">Yeni özellikler ve güncellemeler hakkında bilgi al</p>\n                    </div>\n                    <Switch />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Payment Tab */}\n          <TabsContent value=\"payment\">\n            <div className=\"grid gap-6\">\n              {/* Subscription Status */}\n              <Card className=\"bg-dark-secondary border-dark-accent\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <CreditCard className=\"h-5 w-5\" />\n                    Abonelik Durumu\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between p-4 bg-dark-primary rounded-lg\">\n                    <div>\n                      <p className=\"text-white font-medium\">\n                        Mevcut Plan: <span className={`${(user as any)?.subscriptionType === 'PRO' ? 'text-green-400' : 'text-yellow-400'}`}>\n                          {(user as any)?.subscriptionType === 'PRO' ? 'PRO Plan' : 'DEMO'}\n                        </span>\n                      </p>\n                      <p className=\"text-gray-400 text-sm\">\n                        {(user as any)?.subscriptionType === 'PRO' \n                          ? 'Tüm özelliklere erişim var' \n                          : 'Sınırlı özelliklere erişiminiz var'\n                        }\n                      </p>\n                    </div>\n                    {(user as any)?.subscriptionType === 'DEMO' && (\n                      <div className=\"flex items-center gap-2 text-orange-400\">\n                        <AlertCircle className=\"h-5 w-5\" />\n                        <span className=\"text-sm\">Yükseltme Gerekli</span>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* PRO Subscription Card - Only show for DEMO users */}\n              {(user as any)?.subscriptionType !== 'PRO' && (\n                <Card className=\"bg-dark-secondary border-dark-accent\">\n                  <CardHeader>\n                    <CardTitle className=\"text-white flex items-center gap-2\">\n                      <CreditCard className=\"h-5 w-5\" />\n                      PRO Abonelik Satın Al\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-6\">\n                    <div className=\"bg-gradient-to-r from-blue-600/20 to-purple-600/20 p-6 rounded-lg border border-blue-500/30\">\n                      <h3 className=\"text-white font-bold text-xl mb-2\">PRO Üyelik - {paymentSettings?.amount || \"99 TL\"}/Ay</h3>\n                      <ul className=\"text-gray-300 space-y-2 mb-4\">\n                        <li>• Sınırsız personel ekleme</li>\n                        <li>• Sınırsız proje yönetimi</li>\n                        <li>• Detaylı raporlama</li>\n                        <li>• Firma rehberi ve mesajlaşma</li>\n                        <li>• Toplu SMS gönderimi</li>\n                        <li>• Öncelikli müşteri desteği</li>\n                      </ul>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Payment Information - Always show */}\n              <Card className=\"bg-dark-secondary border-dark-accent\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <CreditCard className=\"h-5 w-5\" />\n                    Ödeme Bilgileri\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"space-y-4\">\n                    <h4 className=\"text-white font-medium\">Ödeme Yöntemi: {paymentSettings?.paymentMethod || \"EFT/Havale\"}</h4>\n                    \n                    <div className=\"bg-dark-primary p-4 rounded-lg space-y-3\">\n                      <p className=\"text-gray-300 font-medium\">Banka Bilgileri:</p>\n                      <div className=\"space-y-2 text-sm\">\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-400\">Banka:</span>\n                          <span className=\"text-white\">{paymentSettings?.bankName || \"Ziraat Bankası\"}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-400\">Hesap Sahibi:</span>\n                          <span className=\"text-white\">{paymentSettings?.accountHolder || \"puantropls Ltd.\"}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-400\">IBAN:</span>\n                          <span className=\"text-white font-mono text-xs\">{paymentSettings?.iban || \"TR64 0001 0017 4513 6456 7890 01\"}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-400\">Tutar:</span>\n                          <span className=\"text-white font-bold\">{paymentSettings?.amount || \"99 TL\"}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-orange-500/10 border border-orange-500/30 p-4 rounded-lg\">\n                      <p className=\"text-orange-400 font-medium mb-2\">Önemli Bilgi:</p>\n                      <p className=\"text-gray-300 text-sm\">\n                        Ödemenizi yaptıktan sonra aşağıdaki formu doldurarak bize bildiriniz. \n                        Ödemeniz onaylandıktan sonra hesabınız PRO'ya yükseltilecektir.\n                      </p>\n                    </div>\n\n                    <Form {...paymentForm}>\n                      <form onSubmit={paymentForm.handleSubmit(onPaymentSubmit)} className=\"space-y-4\">\n                        <FormField\n                          control={paymentForm.control}\n                          name=\"paymentDate\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-gray-300\">Havale/EFT Tarihi</FormLabel>\n                              <FormControl>\n                                <Input\n                                  type=\"date\"\n                                  className=\"bg-dark-primary border-gray-600 text-white\"\n                                  {...field}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={paymentForm.control}\n                          name=\"senderName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-gray-300\">Gönderen Hesap Sahibi Adı</FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder=\"Ödemeyi yapan kişinin adı soyadı\"\n                                  className=\"bg-dark-primary border-gray-600 text-white\"\n                                  {...field}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={paymentForm.control}\n                          name=\"senderBank\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-gray-300\">Gönderen Banka</FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder=\"Ödemenin yapıldığı banka adı\"\n                                  className=\"bg-dark-primary border-gray-600 text-white\"\n                                  {...field}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={paymentForm.control}\n                          name=\"amount\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-gray-300\">Havale/EFT Tutarı</FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder=\"99 TL\"\n                                  className=\"bg-dark-primary border-gray-600 text-white\"\n                                  {...field}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={paymentForm.control}\n                          name=\"description\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-gray-300\">Ek Açıklama (İsteğe bağlı)</FormLabel>\n                              <FormControl>\n                                <Textarea\n                                  placeholder=\"Varsa ek bilgiler veya notlar\"\n                                  className=\"bg-dark-primary border-gray-600 text-white\"\n                                  rows={3}\n                                  {...field}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <Button \n                          type=\"submit\" \n                          className=\"w-full bg-blue-600 hover:bg-blue-700 text-white\"\n                          disabled={paymentNotificationMutation.isPending}\n                        >\n                          <Mail className=\"h-4 w-4 mr-2\" />\n                          {paymentNotificationMutation.isPending ? \"Gönderiliyor...\" : \"Ödeme Bildirimini Gönder\"}\n                        </Button>\n                      </form>\n                    </Form>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* Preferences Tab */}\n          <TabsContent value=\"preferences\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Globe className=\"h-5 w-5\" />\n                  Kullanıcı Tercihleri\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-gray-300\">Dil</Label>\n                    <Input\n                      defaultValue=\"Türkçe\"\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                      disabled\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-gray-300\">Saat Dilimi</Label>\n                    <Input\n                      defaultValue=\"Turkey (UTC+3)\"\n                      className=\"bg-dark-primary border-gray-600 text-white\"\n                      disabled\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Karanlık Tema</Label>\n                      <p className=\"text-sm text-gray-400\">Karanlık arayüz temasını kullan</p>\n                    </div>\n                    <Switch \n                      checked={darkTheme} \n                      onCheckedChange={(checked) => {\n                        console.log('🎨 Dark theme changing to:', checked);\n                        setDarkTheme(checked);\n                        // Manual immediate effect\n                        const root = document.documentElement;\n                        if (checked) {\n                          root.classList.add('dark');\n                          console.log('✅ Added dark class');\n                        } else {\n                          root.classList.remove('dark');\n                          console.log('✅ Removed dark class');\n                        }\n                        if (autoSave) {\n                          toast({\n                            title: \"Tema Değiştirildi\",\n                            description: checked ? \"Karanlık tema aktifleştirildi\" : \"Açık tema aktifleştirildi\",\n                          });\n                        }\n                      }} \n                    />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Kompakt Görünüm</Label>\n                      <p className=\"text-sm text-gray-400\">Daha sıkışık arayüz kullan</p>\n                    </div>\n                    <Switch \n                      checked={compactView} \n                      onCheckedChange={(checked) => {\n                        console.log('📏 Compact view changing to:', checked);\n                        setCompactView(checked);\n                        // Manual immediate effect\n                        const root = document.documentElement;\n                        if (checked) {\n                          root.classList.add('compact');\n                          console.log('✅ Added compact class');\n                        } else {\n                          root.classList.remove('compact');\n                          console.log('✅ Removed compact class');\n                        }\n                        if (autoSave) {\n                          toast({\n                            title: \"Görünüm Değiştirildi\",\n                            description: checked ? \"Kompakt görünüm aktifleştirildi\" : \"Normal görünüm aktifleştirildi\",\n                          });\n                        }\n                      }} \n                    />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-gray-300\">Otomatik Kaydetme</Label>\n                      <p className=\"text-sm text-gray-400\">Değişiklikleri otomatik olarak kaydet</p>\n                    </div>\n                    <Switch \n                      checked={autoSave} \n                      onCheckedChange={(checked) => {\n                        setAutoSave(checked);\n                        toast({\n                          title: \"Otomatik Kaydetme\",\n                          description: checked ? \"Otomatik kaydetme aktifleştirildi\" : \"Otomatik kaydetme kapatıldı\",\n                        });\n                      }} \n                    />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":48198},"client/src/pages/admin/payment-notifications.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { Check, X, Clock, User, Calendar, DollarSign, ArrowLeft, Home } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { tr } from 'date-fns/locale';\nimport { useLocation } from 'wouter';\n\ninterface PaymentNotification {\n  id: string;\n  userId: string;\n  paymentMethod: string;\n  amount: number;\n  paymentDate: string;\n  referenceNumber?: string;\n  description?: string;\n  status: 'pending' | 'approved' | 'rejected';\n  adminNote?: string;\n  createdAt: string;\n  user?: {\n    id: string;\n    email: string;\n    firstName?: string;\n    lastName?: string;\n  };\n}\n\nexport default function PaymentNotifications() {\n  const [selectedNotification, setSelectedNotification] = useState<PaymentNotification | null>(null);\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [adminNote, setAdminNote] = useState('');\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n\n  const { data: notifications, isLoading } = useQuery({\n    queryKey: statusFilter === 'all' ? ['/api/admin/payment-notifications'] : ['/api/admin/payment-notifications', { status: statusFilter }],\n    queryFn: () => statusFilter === 'all' \n      ? apiRequest('/api/admin/payment-notifications', 'GET')\n      : apiRequest(`/api/admin/payment-notifications?status=${statusFilter}`, 'GET')\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, status, adminNote }: { id: string; status: string; adminNote?: string }) => {\n      return apiRequest(`/api/admin/payment-notifications/${id}`, 'PUT', { status, adminNote });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Başarılı\",\n        description: \"Ödeme bildirimi durumu güncellendi.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/payment-notifications'] });\n      setSelectedNotification(null);\n      setAdminNote('');\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Durum güncellenirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleStatusUpdate = (status: 'approved' | 'rejected') => {\n    if (!selectedNotification) return;\n    \n    updateStatusMutation.mutate({\n      id: selectedNotification.id,\n      status,\n      adminNote: adminNote.trim() || undefined\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300\">\n          <Clock className=\"w-3 h-3 mr-1\" />\n          Beklemede\n        </Badge>;\n      case 'approved':\n        return <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\">\n          <Check className=\"w-3 h-3 mr-1\" />\n          Onaylandı\n        </Badge>;\n      case 'rejected':\n        return <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300\">\n          <X className=\"w-3 h-3 mr-1\" />\n          Reddedildi\n        </Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div className=\"flex items-center space-x-4\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => window.history.back()}\n            className=\"flex items-center space-x-2\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            <span>Geri</span>\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setLocation('/')}\n            className=\"flex items-center space-x-2\"\n          >\n            <Home className=\"w-4 h-4\" />\n            <span>Anasayfa</span>\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Ödeme Bildirimleri</h1>\n        </div>\n        <div className=\"flex items-center space-x-4\">\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-[200px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">Tüm Durumlar</SelectItem>\n              <SelectItem value=\"pending\">Beklemede</SelectItem>\n              <SelectItem value=\"approved\">Onaylandı</SelectItem>\n              <SelectItem value=\"rejected\">Reddedildi</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {notifications?.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <p className=\"text-muted-foreground\">Henüz ödeme bildirimi bulunmuyor.</p>\n            </CardContent>\n          </Card>\n        ) : (\n          notifications?.map((notification: PaymentNotification) => (\n            <Card key={notification.id} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg flex items-center space-x-2\">\n                    <User className=\"w-4 h-4\" />\n                    <span>\n                      {notification.user?.firstName} {notification.user?.lastName}\n                    </span>\n                    <span className=\"text-sm text-muted-foreground font-normal\">\n                      ({notification.user?.email})\n                    </span>\n                  </CardTitle>\n                  {getStatusBadge(notification.status)}\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Ödeme Yöntemi</p>\n                    <p className=\"font-medium\">{notification.paymentMethod}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Tutar</p>\n                    <p className=\"font-medium flex items-center\">\n                      <DollarSign className=\"w-4 h-4 mr-1\" />\n                      ₺{notification.amount}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Ödeme Tarihi</p>\n                    <p className=\"font-medium flex items-center\">\n                      <Calendar className=\"w-4 h-4 mr-1\" />\n                      {format(new Date(notification.paymentDate), 'dd MMM yyyy', { locale: tr })}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Referans No</p>\n                    <p className=\"font-medium\">{notification.referenceNumber || '-'}</p>\n                  </div>\n                </div>\n                \n                {notification.description && (\n                  <div className=\"mb-4\">\n                    <p className=\"text-sm text-muted-foreground mb-1\">Açıklama</p>\n                    <p className=\"text-sm bg-gray-50 dark:bg-gray-900 p-2 rounded\">\n                      {notification.description}\n                    </p>\n                  </div>\n                )}\n\n                {notification.adminNote && (\n                  <div className=\"mb-4\">\n                    <p className=\"text-sm text-muted-foreground mb-1\">Admin Notu</p>\n                    <p className=\"text-sm bg-blue-50 dark:bg-blue-900/20 p-2 rounded\">\n                      {notification.adminNote}\n                    </p>\n                  </div>\n                )}\n\n                <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                  <span>\n                    Bildirim: {format(new Date(notification.createdAt), 'dd MMM yyyy HH:mm', { locale: tr })}\n                  </span>\n                  {notification.status === 'pending' && (\n                    <Button\n                      onClick={() => {\n                        setSelectedNotification(notification);\n                        setAdminNote('');\n                      }}\n                      size=\"sm\"\n                      variant=\"outline\"\n                    >\n                      İşlem Yap\n                    </Button>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n\n      <Dialog \n        open={!!selectedNotification} \n        onOpenChange={(open) => {\n          if (!open) {\n            setSelectedNotification(null);\n            setAdminNote('');\n          }\n        }}\n      >\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Ödeme Bildirimini Değerlendir</DialogTitle>\n          </DialogHeader>\n          \n          {selectedNotification && (\n            <div className=\"space-y-4\">\n              <div className=\"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg\">\n                <p className=\"font-medium mb-2\">\n                  {selectedNotification.user?.firstName} {selectedNotification.user?.lastName}\n                </p>\n                <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                  <span>Tutar:</span>\n                  <span className=\"font-medium\">₺{selectedNotification.amount}</span>\n                  <span>Yöntem:</span>\n                  <span>{selectedNotification.paymentMethod}</span>\n                  <span>Tarih:</span>\n                  <span>\n                    {format(new Date(selectedNotification.paymentDate), 'dd MMM yyyy', { locale: tr })}\n                  </span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">\n                  Admin Notu (Opsiyonel)\n                </label>\n                <Textarea\n                  value={adminNote}\n                  onChange={(e) => setAdminNote(e.target.value)}\n                  placeholder=\"Ödeme ile ilgili notlarınızı buraya yazın...\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"flex space-x-2\">\n                <Button\n                  onClick={() => handleStatusUpdate('approved')}\n                  disabled={updateStatusMutation.isPending}\n                  className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                >\n                  <Check className=\"w-4 h-4 mr-2\" />\n                  Onayla\n                </Button>\n                <Button\n                  onClick={() => handleStatusUpdate('rejected')}\n                  disabled={updateStatusMutation.isPending}\n                  variant=\"destructive\"\n                  className=\"flex-1\"\n                >\n                  <X className=\"w-4 h-4 mr-2\" />\n                  Reddet\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":11953},"client/src/pages/admin/payment-settings.tsx":{"content":"import React, { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { PaymentSettings } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Save, CreditCard, Building, Banknote } from \"lucide-react\";\nimport AdminLayout from \"@/components/admin/admin-layout\";\n\nconst paymentSettingsSchema = z.object({\n  bankName: z.string().min(1, \"Banka adı gereklidir\"),\n  accountHolder: z.string().min(1, \"Hesap sahibi gereklidir\"),\n  iban: z.string().min(1, \"IBAN gereklidir\"),\n  amount: z.string().min(1, \"Tutar gereklidir\"),\n  paymentMethod: z.string().min(1, \"Ödeme yöntemi gereklidir\"),\n});\n\ntype PaymentSettingsFormData = z.infer<typeof paymentSettingsSchema>;\n\nexport default function PaymentSettings() {\n  const { toast } = useToast();\n\n  // Fetch current payment settings\n  const { data: settings, isLoading } = useQuery<PaymentSettings>({\n    queryKey: [\"/api/admin/payment-settings\"],\n  });\n\n  const form = useForm<PaymentSettingsFormData>({\n    resolver: zodResolver(paymentSettingsSchema),\n    defaultValues: {\n      bankName: settings?.bankName || \"Ziraat Bankası\",\n      accountHolder: settings?.accountHolder || \"puantropls Ltd.\",\n      iban: settings?.iban || \"TR64 0001 0017 4513 6456 7890 01\",\n      amount: settings?.amount || \"99 TL\",\n      paymentMethod: settings?.paymentMethod || \"EFT/Havale\",\n    },\n  });\n\n  // Update form values when settings are loaded\n  React.useEffect(() => {\n    if (settings) {\n      form.reset({\n        bankName: settings.bankName,\n        accountHolder: settings.accountHolder,\n        iban: settings.iban,\n        amount: settings.amount,\n        paymentMethod: settings.paymentMethod,\n      });\n    }\n  }, [settings, form]);\n\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (data: PaymentSettingsFormData) => {\n      return apiRequest(\"/api/admin/payment-settings\", \"PUT\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/payment-settings\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Ödeme ayarları güncellendi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Güncelleme işlemi başarısız\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: PaymentSettingsFormData) => {\n    updateSettingsMutation.mutate(data);\n  };\n\n  if (isLoading) {\n    return (\n      <AdminLayout>\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"text-white\">Yükleniyor...</div>\n        </div>\n      </AdminLayout>\n    );\n  }\n\n  return (\n    <AdminLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <CreditCard className=\"h-8 w-8 text-blue-500\" />\n          <div>\n            <h1 className=\"text-2xl font-bold text-white\">Ödeme Ayarları</h1>\n            <p className=\"text-gray-400\">PRO üyelik ödeme bilgilerini yönetin</p>\n          </div>\n        </div>\n\n        <div className=\"grid gap-6 max-w-2xl\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardHeader>\n              <CardTitle className=\"text-white flex items-center gap-2\">\n                <Building className=\"h-5 w-5\" />\n                Banka Bilgileri\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                  <div className=\"grid gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"paymentMethod\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">Ödeme Yöntemi</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              className=\"bg-dark-primary border-gray-600 text-white\"\n                              placeholder=\"EFT/Havale\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"bankName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">Banka</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              className=\"bg-dark-primary border-gray-600 text-white\"\n                              placeholder=\"Ziraat Bankası\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"accountHolder\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">Hesap Sahibi</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              className=\"bg-dark-primary border-gray-600 text-white\"\n                              placeholder=\"puantropls Ltd.\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"iban\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">IBAN</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              className=\"bg-dark-primary border-gray-600 text-white\"\n                              placeholder=\"TR64 0001 0017 4513 6456 7890 01\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-300\">Tutar</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              className=\"bg-dark-primary border-gray-600 text-white\"\n                              placeholder=\"99 TL\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <Button\n                    type=\"submit\"\n                    disabled={updateSettingsMutation.isPending}\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                  >\n                    <Save className=\"h-4 w-4 mr-2\" />\n                    {updateSettingsMutation.isPending ? \"Kaydediliyor...\" : \"Ayarları Kaydet\"}\n                  </Button>\n                </form>\n              </Form>\n            </CardContent>\n          </Card>\n\n          {/* Preview Card */}\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardHeader>\n              <CardTitle className=\"text-white flex items-center gap-2\">\n                <Banknote className=\"h-5 w-5\" />\n                Önizleme\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"bg-dark-primary p-4 rounded-lg\">\n                <h3 className=\"text-white font-semibold mb-3\">Ödeme Bilgileri</h3>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-400\">Ödeme Yöntemi:</span>\n                    <span className=\"text-white\">{form.watch(\"paymentMethod\")}</span>\n                  </div>\n                  <div className=\"bg-dark-accent p-3 rounded\">\n                    <h4 className=\"text-white font-medium mb-2\">Banka Bilgileri:</h4>\n                    <div className=\"space-y-1 text-sm\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">Banka:</span>\n                        <span className=\"text-white\">{form.watch(\"bankName\")}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">Hesap Sahibi:</span>\n                        <span className=\"text-white\">{form.watch(\"accountHolder\")}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">IBAN:</span>\n                        <span className=\"text-white font-mono text-xs\">{form.watch(\"iban\")}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">Tutar:</span>\n                        <span className=\"text-white font-bold\">{form.watch(\"amount\")}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </AdminLayout>\n  );\n}","size_bytes":10547},"add-sample-companies.js":{"content":"// Test script to add sample companies for demonstration\nconst sampleCompanies = [\n  {\n    companyName: \"TechCorp Yazılım\",\n    contactPerson: \"Ahmet Yılmaz\",\n    phone: \"+90 532 123 4567\",\n    email: \"info@techcorp.com\",\n    address: \"Maslak Mahallesi, Teknoloji Caddesi No:15 Şişli/İstanbul\",\n    city: \"İstanbul\",\n    industry: \"Teknoloji\",\n    website: \"www.techcorp.com\",\n    description: \"Kurumsal yazılım çözümleri ve dijital dönüşüm hizmetleri\",\n    bio: \"25 yıllık deneyimle Türkiye'nin önde gelen yazılım şirketlerinden biri. Enterprise çözümler, mobil uygulama geliştirme ve cloud hizmetlerinde uzman.\",\n    logoUrl: \"https://via.placeholder.com/64/4CAF50/FFFFFF?text=TC\",\n    isActive: true,\n    isProVisible: true,\n    subscriptionStatus: \"PRO\",\n    isVerified: true\n  },\n  {\n    companyName: \"Başkent İnşaat\",\n    contactPerson: \"Fatma Özkan\",\n    phone: \"+90 312 555 7890\",\n    email: \"iletisim@baskentinsaat.com\",\n    address: \"Çankaya Mahallesi, İnşaat Sokak No:42 Çankaya/Ankara\",\n    city: \"Ankara\",\n    industry: \"İnşaat\",\n    website: \"www.baskentinsaat.com\",\n    description: \"Konut ve ticari yapı inşaatı, tadilat ve restorasyon hizmetleri\",\n    bio: \"1995'ten beri faaliyet gösteren köklü inşaat firması. Kaliteli yapı malzemeleri ve deneyimli ekibi ile güvenilir hizmet sunar.\",\n    logoUrl: \"https://via.placeholder.com/64/FF9800/FFFFFF?text=Bİ\",\n    isActive: true,\n    isProVisible: true,\n    subscriptionStatus: \"ENTERPRISE\",\n    isVerified: true\n  },\n  {\n    companyName: \"Ege Üretim Sanayi\",\n    contactPerson: \"Mehmet Kaya\",\n    phone: \"+90 232 444 1122\",\n    email: \"satis@egeuretim.com\",\n    address: \"Organize Sanayi Bölgesi, 15. Cadde No:78 Bornova/İzmir\",\n    city: \"İzmir\",\n    industry: \"Üretim\",\n    website: \"www.egeuretim.com\",\n    description: \"Plastik ve metal parça üretimi, endüstriyel çözümler\",\n    bio: \"Modern teknoloji ve kalite standartları ile üretim yapan, uluslararası sertifikalara sahip üretim tesisi.\",\n    logoUrl: \"https://via.placeholder.com/64/2196F3/FFFFFF?text=EÜ\",\n    isActive: true,\n    isProVisible: false,\n    subscriptionStatus: \"FREE\",\n    isVerified: false\n  },\n  {\n    companyName: \"Bursa Lojistik\",\n    contactPerson: \"Ayşe Demir\",\n    phone: \"+90 224 333 5566\",\n    email: \"info@bursalojistik.com\",\n    address: \"Nilüfer Mahallesi, Lojistik Bulvarı No:23 Nilüfer/Bursa\",\n    city: \"Bursa\",\n    industry: \"Hizmet\",\n    website: \"www.bursalojistik.com\",\n    description: \"Nakliye, depolama ve lojistik yönetim hizmetleri\",\n    bio: \"Türkiye genelinde hızlı ve güvenilir lojistik çözümleri sunan, 20+ yıl deneyimli ekibi olan firma.\",\n    logoUrl: \"https://via.placeholder.com/64/9C27B0/FFFFFF?text=BL\",\n    isActive: true,\n    isProVisible: true,\n    subscriptionStatus: \"PRO\",\n    isVerified: true\n  }\n];\n\nconsole.log(\"Sample companies data prepared:\", sampleCompanies.length, \"companies\");","size_bytes":2941},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconsole.log(\"Auth Debug - REPLIT_DOMAINS:\", process.env.REPLIT_DOMAINS);\nconsole.log(\"Auth Debug - REPL_ID:\", process.env.REPL_ID);\nconsole.log(\"Auth Debug - SESSION_SECRET:\", process.env.SESSION_SECRET ? \"exists\" : \"missing\");\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    console.log(\"Login attempt - hostname:\", req.hostname);\n    console.log(\"Available domains:\", process.env.REPLIT_DOMAINS);\n    \n    // Use the first domain from REPLIT_DOMAINS for localhost development\n    const domain = req.hostname === 'localhost' \n      ? process.env.REPLIT_DOMAINS!.split(\",\")[0] \n      : req.hostname;\n    \n    console.log(\"Using domain for auth:\", domain);\n    passport.authenticate(`replitauth:${domain}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    // Use the first domain from REPLIT_DOMAINS for localhost development\n    const domain = req.hostname === 'localhost' \n      ? process.env.REPLIT_DOMAINS!.split(\",\")[0] \n      : req.hostname;\n    \n    passport.authenticate(`replitauth:${domain}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};","size_bytes":5022},"server/simpleAuth.ts":{"content":"import type { Express, RequestHandler } from \"express\";\nimport { storage } from \"./storage\";\nimport jwt from \"jsonwebtoken\";\n\nconst JWT_SECRET = process.env.SESSION_SECRET || \"puantaj-secret-key\";\n\nexport async function setupSimpleAuth(app: Express) {\n  // Simple login endpoint - for demo purposes\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      // Create a demo user for testing\n      const demoUser = {\n        id: \"demo-user-1\",\n        email: \"demo@puantajpro.com\",\n        firstName: \"Demo\",\n        lastName: \"User\",\n        profileImageUrl: null,\n      };\n\n      // Store user in database\n      const user = await storage.upsertUser(demoUser);\n      \n      // Create JWT token\n      const token = jwt.sign(\n        { userId: user.id, email: user.email },\n        JWT_SECRET,\n        { expiresIn: '7d' }\n      );\n      \n      console.log(\"JWT token created for user:\", user.id);\n      \n      // Set HTTP-only cookie with token\n      res.cookie('auth-token', token, {\n        httpOnly: true,\n        secure: false, // false for development\n        sameSite: 'lax',\n        maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n        path: '/'\n      });\n      \n      res.json({ success: true, user });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  // Logout endpoint\n  app.post(\"/api/auth/logout\", (req, res) => {\n    res.clearCookie('auth-token');\n    res.json({ success: true });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  try {\n    const token = req.cookies['auth-token'];\n    \n    if (!token) {\n      console.log(\"No auth token found\");\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    // Verify JWT token\n    const decoded = jwt.verify(token, JWT_SECRET) as any;\n    \n    // Get user from database\n    const user = await storage.getUser(decoded.userId);\n    \n    if (!user) {\n      console.log(\"User not found for token\");\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    console.log(\"JWT auth successful for user:\", user.id);\n    \n    // Add user to request\n    (req as any).user = user;\n    next();\n  } catch (error) {\n    console.log(\"JWT verification failed:\", error);\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n};","size_bytes":2349},"client/src/components/maintenance-banner.tsx":{"content":"import { AlertTriangle, Wrench } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ninterface MaintenanceBannerProps {\n  isAdmin?: boolean;\n}\n\nexport default function MaintenanceBanner({ isAdmin = false }: MaintenanceBannerProps) {\n  if (!isAdmin) return null;\n\n  return (\n    <Alert className=\"bg-yellow-900/30 border-yellow-600 mb-4\">\n      <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />\n      <AlertDescription className=\"text-yellow-200\">\n        <div className=\"flex items-center gap-2\">\n          <Wrench className=\"h-4 w-4\" />\n          <span>\n            <strong>Bakım Modu Aktif:</strong> Sistem şu anda bakım modunda. \n            Normal kullanıcılar sisteme erişemiyor, sadece admin kullanıcılar aktif.\n          </span>\n        </div>\n      </AlertDescription>\n    </Alert>\n  );\n}","size_bytes":843},"client/src/components/maintenance-check.tsx":{"content":"import { useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { AlertTriangle, Wrench } from \"lucide-react\";\n\nexport default function MaintenanceCheck() {\n  const { user } = useAuth();\n  \n  // Check maintenance status\n  const { data: settings } = useQuery({\n    queryKey: [\"/api/admin/settings\"],\n    enabled: !!user, // Only run if user is logged in\n  });\n\n  const settingsMap = settings?.reduce((acc: any, setting: any) => {\n    acc[setting.key] = setting.value;\n    return acc;\n  }, {}) || {};\n\n  const isMaintenanceMode = settingsMap.maintenance_mode === \"true\";\n  const isAdmin = user && ((user as any).role === 'ADMIN' || (user as any).role === 'SUPER_ADMIN');\n\n  // If maintenance mode is active and user is not admin, show maintenance page\n  if (isMaintenanceMode && !isAdmin) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary flex items-center justify-center\">\n        <div className=\"max-w-md mx-auto text-center p-8\">\n          <div className=\"mb-6\">\n            <Wrench className=\"h-16 w-16 text-yellow-500 mx-auto mb-4\" />\n            <AlertTriangle className=\"h-8 w-8 text-yellow-500 mx-auto\" />\n          </div>\n          \n          <h1 className=\"text-3xl font-bold text-white mb-4\">\n            Sistem Bakımda\n          </h1>\n          \n          <p className=\"text-gray-300 mb-6\">\n            PuantajPro şu anda bakım modunda. Sistem yöneticileri gerekli güncellemeleri yapmaktadır.\n          </p>\n          \n          <div className=\"bg-yellow-900/30 border border-yellow-600 rounded-lg p-4 mb-6\">\n            <p className=\"text-yellow-200 text-sm\">\n              Bakım işlemleri tamamlandıktan sonra sisteme tekrar erişebileceksiniz.\n              Lütfen daha sonra tekrar deneyin.\n            </p>\n          </div>\n          \n          <p className=\"text-gray-400 text-sm\">\n            Acil durumlar için sistem yöneticinizle iletişime geçin.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return null; // Don't render anything if not in maintenance mode or user is admin\n}","size_bytes":2108},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","size_bytes":115},"client/src/pages/bulk-sms.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Home, MessageSquare, Send, Users, Phone, Clock, CheckCircle, XCircle, Search, ChevronDown, ChevronUp } from \"lucide-react\";\nimport Header from \"@/components/layout/header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface SMSTemplate {\n  id: string;\n  name: string;\n  content: string;\n  category: 'personnel' | 'customer' | 'general' | 'campaign' | 'holiday';\n}\n\ninterface SMSRecipient {\n  id: string;\n  name: string;\n  phone: string;\n  type: 'personnel' | 'customer';\n  selected?: boolean;\n}\n\ninterface SMSHistory {\n  id: string;\n  message: string;\n  recipientCount: number;\n  sentAt: string;\n  status: 'pending' | 'sent' | 'failed';\n  cost: number;\n}\n\nconst smsTemplates: SMSTemplate[] = [\n  // Personnel Templates\n  {\n    id: 'salary-notification',\n    name: 'Maaş Bildirimi',\n    content: 'Sayın {name}, {month} ayı maaşınız hesabınıza yatırılmıştır. İyi çalışmalar.',\n    category: 'personnel'\n  },\n  {\n    id: 'meeting-reminder',\n    name: 'Toplantı Hatırlatması',\n    content: 'Sayın {name}, yarın saat {time}\\'da toplantımız bulunmaktadır. Katılımınızı bekleriz.',\n    category: 'personnel'\n  },\n  \n  // Customer Templates\n  {\n    id: 'project-update',\n    name: 'Proje Güncellemesi',\n    content: 'Merhaba {name}, {project} projeniz ile ilgili güncelleme: {message}',\n    category: 'customer'\n  },\n  {\n    id: 'payment-reminder',\n    name: 'Ödeme Hatırlatması',\n    content: 'Sayın {name}, {amount} TL tutarındaki borcunuzun son ödeme tarihi yaklaşmaktadır.',\n    category: 'customer'\n  },\n  \n  // Campaign Templates\n  {\n    id: 'discount-campaign',\n    name: 'İndirim Kampanyası',\n    content: 'Özel fırsat! {discount}% indirimli fiyatlarla hizmetlerimizden yararlanın. Son tarih: {date}',\n    category: 'campaign'\n  },\n  {\n    id: 'new-service',\n    name: 'Yeni Hizmet Duyurusu',\n    content: 'Yeni hizmetimiz {service} artık mevcut! Detaylar için bizi arayın: {phone}',\n    category: 'campaign'\n  },\n  {\n    id: 'feedback-request',\n    name: 'Geri Bildirim Talebi',\n    content: 'Memnuniyet anketimize katılır mısınız? Görüşleriniz bizim için değerli: {link}',\n    category: 'campaign'\n  },\n  {\n    id: 'seasonal-offer',\n    name: 'Mevsimlik Teklifler',\n    content: 'Bu ay özel! {service} hizmeti için %{discount} indirim. Fırsatı kaçırmayın!',\n    category: 'campaign'\n  },\n  \n  // Official Holiday Templates\n  {\n    id: 'new-year',\n    name: 'Yılbaşı Kutlaması',\n    content: 'Yeni yılınız kutlu olsun! 2024 yılında nice başarılar ve mutluluklar dileriz.',\n    category: 'holiday'\n  },\n  {\n    id: 'ramadan-bayram',\n    name: 'Ramazan Bayramı',\n    content: 'Ramazan Bayramınız mübarek olsun! Sağlık, huzur ve bereket dolu günler dileriz.',\n    category: 'holiday'\n  },\n  {\n    id: 'kurban-bayram',\n    name: 'Kurban Bayramı',\n    content: 'Kurban Bayramınız mübarek olsun! Barış, kardeşlik ve paylaşımın hakim olduğu günler dileriz.',\n    category: 'holiday'\n  },\n  {\n    id: 'republic-day',\n    name: '29 Ekim Cumhuriyet Bayramı',\n    content: '29 Ekim Cumhuriyet Bayramımız kutlu olsun! Atatürk\\'ün izinde nice yıllar.',\n    category: 'holiday'\n  },\n  {\n    id: 'national-sovereignty',\n    name: '23 Nisan Ulusal Egemenlik',\n    content: '23 Nisan Ulusal Egemenlik ve Çocuk Bayramımız kutlu olsun! Çocuklarımızın geleceği aydınlık olsun.',\n    category: 'holiday'\n  },\n  {\n    id: 'youth-day',\n    name: '19 Mayıs Gençlik Bayramı',\n    content: '19 Mayıs Atatürk\\'ü Anma, Gençlik ve Spor Bayramımız kutlu olsun! Gençlerimiz ülkemizin geleceğidir.',\n    category: 'holiday'\n  },\n  {\n    id: 'victory-day',\n    name: '30 Ağustos Zafer Bayramı',\n    content: '30 Ağustos Zafer Bayramımız kutlu olsun! Büyük zaferin yıldönümünde gurur duyuyoruz.',\n    category: 'holiday'\n  },\n  {\n    id: 'teachers-day',\n    name: '24 Kasım Öğretmenler Günü',\n    content: 'Tüm öğretmenlerimizin 24 Kasım Öğretmenler Günü kutlu olsun! Emekleriniz için teşekkürler.',\n    category: 'holiday'\n  },\n  {\n    id: 'mothers-day',\n    name: 'Anneler Günü',\n    content: 'Tüm annelerimizin Anneler Günü kutlu olsun! Sevgi ve fedakarlıklarınız için teşekkürler.',\n    category: 'holiday'\n  },\n  {\n    id: 'fathers-day',\n    name: 'Babalar Günü',\n    content: 'Tüm babalarımızın Babalar Günü kutlu olsun! Destekleriniz ve sevginiz için teşekkürler.',\n    category: 'holiday'\n  },\n  {\n    id: 'womens-day',\n    name: '8 Mart Kadınlar Günü',\n    content: 'Tüm kadınlarımızın 8 Mart Dünya Kadınlar Günü kutlu olsun! Güçlü ve değerlisiniz.',\n    category: 'holiday'\n  },\n  {\n    id: 'workers-day',\n    name: '1 Mayıs İşçi Bayramı',\n    content: 'Tüm çalışanlarımızın 1 Mayıs İşçi Bayramı kutlu olsun! Emekleriniz için teşekkürler.',\n    category: 'holiday'\n  }\n];\n\nexport default function BulkSMSPage() {\n  const [, setLocation] = useLocation();\n  const [selectedTemplate, setSelectedTemplate] = useState<string>(\"\");\n  const [customMessage, setCustomMessage] = useState(\"\");\n  const [selectedRecipients, setSelectedRecipients] = useState<string[]>([]);\n  const [recipientType, setRecipientType] = useState<'all' | 'personnel' | 'customer'>('all');\n  const [templateCategory, setTemplateCategory] = useState<'all' | 'personnel' | 'customer' | 'campaign' | 'holiday'>('all');\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [showRecipients, setShowRecipients] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch personnel and customers\n  const { data: personnel = [] } = useQuery<any[]>({\n    queryKey: [\"/api/personnel\"],\n  });\n\n  const { data: customers = [] } = useQuery<any[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: smsHistory = [] } = useQuery<SMSHistory[]>({\n    queryKey: [\"/api/sms/history\"],\n  });\n\n\n\n  // Combine recipients\n  const allRecipients: SMSRecipient[] = [\n    ...personnel.map(p => ({\n      id: p.id,\n      name: p.name,\n      phone: p.phone || '',\n      type: 'personnel' as const\n    })),\n    ...customers.map(c => ({\n      id: c.id,\n      name: c.name,\n      phone: c.phone || '',\n      type: 'customer' as const\n    }))\n  ].filter(r => r.phone && r.phone.trim() !== ''); // Only include recipients with phone numbers\n  \n\n\n  const filteredRecipients = allRecipients.filter(r => {\n    const matchesType = recipientType === 'all' || r.type === recipientType;\n    const matchesSearch = searchTerm === '' || \n      r.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      r.phone.includes(searchTerm);\n    return matchesType && matchesSearch;\n  });\n\n  const filteredTemplates = smsTemplates.filter(t => \n    templateCategory === 'all' || t.category === templateCategory\n  );\n\n  const sendSMSMutation = useMutation({\n    mutationFn: async (data: {\n      message: string;\n      recipients: string[];\n      templateId?: string;\n    }) => {\n      return await apiRequest(\"/api/sms/send\", \"POST\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"SMS Gönderildi\",\n        description: \"Toplu SMS başarıyla gönderildi.\",\n      });\n      setCustomMessage(\"\");\n      setSelectedRecipients([]);\n      setSelectedTemplate(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/sms/history\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"SMS Gönderimi Başarısız\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleTemplateSelect = (templateId: string) => {\n    setSelectedTemplate(templateId);\n    const template = smsTemplates.find(t => t.id === templateId);\n    if (template) {\n      setCustomMessage(template.content);\n    }\n  };\n\n  const handleRecipientToggle = (recipientId: string) => {\n    setSelectedRecipients(prev => \n      prev.includes(recipientId) \n        ? prev.filter(id => id !== recipientId)\n        : [...prev, recipientId]\n    );\n  };\n\n  const handleSelectAll = () => {\n    if (selectedRecipients.length === filteredRecipients.length) {\n      setSelectedRecipients([]);\n    } else {\n      setSelectedRecipients(filteredRecipients.map(r => r.id));\n    }\n  };\n\n  const handleSendSMS = () => {\n    if (!customMessage.trim()) {\n      toast({\n        title: \"Hata\",\n        description: \"Mesaj içeriği boş olamaz.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (selectedRecipients.length === 0) {\n      toast({\n        title: \"Hata\", \n        description: \"En az bir alıcı seçmelisiniz.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const characterCount = customMessage.length;\n    const smsCount = Math.ceil(characterCount / 160);\n    const estimatedCost = selectedRecipients.length * smsCount * 0.08; // 0.08 TL per SMS\n\n    if (window.confirm(\n      `${selectedRecipients.length} kişiye ${smsCount} SMS gönderilecek.\\n` +\n      `Tahmini maliyet: ${estimatedCost.toFixed(2)} TL\\n` +\n      `Göndermek istediğinizden emin misiniz?`\n    )) {\n      sendSMSMutation.mutate({\n        message: customMessage,\n        recipients: selectedRecipients,\n        templateId: selectedTemplate || undefined\n      });\n    }\n  };\n\n  const messageLength = customMessage.length;\n  const smsCount = Math.ceil(messageLength / 160);\n  const estimatedCost = selectedRecipients.length * smsCount * 0.08;\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            className=\"text-gray-400 hover:text-white\"\n          >\n            <Home className=\"h-4 w-4\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Toplu SMS</h1>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* SMS Composition */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Template Selection */}\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <MessageSquare className=\"h-5 w-5 text-blue-400\" />\n                  SMS Şablonları\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div>\n                  <Label className=\"text-gray-300\">Kategori Filtresi</Label>\n                  <Select value={templateCategory} onValueChange={(value: any) => setTemplateCategory(value)}>\n                    <SelectTrigger className=\"bg-dark-accent border-gray-600 text-white\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-dark-secondary border-gray-600\">\n                      <SelectItem value=\"all\" className=\"text-white hover:bg-dark-accent\">\n                        Tüm Şablonlar\n                      </SelectItem>\n                      <SelectItem value=\"personnel\" className=\"text-white hover:bg-dark-accent\">\n                        Personel Şablonları\n                      </SelectItem>\n                      <SelectItem value=\"customer\" className=\"text-white hover:bg-dark-accent\">\n                        Müşteri Şablonları\n                      </SelectItem>\n                      <SelectItem value=\"campaign\" className=\"text-white hover:bg-dark-accent\">\n                        Kampanya Şablonları\n                      </SelectItem>\n                      <SelectItem value=\"holiday\" className=\"text-white hover:bg-dark-accent\">\n                        Tatil Şablonları\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <Label className=\"text-gray-300\">Şablon Seçimi</Label>\n                  <Select value={selectedTemplate} onValueChange={handleTemplateSelect}>\n                    <SelectTrigger className=\"bg-dark-accent border-gray-600 text-white\">\n                      <SelectValue placeholder=\"Hazır şablon seçin (opsiyonel)\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-dark-secondary border-gray-600\">\n                      {filteredTemplates.map(template => (\n                        <SelectItem key={template.id} value={template.id} className=\"text-white hover:bg-dark-accent\">\n                          {template.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Message Composition */}\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white\">Mesaj İçeriği</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <Label className=\"text-gray-300\">Mesaj Metni</Label>\n                    <Textarea\n                      value={customMessage}\n                      onChange={(e) => setCustomMessage(e.target.value)}\n                      placeholder=\"SMS mesajınızı yazın...\"\n                      className=\"bg-dark-accent border-gray-600 text-white min-h-[120px]\"\n                      maxLength={1000}\n                    />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between text-sm\">\n                    <div className=\"text-gray-400\">\n                      <span className={messageLength > 160 ? 'text-orange-400' : ''}>\n                        {messageLength}/160 karakter\n                      </span>\n                      {smsCount > 1 && (\n                        <span className=\"ml-2 text-orange-400\">\n                          ({smsCount} SMS)\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"text-gray-400\">\n                      Tahmini maliyet: {estimatedCost.toFixed(2)} TL\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Recipients */}\n          <div className=\"space-y-6\">\n            <Card className=\"bg-dark-secondary border-dark-accent\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Users className=\"h-5 w-5 text-green-400\" />\n                  Alıcılar ({selectedRecipients.length})\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <Label className=\"text-gray-300\">Alıcı Türü</Label>\n                    <Select value={recipientType} onValueChange={(value: any) => setRecipientType(value)}>\n                      <SelectTrigger className=\"bg-dark-accent border-gray-600 text-white\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent className=\"bg-dark-secondary border-gray-600\">\n                        <SelectItem value=\"all\" className=\"text-white hover:bg-dark-accent\">\n                          Tüm Kişiler\n                        </SelectItem>\n                        <SelectItem value=\"personnel\" className=\"text-white hover:bg-dark-accent\">\n                          Sadece Personel\n                        </SelectItem>\n                        <SelectItem value=\"customer\" className=\"text-white hover:bg-dark-accent\">\n                          Sadece Müşteriler\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div>\n                    <Label className=\"text-gray-300\">Kişi Ara</Label>\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                      <Input\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        placeholder=\"İsim veya telefon numarası...\"\n                        className=\"bg-dark-accent border-gray-600 text-white pl-10\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={handleSelectAll}\n                      className=\"border-gray-600 text-gray-300 hover:bg-dark-accent\"\n                    >\n                      {selectedRecipients.length === filteredRecipients.length ? 'Tümünü Kaldır' : 'Tümünü Seç'}\n                    </Button>\n                    \n                    {filteredRecipients.length > 0 && (\n                      <div className=\"text-xs text-gray-400\">\n                        {filteredRecipients.length} kişi listelendi\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Recipients Dropdown */}\n                  <div className=\"space-y-2\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => setShowRecipients(!showRecipients)}\n                      className=\"w-full border-gray-600 text-gray-300 hover:bg-dark-accent flex items-center justify-between\"\n                    >\n                      <span>\n                        {selectedRecipients.length > 0 \n                          ? `${selectedRecipients.length} kişi seçildi` \n                          : 'Alıcı seç'}\n                      </span>\n                      {showRecipients ? (\n                        <ChevronUp className=\"h-4 w-4\" />\n                      ) : (\n                        <ChevronDown className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n\n                    {showRecipients && (\n                      <div className=\"border border-gray-600 rounded-md bg-dark-accent max-h-48 overflow-y-auto\">\n                        {filteredRecipients.length === 0 ? (\n                          <div className=\"p-4 text-center text-gray-400\">\n                            Telefon numarası olan kişi bulunamadı\n                          </div>\n                        ) : (\n                          <div className=\"p-2 space-y-1\">\n                            {filteredRecipients.map(recipient => (\n                              <div\n                                key={recipient.id}\n                                className=\"flex items-center space-x-2 p-2 rounded hover:bg-dark-secondary cursor-pointer\"\n                                onClick={() => handleRecipientToggle(recipient.id)}\n                              >\n                                <Checkbox\n                                  checked={selectedRecipients.includes(recipient.id)}\n                                  onCheckedChange={(checked) => {\n                                    handleRecipientToggle(recipient.id);\n                                  }}\n                                  onClick={(e) => e.stopPropagation()}\n                                />\n                                <div className=\"flex-1 min-w-0\">\n                                  <p className=\"text-white text-sm font-medium truncate\">\n                                    {recipient.name}\n                                  </p>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Phone className=\"h-3 w-3 text-gray-400\" />\n                                    <p className=\"text-gray-400 text-xs\">\n                                      {recipient.phone}\n                                    </p>\n                                  </div>\n                                </div>\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  {recipient.type === 'personnel' ? 'Personel' : 'Müşteri'}\n                                </Badge>\n                              </div>\n                            ))}\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Send Button */}\n            <Button\n              onClick={handleSendSMS}\n              disabled={sendSMSMutation.isPending}\n              className={`w-full text-white ${\n                sendSMSMutation.isPending \n                  ? 'bg-gray-500' \n                  : !customMessage.trim() || selectedRecipients.length === 0\n                    ? 'bg-gray-600 hover:bg-gray-700'\n                    : 'bg-green-500 hover:bg-green-600'\n              }`}\n            >\n              <Send className=\"h-4 w-4 mr-2\" />\n              {sendSMSMutation.isPending ? \"Gönderiliyor...\" : \"SMS Gönder\"}\n            </Button>\n          </div>\n        </div>\n\n        {/* SMS History */}\n        <Card className=\"bg-dark-secondary border-dark-accent mt-6\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <Clock className=\"h-5 w-5 text-purple-400\" />\n              SMS Geçmişi\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {smsHistory.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <MessageSquare className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-400\">Henüz SMS gönderimi yapılmamış</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {smsHistory.map(sms => (\n                  <div\n                    key={sms.id}\n                    className=\"flex items-center justify-between p-3 border border-gray-600 rounded hover:bg-dark-accent\"\n                  >\n                    <div className=\"flex-1\">\n                      <p className=\"text-white text-sm line-clamp-2 mb-1\">\n                        {sms.message}\n                      </p>\n                      <div className=\"flex items-center gap-4 text-xs text-gray-400\">\n                        <span>{sms.recipientCount} kişi</span>\n                        <span>{new Date(sms.sentAt).toLocaleString('tr-TR')}</span>\n                        <span>{typeof sms.cost === 'number' ? sms.cost.toFixed(2) : parseFloat(sms.cost || '0').toFixed(2)} TL</span>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {sms.status === 'sent' && (\n                        <CheckCircle className=\"h-4 w-4 text-green-400\" />\n                      )}\n                      {sms.status === 'failed' && (\n                        <XCircle className=\"h-4 w-4 text-red-400\" />\n                      )}\n                      {sms.status === 'pending' && (\n                        <Clock className=\"h-4 w-4 text-yellow-400\" />\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":24231},"client/src/pages/customers-old.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { ArrowLeft, Plus, User, Edit, Trash2, Building2, Phone, Mail, DollarSign, TrendingUp, TrendingDown } from \"lucide-react\";\nimport { type Customer, type CustomerTask, type CustomerPayment } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport Header from \"@/components/layout/header\";\nimport AdvancedFilters, { type FilterOptions } from \"@/components/filters/advanced-filters\";\nimport CustomerForm from \"@/components/forms/customer-form-new\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\nexport default function CustomersPage() {\n  const [, setLocation] = useLocation();\n  const [showCustomerForm, setShowCustomerForm] = useState(false);\n  const [editingCustomer, setEditingCustomer] = useState<Customer | null>(null);\n  const [filters, setFilters] = useState<FilterOptions>({\n    search: \"\",\n    dateFrom: \"\",\n    dateTo: \"\",\n    status: \"\",\n    type: \"\",\n    personnel: \"\",\n  });\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: customers = [], isLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: allCustomerTasks = [] } = useQuery<CustomerTask[]>({\n    queryKey: [\"/api/customer-tasks\"],\n  });\n\n  const { data: allCustomerPayments = [] } = useQuery<CustomerPayment[]>({\n    queryKey: [\"/api/customer-payments\"],\n  });\n\n  const deleteCustomerMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(`/api/customers/${id}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Müşteri kaydı silindi.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: \"Müşteri kaydı silinemedi.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEditCustomer = (customer: Customer) => {\n    setEditingCustomer(customer);\n    setShowCustomerForm(true);\n  };\n\n  const onSubmit = (data: InsertCustomer) => {\n    const cleanedData = {\n      ...data,\n      company: data.company?.trim() || null,\n      phone: data.phone?.trim() || null,\n      email: data.email?.trim() || null,\n      address: data.address?.trim() || null,\n      taxNumber: data.taxNumber?.trim() || null,\n    };\n\n    if (editingCustomer) {\n      updateCustomerMutation.mutate({ id: editingCustomer.id, data: cleanedData });\n    } else {\n      createCustomerMutation.mutate(cleanedData);\n    }\n  };\n\n  const handleFilterChange = (newFilters: FilterOptions) => {\n    setFilters(newFilters);\n  };\n\n  const handleExport = (format: 'csv' | 'pdf') => {\n    toast({\n      title: \"Dışa Aktarma\",\n      description: `${format.toUpperCase()} formatında dışa aktarılıyor...`,\n    });\n  };\n\n  // Filter customers based on search and filters\n  const filteredCustomers = customers.filter(customer => {\n    const matchesSearch = !filters.search || \n      customer.name.toLowerCase().includes(filters.search.toLowerCase()) ||\n      customer.company?.toLowerCase().includes(filters.search.toLowerCase()) ||\n      customer.email?.toLowerCase().includes(filters.search.toLowerCase());\n    \n    const matchesStatus = !filters.status || filters.status === \"all\" || customer.status === filters.status;\n    \n    return matchesSearch && matchesStatus;\n  });\n\n  // Helper functions\n  const getCustomerTasks = (customerId: string) => {\n    return allCustomerTasks.filter(task => task.customerId === customerId);\n  };\n\n  const getCustomerPayments = (customerId: string) => {\n    return allCustomerPayments.filter(payment => payment.customerId === customerId);\n  };\n\n  const formatCurrency = (amount: string | number) => {\n    return new Intl.NumberFormat('tr-TR', {\n      style: 'currency',\n      currency: 'TRY',\n      minimumFractionDigits: 0,\n    }).format(typeof amount === 'string' ? parseFloat(amount) : amount);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary text-white\">\n        <Header />\n        <div className=\"p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <p className=\"text-gray-400\">Yükleniyor...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary text-white\">\n      <Header />\n      \n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            className=\"text-gray-400 hover:text-white\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n          <h1 className=\"text-2xl font-bold\">Müşteri Yönetimi</h1>\n        </div>\n\n        <AdvancedFilters\n          onFilterChange={handleFilterChange}\n          onExport={handleExport}\n          exportData={filteredCustomers}\n          exportTitle=\"Müşteriler\"\n        />\n\n        <div className=\"mb-6 mt-6\">\n          <Button\n            className=\"bg-blue-500 hover:bg-blue-600 text-white\"\n            onClick={() => setShowCustomerForm(true)}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Yeni Müşteri\n          </Button>\n        </div>\n\n        {filteredCustomers.length === 0 ? (\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"py-12 text-center\">\n              <User className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-400 text-lg mb-2\">\n                {filters.search ? \"Arama kriterlerine uygun müşteri bulunamadı\" : \"Henüz müşteri eklenmemiş\"}\n              </p>\n              <p className=\"text-gray-500 text-sm\">\n                {filters.search ? \"Farklı anahtar kelimeler deneyin\" : \"Yeni müşteri eklemek için yukarıdaki butonu kullanın.\"}\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-3\">\n            {filteredCustomers.map((customer) => {\n              const customerTasks = getCustomerTasks(customer.id);\n              const customerPayments = getCustomerPayments(customer.id);\n              const totalTaskAmount = customerTasks.reduce((sum, task) => sum + parseFloat(task.amount), 0);\n              const totalPaidAmount = customerPayments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0);\n              const remainingAmount = totalTaskAmount - totalPaidAmount;\n\n              return (\n                <Card key={customer.id} className=\"bg-dark-secondary border-dark-accent\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex justify-between items-start\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                          <User className=\"h-5 w-5 text-blue-400\" />\n                          <button\n                            className=\"text-white font-medium text-lg hover:text-blue-400 underline cursor-pointer\"\n                            onClick={() => setLocation(`/customers/${encodeURIComponent(customer.name)}`)}\n                          >\n                            {customer.name}\n                          </button>\n                          <span className={`text-sm px-2 py-1 rounded ${\n                            customer.status === \"active\" ? \"text-green-400 bg-green-400/10\" : \"text-gray-400 bg-gray-400/10\"\n                          }`}>\n                            {customer.status === \"active\" ? \"Aktif\" : \"Pasif\"}\n                          </span>\n                        </div>\n                      \n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\">\n                        {customer.company && (\n                          <div className=\"flex items-center gap-2\">\n                            <Building2 className=\"h-4 w-4 text-gray-400\" />\n                            <div>\n                              <p className=\"text-gray-400\">Şirket</p>\n                              <p className=\"text-white\">{customer.company}</p>\n                            </div>\n                          </div>\n                        )}\n                        \n                        {customer.phone && (\n                          <div className=\"flex items-center gap-2\">\n                            <Phone className=\"h-4 w-4 text-gray-400\" />\n                            <div>\n                              <p className=\"text-gray-400\">Telefon</p>\n                              <p className=\"text-white\">{customer.phone}</p>\n                            </div>\n                          </div>\n                        )}\n                        \n                        {customer.email && (\n                          <div className=\"flex items-center gap-2\">\n                            <Mail className=\"h-4 w-4 text-gray-400\" />\n                            <div>\n                              <p className=\"text-gray-400\">E-posta</p>\n                              <p className=\"text-white\">{customer.email}</p>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n\n                      {customer.address && (\n                        <div className=\"mt-3\">\n                          <p className=\"text-gray-400 text-sm\">Adres</p>\n                          <p className=\"text-gray-300 text-sm\">{customer.address}</p>\n                        </div>\n                      )}\n\n                      {customer.taxNumber && (\n                        <div className=\"mt-2\">\n                          <p className=\"text-gray-400 text-sm\">Vergi No</p>\n                          <p className=\"text-gray-300 text-sm\">{customer.taxNumber}</p>\n                        </div>\n                      )}\n\n                      {/* Financial Summary */}\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 p-3 bg-dark-primary rounded-lg\">\n                        <div className=\"text-center\">\n                          <div className=\"flex items-center justify-center gap-2 mb-1\">\n                            <TrendingUp className=\"h-4 w-4 text-blue-400\" />\n                            <p className=\"text-gray-400 text-sm\">Toplam İş</p>\n                          </div>\n                          <p className=\"text-blue-400 font-semibold\">{formatCurrency(totalTaskAmount)}</p>\n                          <p className=\"text-gray-500 text-xs\">{customerTasks.length} adet</p>\n                        </div>\n                        \n                        <div className=\"text-center\">\n                          <div className=\"flex items-center justify-center gap-2 mb-1\">\n                            <TrendingDown className=\"h-4 w-4 text-green-400\" />\n                            <p className=\"text-gray-400 text-sm\">Ödenen</p>\n                          </div>\n                          <p className=\"text-green-400 font-semibold\">{formatCurrency(totalPaidAmount)}</p>\n                          <p className=\"text-gray-500 text-xs\">{customerPayments.length} ödeme</p>\n                        </div>\n                        \n                        <div className=\"text-center\">\n                          <div className=\"flex items-center justify-center gap-2 mb-1\">\n                            <DollarSign className=\"h-4 w-4 text-orange-400\" />\n                            <p className=\"text-gray-400 text-sm\">Kalan</p>\n                          </div>\n                          <p className={`font-semibold ${remainingAmount > 0 ? 'text-orange-400' : 'text-gray-400'}`}>\n                            {formatCurrency(remainingAmount)}\n                          </p>\n                          <p className=\"text-gray-500 text-xs\">\n                            {remainingAmount > 0 ? 'Alacak' : 'Tamam'}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex gap-2 ml-4\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-blue-400 hover:text-blue-300 hover:bg-dark-accent\"\n                        onClick={() => handleEditCustomer(customer)}\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-red-400 hover:text-red-300 hover:bg-dark-accent\"\n                        onClick={() => deleteCustomerMutation.mutate(customer.id)}\n                        disabled={deleteCustomerMutation.isPending}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Customer Form Dialog - NEW */}\n      <CustomerForm \n        open={showCustomerForm} \n        onOpenChange={(open) => {\n          setShowCustomerForm(open);\n          if (!open) setEditingCustomer(null);\n        }}\n        customer={editingCustomer || undefined}\n      />\n        <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-semibold\">\n              {editingCustomer ? \"Müşteri Düzenle\" : \"Yeni Müşteri\"}\n            </DialogTitle>\n            <DialogDescription className=\"text-gray-400\">\n              {editingCustomer ? \"Mevcut müşteri bilgilerini düzenleyin\" : \"Yeni müşteri bilgilerini girin\"}\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Müşteri Adı *</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Müşteri adını girin\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"company\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Şirket</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Şirket adını girin\"\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Telefon</FormLabel>\n                      <FormControl>\n                        <Input\n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Telefon numarası\"\n                          value={field.value || \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          ref={field.ref}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">E-posta</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"E-posta adresi\"\n                          value={field.value || \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          ref={field.ref}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"address\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Adres</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        className=\"bg-dark-primary border-dark-accent text-white h-20\"\n                        placeholder=\"Müşteri adresi\"\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"taxNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Vergi No</FormLabel>\n                      <FormControl>\n                        <Input\n                          className=\"bg-dark-primary border-dark-accent text-white\"\n                          placeholder=\"Vergi numarası\"\n                          value={field.value || \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          ref={field.ref}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-300\">Durum</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                            <SelectValue placeholder=\"Durum seçin\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                          <SelectItem value=\"active\" className=\"text-white\">Aktif</SelectItem>\n                          <SelectItem value=\"inactive\" className=\"text-white\">Pasif</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"flex gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white\"\n                  onClick={handleCloseForm}\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white\"\n                  disabled={createCustomerMutation.isPending || updateCustomerMutation.isPending}\n                >\n                  {(createCustomerMutation.isPending || updateCustomerMutation.isPending) \n                    ? \"Kaydediliyor...\" \n                    : editingCustomer \n                      ? \"Güncelle\" \n                      : \"Kaydet\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":21423},"client/src/pages/logout.tsx":{"content":"import { useEffect } from 'react';\nimport { apiRequest } from '@/lib/queryClient';\n\nexport default function Logout() {\n  useEffect(() => {\n    // Call logout API to clear cookie and redirect\n    const performLogout = async () => {\n      try {\n        await apiRequest('/api/auth/logout', 'POST');\n      } catch (error) {\n        console.error('Logout error:', error);\n      } finally {\n        // Clear any remaining client-side data and redirect\n        localStorage.clear();\n        sessionStorage.clear();\n        window.location.href = '/';\n      }\n    };\n    \n    performLogout();\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary flex items-center justify-center\">\n      <div className=\"text-white\">Çıkış yapılıyor...</div>\n    </div>\n  );\n}","size_bytes":774},"client/src/components/admin/admin-layout.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { \n  Settings, \n  Users, \n  CreditCard, \n  BarChart3, \n  Bell, \n  MessageSquare,\n  FileText,\n  Home,\n  LogOut\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\n\ninterface AdminLayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function AdminLayout({ children }: AdminLayoutProps) {\n  const [location] = useLocation();\n\n  const sidebarItems = [\n    { href: \"/admin/dashboard\", icon: Home, label: \"Ana Sayfa\" },\n    { href: \"/admin/users\", icon: Users, label: \"Kullanıcılar\" },\n    { href: \"/admin/payment-settings\", icon: CreditCard, label: \"Ödeme Ayarları\" },\n    { href: \"/admin/payment-notifications\", icon: Bell, label: \"Ödeme Bildirimleri\" },\n    { href: \"/admin/system-settings\", icon: Settings, label: \"Sistem Ayarları\" },\n    { href: \"/admin/analytics\", icon: BarChart3, label: \"Analitik\" },\n    { href: \"/admin/messages\", icon: MessageSquare, label: \"Mesajlar\" },\n    { href: \"/admin/reports\", icon: FileText, label: \"Raporlar\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary\">\n      {/* Header */}\n      <header className=\"bg-dark-secondary border-b border-dark-accent\">\n        <div className=\"flex items-center justify-between px-6 py-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center\">\n              <Settings className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-bold text-white\">Admin Panel</h1>\n              <p className=\"text-sm text-gray-400\">puantropls Yönetimi</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <Link href=\"/\">\n              <Button variant=\"outline\" size=\"sm\" className=\"border-gray-600 text-gray-300 hover:bg-dark-accent\">\n                <Home className=\"w-4 h-4 mr-2\" />\n                Ana Sayfaya Dön\n              </Button>\n            </Link>\n            <Link href=\"/api/auth/logout\">\n              <Button variant=\"outline\" size=\"sm\" className=\"border-gray-600 text-gray-300 hover:bg-dark-accent\">\n                <LogOut className=\"w-4 h-4 mr-2\" />\n                Çıkış\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex\">\n        {/* Sidebar */}\n        <aside className=\"w-64 bg-dark-secondary border-r border-dark-accent min-h-[calc(100vh-73px)]\">\n          <nav className=\"p-4 space-y-2\">\n            {sidebarItems.map((item) => {\n              const isActive = location === item.href;\n              return (\n                <Link key={item.href} href={item.href}>\n                  <Button\n                    variant={isActive ? \"default\" : \"ghost\"}\n                    className={`w-full justify-start ${\n                      isActive \n                        ? \"bg-blue-600 text-white\" \n                        : \"text-gray-300 hover:bg-dark-accent hover:text-white\"\n                    }`}\n                  >\n                    <item.icon className=\"w-4 h-4 mr-3\" />\n                    {item.label}\n                  </Button>\n                </Link>\n              );\n            })}\n          </nav>\n        </aside>\n\n        {/* Main Content */}\n        <main className=\"flex-1 p-6\">\n          <Card className=\"bg-dark-secondary border-dark-accent p-6\">\n            {children}\n          </Card>\n        </main>\n      </div>\n    </div>\n  );\n}","size_bytes":3545},"client/src/components/cards/draggable-navigation-card.tsx":{"content":"import { useRef } from \"react\";\nimport { useDrag, useDrop } from \"react-dnd\";\nimport { LucideIcon } from \"lucide-react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\ninterface DraggableNavigationCardProps {\n  id: string;\n  index: number;\n  icon: LucideIcon;\n  label: string;\n  onClick: () => void;\n  iconColor: string;\n  moveCard: (dragIndex: number, hoverIndex: number) => void;\n}\n\nconst ItemType = \"NAVIGATION_CARD\";\n\nexport default function DraggableNavigationCard({\n  id,\n  index,\n  icon: Icon,\n  label,\n  onClick,\n  iconColor,\n  moveCard,\n}: DraggableNavigationCardProps) {\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [{ handlerId }, drop] = useDrop<\n    { index: number; id: string },\n    void,\n    { handlerId: string | symbol | null }\n  >({\n    accept: ItemType,\n    collect(monitor) {\n      return {\n        handlerId: monitor.getHandlerId(),\n      };\n    },\n    hover(item, monitor) {\n      if (!ref.current) {\n        return;\n      }\n      const dragIndex = item.index;\n      const hoverIndex = index;\n\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      const clientOffset = monitor.getClientOffset();\n      const hoverClientY = clientOffset!.y - hoverBoundingRect.top;\n\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n\n      moveCard(dragIndex, hoverIndex);\n      item.index = hoverIndex;\n    },\n  });\n\n  const [{ isDragging }, drag] = useDrag({\n    type: ItemType,\n    item: () => {\n      return { id, index };\n    },\n    collect: (monitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const opacity = isDragging ? 0.4 : 1;\n  drag(drop(ref));\n\n  return (\n    <div ref={ref} style={{ opacity }} data-handler-id={handlerId}>\n      <Card \n        className=\"bg-dark-secondary border-dark-accent hover:bg-dark-accent transition-all duration-200 cursor-pointer group\"\n        onClick={onClick}\n      >\n        <CardContent className=\"p-6 text-center\">\n          <Icon className={`h-8 w-8 mx-auto mb-3 ${iconColor} group-hover:scale-110 transition-transform`} />\n          <p className=\"text-white font-medium\">{label}</p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":2431},"client/src/components/forms/contractor-task-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { insertContractorTaskSchema, type InsertContractorTask } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { CalendarIcon } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface ContractorTaskFormProps {\n  contractorId: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  editingTask?: any;\n}\n\nexport default function ContractorTaskForm({ contractorId, open, onOpenChange, editingTask }: ContractorTaskFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<InsertContractorTask>({\n    resolver: zodResolver(insertContractorTaskSchema),\n    defaultValues: {\n      contractorId,\n      title: editingTask?.title || \"\",\n      description: editingTask?.description || \"\",\n      amount: editingTask?.amount || \"\",\n      status: editingTask?.status || \"pending\",\n      dueDate: editingTask?.dueDate ? new Date(editingTask.dueDate) : undefined,\n    },\n  });\n\n  const createTaskMutation = useMutation({\n    mutationFn: async (data: InsertContractorTask) => {\n      const url = editingTask ? `/api/contractor-tasks/${editingTask.id}` : \"/api/contractor-tasks\";\n      const method = editingTask ? \"PUT\" : \"POST\";\n      const response = await fetch(url, {\n        method,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error(`Failed to ${editingTask ? 'update' : 'create'} task`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contractor-tasks\"] });\n      queryClient.invalidateQueries({ queryKey: ['/api/contractor-tasks/contractor/' + contractorId] });\n      toast({\n        title: \"Başarılı\",\n        description: editingTask ? \"Görev başarıyla güncellendi.\" : \"Görev başarıyla eklendi.\",\n      });\n      form.reset({\n        contractorId,\n        title: \"\",\n        description: \"\",\n        amount: \"\",\n        status: \"pending\",\n        dueDate: undefined,\n      });\n      onOpenChange(false);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Hata\",\n        description: editingTask ? \"Görev güncellenirken bir hata oluştu.\" : \"Görev eklenirken bir hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Form değerlerini editingTask değiştiğinde güncelle\n  useEffect(() => {\n    if (editingTask) {\n      form.reset({\n        contractorId,\n        title: editingTask.title || \"\",\n        description: editingTask.description || \"\",\n        amount: editingTask.amount || \"\",\n        status: editingTask.status || \"pending\",\n        dueDate: editingTask.dueDate ? new Date(editingTask.dueDate) : undefined,\n      });\n    } else {\n      form.reset({\n        contractorId,\n        title: \"\",\n        description: \"\",\n        amount: \"\",\n        status: \"pending\",\n        dueDate: undefined,\n      });\n    }\n  }, [editingTask, contractorId, form]);\n\n  const onSubmit = (data: InsertContractorTask) => {\n    createTaskMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[450px] max-h-[85vh] overflow-y-auto bg-dark-secondary border-dark-accent\">\n        <DialogHeader>\n          <DialogTitle className=\"text-white\">\n            {editingTask ? \"Görevi Düzenle\" : \"Yeni Görev Ekle\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3\">\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-white\">Görev Başlığı</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"Görev başlığını giriniz\"\n                      className=\"bg-dark-primary border-dark-accent text-white placeholder:text-gray-400\"\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-white\">Açıklama</FormLabel>\n                  <FormControl>\n                    <Textarea \n                      placeholder=\"Görev açıklaması\"\n                      className=\"bg-dark-primary border-dark-accent text-white placeholder:text-gray-400\"\n                      rows={2}\n                      {...field}\n                      value={field.value || \"\"} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"amount\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-white\">Tutar (₺)</FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"0.00\"\n                      className=\"bg-dark-primary border-dark-accent text-white placeholder:text-gray-400\"\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"status\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-white\">Durum</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                        <SelectValue placeholder=\"Durum seçiniz\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                      <SelectItem value=\"pending\">Bekliyor</SelectItem>\n                      <SelectItem value=\"in_progress\">Devam Ediyor</SelectItem>\n                      <SelectItem value=\"completed\">Tamamlandı</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"dueDate\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-col\">\n                  <FormLabel className=\"text-white\">Bitiş Tarihi</FormLabel>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <FormControl>\n                        <Button\n                          variant=\"outline\"\n                          className=\"bg-dark-primary border-dark-accent text-white hover:bg-dark-accent w-full pl-3 text-left font-normal\"\n                        >\n                          {field.value ? (\n                            format(field.value, \"dd/MM/yyyy\")\n                          ) : (\n                            <span className=\"text-gray-400\">Tarih seçiniz</span>\n                          )}\n                          <CalendarIcon className=\"ml-auto h-4 w-4 opacity-50\" />\n                        </Button>\n                      </FormControl>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-auto p-0 bg-dark-secondary border-dark-accent\" align=\"start\">\n                      <Calendar\n                        mode=\"single\"\n                        selected={field.value || undefined}\n                        onSelect={field.onChange}\n                        disabled={(date) => date < new Date()}\n                        initialFocus\n                      />\n                    </PopoverContent>\n                  </Popover>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex gap-3 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => onOpenChange(false)}\n                className=\"flex-1 bg-transparent border-dark-accent text-white hover:bg-dark-accent\"\n              >\n                İptal\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createTaskMutation.isPending}\n                className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white\"\n              >\n                {createTaskMutation.isPending ? \"Ekleniyor...\" : \"Görev Ekle\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":9879},"client/src/components/forms/customer-form-new.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { insertCustomerSchema, type InsertCustomer, type Customer } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ninterface CustomerFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  customer?: Customer;\n}\n\nexport default function CustomerForm({ open, onOpenChange, customer }: CustomerFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [loading, setLoading] = useState(false);\n\n  const form = useForm<InsertCustomer>({\n    resolver: zodResolver(insertCustomerSchema),\n    defaultValues: {\n      name: customer?.name ?? \"\",\n      company: customer?.company ?? \"\",\n      phone: customer?.phone ?? \"\",\n      email: customer?.email ?? \"\",\n      address: customer?.address ?? \"\",\n      taxNumber: customer?.taxNumber ?? \"\",\n      status: customer?.status ?? \"active\",\n    },\n  });\n\n  const handleSubmit = async (data: InsertCustomer) => {\n    console.log(\"🔥 NEW FORM - Submit started!\", data);\n    setLoading(true);\n\n    try {\n      const payload = {\n        name: data.name,\n        company: data.company || null,\n        phone: data.phone || null,\n        email: data.email || null,\n        address: data.address || null,\n        taxNumber: data.taxNumber || null,\n        status: data.status,\n      };\n\n      let result;\n      if (customer) {\n        console.log(\"🔥 Updating customer...\", payload);\n        result = await apiRequest(`/api/customers/${customer.id}`, \"PUT\", payload);\n      } else {\n        console.log(\"🔥 Creating customer...\", payload);\n        result = await apiRequest(\"/api/customers\", \"POST\", payload);\n      }\n\n      console.log(\"🔥 SUCCESS!\", result);\n      \n      toast({\n        title: \"Başarılı\",\n        description: customer ? \"Müşteri güncellendi.\" : \"Müşteri oluşturuldu.\",\n      });\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      form.reset();\n      onOpenChange(false);\n\n    } catch (error) {\n      console.error(\"🔥 ERROR:\", error);\n      toast({\n        title: \"Hata\",\n        description: \"İşlem başarısız.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[85vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-lg font-semibold text-white\">\n            {customer ? \"Müşteri Düzenle\" : \"Yeni Müşteri\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-3\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300 text-sm\">Müşteri Adı *</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white h-9\"\n                      placeholder=\"Müşteri adı\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"company\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300 text-sm\">Şirket</FormLabel>\n                  <FormControl>\n                    <Input\n                      className=\"bg-dark-primary border-dark-accent text-white h-9\"\n                      placeholder=\"Şirket adı\"\n                      value={field.value ?? \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-2 gap-3\">\n              <FormField\n                control={form.control}\n                name=\"phone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300 text-sm\">Telefon</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white h-9\"\n                        placeholder=\"Telefon\"\n                        value={field.value ?? \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300 text-sm\">E-posta</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white h-9\"\n                        placeholder=\"E-posta\"\n                        value={field.value ?? \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"address\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300 text-sm\">Adres</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      className=\"bg-dark-primary border-dark-accent text-white resize-none\"\n                      placeholder=\"Adres bilgisi\"\n                      rows={2}\n                      value={field.value ?? \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-2 gap-3\">\n              <FormField\n                control={form.control}\n                name=\"taxNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300 text-sm\">Vergi No</FormLabel>\n                    <FormControl>\n                      <Input\n                        className=\"bg-dark-primary border-dark-accent text-white h-9\"\n                        placeholder=\"Vergi No\"\n                        value={field.value ?? \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"status\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300 text-sm\">Durum</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white h-9\">\n                          <SelectValue placeholder=\"Durum\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent className=\"bg-dark-secondary border-dark-accent\">\n                        <SelectItem value=\"active\" className=\"text-white hover:bg-dark-accent\">Aktif</SelectItem>\n                        <SelectItem value=\"inactive\" className=\"text-white hover:bg-dark-accent\">Pasif</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <div className=\"flex gap-2 pt-3\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => onOpenChange(false)}\n                className=\"border-dark-accent text-white hover:bg-dark-accent h-9\"\n                size=\"sm\"\n              >\n                İptal\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={loading}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white h-9\"\n                size=\"sm\"\n              >\n                {loading ? \"Kaydediliyor...\" : customer ? \"Güncelle\" : \"Kaydet\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":10138},"client/src/components/forms/timesheet-form-old.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { insertTimesheetSchema, type InsertTimesheet, type Personnel, type Customer, type Timesheet } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { X } from \"lucide-react\";\nimport { useState } from \"react\";\n\ninterface TimesheetFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  editingTimesheet?: Timesheet | null;\n}\n\nexport default function TimesheetForm({ open, onOpenChange, editingTimesheet }: TimesheetFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const [selectedPersonnelIds, setSelectedPersonnelIds] = useState<string[]>([]);\n  const [workType, setWorkType] = useState<string>(\"\");\n  const [showPersonnelDropdown, setShowPersonnelDropdown] = useState(false);\n\n  const form = useForm<InsertTimesheet>({\n    resolver: zodResolver(insertTimesheetSchema),\n    defaultValues: {\n      personnelId: editingTimesheet?.personnelId || \"\",\n      customerId: editingTimesheet?.customerId || \"\",\n      date: editingTimesheet?.date ? new Date(editingTimesheet.date) : new Date(),\n      workType: editingTimesheet?.workType || \"tam\",\n      startTime: editingTimesheet?.startTime || \"08:00\",\n      endTime: editingTimesheet?.endTime || \"17:00\",\n      totalHours: editingTimesheet?.totalHours || \"8.00\",\n      overtimeHours: editingTimesheet?.overtimeHours || \"0.00\",\n      hourlyRate: editingTimesheet?.hourlyRate || \"0.00\",\n      dailyWage: editingTimesheet?.dailyWage || \"0.00\",\n      notes: editingTimesheet?.notes || \"\",\n    },\n  });\n\n  const { data: personnel = [] } = useQuery<Personnel[]>({\n    queryKey: [\"/api/personnel\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  // Dialog açıldığında değerleri güncelle\n  const handleDialogOpen = () => {\n    if (editingTimesheet) {\n      setSelectedPersonnelIds([editingTimesheet.personnelId || \"\"]);\n      setWorkType(editingTimesheet.workType || \"tam\");\n      form.reset({\n        personnelId: editingTimesheet.personnelId || \"\",\n        customerId: editingTimesheet.customerId || \"\",\n        date: editingTimesheet.date ? new Date(editingTimesheet.date) : new Date(),\n        workType: editingTimesheet.workType || \"tam\",\n        startTime: editingTimesheet.startTime || \"08:00\",\n        endTime: editingTimesheet.endTime || \"17:00\",\n        totalHours: editingTimesheet.totalHours || \"8.00\",\n        overtimeHours: editingTimesheet.overtimeHours || \"0.00\",\n        hourlyRate: editingTimesheet.hourlyRate || \"0.00\",\n        dailyWage: editingTimesheet.dailyWage || \"0.00\",\n        notes: editingTimesheet.notes || \"\",\n      });\n    } else {\n      setSelectedPersonnelIds([]);\n      setWorkType(\"tam\");\n      form.reset({\n        personnelId: \"\",\n        customerId: \"\",\n        date: new Date(),\n        workType: \"tam\",\n        startTime: \"08:00\",\n        endTime: \"17:00\",\n        totalHours: \"8.00\",\n        overtimeHours: \"0.00\",\n        hourlyRate: \"0.00\",\n        dailyWage: \"0.00\",\n        notes: \"\",\n      });\n    }\n  };\n\n\n\n  const createTimesheetMutation = useMutation({\n    mutationFn: async (data: InsertTimesheet) => {\n      if (editingTimesheet) {\n        // Düzenleme modu - tek kayıt güncelle\n        const response = await apiRequest(`/api/timesheets/${editingTimesheet.id}`, \"PUT\", data);\n        return response.json();\n      } else {\n        // Yeni kayıt modu - seçili personeller için toplu kayıt\n        const promises = selectedPersonnelIds.map(async (personnelId) => {\n          const personnelData = personnel.find(p => p.id === personnelId);\n          if (!personnelData) return null;\n          \n          const salary = parseFloat(personnelData.salary || \"0\");\n          const dailyWage = salary / 30;\n          \n          let totalHours = \"8.00\";\n          let hourlyRate = \"0.00\";\n          let calculatedWage = \"0.00\";\n          \n          switch (workType) {\n            case \"tam\":\n              totalHours = \"8.00\";\n              calculatedWage = dailyWage.toFixed(2);\n              hourlyRate = (dailyWage / 8).toFixed(2);\n              break;\n            case \"yarim\":\n              totalHours = \"4.00\";\n              calculatedWage = (dailyWage / 2).toFixed(2);\n              hourlyRate = (dailyWage / 8).toFixed(2);\n              break;\n            case \"mesai\":\n              const overtimeHours = parseFloat(data.overtimeHours || \"0\");\n              totalHours = overtimeHours.toFixed(2);\n              hourlyRate = (dailyWage / 8).toFixed(2);\n              calculatedWage = (parseFloat(hourlyRate) * overtimeHours).toFixed(2);\n              break;\n          }\n          \n          const timesheetData = {\n            ...data,\n            personnelId,\n            totalHours,\n            hourlyRate,\n            dailyWage: calculatedWage,\n            workType,\n          };\n          \n          const response = await apiRequest(\"/api/timesheets\", \"POST\", timesheetData);\n          return response.json();\n        });\n        \n        const results = await Promise.all(promises);\n        return results.filter(r => r !== null);\n      }\n    },\n    onSuccess: (results) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timesheets\"] });\n      const count = editingTimesheet ? 1 : selectedPersonnelIds.length;\n      toast({\n        title: \"Başarılı\",\n        description: editingTimesheet \n          ? \"Puantaj kaydı güncellendi.\" \n          : `${count} personel için puantaj kaydı oluşturuldu.`,\n      });\n      form.reset();\n      setSelectedPersonnelIds([]);\n      setWorkType(\"tam\");\n      onOpenChange(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Hata\",\n        description: editingTimesheet ? \"Puantaj kaydı güncellenemedi.\" : \"Puantaj kayıtları oluşturulamadı.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertTimesheet) => {\n    // Düzenleme modunda validation\n    if (editingTimesheet) {\n      createTimesheetMutation.mutate(data);\n      return;\n    }\n    \n    // Yeni kayıt modunda multi-selection validation\n    if (selectedPersonnelIds.length === 0) {\n      toast({\n        title: \"Uyarı\",\n        description: \"Lütfen en az bir personel seçin.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!workType) {\n      toast({\n        title: \"Uyarı\", \n        description: \"Lütfen çalışma şekli seçin.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    console.log(\"Submitting timesheet data for personnel:\", selectedPersonnelIds);\n    createTimesheetMutation.mutate(data);\n  };\n  \n  const togglePersonnelSelection = (personnelId: string) => {\n    setSelectedPersonnelIds(prev => {\n      if (prev.includes(personnelId)) {\n        return prev.filter(id => id !== personnelId);\n      } else {\n        return [...prev, personnelId];\n      }\n    });\n  };\n  \n  const removePersonnel = (personnelId: string) => {\n    setSelectedPersonnelIds(prev => prev.filter(id => id !== personnelId));\n  };\n  \n  const selectedPersonnelList = personnel.filter(p => selectedPersonnelIds.includes(p.id));\n\n  return (\n    <Dialog \n      open={open} \n      onOpenChange={(isOpen) => {\n        if (isOpen) {\n          handleDialogOpen();\n        }\n        onOpenChange(isOpen);\n      }}\n    >\n      <DialogContent className=\"bg-dark-secondary border-dark-accent text-white max-w-md max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl font-semibold\">\n            {editingTimesheet ? \"Puantaj Düzenle\" : \"Puantaj Yaz\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            {!editingTimesheet && (\n              <div className=\"space-y-3\">\n                <FormLabel className=\"text-gray-300\">Personel Seç</FormLabel>\n                \n                {/* Seçili Personeller */}\n                {selectedPersonnelList.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <div className=\"text-sm text-gray-400\">Seçili Personeller:</div>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {selectedPersonnelList.map((person) => (\n                        <Badge\n                          key={person.id}\n                          variant=\"secondary\"\n                          className=\"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-1\"\n                        >\n                          {person.name}\n                          <X \n                            className=\"h-3 w-3 cursor-pointer\" \n                            onClick={() => removePersonnel(person.id)}\n                          />\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                \n                {/* Personel Listesi */}\n                <div className=\"space-y-1\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    className=\"w-full justify-start bg-dark-primary border-dark-accent text-white hover:bg-dark-accent\"\n                    onClick={() => setShowPersonnelDropdown(!showPersonnelDropdown)}\n                  >\n                    {selectedPersonnelIds.length > 0 \n                      ? `${selectedPersonnelIds.length} personel seçildi` \n                      : \"Personel seçin\"}\n                  </Button>\n                  \n                  {showPersonnelDropdown && (\n                    <ScrollArea className=\"h-40 w-full border border-dark-accent rounded-md bg-dark-primary\">\n                      <div className=\"p-2 space-y-1\">\n                        {personnel.map((person) => (\n                          <div\n                            key={person.id}\n                            className=\"flex items-center space-x-2 cursor-pointer hover:bg-dark-accent p-2 rounded\"\n                            onClick={() => togglePersonnelSelection(person.id)}\n                          >\n                            <Checkbox\n                              checked={selectedPersonnelIds.includes(person.id)}\n                              onCheckedChange={() => togglePersonnelSelection(person.id)}\n                              className=\"border-gray-400\"\n                            />\n                            <span className=\"text-white text-sm\">{person.name}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  )}\n                </div>\n              </div>\n            )}\n            \n            {editingTimesheet && (\n              <FormField\n                control={form.control}\n                name=\"personnelId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Personel</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                          <SelectValue placeholder=\"Personel seçin\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                        {personnel.map((person) => (\n                          <SelectItem key={person.id} value={person.id} className=\"text-white\">\n                            {person.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            )}\n\n            <FormField\n              control={form.control}\n              name=\"customerId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Müşteri Seç</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value || \"\"}>\n                    <FormControl>\n                      <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                        <SelectValue placeholder=\"Müşteri seçin\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                      {customers.map((customer) => (\n                        <SelectItem key={customer.id} value={customer.id} className=\"text-white\">\n                          {customer.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {!editingTimesheet && (\n              <div className=\"space-y-2\">\n                <FormLabel className=\"text-gray-300\">Çalışma Şekli</FormLabel>\n                <Select onValueChange={setWorkType} value={workType}>\n                  <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                    <SelectValue placeholder=\"Çalışma şekli seçin\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                    <SelectItem value=\"tam\" className=\"text-white\">TAM GÜN</SelectItem>\n                    <SelectItem value=\"yarim\" className=\"text-white\">YARIM GÜN</SelectItem>\n                    <SelectItem value=\"mesai\" className=\"text-white\">MESAİ</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            {editingTimesheet && (\n              <FormField\n                control={form.control}\n                name=\"workType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Çalışma Şekli</FormLabel>\n                    <Select onValueChange={(value) => {\n                      field.onChange(value);\n                      setWorkType(value);\n                    }} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger className=\"bg-dark-primary border-dark-accent text-white\">\n                          <SelectValue placeholder=\"Çalışma şekli seçin\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent className=\"bg-dark-primary border-dark-accent\">\n                        <SelectItem value=\"tam\" className=\"text-white\">TAM GÜN</SelectItem>\n                        <SelectItem value=\"yarim\" className=\"text-white\">YARIM GÜN</SelectItem>\n                        <SelectItem value=\"mesai\" className=\"text-white\">MESAİ</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            )}\n\n            <FormField\n              control={form.control}\n              name=\"date\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Tarih</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"date\"\n                      className=\"bg-dark-primary border-dark-accent text-white\"\n                      value={field.value instanceof Date ? field.value.toISOString().split('T')[0] : field.value}\n                      onChange={(e) => field.onChange(new Date(e.target.value))}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {/* Mesai Saati Girişi */}\n            {workType === \"mesai\" && (\n              <FormField\n                control={form.control}\n                name=\"overtimeHours\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-300\">Mesai Saati</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        step=\"0.5\"\n                        min=\"0\"\n                        max=\"12\"\n                        className=\"bg-dark-primary border-dark-accent text-white\"\n                        placeholder=\"Mesai saati giriniz...\"\n                        value={field.value || \"\"}\n                        onChange={field.onChange}\n                        onBlur={field.onBlur}\n                        name={field.name}\n                        ref={field.ref}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            )}\n\n            {/* Ücret Bilgileri - Multi-selection Preview */}\n            {!editingTimesheet && selectedPersonnelIds.length > 0 && workType && (\n              <div className=\"bg-dark-accent p-4 rounded-lg space-y-2\">\n                <h4 className=\"text-white font-medium\">Ücret Önizlemesi ({selectedPersonnelIds.length} personel)</h4>\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-gray-400\">Çalışma Şekli:</span>\n                    <p className=\"text-white\">\n                      {workType === \"tam\" ? \"Tam Gün (8h)\" : workType === \"yarim\" ? \"Yarım Gün (4h)\" : `Mesai (${form.watch(\"overtimeHours\") || 0}h)`}\n                    </p>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-400\">Toplam Personel:</span>\n                    <p className=\"text-blue-400\">{selectedPersonnelIds.length} kişi</p>\n                  </div>\n                </div>\n                <div className=\"text-xs text-gray-400 mt-2\">\n                  * Her personelin kendi maaşına göre ücret hesaplanacak\n                </div>\n              </div>\n            )}\n\n            {/* Ücret Bilgileri - Edit Mode */}\n            {editingTimesheet && workType && (\n              <div className=\"bg-dark-accent p-4 rounded-lg space-y-2\">\n                <h4 className=\"text-white font-medium\">Ücret Bilgileri</h4>\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-gray-400\">Çalışma Saati:</span>\n                    <p className=\"text-white\">\n                      {workType === \"mesai\" ? `${form.watch(\"overtimeHours\") || 0}h (Mesai)` : `${form.watch(\"totalHours\")}h`}\n                    </p>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-400\">Saatlik Ücret:</span>\n                    <p className=\"text-blue-400\">{parseFloat(form.watch(\"hourlyRate\") || \"0\").toLocaleString('tr-TR')} TL</p>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-400\">Günlük Ücret:</span>\n                    <p className=\"text-green-400\">{parseFloat(form.watch(\"dailyWage\") || \"0\").toLocaleString('tr-TR')} TL</p>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-400\">Çalışma Şekli:</span>\n                    <p className=\"text-white\">\n                      {workType === \"tam\" ? \"Tam Gün\" : workType === \"yarim\" ? \"Yarım Gün\" : \"Mesai\"}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <FormField\n              control={form.control}\n              name=\"notes\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-gray-300\">Not</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      className=\"bg-dark-primary border-dark-accent text-white h-20\"\n                      placeholder=\"Ek bilgiler...\"\n                      value={field.value || \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex gap-3\">\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white\"\n                onClick={() => onOpenChange(false)}\n              >\n                İptal\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"flex-1 bg-blue-500 hover:bg-blue-600 text-white\"\n                disabled={createTimesheetMutation.isPending}\n              >\n                {createTimesheetMutation.isPending ? \"Kaydediliyor...\" : \"Kaydet\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":22012},"client/src/pages/admin/announcements.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { \n  ArrowLeft, Megaphone, Plus, Edit2, Trash2, Eye,\n  Calendar, User, AlertCircle, Send, Save\n} from \"lucide-react\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Dialog, \n  DialogContent, \n  DialogHeader, \n  DialogTitle, \n  DialogTrigger \n} from \"@/components/ui/dialog\";\nimport { \n  Select, \n  SelectContent, \n  SelectItem, \n  SelectTrigger, \n  SelectValue \n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function AdminAnnouncements() {\n  const [, setLocation] = useLocation();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newAnnouncement, setNewAnnouncement] = useState({\n    title: \"\",\n    content: \"\",\n    priority: \"normal\",\n  });\n  const { toast } = useToast();\n\n  // Fetch announcements\n  const { data: announcements, isLoading } = useQuery({\n    queryKey: [\"/api/admin/announcements\"],\n  });\n\n  // Create announcement\n  const createMutation = useMutation({\n    mutationFn: async (announcement: any) => {\n      return await apiRequest(\"/api/admin/announcements\", \"POST\", announcement);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/announcements\"] });\n      setIsCreateOpen(false);\n      setNewAnnouncement({ title: \"\", content: \"\", priority: \"normal\" });\n      toast({\n        title: \"Başarılı\",\n        description: \"Duyuru oluşturuldu.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Duyuru oluşturulurken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete announcement\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(`/api/admin/announcements/${id}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/announcements\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Duyuru silindi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message || \"Duyuru silinirken hata oluştu.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreate = () => {\n    if (!newAnnouncement.title.trim() || !newAnnouncement.content.trim()) {\n      toast({\n        title: \"Hata\",\n        description: \"Başlık ve içerik gereklidir.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createMutation.mutate(newAnnouncement);\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case \"high\":\n        return \"text-red-400 border-red-400\";\n      case \"medium\":\n        return \"text-yellow-400 border-yellow-400\";\n      default:\n        return \"text-blue-400 border-blue-400\";\n    }\n  };\n\n  const getPriorityIcon = (priority: string) => {\n    switch (priority) {\n      case \"high\":\n        return <AlertCircle className=\"h-4 w-4\" />;\n      case \"medium\":\n        return <Eye className=\"h-4 w-4\" />;\n      default:\n        return <Megaphone className=\"h-4 w-4\" />;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"text-center\">\n              <Megaphone className=\"h-12 w-12 text-purple-400 mx-auto mb-4 animate-spin\" />\n              <p className=\"text-gray-400\">Duyurular yükleniyor...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-gray-400 hover:text-white\"\n              onClick={() => setLocation(\"/admin\")}\n            >\n              <ArrowLeft className=\"h-6 w-6\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <Megaphone className=\"h-8 w-8 text-yellow-400\" />\n              <div>\n                <h1 className=\"text-2xl font-bold text-white\">Duyurular</h1>\n                <p className=\"text-gray-400\">Sistem duyurularını yönet</p>\n              </div>\n            </div>\n          </div>\n          \n          <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"bg-yellow-600 hover:bg-yellow-700\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Yeni Duyuru\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"bg-dark-secondary border-dark-accent\">\n              <DialogHeader>\n                <DialogTitle className=\"text-white\">Yeni Duyuru Oluştur</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\" className=\"text-gray-300\">Başlık</Label>\n                  <Input\n                    id=\"title\"\n                    value={newAnnouncement.title}\n                    onChange={(e) => setNewAnnouncement(prev => ({\n                      ...prev,\n                      title: e.target.value\n                    }))}\n                    className=\"bg-dark-primary border-gray-600 text-white\"\n                    placeholder=\"Duyuru başlığı\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"content\" className=\"text-gray-300\">İçerik</Label>\n                  <Textarea\n                    id=\"content\"\n                    value={newAnnouncement.content}\n                    onChange={(e) => setNewAnnouncement(prev => ({\n                      ...prev,\n                      content: e.target.value\n                    }))}\n                    className=\"bg-dark-primary border-gray-600 text-white min-h-32\"\n                    placeholder=\"Duyuru içeriği\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"priority\" className=\"text-gray-300\">Öncelik</Label>\n                  <Select\n                    value={newAnnouncement.priority}\n                    onValueChange={(value) => setNewAnnouncement(prev => ({\n                      ...prev,\n                      priority: value\n                    }))}\n                  >\n                    <SelectTrigger className=\"bg-dark-primary border-gray-600 text-white\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-dark-accent border-gray-600\">\n                      <SelectItem value=\"normal\">Normal</SelectItem>\n                      <SelectItem value=\"medium\">Orta</SelectItem>\n                      <SelectItem value=\"high\">Yüksek</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div className=\"flex gap-2 pt-4\">\n                  <Button\n                    onClick={() => setIsCreateOpen(false)}\n                    variant=\"outline\"\n                    className=\"flex-1 border-gray-600 text-gray-300\"\n                  >\n                    İptal\n                  </Button>\n                  <Button\n                    onClick={handleCreate}\n                    disabled={createMutation.isPending}\n                    className=\"flex-1 bg-yellow-600 hover:bg-yellow-700\"\n                  >\n                    <Save className=\"h-4 w-4 mr-2\" />\n                    {createMutation.isPending ? \"Kaydediliyor...\" : \"Kaydet\"}\n                  </Button>\n                </div>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {/* Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Toplam Duyuru</p>\n                  <p className=\"text-2xl font-bold text-white\">{announcements?.length || 0}</p>\n                </div>\n                <Megaphone className=\"h-8 w-8 text-yellow-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Yüksek Öncelik</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {announcements?.filter((a: any) => a.priority === \"high\").length || 0}\n                  </p>\n                </div>\n                <AlertCircle className=\"h-8 w-8 text-red-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Bu Hafta</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {announcements?.filter((a: any) => {\n                      const weekAgo = new Date();\n                      weekAgo.setDate(weekAgo.getDate() - 7);\n                      return new Date(a.createdAt) >= weekAgo;\n                    }).length || 0}\n                  </p>\n                </div>\n                <Calendar className=\"h-8 w-8 text-green-400\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Announcements List */}\n        <Card className=\"bg-dark-secondary border-dark-accent\">\n          <CardHeader>\n            <CardTitle className=\"text-white\">Duyuru Listesi</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow className=\"border-gray-600\">\n                  <TableHead className=\"text-gray-300\">Başlık</TableHead>\n                  <TableHead className=\"text-gray-300\">Öncelik</TableHead>\n                  <TableHead className=\"text-gray-300\">Oluşturma Tarihi</TableHead>\n                  <TableHead className=\"text-gray-300\">İşlemler</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {announcements?.map((announcement: any) => (\n                  <TableRow key={announcement.id} className=\"border-gray-600\">\n                    <TableCell>\n                      <div>\n                        <p className=\"text-white font-medium\">{announcement.title}</p>\n                        <p className=\"text-gray-400 text-sm line-clamp-2\">\n                          {announcement.content}\n                        </p>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge \n                        variant=\"outline\" \n                        className={getPriorityColor(announcement.priority)}\n                      >\n                        {getPriorityIcon(announcement.priority)}\n                        <span className=\"ml-1\">\n                          {announcement.priority === \"high\" \n                            ? \"Yüksek\" \n                            : announcement.priority === \"medium\" \n                              ? \"Orta\" \n                              : \"Normal\"}\n                        </span>\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-gray-300\">\n                        <Calendar className=\"h-4 w-4\" />\n                        {new Date(announcement.createdAt).toLocaleDateString('tr-TR')}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Button variant=\"ghost\" size=\"sm\">\n                          <Edit2 className=\"h-4 w-4\" />\n                        </Button>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={() => deleteMutation.mutate(announcement.id)}\n                          disabled={deleteMutation.isPending}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":13742},"client/src/pages/admin/logs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { \n  ArrowLeft, FileText, Filter, Download, RefreshCw,\n  Calendar, User, Activity, AlertTriangle, Info, CheckCircle\n} from \"lucide-react\";\nimport Header from \"@/components/layout/header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  Select, \n  SelectContent, \n  SelectItem, \n  SelectTrigger, \n  SelectValue \n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { queryClient } from \"@/lib/queryClient\";\n\nexport default function AdminLogs() {\n  const [, setLocation] = useLocation();\n  const [filterAction, setFilterAction] = useState<string>(\"all\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  // Fetch admin logs\n  const { data: logs, isLoading } = useQuery({\n    queryKey: [\"/api/admin/logs\"],\n  });\n\n  const filteredLogs = logs?.filter((log: any) => {\n    const matchesFilter = filterAction === \"all\" || log.action === filterAction;\n    const matchesSearch = \n      log.action.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      log.details?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      log.userId.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    return matchesFilter && matchesSearch;\n  }) || [];\n\n  const getLogTypeColor = (action: string) => {\n    switch (action) {\n      case \"login\":\n      case \"logout\":\n        return \"text-blue-400 border-blue-400\";\n      case \"create\":\n      case \"update\":\n        return \"text-green-400 border-green-400\";\n      case \"delete\":\n        return \"text-red-400 border-red-400\";\n      case \"view\":\n        return \"text-gray-400 border-gray-400\";\n      default:\n        return \"text-yellow-400 border-yellow-400\";\n    }\n  };\n\n  const getLogTypeIcon = (action: string) => {\n    switch (action) {\n      case \"login\":\n      case \"logout\":\n        return <User className=\"h-4 w-4\" />;\n      case \"create\":\n      case \"update\":\n        return <CheckCircle className=\"h-4 w-4\" />;\n      case \"delete\":\n        return <AlertTriangle className=\"h-4 w-4\" />;\n      case \"view\":\n        return <Info className=\"h-4 w-4\" />;\n      default:\n        return <Activity className=\"h-4 w-4\" />;\n    }\n  };\n\n  const handleRefresh = () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/admin/logs\"] });\n  };\n\n  const handleExport = () => {\n    const csvContent = [\n      [\"Tarih\", \"Kullanıcı\", \"İşlem\", \"Detaylar\"],\n      ...filteredLogs.map((log: any) => [\n        new Date(log.createdAt).toLocaleString('tr-TR'),\n        log.userId,\n        log.action,\n        log.details || \"\"\n      ])\n    ]\n      .map(row => row.map(field => `\"${field}\"`).join(\",\"))\n      .join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n    const link = document.createElement(\"a\");\n    const url = URL.createObjectURL(blob);\n    link.setAttribute(\"href\", url);\n    link.setAttribute(\"download\", `admin_logs_${new Date().toISOString().split('T')[0]}.csv`);\n    link.style.visibility = \"hidden\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-dark-primary\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"text-center\">\n              <FileText className=\"h-12 w-12 text-purple-400 mx-auto mb-4 animate-spin\" />\n              <p className=\"text-gray-400\">Admin logları yükleniyor...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const stats = {\n    total: logs?.length || 0,\n    today: logs?.filter((log: any) => {\n      const today = new Date();\n      const logDate = new Date(log.createdAt);\n      return logDate.toDateString() === today.toDateString();\n    }).length || 0,\n    errors: logs?.filter((log: any) => log.action === \"error\").length || 0,\n    users: new Set(logs?.map((log: any) => log.userId)).size || 0,\n  };\n\n  return (\n    <div className=\"min-h-screen bg-dark-primary\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-gray-400 hover:text-white\"\n              onClick={() => setLocation(\"/admin\")}\n            >\n              <ArrowLeft className=\"h-6 w-6\" />\n            </Button>\n            <div className=\"flex items-center gap-3\">\n              <FileText className=\"h-8 w-8 text-indigo-400\" />\n              <div>\n                <h1 className=\"text-2xl font-bold text-white\">Admin Logları</h1>\n                <p className=\"text-gray-400\">Sistem aktivitelerini izle</p>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"border-gray-600 text-gray-300\"\n              onClick={handleRefresh}\n            >\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Yenile\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"border-gray-600 text-gray-300\"\n              onClick={handleExport}\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Dışa Aktar\n            </Button>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Toplam Log</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.total}</p>\n                </div>\n                <FileText className=\"h-8 w-8 text-indigo-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Bugün</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.today}</p>\n                </div>\n                <Calendar className=\"h-8 w-8 text-green-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Hatalar</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.errors}</p>\n                </div>\n                <AlertTriangle className=\"h-8 w-8 text-red-400\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-dark-secondary border-dark-accent\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Aktif Kullanıcılar</p>\n                  <p className=\"text-2xl font-bold text-white\">{stats.users}</p>\n                </div>\n                <User className=\"h-8 w-8 text-blue-400\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Filters */}\n        <Card className=\"bg-dark-secondary border-dark-accent mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"relative flex-1\">\n                <Input\n                  placeholder=\"Log ara (işlem, kullanıcı, detay)...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"bg-dark-primary border-gray-600 text-white\"\n                />\n              </div>\n              <Select value={filterAction} onValueChange={setFilterAction}>\n                <SelectTrigger className=\"w-48 bg-dark-primary border-gray-600 text-white\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent className=\"bg-dark-accent border-gray-600\">\n                  <SelectItem value=\"all\">Tüm İşlemler</SelectItem>\n                  <SelectItem value=\"login\">Giriş</SelectItem>\n                  <SelectItem value=\"logout\">Çıkış</SelectItem>\n                  <SelectItem value=\"create\">Oluşturma</SelectItem>\n                  <SelectItem value=\"update\">Güncelleme</SelectItem>\n                  <SelectItem value=\"delete\">Silme</SelectItem>\n                  <SelectItem value=\"view\">Görüntüleme</SelectItem>\n                  <SelectItem value=\"error\">Hatalar</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Logs Table */}\n        <Card className=\"bg-dark-secondary border-dark-accent\">\n          <CardHeader>\n            <CardTitle className=\"text-white\">\n              Sistem Logları ({filteredLogs.length})\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow className=\"border-gray-600\">\n                  <TableHead className=\"text-gray-300\">Tarih & Saat</TableHead>\n                  <TableHead className=\"text-gray-300\">Kullanıcı</TableHead>\n                  <TableHead className=\"text-gray-300\">İşlem</TableHead>\n                  <TableHead className=\"text-gray-300\">Detaylar</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredLogs.map((log: any) => (\n                  <TableRow key={log.id} className=\"border-gray-600\">\n                    <TableCell>\n                      <div className=\"flex items-center gap-2 text-gray-300\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>\n                          {new Date(log.createdAt).toLocaleDateString('tr-TR')}\n                          <br />\n                          <small className=\"text-gray-400\">\n                            {new Date(log.createdAt).toLocaleTimeString('tr-TR')}\n                          </small>\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center text-white text-sm font-semibold\">\n                          {log.userId.slice(0, 2).toUpperCase()}\n                        </div>\n                        <span className=\"text-white\">{log.userId.slice(0, 8)}...</span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge \n                        variant=\"outline\" \n                        className={getLogTypeColor(log.action)}\n                      >\n                        {getLogTypeIcon(log.action)}\n                        <span className=\"ml-1 capitalize\">{log.action}</span>\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <p className=\"text-gray-300 text-sm\">\n                        {log.details || \"Detay yok\"}\n                      </p>\n                    </TableCell>\n                  </TableRow>\n                ))}\n                {filteredLogs.length === 0 && (\n                  <TableRow>\n                    <TableCell colSpan={4} className=\"text-center py-8\">\n                      <div className=\"text-gray-400\">\n                        <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                        <p>Gösterilecek log kaydı bulunamadı.</p>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":12739}}}